//>>built
define("dgrid/extensions/ColumnResizer",["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){var _a=_7("touch")&&webkitConvertPointFromNodeToPage;function _b(_c,_d,_e,_f,id){for(var i=1;i<_d;i++){_c[_e+i][_f]=id;}};function _10(_11){var i=_11.length,l=i,_12=_11[0].length,_13=new Array(i);while(i--){_13[i]=new Array(_12);}var _14={};for(i=0;i<l;i++){var row=_13[i],_15=_11[i];for(var j=0,js=0;j<_12;j++){var _16=_15[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=_16.id;if(_16.rowSpan&&_16.rowSpan>1){_b(_13,_16.rowSpan,i,j,_16.id);}if(i>0&&_16.colSpan&&_16.colSpan>1){for(k=1;k<_16.colSpan;k++){row[++j]=_16.id;if(_16.rowSpan&&_16.rowSpan>1){_b(_13,_16.rowSpan,i,j,_16.id);}}}_14[_16.id]=_11[0][j].id;js++;}}return _14;};return _1(null,{resizeNode:null,minWidth:40,gridWidth:null,_resizedColumns:false,resizeColumnWidth:function(_17,_18){if(_18<=0){return;}var old=this._columnStyles[_17],x=this.styleColumn(_17,"width: "+_18+"px;");old&&old.remove();this._columnStyles[_17]=x;},configStructure:function(){this._resizedColumns=false;for(var _19 in this._columnStyles){this._columnStyles[_19].remove();}this._columnStyles={};this.inherited(arguments);},renderHeader:function(){this.inherited(arguments);var _1a=this;_1a.gridWidth=_1a.headerNode.clientWidth-1;var _1b;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){_1b=_4.mixin(_1b||{},_10(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){_1b=_10(this.subRows);}}var _1c=_3(".dgrid-cell",_1a.headerNode),i=_1c.length;while(i--){var _1d=_1c[i],id=_1d.columnId,col=_1a.columns[id],_1e=_1d.childNodes;if(!col){continue;}var _1f=_9("div.dgrid-resize-header-container");_1d.contents=_1f;while(_1e.length>0){_9(_1f,_1e[0]);}_9(_1d,_1f,"div.dgrid-resize-handle.resizeNode-"+id).columnId=_1b?_1b[id]:id;}if(!_1a.mouseMoveListen){_2(_1a.headerNode,".dgrid-resize-handle:mousedown"+(_7("touch")?",.dgrid-resize-handle:touchstart":""),function(e){_1a._resizeMouseDown(e,this);_1a.mouseMoveListen.resume();_1a.mouseUpListen.resume();});_1a.mouseMoveListen=_2.pausable(document.body,"mousemove"+(_7("touch")?",touchmove":""),_8.throttleDelayed(function(e){_1a._updateResizerPosition(e);}));_1a.mouseUpListen=_2.pausable(document.body,"mouseup"+(_7("touch")?",touchend":""),function(e){_1a._resizeMouseUp(e);_1a.mouseMoveListen.pause();_1a.mouseUpListen.pause();});_1a.mouseMoveListen.pause();_1a.mouseUpListen.pause();}},_resizeMouseDown:function(e,_20){e.preventDefault();_5.setSelectable(this.domNode,false);var _21=this;_21._startX=_21._getResizeMouseLocation(e);_21._gridX=_a?webkitConvertPointFromNodeToPage(_21.bodyNode,new WebKitPoint(0,0)).x:_6.position(_21.bodyNode).x;_21._targetCell=_3(".dgrid-column-"+_20.columnId,_21.headerNode)[0];if(!_21._resizer){_21._resizer=_9(_21.domNode,"div.dgrid-column-resizer");}_21._resizer.style.display="block";_21._updateResizerPosition(e);},_resizeMouseUp:function(e){this._readyToResize=false;if(!this._resizedColumns){var _22=_3(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_22=_22.filter(function(_23){var idx=_23.columnId.split("-");return idx[0]=="0";});}else{if(this.subRows&&this.subRows.length>1){_22=_22.filter(function(_24){return _24.columnId.charAt(0)=="0";});}}var _25=_22.map(function(_26){return _26.offsetWidth;});_22.forEach(function(_27,i){this.resizeColumnWidth(_27.columnId,_25[i]);},this);this._resizedColumns=true;}_5.setSelectable(this.domNode,true);var _28=this._targetCell,_29=this._getResizeMouseLocation(e)-this._startX,_2a=_28.offsetWidth+_29,obj=this._getResizedColumnWidths(),_2b=obj.totalWidth,_2c=obj.lastColId,_2d=_3(".dgrid-column-"+_2c,this.headerNode)[0].offsetWidth;if(_28.columnId!=_2c){if(_2b+_29<this.gridWidth){this.styleColumn(_2c,"width: auto;");}else{if(_2d-_29<=this.minWidth){this.resizeColumnWidth(_2c,this.minWidth);}}}if(_2a<this.minWidth){_2a=this.minWidth;}this.resizeColumnWidth(_28.columnId,_2a);this.resize();this._hideResizer();},_updateResizerPosition:function(e){var _2e=this._getResizeMouseLocation(e),_2f=_2e-this._startX,_30=this._targetCell,_31=_2e-this._gridX;if(_30.offsetWidth+_2f<this.minWidth){_31=this._startX-this._gridX-(_30.offsetWidth-this.minWidth);}this._resizer.style.left=_31+"px";},_hideResizer:function(){this._resizer.style.display="none";},_getResizeMouseLocation:function(e){var _32=0;if(e.pageX){_32=e.pageX;}else{if(e.clientX){_32=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return _32;},_getResizedColumnWidths:function(){var _33=0,_34=_3(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_34=_34.filter(function(_35){var idx=_35.columnId.split("-");return idx[1]=="0";});}else{if(this.subRows&&this.subRows.length>1){_34=_34.filter(function(_36){return _36.columnId.charAt(0)=="0";});}}var i=_34.length;if(!i){return {};}var _37=_34[i-1].columnId;while(i--){_33+=_34[i].offsetWidth;}return {totalWidth:_33,lastColId:_37};}});});