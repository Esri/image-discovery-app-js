//>>built
define("esriviewer/portal/PortalSupport",["dojo/_base/declare","dojo/topic","dojo/_base/connect","dojo/_base/lang","esri/arcgis/Portal","../base/ConfigurationEntryMixin","./PortalSearcher","../base/DataLoaderSupport","esri/dijit/Basemap","esri/dijit/BasemapLayer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1([_6,_8],{constructor:function(){this.portalConfiguration=null;this.loadViewerConfigurationData();if(this.portalConfiguration!=null&&_4.isObject(this.portalConfiguration)&&this.portalConfiguration.url!=null&&this.portalConfiguration.url!=""){this.initPortal();}else{VIEWER_UTILS.log("Portal Configuration not found",VIEWER_GLOBALS.LOG_TYPE.ERROR);_2.publish(VIEWER_GLOBALS.EVENTS.PORTAL.INITIALIZED);}},initPortal:function(){this.portal=new _5.Portal(this.portalConfiguration.url);_3.connect(this.portal,"onLoad",_4.hitch(this,this._handlePortalLoaded));},_handlePortalLoaded:function(_b){this._createPortalSearcher();this.initListeners();_2.publish(VIEWER_GLOBALS.EVENTS.PORTAL.INITIALIZED);},initListeners:function(){_2.subscribe(VIEWER_GLOBALS.EVENTS.PORTAL.GET_INSTANCE,_4.hitch(this,this.handleGetPortalInstance));_2.subscribe(VIEWER_GLOBALS.EVENTS.PORTAL.LOG_IN,_4.hitch(this,this.handlePortalLogIn));_2.subscribe(VIEWER_GLOBALS.EVENTS.PORTAL.LOG_OUT,_4.hitch(this,this.handlePortalLogOut));_2.subscribe(VIEWER_GLOBALS.EVENTS.PORTAL.IS_USER_LOGGED_IN,_4.hitch(this,this.handleIsUserLoggedIn));_2.subscribe(VIEWER_GLOBALS.EVENTS.PORTAL.GET_BASEMAPS,_4.hitch(this,this.getBasemaps));},getBasemaps:function(_c){if(_c!=null&&_4.isFunction(_c)){var _d=this;var _e=[];if(this.portal&&this.portal.basemapGalleryGroupQuery){var _f=this.portal.basemapGalleryGroupQuery.replace("id:","group:");_2.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_WEBMAPS,_f,null,null,null,function(_10){if(_10&&_10.results){var _11;var _12={f:"json"};for(var i=0;i<_10.results.length;i++){_11=_10.results[i];_d.loadJsonP(_11.itemDataUrl,_12,_4.partial(function(_13,_14){var _15=[];for(var j=0;j<_14.baseMap.baseMapLayers.length;j++){var _16=new _a({url:_14.baseMap.baseMapLayers[j].url});_15.push(_16);}var _17=new _9({thumbnailUrl:_13.thumbnailUrl,title:_13.title,layers:_15});_e.push(_17);if(_e.length==_10.results.length){_c(_e);}},_11));}}});}}},handleIsUserLoggedIn:function(_18){if(_18!=null&&_4.isFunction(_18)){_18(this.portal&&this.portal.getPortalUser()!=null);}},handlePortalLogOut:function(){this.portal.signOut();_2.publish(VIEWER_GLOBALS.EVENTS.PORTAL.USER_LOGGED_OUT);},handlePortalLogIn:function(_19){this.portal.signIn().then(_4.hitch(this,function(_1a){_2.publish(VIEWER_GLOBALS.EVENTS.PORTAL.USER_LOGGED_IN,_1a);if(_19!=null&&_4.isFunction(_19)){_19(_1a);}}));},loadViewerConfigurationData:function(){var _1b;_2.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"portal",function(_1c){_1b=_1c;});this.portalConfiguration=_1b;},handleGetPortalInstance:function(_1d){if(_1d!=null&&_4.isFunction(_1d)){_1d(this.portal);}},_createPortalSearcher:function(){this.portalSearcher=new _7();}});});