//>>built
define("esriviewer/manager/base/WebMapTemplateConfigurationUtil",["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","esri/request","dojo/_base/array","../../base/DataLoaderSupport","esri/arcgis/utils"],function(_1,_2,_3,_4,_5,_6,_7){return _1([_6],{showOverviewParameter:"showOverview",showLegendParameter:"showLegend",showHeaderParameter:"showHeader",headerTextParameter:"headerText",helpLinkParameter:"helpUrl",contactUsParameter:"contactUsUrl",ignoreProcessingConfigurationEntries:["webmap","geometryServiceUrl","locators","baseViewer","showOverview","showLegend"],appConfigToViewerWindowWidgetConfigLookup:{logging:"logging"},appConfigToViewerWidgetConfigLookup:{pointUploadWidget:"pointUploadWidget",drawWidget:"drawWidget",plottingWidget:"plottingWidget",reverseGeocodeWidget:"reverseGeocodeWidget",portalSearchWidget:"portalSearchWidget",reflectivityWidget:"reflectivityWidget",zoomToWidget:"zoomToWidget",timeSliderWidget:"timeSliderWidget",identifyWidget:"identifyWidget",configureWidget:"configureWidget",measureWidget:"measureWidget",socialMediaWidget:"socialMediaWidget",printWidget:"printWidget",weatherWidget:"weatherWidget"},defaultConfigFile:"config/portal/config.json",constructor:function(){this.init();},init:function(){},loadConfiguration:function(_8){this.appId=_8;this.deferred=new _3();this._loadDefaultConfiguration();return this.deferred.promise;},_loadDefaultConfiguration:function(){this.loadJson(this.defaultConfigFile,_2.hitch(this,this._handleDefaultConfigurationLoaded),_2.hitch(this,this._handleDefaultConfigurationLoadError));},_loadTemplateConfiguration:function(){var _9=_4({url:_7.arcgisUrl+"/"+this.appId+"/data",content:{f:"json"},callbackParamName:"callback",load:_2.hitch(this,this.handleTemplateResponse),error:_2.hitch(this,this.handleTemplateErrorResponse)},{useProxy:false});},handleTemplateErrorResponse:function(_a){alert("Could not load application data from "+_7.arcgisUrl);},handleTemplateResponse:function(_b){this.templateResponse=_b;this.appConfig={};for(var _c in _b.values){if(_b.values[_c]!==undefined){this.appConfig[_c]=_b.values[_c];}}this._loadWebMapItem(this.appConfig.webmap);},_loadWebMapItem:function(_d){_7.getItem(_d).then(_2.hitch(this,this.handleWebMapItemLoaded));},handleWebMapItemLoaded:function(_e){this.webMapItem=_e;var _f=_2.mixin(this.defaultConfiguration.values,this.appConfig);this.viewerConfiguration=this._applicationConfigurationToViewerConfiguration(_f);this.viewerConfiguration.webMapItem=this.webMapItem;this.handleWebMapConfigurationComplete();},_handleDefaultConfigurationLoaded:function(_10){this.defaultConfiguration=_10;this.portalUrl=this.defaultConfiguration.values.portalConfiguration.url;_7.arcgisUrl=VIEWER_UTILS.joinUrl(this.portalUrl,this.defaultConfiguration.values.portalConfiguration.itemsPath);this._loadTemplateConfiguration();},handleWebMapConfigurationComplete:function(){this.finalizeLoad();},finalizeLoad:function(){this.deferred.resolve(this.viewerConfiguration);},_handleDefaultConfigurationLoadError:function(){alert("Could not load default configuration");},_applicationConfigurationToViewerConfiguration:function(_11){var _12={small:true,display:true,headerText:"Mapping Application",headerImage:"images/logoSmall.png",contact:{label:"Contact Us",url:"http://www.esri.com/about-esri/contact"},help:{label:"Help",url:"http://support.esri.com/en/"}};var _13={webMapItem:_11.webmap,header:_12};for(var key in _11){if(_5.indexOf(this.ignoreProcessingConfigurationEntries,key)>-1){continue;}else{if(key===this.showHeaderParameter){_13.header.display=_11[key];}else{if(key===this.headerTextParameter){_13.header.headerText=_11[key];}else{if(key===this.helpLinkParameter){_13.header.contact.url=_11[key];}else{if(key===this.contactUsParameter){_13.header.help.url=_11[key];}else{if(this.appConfigToViewerWidgetConfigLookup[key]){_13[key]={create:_11[key]};}else{if(this.appConfigToViewerWindowWidgetConfigLookup[key]){_13[key]={window:{create:_11[key]}};}else{_13[key]={create:false};}}}}}}}}this._applyWebMappingApplicationDefaults(_11,_13);return _13;},_applyWebMappingApplicationDefaults:function(_14,_15){var _16=_14[this.showOverviewParameter]!=null&&_14[this.showOverviewParameter];var _17=_14[this.showLegendParameter]!=null&&_14[this.showLegendParameter];_15.map={overview:{create:_16},useBasemapGallery:true,useConfiguredPortalBasemaps:true,legend:{create:_17}};_15.toolsBar={showToolsDropdown:true,showLayersButton:true,showConfigureLocatorsIcon:false,showBookmarksButton:true,showExtentActions:false,display:true};_15.toolsAccordion={create:false};if(this.portalUrl){_15.portal={url:this.portalUrl};}if(_14.geometryServiceUrl){_15.geometryServiceUrl=_14.geometryServiceUrl;}if(_14.locators){_15.locators=_14.locators;}var _18=_15[this.appConfigToViewerWidgetConfigLookup.socialMediaWidget];if(_18){if(_18.create){_18.configurationUrl=this.defaultConfiguration.values.baseViewer.socialMediaWidgetConfiguration.configurationUrl;}}var _19=_15[this.appConfigToViewerWidgetConfigLookup.weatherWidget];if(_19){if(_19.create){_19.configurationUrl=this.defaultConfiguration.values.baseViewer.weatherWidgetConfiguration.configurationUrl;}}var _1a=_15[this.appConfigToViewerWidgetConfigLookup.printWidget];if(_1a){if(_1a.create){_1a.printTaskUrl=this.defaultConfiguration.values.baseViewer.printWidgetConfiguration.printTaskUrl;}}var _1b=_15[this.appConfigToViewerWidgetConfigLookup.zoomToWidget];if(_1b){if(_1b.create){_1b.stateJson=this.defaultConfiguration.values.baseViewer.zoomToWidgetConfiguration.stateJson;_1b.countyJson=this.defaultConfiguration.values.baseViewer.zoomToWidgetConfiguration.countyJson;}}}});});