//>>built
define("esriviewer/manager/base/IdentityManagerMixin",["dojo/_base/declare","esri/IdentityManager","esri/kernel","dojo/_base/lang","dojo/cookie","dojo/topic","dojo/json","dojo/_base/unload"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1([],{forcedUserLogout:false,cred:"esri_jsapi_id_manager_data",constructor:function(){_8.addOnUnload(_4.hitch(this,this._storeCredentials));this._loadCredentials();this._loadIdentityManagerListeners();},_loadIdentityManagerListeners:function(){_6.subscribe(VIEWER_GLOBALS.EVENTS.IDENTITY_MANAGER.GET_TOKEN,_4.hitch(this,this._getToken));_6.subscribe(VIEWER_GLOBALS.EVENTS.PORTAL.USER_LOGGED_OUT,_4.hitch(this,this._clearToken));},_clearToken:function(){if(this._supportsLocalStorage()){window.localStorage.removeItem(this.cred);}else{_5(this.cred,null,{expire:-1});}this.forcedUserLogout=true;},_getToken:function(_9,_a){if(_a!=null&&_4.isFunction(_a)){if(_2.credentials==null||_2.credentials.length<1){_a(null);return;}var _b;var _c;for(var i=0;i<_2.credentials.length;i++){_b=_2.credentials[i];_c=_b.resources;if(_c!=null&&_4.isArray(_c)){for(var j=0;j<_c.length;j++){if(_c[j].indexOf(_9)>-1){_a({username:_b.userId,token:_b.token});}}}}}},_loadCredentials:function(){var _d,_e;if(this._supportsLocalStorage()){_d=window.localStorage.getItem(this.cred);}else{_d=_5(this.cred);}if(_d&&_d!="null"&&_d.length>4){_e=_7.parse(_d);_3.id.initialize(_e);}else{}},_storeCredentials:function(){if(this.forcedUserLogout){return;}if(_3.id.credentials.length===0){return;}var _f=_7.stringify(_3.id.toJson());if(this._supportsLocalStorage()){window.localStorage.setItem(this.cred,_f);}else{_5(cred,_f,{expires:1});}},_supportsLocalStorage:function(){try{return "localStorage" in window&&window["localStorage"]!==null;}catch(e){return false;}}});});