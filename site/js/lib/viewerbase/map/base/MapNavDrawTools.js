//>>built
define("esriviewer/map/base/MapNavDrawTools",["dojo/_base/declare","dojo/topic","dojo/_base/connect","dojo/_base/lang","dojox/timing","dojo/_base/Color","esri/toolbars/draw","esri/graphic","esri/geometry/Point","esri/geometry/Polyline","esri/geometry/Polygon","esri/geometry/Extent","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _1([],{CROSSHAIR:"crosshair",DEFAULT:"default",MOVE:"move",POINTER:"pointer",currentGraphicFlashCount:0,maxGraphicFlashCount:3,currentFlashGraphicVisible:false,constructor:function(_f){_4.mixin(this,_f);this.initListeners();this.createDrawToolbar();},createDrawToolbar:function(){this.drawToolbar=new _7(this.map,{showTooltips:true});},initListeners:function(){_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.FLASH.POINT,_4.hitch(this,this.flashPoint));_2.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.DRAW_CANCEL,_4.hitch(this,this.handleDrawCancel));_2.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.RECTANGLE_INPUT,_4.hitch(this,this.handleUserRectangleDrawInput));_2.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.POLYLINE_INPUT,_4.hitch(this,this.handleUserPolyLineDrawInput));_2.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.LINE_INPUT,_4.hitch(this,this.handleUserLineDrawInput));_2.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.POINT_INPUT,_4.hitch(this,this.handleUserPointClickInput));_2.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.POLYGON_INPUT,_4.hitch(this,this.handleUserPolygonClickInput));_2.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.FREEHAND_POLYLINE_INPUT,_4.hitch(this,this.handleUserFreehandLineDrawInput));_2.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.FREEHAND_POLYGON_INPUT,_4.hitch(this,this.handleUserFreehandPolygonDrawInput));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.GRAPHICS.ADD,_4.hitch(this,this.handleAddGraphic));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.GRAPHICS.REMOVE,_4.hitch(this,this.removeGraphic));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.GRAPHICS.CENTER_AND_FLASH,_4.hitch(this,this.handleCenterAndFlashGraphic));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.GRAPHICS.CENTER_ON_MAP,_4.hitch(this,this.centerMapAtGraphic));},handleAddGraphic:function(_10){if(this.map&&this.map.graphics){this.map.graphics.add(_10);}},removeGraphic:function(_11){if(this.map&&this.map.graphics){this.map.graphics.remove(_11);}},handleDrawCancel:function(){this.drawToolbar.deactivate();if(this._drawEventHandle){_3.disconnect(this._drawEventHandle);this._drawEventHandle=null;_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.DRAW_CANCELLED);}this.map.enableMapNavigation();this.map.setMapCursor(this.DEFAULT);},handleUserRectangleDrawInput:function(_12,_13){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.ACTIONS.TOOL_CHANGED,VIEWER_GLOBALS.EVENTS.TOOLS.DRAW_RECTANGLE);this._userRectangleDrawInput(_12,_13);},handleUserLineDrawInput:function(_14,_15){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.ACTIONS.TOOL_CHANGED,VIEWER_GLOBALS.EVENTS.TOOLS.DRAW_LINE);this._userLineDrawInput(_14,_15);},handleUserPolyLineDrawInput:function(_16,_17){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.ACTIONS.TOOL_CHANGED,VIEWER_GLOBALS.EVENTS.TOOLS.DRAW_POLYLINE);this._userPolylineDrawInput(_16,_17);},handleUserPointClickInput:function(_18,_19){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.ACTIONS.TOOL_CHANGED,VIEWER_GLOBALS.EVENTS.TOOLS.DRAW_POINT);this._userPointDrawInput(_18,_19);},handleUserPolygonClickInput:function(_1a,_1b){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.ACTIONS.TOOL_CHANGED,VIEWER_GLOBALS.EVENTS.TOOLS.DRAW_POLYGON);this._userPolygonDrawInput(_1a,_1b);},handleUserFreehandLineDrawInput:function(_1c,_1d){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.ACTIONS.TOOL_CHANGED,VIEWER_GLOBALS.EVENTS.TOOLS.DRAW_FREEHAND_LINE);this._userFreehandLineDrawInput(_1c,_1d);},handleUserFreehandPolygonDrawInput:function(_1e,_1f){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.ACTIONS.TOOL_CHANGED,VIEWER_GLOBALS.EVENTS.TOOLS.DRAW_FREEHAND_POLYGON);this._userFreehandPolygonDrawInput(_1e,_1f);},_userFreehandPolygonDrawInput:function(_20,_21){this.userDrawCancel();var _22=_21&&_21.cursor?_21.cursor:this.CROSSHAIR;this.map.setMapCursor(_22);this.activateDraw(_7.FREEHAND_POLYGON,_20,_21);},_userFreehandLineDrawInput:function(_23,_24){this.userDrawCancel();var _25=_24&&_24.cursor?_24.cursor:this.CROSSHAIR;this.map.setMapCursor(_25);this.activateDraw(_7.FREEHAND_POLYLINE,_23,_24);},_userRectangleDrawInput:function(_26,_27){this.userDrawCancel();var _28=_27&&_27.cursor?_27.cursor:this.CROSSHAIR;this.map.setMapCursor(_28);this.activateDraw(_7.EXTENT,_26,_27);},_userLineDrawInput:function(_29,_2a){this.userDrawCancel();var _2b=_2a&&_2a.cursor?_2a.cursor:this.CROSSHAIR;this.map.setMapCursor(_2b);this.activateDraw(_7.LINE,_29,_2a);},_userPolylineDrawInput:function(_2c,_2d){this.userDrawCancel();var _2e=_2d&&_2d.cursor?_2d.cursor:this.CROSSHAIR;this.map.setMapCursor(_2e);this.activateDraw(_7.POLYLINE,_2c,_2d);},_userPointDrawInput:function(_2f,_30){this.userDrawCancel();var _31=_30&&_30.cursor?_30.cursor:this.POINTER;this.map.setMapCursor(_31);this.activateDraw(_7.POINT,_2f,_30);},_userPolygonDrawInput:function(_32,_33){this.userDrawCancel();var _34=_33&&_33.cursor?_33.cursor:this.CROSSHAIR;this.map.setMapCursor(_34);this.activateDraw(_7.POLYGON,_32,_33);},activateDraw:function(_35,_36,_37){if(_37==null){_37={};}if(_36!=null&&_4.isFunction(_36)){this._drawEventHandle=_3.connect(this.drawToolbar,"onDrawEnd",_4.hitch(this,this._internalDrawComplete,_36));}_37.showTooltips=_37.showTooltips==null?true:_37.showTooltips;this.drawToolbar.activate(_35,_37);this.map.disableMapNavigation();_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.DRAW_STARTED);},_internalDrawComplete:function(_38,_39){_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.DRAW_COMPLETE);this.drawToolbar.deactivate();this.map.setMapCursor(this.DEFAULT);this.map.enableMapNavigation();if(_38!=null&&_4.isFunction(_38)){_38(_39);}},userDrawCancel:function(){this.drawToolbar.deactivate();if(this._drawEventHandle){_3.disconnect(this._drawEventHandle);this._drawEventHandle=null;_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.DRAW_CANCELLED);}this.map.setMapCursor(this.DEFAULT);},handleCenterAndFlashGraphic:function(_3a){this.centerMapAtGraphic(_3a);this.flashGraphic(_3a);},centerMapAtGraphic:function(_3b){var _3c=this.getGraphicCenter(_3b);if(_3c){this.centerMapAtPoint(_3c);}},centerMapAtPoint:function(_3d){this.map.centerAt(_3d);},flashGraphic:function(_3e){if(_3e==null||!(_3e instanceof _8)||this.graphicFlashInProgress){return;}this.currentGraphicFlashCount=0;this.currentFlashGraphic=_3e;this.graphicFlashTimer=new _5.Timer(500);var _3f=_3e.visible;_3e.hide();this.graphicFlashTimer.onTick=_4.hitch(this,function(_40){try{if(this.currentGraphicFlashCount==this.maxGraphicFlashCount){this.currentGraphicFlashCount=0;this.graphicFlashTimer.stop();this.graphicFlashInProgress=false;if(_40){this.currentFlashGraphic.show();}else{this.currentFlashGraphic.hide();}}else{if(this.currentFlashGraphic.visible){if(this.currentFlashGraphic!=null){this.currentFlashGraphic.hide();}}else{if(this.currentFlashGraphic!=null){this.currentFlashGraphic.show();this.currentGraphicFlashCount++;}}}}catch(err){}},_3f);this.graphicFlashInProgress=true;this.graphicFlashTimer.start();},getGraphicCenter:function(_41){if(_41==null){return;}if(_41.geometry==null){return;}var _42=_41.geometry;if(_42 instanceof _9){return _42;}else{if(_42 instanceof _a||_42 instanceof _b){var _43=_42.getExtent();return _43.getCenter();}else{if(_42 instanceof _c){return _42.getCenter();}}}return null;},flashPoint:function(pt,_44){if(_44==null){_44=20;}var _45;if(pt==null||!(pt instanceof _9)){return;}var _46=new _d(_d.STYLE_X,2,new _e(_e.STYLE_SOLID,new _6([255,0,0])));_45=new _8(pt,_46);var _47=1;setTimeout(function(){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.GRAPHICS.ADD,_45);var _48=setInterval(function(){_46.setColor(new _6([255,0,0,_47]));_45.setSymbol(_46);if(_47<0.01){clearInterval(_48);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.GRAPHICS.REMOVE,_45);}_47-=0.01;},_44);},700);}});});