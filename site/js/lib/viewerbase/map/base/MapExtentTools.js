//>>built
define("esriviewer/map/base/MapExtentTools",["dojo/_base/declare","dojo/topic","dojo/_base/lang","esri/geometry/Extent","esri/geometry/Point"],function(_1,_2,_3,_4,_5){return _1([],{maxClientZoom:null,extentArray:[],currentExtentIdx:0,extentActionInProgress:false,constructor:function(_6){_3.mixin(this,_6);this._initListeners();},_initListeners:function(){_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.BASEMAP.CHANGED,_3.hitch(this,this.handleBasemapChanged));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PAN_TO,_3.hitch(this,this.panToPoint));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_CENTER,_3.hitch(this,this.handleGetCenter));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_EXTENT,_3.hitch(this,this.handleGetExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_LEVEL,_3.hitch(this,this.handleGetLevel));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_LEVEL,_3.hitch(this,this.handleSetLevel));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.DIMENSIONS.GET,_3.hitch(this,this.handleGetMapDimensions));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_3.hitch(this,this.setMapExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.LEVEL.GET_LEVEL_COUNT,_3.hitch(this,this.getZoomLevelCount));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GO_PREV_EXTENT,_3.hitch(this,this.handleGotoPrevExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GO_NEXT_EXTENT,_3.hitch(this,this.handleGotoNextExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.CHANGED,_3.hitch(this,this.handleRecordNewMapExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GO_INITIAL_EXTENT,_3.hitch(this,this.handleGotoInitialExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GO_LAST_EXTENT,_3.hitch(this,this.handleGotoLastExtent));},handleBasemapChanged:function(){var _7=this.getZoomLevelCount();_2.publish(VIEWER_GLOBALS.EVENTS.MAP.LEVEL.LEVEL_COUNT_CHANGED,_7);},getZoomLevelCount:function(_8){var _9=null;if(_3.isObject(this.map.__tileInfo)&&_3.isArray(this.map.__tileInfo.lods)){_9=this.map.__tileInfo.lods.length-1;}var _a={count:_9,current:this.map.getLevel()};if(_8!=null&&_3.isFunction(_8)){_8(_a);}else{return _a;}},setMapExtent:function(_b){if(_b!=null&&_b instanceof _4){if(_b.spatialReference.wkid==this.map.spatialReference.wkid){this.map.setExtent(_b);}else{_2.publish(VIEWER_GLOBALS.EVENTS.GEOMETRY_SERVICE.TASKS.PROJECT_TO_MAP_SR,_b,_3.hitch(this,function(_c){if(_3.isArray(_c)&&_c.length>0){if(this.maxClientZoom!=null){this.map.setLevel(this.maxClientZoom);}this.map.setExtent(_c[0]);}}));}}},handleGetMapDimensions:function(_d){if(_d!=null&&_3.isFunction(_d)){_d({width:this.map.width,height:this.map.height});}},handleMapExtentChanged:function(){this.mapDisplayWidgets.showScale();},panToPoint:function(_e,_f){var _10;if(!(_e instanceof _5)){return;}if(_f!=null&&_3.isObject(_f)){if(_f.zoomTo!=null&&_f.zoomTo===false){this.map.centerAt(_e);}else{if(_f.deepest!=null&&_f.deepest==true){if(_3.isObject(this.map.__tileInfo)&&_3.isArray(this.map.__tileInfo.lods)){_10=this.map.__tileInfo.lods.length-1;}}else{if(_f.zoomLevel!=null&&_3.isObject(this.map.__tileInfo)&&_3.isArray(this.map.__tileInfo.lods)){if(_10>=this.map.__tileInfo.lods.length){_10=this.map.__tileInfo.lods.length-1;}else{_10=_f.zoomLevel;}}}if(_10!=null){this.map.centerAndZoom(_e,_10);}}}else{if(this.map.getLevel()<8||this.map.getLevel()>15){_10=7;}else{_10=this.map.getLevel();}if(this.map.getLevel()==_10){this.map.centerAt(_e);}else{this.map.centerAndZoom(_e,_10);}}},handleSetLevel:function(_11){if(_11<this.map.__tileInfo.lods.length){this.map.setLevel(_11);}},handleGetLevel:function(_12){if(_12==null||!_3.isFunction(_12)){return;}_12(this.map.getLevel());},handleGetExtent:function(_13){if(_13==null||!_3.isFunction(_13)){return;}_13(this.map.extent);},handleGetCenter:function(_14){if(_14==null||!_3.isFunction(_14)){return;}_14(this.map.extent.getCenter());},handleRecordNewMapExtent:function(){if(arguments&&arguments[0]&&arguments[0].extent){if(!this.extentActionInProgress){if(this.currentExtentIdx<(this.extentArray.length-1)){this.extentArray.splice(this.currentExtentIdx+1,this.extentArray.length-(this.currentExtentIdx+1));}this.extentArray.push(arguments[0].extent);this.currentExtentIdx=this.extentArray.length-1;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));}else{this.extentActionInProgress=false;}}},handleGotoPrevExtent:function(){if(this.currentExtentIdx>0){this.currentExtentIdx-=1;this.extentActionInProgress=true;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,this.extentArray[this.currentExtentIdx]);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));}},handleGotoNextExtent:function(){if(this.currentExtentIdx<this.extentArray.length-1){this.currentExtentIdx+=1;this.extentActionInProgress=true;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,this.extentArray[this.currentExtentIdx]);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));}},handleGotoInitialExtent:function(){this.currentExtentIdx=0;this.extentActionInProgress=true;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,this.extentArray[this.currentExtentIdx]);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));},handleGotoLastExtent:function(){this.currentExtentIdx=this.extentArray.length-1;this.extentActionInProgress=true;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,this.extentArray[this.currentExtentIdx]);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));}});});