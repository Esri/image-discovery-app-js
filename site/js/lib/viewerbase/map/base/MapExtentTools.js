//>>built
define("esriviewer/map/base/MapExtentTools",["dojo/_base/declare","dojo/topic","dojo/_base/lang","esri/geometry/Extent","esri/geometry/Point"],function(_1,_2,_3,_4,_5){return _1([],{maxClientZoom:null,extentArray:[],currentExtentIdx:0,extentActionInProgress:false,constructor:function(_6){_3.mixin(this,_6);this.initListeners();},initListeners:function(){_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_SPATIAL_REFERENCE,_3.hitch(this,this.handleGetSpatialReference));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.BASEMAP.CHANGED,_3.hitch(this,this.handleBasemapChanged));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PAN_TO,_3.hitch(this,this.panToPoint));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.ZOOM_OUT,_3.hitch(this,this.zoomOut));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_CENTER,_3.hitch(this,this.handleGetCenter));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_EXTENT,_3.hitch(this,this.handleGetExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_LEVEL,_3.hitch(this,this.handleGetLevel));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_LEVEL,_3.hitch(this,this.handleSetLevel));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.DIMENSIONS.GET,_3.hitch(this,this.handleGetMapDimensions));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_3.hitch(this,this.setMapExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.LEVEL.GET_LEVEL_COUNT,_3.hitch(this,this.getZoomLevelCount));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GO_PREV_EXTENT,_3.hitch(this,this.handleGotoPrevExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GO_NEXT_EXTENT,_3.hitch(this,this.handleGotoNextExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.CHANGED,_3.hitch(this,this.handleRecordNewMapExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GO_INITIAL_EXTENT,_3.hitch(this,this.handleGotoInitialExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GO_LAST_EXTENT,_3.hitch(this,this.handleGotoLastExtent));_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.ZOOM_TO_LAYER,_3.hitch(this,this.handleZoomToLayer));},handleZoomToLayer:function(_7){if(_7.fullExtent){this.setExtent(_7.fullExtent);}},handleGetSpatialReference:function(_8){if(_8!=null&&_3.isFunction(_8)){_8(this.map.extent.spatialReference);}},zoomOut:function(){var _9=this.map.getLevel();var _a=-1;if(_9>1){_a=_9-1;}else{_a=0;}this.map.setLevel(_a);},handleBasemapChanged:function(){var _b=this.getZoomLevelCount();_2.publish(VIEWER_GLOBALS.EVENTS.MAP.LEVEL.LEVEL_COUNT_CHANGED,_b);},getZoomLevelCount:function(_c){var _d=null;if(_3.isObject(this.map.__tileInfo)&&_3.isArray(this.map.__tileInfo.lods)){_d=this.map.__tileInfo.lods.length-1;}var _e={count:_d,current:this.map.getLevel()};if(_c!=null&&_3.isFunction(_c)){_c(_e);}else{return _e;}return null;},setMapExtent:function(_f){if(_f!=null&&_f instanceof _4){if(_f.spatialReference.wkid==this.map.spatialReference.wkid){this.map.setExtent(_f);}else{_2.publish(VIEWER_GLOBALS.EVENTS.GEOMETRY_SERVICE.TASKS.PROJECT_TO_MAP_SR,_f,_3.hitch(this,function(_10){if(_3.isArray(_10)&&_10.length>0){if(this.maxClientZoom!=null){this.map.setLevel(this.maxClientZoom);}this.map.setExtent(_10[0]);}}));}}},handleGetMapDimensions:function(_11){if(_11!=null&&_3.isFunction(_11)){_11({width:this.map.width,height:this.map.height});}},handleMapExtentChanged:function(){this.mapDisplayWidgets.showScale();},panToPoint:function(_12,_13){var _14;if(!(_12 instanceof _5)){return;}if(_13!=null&&_3.isObject(_13)){if(_13.zoomTo!=null&&_13.zoomTo===false){this.map.centerAt(_12);}else{if(_13.deepest!=null&&_13.deepest==true){if(_3.isObject(this.map.__tileInfo)&&_3.isArray(this.map.__tileInfo.lods)){_14=this.map.__tileInfo.lods.length-1;}}else{if(_13.zoomLevel!=null&&_3.isObject(this.map.__tileInfo)&&_3.isArray(this.map.__tileInfo.lods)){if(_14>=this.map.__tileInfo.lods.length){_14=this.map.__tileInfo.lods.length-1;}else{_14=_13.zoomLevel;}}}if(_14!=null){this.map.centerAndZoom(_12,_14);}}}else{if(this.map.getLevel()<8||this.map.getLevel()>15){_14=7;}else{_14=this.map.getLevel();}if(this.map.getLevel()==_14){this.map.centerAt(_12);}else{this.map.centerAndZoom(_12,_14);}}},handleSetLevel:function(_15){if(_15<this.map.__tileInfo.lods.length){this.map.setLevel(_15);}},handleGetLevel:function(_16){if(_16==null||!_3.isFunction(_16)){return;}_16(this.map.getLevel());},handleGetExtent:function(_17){if(_17==null||!_3.isFunction(_17)){return;}_17(this.map.extent);},handleGetCenter:function(_18){if(_18==null||!_3.isFunction(_18)){return;}_18(this.map.extent.getCenter());},handleRecordNewMapExtent:function(){if(arguments&&arguments[0]&&arguments[0].extent){if(!this.extentActionInProgress){if(this.currentExtentIdx<(this.extentArray.length-1)){this.extentArray.splice(this.currentExtentIdx+1,this.extentArray.length-(this.currentExtentIdx+1));}this.extentArray.push(arguments[0].extent);this.currentExtentIdx=this.extentArray.length-1;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));}else{this.extentActionInProgress=false;}}},handleGotoPrevExtent:function(){if(this.currentExtentIdx>0){this.currentExtentIdx-=1;this.extentActionInProgress=true;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,this.extentArray[this.currentExtentIdx]);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));}},handleGotoNextExtent:function(){if(this.currentExtentIdx<this.extentArray.length-1){this.currentExtentIdx+=1;this.extentActionInProgress=true;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,this.extentArray[this.currentExtentIdx]);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));}},handleGotoInitialExtent:function(){this.currentExtentIdx=0;this.extentActionInProgress=true;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,this.extentArray[this.currentExtentIdx]);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));},handleGotoLastExtent:function(){this.currentExtentIdx=this.extentArray.length-1;this.extentActionInProgress=true;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,this.extentArray[this.currentExtentIdx]);_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PREV_EXTENT_EXISTS,(this.currentExtentIdx>0));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.NEXT_EXTENT_EXISTS,(this.currentExtentIdx<(this.extentArray.length-1)));}});});