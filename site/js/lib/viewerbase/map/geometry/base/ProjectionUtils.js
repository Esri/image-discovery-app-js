//>>built
define("esriviewer/map/geometry/base/ProjectionUtils",["dojo/_base/declare","dojo/_base/lang","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/SpatialReference"],function(_1,_2,_3,_4,_5){return _1([],{DEG_2_RAD:Math.PI/180,BLOCK_SIZE:100000,GRIDSQUARE_SET_COL_SIZE:8,GRIDSQUARE_SET_ROW_SIZE:20,UNDEFINED_STR:"undefined",WEB_MERCATOR_WKID:102100,WGS_84_WKID:4326,EASTING_OFFSET:500000,NORTHING_OFFSET:10000000,k0:0.9996,RAD_2_DEG:(180/Math.PI),EQUATORIAL_RADIUS_NAD83:6378137,EQUATORIAL_RADIUS_NAD27:6378206.4,ECC_SQUARED_NAD83:0.006694380023,ECC_SQUARED_NAD27:0.006768658,UTMGzdLetters:"NPQRSTUVWX",USNGSqEast:"ABCDEFGHJKLMNPQRSTUVWXYZ",USNGSqLetOdd:"ABCDEFGHJKLMNPQRSTUV",USNGSqLetEven:"FGHJKLMNPQRSTUVABCDE",zoneBase:[1.1,2,2.9,3.8,4.7,5.6,6.5,7.3,8.2,9.1,0,0.8,1.7,2.6,3.5,4.4,5.3,6.2,7,7.9],segBase:[0,2,2,2,4,4,6,6,8,8,0,0,0,2,2,4,4,6,6,6],isNad83Mode:true,constructor:function(){if(this.isNad83Mode){this.EQUATORIAL_RADIUS=this.EQUATORIAL_RADIUS_NAD83;this.ECC_SQUARED=this.ECC_SQUARED_NAD83;}else{this.EQUATORIAL_RADIUS=this.EQUATORIAL_RADIUS_NAD27;this.ECC_SQUARED=this.ECC_SQUARED_NAD27;}this.ECC_PRIME_SQUARED=this.ECC_SQUARED/(1-this.ECC_SQUARED);this.E1=(1-Math.sqrt(1-this.ECC_SQUARED))/(1+Math.sqrt(1-this.ECC_SQUARED));},setMapSpatialReference:function(_6){this.mapSpatialReference=_6;},graphicsToMapSpatialReference:function(_7){if(_7==null){return null;}if(!_2.isArray(_7)){_7=[_7];}if(_7.length<1){return [];}if((this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID||this.mapSpatialReference.wkid===this.WGS_84_WKID)&&_7[0].geometry.spatialReference.wkid===this.WEB_MERCATOR_WKID||_7[0].geometry.spatialReference.wkid===this.WGS_84_WKID){var _8=null;if(this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID&&_7[0].geometry.spatialReference.wkid===this.WGS_84_WKID){_8=_3.geographicToWebMercator;}else{if(_7[0].geometry.spatialReference.wkid===this.WEB_MERCATOR_WKID&&this.mapSpatialReference.wkid===this.WGS_84_WKID){_8=_3.webMercatorToGeographic;}}if(_2.isFunction(_8)){var _9;for(var i=0;i<_7.length;i++){_9=_7[i];_9.geometry=_8(_9.geometry);}}}return _7;},geometryToMapSpatialReference:function(_a){if(_a==null){return null;}if(!_2.isArray(_a)){_a=[_a];}if(_a.length<1){return [];}if(this.mapSpatialReference.wkid==_a[0].spatialReference.wkid){return _a;}var _b=null;if((this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID||this.mapSpatialReference.wkid===this.WGS_84_WKID)&&_a[0].spatialReference.wkid===this.WEB_MERCATOR_WKID||_a[0].spatialReference.wkid===this.WGS_84_WKID){var _c=null;if(this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID&&_a[0].spatialReference.wkid===this.WGS_84_WKID){_c=_3.geographicToWebMercator;}else{if(_a[0].spatialReference.wkid===this.WEB_MERCATOR_WKID&&this.mapSpatialReference.wkid===this.WGS_84_WKID){_c=_3.webMercatorToGeographic;}}if(_2.isFunction(_c)){_b=[];for(var i=0;i<_a.length;i++){_b.push(_c(_a[i]));}}}return _b;},USNGtoLL:function(_d,_e){var _f=[];var _10={};this.parseUSNG_str(_d,_10);var _11={};this.USNGtoUTM(_10.zone,_10.letN,_10.sq1,_10.sq2,_10.east,_10.north,_11);if(_10.letN<"N"){_11.N-=this.NORTHING_OFFSET;}this.UTMtoLL(_11.N,_11.E,_10.zone,_11);_f[0]=_11.lat;_f[1]=_11.lon;var _12=new _4(_11.lon,_11.lat,new _5(4326));if(_e&&_2.isFunction(_e)){_e(_12);}else{return _12;}},USNGtoUTM:function(_13,_14,sq1,sq2,_15,_16,ret){var _17=this.USNGSqEast.indexOf(sq1);var _18=1+_17%8;var _19;var _1a="CDEFGHJKLMNPQRSTUVWX".indexOf(_14);if(_13%2){_19="ABCDEFGHJKLMNPQRSTUV".indexOf(sq2);}else{_19="FGHJKLMNPQRSTUVABCDE".indexOf(sq2);}var _1b=this.zoneBase[_1a];var _1c=Number(this.segBase[_1a])+_19/10;if(_1c<_1b){_1c+=2;}ret.N=_1c*1000000+Number(_16)*Math.pow(10,5-_16.length);ret.E=_18*100000+Number(_15)*Math.pow(10,5-_15.length);ret.zone=_13;ret.letter=_14;},parseUSNG_str:function(_1d,_1e){var j=0;var k;var _1f=[];var _20=[];_20=_1d.toUpperCase();var _21=/%20/g;_1f=_20.replace(_21,"");_21=/ /g;_1f=_20.replace(_21,"");if(_1f.length<7){return 0;}_1e.zone=_1f.charAt(j++)*10+_1f.charAt(j++)*1;_1e.letN=_1f.charAt(j++);_1e.sq1=_1f.charAt(j++);_1e.sq2=_1f.charAt(j++);_1e.precision=(_1f.length-j)/2;_1e.east="";_1e.north="";for(k=0;k<_1e.precision;k++){_1e.east+=_1f.charAt(j++);}if(_1f[j]==" "){j++;}for(k=0;k<_1e.precision;k++){_1e.north+=_1f.charAt(j++);}},UTMtoLL:function(_22,_23,_24,ret){var _25=parseFloat(_23)-this.EASTING_OFFSET;var _26=parseFloat(_22);var _27=parseInt(_24,10);var _28=(_27-1)*6-180+3;var M=_26/this.k0;var mu=M/(this.EQUATORIAL_RADIUS*(1-this.ECC_SQUARED/4-3*this.ECC_SQUARED*this.ECC_SQUARED/64-5*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/256));var _29=mu+(3*this.E1/2-27*this.E1*this.E1*this.E1/32)*Math.sin(2*mu)+(21*this.E1*this.E1/16-55*this.E1*this.E1*this.E1*this.E1/32)*Math.sin(4*mu)+(151*this.E1*this.E1*this.E1/96)*Math.sin(6*mu);var _2a=_29*this.RAD_2_DEG;var N1=this.EQUATORIAL_RADIUS/Math.sqrt(1-this.ECC_SQUARED*Math.sin(_29)*Math.sin(_29));var T1=Math.tan(_29)*Math.tan(_29);var C1=this.ECC_PRIME_SQUARED*Math.cos(_29)*Math.cos(_29);var R1=this.EQUATORIAL_RADIUS*(1-this.ECC_SQUARED)/Math.pow(1-this.ECC_SQUARED*Math.sin(_29)*Math.sin(_29),1.5);var D=_25/(N1*this.k0);var lat=_29-(N1*Math.tan(_29)/R1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*this.ECC_PRIME_SQUARED)*D*D*D*D/24+(61+90*T1+298*C1+45*T1*T1-252*this.ECC_PRIME_SQUARED-3*C1*C1)*D*D*D*D*D*D/720);lat=lat*this.RAD_2_DEG;var lon=(D-(1+2*T1+C1)*D*D*D/6+(5-2*C1+28*T1-3*C1*C1+8*this.ECC_PRIME_SQUARED+24*T1*T1)*D*D*D*D*D/120)/Math.cos(_29);lon=_28+lon*this.RAD_2_DEG;ret.lat=lat;ret.lon=lon;},LLtoMGRS:function(lat,lon,_2b){var _2c="";var _2d=this.LLtoUSNG(lat,lon,_2b);var _2e=/ /g;return _2d.replace(_2e,"");},LLtoUSNG:function(lat,lon,_2f){var _30;lat=parseFloat(lat);lon=parseFloat(lon);var _31=this.LLtoUTM(lat,lon);var _32=_31.easting;var _33=_31.northing;if(lat<0){_33+=this.NORTHING_OFFSET;}var _34=this.getZoneNumber(lat,lon);var _35=this.findGridLetters(_34,_33,_32);var _36=Math.round(_33)%this.BLOCK_SIZE;var _37=Math.round(_32)%this.BLOCK_SIZE;_36=Math.floor(_36/Math.pow(10,(5-_2f)));_37=Math.floor(_37/Math.pow(10,(5-_2f)));_30=this.getZoneNumber(lat,lon)+this.UTMLetterDesignator(lat)+" "+_35+" ";var i;for(i=String(_37).length;i<_2f;i++){_30+="0";}_30+=_37+" ";for(i=String(_36).length;i<_2f;i++){_30+="0";}return _30;},LLtoUTM:function(lat,lon,_38){lat=parseFloat(lat);lon=parseFloat(lon);if(lat>84||lat<-80){return this.UNDEFINED_STR;}var _39=(lon+180)-parseInt((lon+180)/360,10)*360-180;var _3a=lat*this.DEG_2_RAD;var _3b=_39*this.DEG_2_RAD;var _3c=this.getZoneNumber(lat,lon);var _3d=(_3c-1)*6-180+3;var _3e=_3d*this.DEG_2_RAD;var _3f=_3c+""+this.UTMLetterDesignator(lat)+" ";var N=this.EQUATORIAL_RADIUS/Math.sqrt(1-this.ECC_SQUARED*Math.sin(_3a)*Math.sin(_3a));var T=Math.tan(_3a)*Math.tan(_3a);var C=this.ECC_PRIME_SQUARED*Math.cos(_3a)*Math.cos(_3a);var A=Math.cos(_3a)*(_3b-_3e);var M=this.EQUATORIAL_RADIUS*((1-this.ECC_SQUARED/4-3*(this.ECC_SQUARED*this.ECC_SQUARED)/64-5*(this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED)/256)*_3a-(3*this.ECC_SQUARED/8+3*this.ECC_SQUARED*this.ECC_SQUARED/32+45*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/1024)*Math.sin(2*_3a)+(15*this.ECC_SQUARED*this.ECC_SQUARED/256+45*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/1024)*Math.sin(4*_3a)-(35*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/3072)*Math.sin(6*_3a));var _40=(this.k0*N*(A+(1-T+C)*(A*A*A)/6+(5-18*T+T*T+72*C-58*this.ECC_PRIME_SQUARED)*(A*A*A*A*A)/120)+this.EASTING_OFFSET);var _41=(this.k0*(M+N*Math.tan(_3a)*((A*A)/2+(5-T+9*C+4*C*C)*(A*A*A*A)/24+(61-58*T+T*T+600*C-330*this.ECC_PRIME_SQUARED)*(A*A*A*A*A*A)/720)));return {easting:_40,northing:_41,zone:_3c};},getZoneNumber:function(lat,lon){lat=parseFloat(lat);lon=parseFloat(lon);var _42=(lon+180)-parseInt((lon+180)/360,10)*360-180;var _43=parseInt((_42+180)/6,10)+1;if(lat>=56&&lat<64&&_42>=3&&_42<12){_43=32;}if(lat>=72&&lat<84){if(_42>=0&&_42<9){_43=31;}else{if(_42>=9&&_42<21){_43=33;}else{if(_42>=21&&_42<33){_43=35;}else{if(_42>=33&&_42<42){_43=37;}}}}}return _43;},findGridLetters:function(_44,_45,_46){_44=parseInt(_44,10);_45=parseFloat(_45);_46=parseFloat(_46);row=1;var _47=Math.round(_45);while(_47>=this.BLOCK_SIZE){_47=_47-this.BLOCK_SIZE;row++;}var row=row%this.GRIDSQUARE_SET_ROW_SIZE;var col=0;var _48=Math.round(_46);while(_48>=this.BLOCK_SIZE){_48=_48-this.BLOCK_SIZE;col++;}col=col%this.GRIDSQUARE_SET_COL_SIZE;return this.lettersHelper(this.findSet(_44),row,col);},findSet:function(_49){_49=parseInt(_49,10);_49=_49%6;switch(_49){case 0:return 6;break;case 1:return 1;break;case 2:return 2;break;case 3:return 3;break;case 4:return 4;break;case 5:return 5;break;default:return -1;break;}},lettersHelper:function(set,row,col){if(row==0){row=this.GRIDSQUARE_SET_ROW_SIZE-1;}else{row--;}if(col==0){col=this.GRIDSQUARE_SET_COL_SIZE-1;}else{col--;}var l1;var l2;switch(set){case 1:l1="ABCDEFGH";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 2:l1="JKLMNPQR";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;case 3:l1="STUVWXYZ";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 4:l1="ABCDEFGH";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;case 5:l1="JKLMNPQR";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 6:l1="STUVWXYZ";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;}},UTMLetterDesignator:function(lat){lat=parseFloat(lat);var _4a;if((84>=lat)&&(lat>=72)){_4a="X";}else{if((72>lat)&&(lat>=64)){_4a="W";}else{if((64>lat)&&(lat>=56)){_4a="V";}else{if((56>lat)&&(lat>=48)){_4a="U";}else{if((48>lat)&&(lat>=40)){_4a="T";}else{if((40>lat)&&(lat>=32)){_4a="S";}else{if((32>lat)&&(lat>=24)){_4a="R";}else{if((24>lat)&&(lat>=16)){_4a="Q";}else{if((16>lat)&&(lat>=8)){_4a="P";}else{if((8>lat)&&(lat>=0)){_4a="N";}else{if((0>lat)&&(lat>=-8)){_4a="M";}else{if((-8>lat)&&(lat>=-16)){_4a="L";}else{if((-16>lat)&&(lat>=-24)){_4a="K";}else{if((-24>lat)&&(lat>=-32)){_4a="J";}else{if((-32>lat)&&(lat>=-40)){_4a="H";}else{if((-40>lat)&&(lat>=-48)){_4a="G";}else{if((-48>lat)&&(lat>=-56)){_4a="F";}else{if((-56>lat)&&(lat>=-64)){_4a="E";}else{if((-64>lat)&&(lat>=-72)){_4a="D";}else{if((-72>lat)&&(lat>=-80)){_4a="C";}else{_4a="Z";}}}}}}}}}}}}}}}}}}}}return _4a;}});});