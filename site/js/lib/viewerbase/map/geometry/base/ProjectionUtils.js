//>>built
define("esriviewer/map/geometry/base/ProjectionUtils",["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/SpatialReference"],function(_1,_2,_3,_4,_5,_6){return _1([],{DEG_2_RAD:Math.PI/180,BLOCK_SIZE:100000,GRIDSQUARE_SET_COL_SIZE:8,GRIDSQUARE_SET_ROW_SIZE:20,UNDEFINED_STR:"undefined",WEB_MERCATOR_WKID:102100,WGS_84_WKID:4326,EASTING_OFFSET:500000,NORTHING_OFFSET:10000000,k0:0.9996,RAD_2_DEG:(180/Math.PI),EQUATORIAL_RADIUS_NAD83:6378137,EQUATORIAL_RADIUS_NAD27:6378206.4,ECC_SQUARED_NAD83:0.006694380023,ECC_SQUARED_NAD27:0.006768658,UTMGzdLetters:"NPQRSTUVWX",USNGSqEast:"ABCDEFGHJKLMNPQRSTUVWXYZ",USNGSqLetOdd:"ABCDEFGHJKLMNPQRSTUV",USNGSqLetEven:"FGHJKLMNPQRSTUVABCDE",zoneBase:[1.1,2,2.9,3.8,4.7,5.6,6.5,7.3,8.2,9.1,0,0.8,1.7,2.6,3.5,4.4,5.3,6.2,7,7.9],segBase:[0,2,2,2,4,4,6,6,8,8,0,0,0,2,2,4,4,6,6,6],isNad83Mode:true,constructor:function(){if(this.isNad83Mode){this.EQUATORIAL_RADIUS=this.EQUATORIAL_RADIUS_NAD83;this.ECC_SQUARED=this.ECC_SQUARED_NAD83;}else{this.EQUATORIAL_RADIUS=this.EQUATORIAL_RADIUS_NAD27;this.ECC_SQUARED=this.ECC_SQUARED_NAD27;}this.ECC_PRIME_SQUARED=this.ECC_SQUARED/(1-this.ECC_SQUARED);this.E1=(1-Math.sqrt(1-this.ECC_SQUARED))/(1+Math.sqrt(1-this.ECC_SQUARED));},setMapSpatialReference:function(_7){this.mapSpatialReference=_7;},graphicsToMapSpatialReference:function(_8){if(_8==null){return null;}if(!_2.isArray(_8)){_8=[_8];}if(_8.length<1){return [];}var _9=null;if((this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID||this.mapSpatialReference.wkid===this.WGS_84_WKID)&&_8[0].geometry.spatialReference.wkid===this.WEB_MERCATOR_WKID||_8[0].geometry.spatialReference.wkid===this.WGS_84_WKID){var _a=null;if(this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID&&_8[0].geometry.spatialReference.wkid===this.WGS_84_WKID){_a=_4.geographicToWebMercator;}else{if(_8[0].geometry.spatialReference.wkid===this.WEB_MERCATOR_WKID&&this.mapSpatialReference.wkid===this.WGS_84_WKID){_a=_4.webMercatorToGeographic;}}if(_2.isFunction(_a)){var _b;_9=[];for(var i=0;i<_8.length;i++){_b=_8[i];_b.geometry=_a(_b.geometry);}}}return _8;},geometryToMapSpatialReference:function(_c){if(_c==null){return null;}if(!_2.isArray(_c)){_c=[_c];}if(_c.length<1){return [];}if(this.mapSpatialReference.wkid==_c[0].spatialReference.wkid){return _c;}var _d=null;if((this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID||this.mapSpatialReference.wkid===this.WGS_84_WKID)&&_c[0].spatialReference.wkid===this.WEB_MERCATOR_WKID||_c[0].spatialReference.wkid===this.WGS_84_WKID){var _e=null;if(this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID&&_c[0].spatialReference.wkid===this.WGS_84_WKID){_e=_4.geographicToWebMercator;}else{if(_c[0].spatialReference.wkid===this.WEB_MERCATOR_WKID&&this.mapSpatialReference.wkid===this.WGS_84_WKID){_e=_4.webMercatorToGeographic;}}if(_2.isFunction(_e)){_d=[];for(var i=0;i<_c.length;i++){_d.push(_e(_c[i]));}}}return _d;},USNGtoLL:function(_f,_10){var _11=[];var _12={};this.parseUSNG_str(_f,_12);var _13={};this.USNGtoUTM(_12.zone,_12.letN,_12.sq1,_12.sq2,_12.east,_12.north,_13);if(_12.letN<"N"){_13.N-=this.NORTHING_OFFSET;}this.UTMtoLL(_13.N,_13.E,_12.zone,_13);_11[0]=_13.lat;_11[1]=_13.lon;var _14=new _5(_13.lon,_13.lat,new _6(4326));if(_10&&_2.isFunction(_10)){_10(_14);}else{return _14;}},USNGtoUTM:function(_15,_16,sq1,sq2,_17,_18,ret){var _19=this.USNGSqEast.indexOf(sq1);var _1a=1+_19%8;var _1b;var _1c="CDEFGHJKLMNPQRSTUVWX".indexOf(_16);if(_15%2){_1b="ABCDEFGHJKLMNPQRSTUV".indexOf(sq2);}else{_1b="FGHJKLMNPQRSTUVABCDE".indexOf(sq2);}var _1d=this.zoneBase[_1c];var _1e=Number(this.segBase[_1c])+_1b/10;if(_1e<_1d){_1e+=2;}ret.N=_1e*1000000+Number(_18)*Math.pow(10,5-_18.length);ret.E=_1a*100000+Number(_17)*Math.pow(10,5-_17.length);ret.zone=_15;ret.letter=_16;},parseUSNG_str:function(_1f,_20){var j=0;var k;var _21=[];var _22=[];_22=_1f.toUpperCase();var _23=/%20/g;_21=_22.replace(_23,"");_23=/ /g;_21=_22.replace(_23,"");if(_21.length<7){return 0;}_20.zone=_21.charAt(j++)*10+_21.charAt(j++)*1;_20.letN=_21.charAt(j++);_20.sq1=_21.charAt(j++);_20.sq2=_21.charAt(j++);_20.precision=(_21.length-j)/2;_20.east="";_20.north="";for(k=0;k<_20.precision;k++){_20.east+=_21.charAt(j++);}if(_21[j]==" "){j++;}for(k=0;k<_20.precision;k++){_20.north+=_21.charAt(j++);}},UTMtoLL:function(_24,_25,_26,ret){var _27=parseFloat(_25)-this.EASTING_OFFSET;var _28=parseFloat(_24);var _29=parseInt(_26,10);var _2a=(_29-1)*6-180+3;var M=_28/this.k0;var mu=M/(this.EQUATORIAL_RADIUS*(1-this.ECC_SQUARED/4-3*this.ECC_SQUARED*this.ECC_SQUARED/64-5*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/256));var _2b=mu+(3*this.E1/2-27*this.E1*this.E1*this.E1/32)*Math.sin(2*mu)+(21*this.E1*this.E1/16-55*this.E1*this.E1*this.E1*this.E1/32)*Math.sin(4*mu)+(151*this.E1*this.E1*this.E1/96)*Math.sin(6*mu);var _2c=_2b*this.RAD_2_DEG;var N1=this.EQUATORIAL_RADIUS/Math.sqrt(1-this.ECC_SQUARED*Math.sin(_2b)*Math.sin(_2b));var T1=Math.tan(_2b)*Math.tan(_2b);var C1=this.ECC_PRIME_SQUARED*Math.cos(_2b)*Math.cos(_2b);var R1=this.EQUATORIAL_RADIUS*(1-this.ECC_SQUARED)/Math.pow(1-this.ECC_SQUARED*Math.sin(_2b)*Math.sin(_2b),1.5);var D=_27/(N1*this.k0);var lat=_2b-(N1*Math.tan(_2b)/R1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*this.ECC_PRIME_SQUARED)*D*D*D*D/24+(61+90*T1+298*C1+45*T1*T1-252*this.ECC_PRIME_SQUARED-3*C1*C1)*D*D*D*D*D*D/720);lat=lat*this.RAD_2_DEG;var lon=(D-(1+2*T1+C1)*D*D*D/6+(5-2*C1+28*T1-3*C1*C1+8*this.ECC_PRIME_SQUARED+24*T1*T1)*D*D*D*D*D/120)/Math.cos(_2b);lon=_2a+lon*this.RAD_2_DEG;ret.lat=lat;ret.lon=lon;},LLtoMGRS:function(lat,lon,_2d){var _2e="";var _2f=this.LLtoUSNG(lat,lon,_2d);var _30=/ /g;return _2f.replace(_30,"");},LLtoUSNG:function(lat,lon,_31){var _32;lat=parseFloat(lat);lon=parseFloat(lon);var _33=[];this.LLtoUTM(lat,lon,_33);var _34=_33[0];var _35=_33[1];if(lat<0){_35+=this.NORTHING_OFFSET;}var _36=this.getZoneNumber(lat,lon);USNGLetters=this.findGridLetters(_36,_35,_34);var _37=Math.round(_35)%this.BLOCK_SIZE;var _38=Math.round(_34)%this.BLOCK_SIZE;_37=Math.floor(_37/Math.pow(10,(5-_31)));_38=Math.floor(_38/Math.pow(10,(5-_31)));_32=this.getZoneNumber(lat,lon)+this.UTMLetterDesignator(lat)+" "+USNGLetters+" ";var i;for(i=String(_38).length;i<_31;i++){_32+="0";}_32+=_38+" ";for(i=String(_37).length;i<_31;i++){_32+="0";}return _32;},LLtoUTM:function(lat,lon,_39,_3a){lat=parseFloat(lat);lon=parseFloat(lon);if(lat>84||lat<-80){return this.UNDEFINED_STR;}var _3b=(lon+180)-parseInt((lon+180)/360,10)*360-180;var _3c=lat*this.DEG_2_RAD;var _3d=_3b*this.DEG_2_RAD;var _3e=this.getZoneNumber(lat,lon);var _3f=(_3e-1)*6-180+3;var _40=_3f*this.DEG_2_RAD;var _41=_3e+""+this.UTMLetterDesignator(lat)+" ";var N=this.EQUATORIAL_RADIUS/Math.sqrt(1-this.ECC_SQUARED*Math.sin(_3c)*Math.sin(_3c));var T=Math.tan(_3c)*Math.tan(_3c);var C=this.ECC_PRIME_SQUARED*Math.cos(_3c)*Math.cos(_3c);var A=Math.cos(_3c)*(_3d-_40);var M=this.EQUATORIAL_RADIUS*((1-this.ECC_SQUARED/4-3*(this.ECC_SQUARED*this.ECC_SQUARED)/64-5*(this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED)/256)*_3c-(3*this.ECC_SQUARED/8+3*this.ECC_SQUARED*this.ECC_SQUARED/32+45*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/1024)*Math.sin(2*_3c)+(15*this.ECC_SQUARED*this.ECC_SQUARED/256+45*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/1024)*Math.sin(4*_3c)-(35*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/3072)*Math.sin(6*_3c));var _42=(this.k0*N*(A+(1-T+C)*(A*A*A)/6+(5-18*T+T*T+72*C-58*this.ECC_PRIME_SQUARED)*(A*A*A*A*A)/120)+this.EASTING_OFFSET);var _43=(this.k0*(M+N*Math.tan(_3c)*((A*A)/2+(5-T+9*C+4*C*C)*(A*A*A*A)/24+(61-58*T+T*T+600*C-330*this.ECC_PRIME_SQUARED)*(A*A*A*A*A*A)/720)));_39[0]=_42;_39[1]=_43;_39[2]=_3e;},getZoneNumber:function(lat,lon){lat=parseFloat(lat);lon=parseFloat(lon);var _44=(lon+180)-parseInt((lon+180)/360,10)*360-180;var _45=parseInt((_44+180)/6,10)+1;if(lat>=56&&lat<64&&_44>=3&&_44<12){_45=32;}if(lat>=72&&lat<84){if(_44>=0&&_44<9){_45=31;}else{if(_44>=9&&_44<21){_45=33;}else{if(_44>=21&&_44<33){_45=35;}else{if(_44>=33&&_44<42){_45=37;}}}}}return _45;},findGridLetters:function(_46,_47,_48){_46=parseInt(_46,10);_47=parseFloat(_47);_48=parseFloat(_48);row=1;var _49=Math.round(_47);while(_49>=this.BLOCK_SIZE){_49=_49-this.BLOCK_SIZE;row++;}var row=row%this.GRIDSQUARE_SET_ROW_SIZE;var col=0;var _4a=Math.round(_48);while(_4a>=this.BLOCK_SIZE){_4a=_4a-this.BLOCK_SIZE;col++;}col=col%this.GRIDSQUARE_SET_COL_SIZE;return this.lettersHelper(this.findSet(_46),row,col);},findSet:function(_4b){_4b=parseInt(_4b,10);_4b=_4b%6;switch(_4b){case 0:return 6;break;case 1:return 1;break;case 2:return 2;break;case 3:return 3;break;case 4:return 4;break;case 5:return 5;break;default:return -1;break;}},lettersHelper:function(set,row,col){if(row==0){row=this.GRIDSQUARE_SET_ROW_SIZE-1;}else{row--;}if(col==0){col=this.GRIDSQUARE_SET_COL_SIZE-1;}else{col--;}var l1;var l2;switch(set){case 1:l1="ABCDEFGH";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 2:l1="JKLMNPQR";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;case 3:l1="STUVWXYZ";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 4:l1="ABCDEFGH";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;case 5:l1="JKLMNPQR";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 6:l1="STUVWXYZ";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;}},UTMLetterDesignator:function(lat){lat=parseFloat(lat);var _4c;if((84>=lat)&&(lat>=72)){_4c="X";}else{if((72>lat)&&(lat>=64)){_4c="W";}else{if((64>lat)&&(lat>=56)){_4c="V";}else{if((56>lat)&&(lat>=48)){_4c="U";}else{if((48>lat)&&(lat>=40)){_4c="T";}else{if((40>lat)&&(lat>=32)){_4c="S";}else{if((32>lat)&&(lat>=24)){_4c="R";}else{if((24>lat)&&(lat>=16)){_4c="Q";}else{if((16>lat)&&(lat>=8)){_4c="P";}else{if((8>lat)&&(lat>=0)){_4c="N";}else{if((0>lat)&&(lat>=-8)){_4c="M";}else{if((-8>lat)&&(lat>=-16)){_4c="L";}else{if((-16>lat)&&(lat>=-24)){_4c="K";}else{if((-24>lat)&&(lat>=-32)){_4c="J";}else{if((-32>lat)&&(lat>=-40)){_4c="H";}else{if((-40>lat)&&(lat>=-48)){_4c="G";}else{if((-48>lat)&&(lat>=-56)){_4c="F";}else{if((-56>lat)&&(lat>=-64)){_4c="E";}else{if((-64>lat)&&(lat>=-72)){_4c="D";}else{if((-72>lat)&&(lat>=-80)){_4c="C";}else{_4c="Z";}}}}}}}}}}}}}}}}}}}}return _4c;}});});