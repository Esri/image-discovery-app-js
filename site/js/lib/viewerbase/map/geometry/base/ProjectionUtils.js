//>>built
define("esriviewer/map/geometry/base/ProjectionUtils",["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/SpatialReference"],function(_1,_2,_3,_4,_5,_6){return _1([],{DEG_2_RAD:Math.PI/180,BLOCK_SIZE:100000,GRIDSQUARE_SET_COL_SIZE:8,GRIDSQUARE_SET_ROW_SIZE:20,UNDEFINED_STR:"undefined",WEB_MERCATOR_WKID:102100,WGS_84_WKID:4326,EASTING_OFFSET:500000,NORTHING_OFFSET:10000000,k0:0.9996,RAD_2_DEG:(180/Math.PI),EQUATORIAL_RADIUS_NAD83:6378137,EQUATORIAL_RADIUS_NAD27:6378206.4,ECC_SQUARED_NAD83:0.006694380023,ECC_SQUARED_NAD27:0.006768658,UTMGzdLetters:"NPQRSTUVWX",USNGSqEast:"ABCDEFGHJKLMNPQRSTUVWXYZ",USNGSqLetOdd:"ABCDEFGHJKLMNPQRSTUV",USNGSqLetEven:"FGHJKLMNPQRSTUVABCDE",zoneBase:[1.1,2,2.9,3.8,4.7,5.6,6.5,7.3,8.2,9.1,0,0.8,1.7,2.6,3.5,4.4,5.3,6.2,7,7.9],segBase:[0,2,2,2,4,4,6,6,8,8,0,0,0,2,2,4,4,6,6,6],isNad83Mode:true,constructor:function(){if(this.isNad83Mode){this.EQUATORIAL_RADIUS=this.EQUATORIAL_RADIUS_NAD83;this.ECC_SQUARED=this.ECC_SQUARED_NAD83;}else{this.EQUATORIAL_RADIUS=this.EQUATORIAL_RADIUS_NAD27;this.ECC_SQUARED=this.ECC_SQUARED_NAD27;}this.ECC_PRIME_SQUARED=this.ECC_SQUARED/(1-this.ECC_SQUARED);this.E1=(1-Math.sqrt(1-this.ECC_SQUARED))/(1+Math.sqrt(1-this.ECC_SQUARED));},setMapSpatialReference:function(_7){this.mapSpatialReference=_7;},graphicsToMapSpatialReference:function(_8){if(_8==null){return null;}if(!_2.isArray(_8)){_8=[_8];}if(_8.length<1){return [];}if((this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID||this.mapSpatialReference.wkid===this.WGS_84_WKID)&&_8[0].geometry.spatialReference.wkid===this.WEB_MERCATOR_WKID||_8[0].geometry.spatialReference.wkid===this.WGS_84_WKID){var _9=null;if(this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID&&_8[0].geometry.spatialReference.wkid===this.WGS_84_WKID){_9=_4.geographicToWebMercator;}else{if(_8[0].geometry.spatialReference.wkid===this.WEB_MERCATOR_WKID&&this.mapSpatialReference.wkid===this.WGS_84_WKID){_9=_4.webMercatorToGeographic;}}if(_2.isFunction(_9)){var _a;for(var i=0;i<_8.length;i++){_a=_8[i];_a.geometry=_9(_a.geometry);}}}return _8;},geometryToMapSpatialReference:function(_b){if(_b==null){return null;}if(!_2.isArray(_b)){_b=[_b];}if(_b.length<1){return [];}if(this.mapSpatialReference.wkid==_b[0].spatialReference.wkid){return _b;}var _c=null;if((this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID||this.mapSpatialReference.wkid===this.WGS_84_WKID)&&_b[0].spatialReference.wkid===this.WEB_MERCATOR_WKID||_b[0].spatialReference.wkid===this.WGS_84_WKID){var _d=null;if(this.mapSpatialReference.wkid===this.WEB_MERCATOR_WKID&&_b[0].spatialReference.wkid===this.WGS_84_WKID){_d=_4.geographicToWebMercator;}else{if(_b[0].spatialReference.wkid===this.WEB_MERCATOR_WKID&&this.mapSpatialReference.wkid===this.WGS_84_WKID){_d=_4.webMercatorToGeographic;}}if(_2.isFunction(_d)){_c=[];for(var i=0;i<_b.length;i++){_c.push(_d(_b[i]));}}}return _c;},USNGtoLL:function(_e,_f){var _10=[];var _11={};this.parseUSNG_str(_e,_11);var _12={};this.USNGtoUTM(_11.zone,_11.letN,_11.sq1,_11.sq2,_11.east,_11.north,_12);if(_11.letN<"N"){_12.N-=this.NORTHING_OFFSET;}this.UTMtoLL(_12.N,_12.E,_11.zone,_12);_10[0]=_12.lat;_10[1]=_12.lon;var _13=new _5(_12.lon,_12.lat,new _6(4326));if(_f&&_2.isFunction(_f)){_f(_13);}else{return _13;}},USNGtoUTM:function(_14,_15,sq1,sq2,_16,_17,ret){var _18=this.USNGSqEast.indexOf(sq1);var _19=1+_18%8;var _1a;var _1b="CDEFGHJKLMNPQRSTUVWX".indexOf(_15);if(_14%2){_1a="ABCDEFGHJKLMNPQRSTUV".indexOf(sq2);}else{_1a="FGHJKLMNPQRSTUVABCDE".indexOf(sq2);}var _1c=this.zoneBase[_1b];var _1d=Number(this.segBase[_1b])+_1a/10;if(_1d<_1c){_1d+=2;}ret.N=_1d*1000000+Number(_17)*Math.pow(10,5-_17.length);ret.E=_19*100000+Number(_16)*Math.pow(10,5-_16.length);ret.zone=_14;ret.letter=_15;},parseUSNG_str:function(_1e,_1f){var j=0;var k;var _20=[];var _21=[];_21=_1e.toUpperCase();var _22=/%20/g;_20=_21.replace(_22,"");_22=/ /g;_20=_21.replace(_22,"");if(_20.length<7){return 0;}_1f.zone=_20.charAt(j++)*10+_20.charAt(j++)*1;_1f.letN=_20.charAt(j++);_1f.sq1=_20.charAt(j++);_1f.sq2=_20.charAt(j++);_1f.precision=(_20.length-j)/2;_1f.east="";_1f.north="";for(k=0;k<_1f.precision;k++){_1f.east+=_20.charAt(j++);}if(_20[j]==" "){j++;}for(k=0;k<_1f.precision;k++){_1f.north+=_20.charAt(j++);}},UTMtoLL:function(_23,_24,_25,ret){var _26=parseFloat(_24)-this.EASTING_OFFSET;var _27=parseFloat(_23);var _28=parseInt(_25,10);var _29=(_28-1)*6-180+3;var M=_27/this.k0;var mu=M/(this.EQUATORIAL_RADIUS*(1-this.ECC_SQUARED/4-3*this.ECC_SQUARED*this.ECC_SQUARED/64-5*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/256));var _2a=mu+(3*this.E1/2-27*this.E1*this.E1*this.E1/32)*Math.sin(2*mu)+(21*this.E1*this.E1/16-55*this.E1*this.E1*this.E1*this.E1/32)*Math.sin(4*mu)+(151*this.E1*this.E1*this.E1/96)*Math.sin(6*mu);var _2b=_2a*this.RAD_2_DEG;var N1=this.EQUATORIAL_RADIUS/Math.sqrt(1-this.ECC_SQUARED*Math.sin(_2a)*Math.sin(_2a));var T1=Math.tan(_2a)*Math.tan(_2a);var C1=this.ECC_PRIME_SQUARED*Math.cos(_2a)*Math.cos(_2a);var R1=this.EQUATORIAL_RADIUS*(1-this.ECC_SQUARED)/Math.pow(1-this.ECC_SQUARED*Math.sin(_2a)*Math.sin(_2a),1.5);var D=_26/(N1*this.k0);var lat=_2a-(N1*Math.tan(_2a)/R1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*this.ECC_PRIME_SQUARED)*D*D*D*D/24+(61+90*T1+298*C1+45*T1*T1-252*this.ECC_PRIME_SQUARED-3*C1*C1)*D*D*D*D*D*D/720);lat=lat*this.RAD_2_DEG;var lon=(D-(1+2*T1+C1)*D*D*D/6+(5-2*C1+28*T1-3*C1*C1+8*this.ECC_PRIME_SQUARED+24*T1*T1)*D*D*D*D*D/120)/Math.cos(_2a);lon=_29+lon*this.RAD_2_DEG;ret.lat=lat;ret.lon=lon;},LLtoMGRS:function(lat,lon,_2c){var _2d="";var _2e=this.LLtoUSNG(lat,lon,_2c);var _2f=/ /g;return _2e.replace(_2f,"");},LLtoUSNG:function(lat,lon,_30){var _31;lat=parseFloat(lat);lon=parseFloat(lon);var _32=this.LLtoUTM(lat,lon);var _33=_32.easting;var _34=_32.northing;if(lat<0){_34+=this.NORTHING_OFFSET;}var _35=this.getZoneNumber(lat,lon);var _36=this.findGridLetters(_35,_34,_33);var _37=Math.round(_34)%this.BLOCK_SIZE;var _38=Math.round(_33)%this.BLOCK_SIZE;_37=Math.floor(_37/Math.pow(10,(5-_30)));_38=Math.floor(_38/Math.pow(10,(5-_30)));_31=this.getZoneNumber(lat,lon)+this.UTMLetterDesignator(lat)+" "+_36+" ";var i;for(i=String(_38).length;i<_30;i++){_31+="0";}_31+=_38+" ";for(i=String(_37).length;i<_30;i++){_31+="0";}return _31;},LLtoUTM:function(lat,lon,_39){lat=parseFloat(lat);lon=parseFloat(lon);if(lat>84||lat<-80){return this.UNDEFINED_STR;}var _3a=(lon+180)-parseInt((lon+180)/360,10)*360-180;var _3b=lat*this.DEG_2_RAD;var _3c=_3a*this.DEG_2_RAD;var _3d=this.getZoneNumber(lat,lon);var _3e=(_3d-1)*6-180+3;var _3f=_3e*this.DEG_2_RAD;var _40=_3d+""+this.UTMLetterDesignator(lat)+" ";var N=this.EQUATORIAL_RADIUS/Math.sqrt(1-this.ECC_SQUARED*Math.sin(_3b)*Math.sin(_3b));var T=Math.tan(_3b)*Math.tan(_3b);var C=this.ECC_PRIME_SQUARED*Math.cos(_3b)*Math.cos(_3b);var A=Math.cos(_3b)*(_3c-_3f);var M=this.EQUATORIAL_RADIUS*((1-this.ECC_SQUARED/4-3*(this.ECC_SQUARED*this.ECC_SQUARED)/64-5*(this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED)/256)*_3b-(3*this.ECC_SQUARED/8+3*this.ECC_SQUARED*this.ECC_SQUARED/32+45*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/1024)*Math.sin(2*_3b)+(15*this.ECC_SQUARED*this.ECC_SQUARED/256+45*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/1024)*Math.sin(4*_3b)-(35*this.ECC_SQUARED*this.ECC_SQUARED*this.ECC_SQUARED/3072)*Math.sin(6*_3b));var _41=(this.k0*N*(A+(1-T+C)*(A*A*A)/6+(5-18*T+T*T+72*C-58*this.ECC_PRIME_SQUARED)*(A*A*A*A*A)/120)+this.EASTING_OFFSET);var _42=(this.k0*(M+N*Math.tan(_3b)*((A*A)/2+(5-T+9*C+4*C*C)*(A*A*A*A)/24+(61-58*T+T*T+600*C-330*this.ECC_PRIME_SQUARED)*(A*A*A*A*A*A)/720)));return {easting:_41,northing:_42,zone:_3d};},getZoneNumber:function(lat,lon){lat=parseFloat(lat);lon=parseFloat(lon);var _43=(lon+180)-parseInt((lon+180)/360,10)*360-180;var _44=parseInt((_43+180)/6,10)+1;if(lat>=56&&lat<64&&_43>=3&&_43<12){_44=32;}if(lat>=72&&lat<84){if(_43>=0&&_43<9){_44=31;}else{if(_43>=9&&_43<21){_44=33;}else{if(_43>=21&&_43<33){_44=35;}else{if(_43>=33&&_43<42){_44=37;}}}}}return _44;},findGridLetters:function(_45,_46,_47){_45=parseInt(_45,10);_46=parseFloat(_46);_47=parseFloat(_47);row=1;var _48=Math.round(_46);while(_48>=this.BLOCK_SIZE){_48=_48-this.BLOCK_SIZE;row++;}var row=row%this.GRIDSQUARE_SET_ROW_SIZE;var col=0;var _49=Math.round(_47);while(_49>=this.BLOCK_SIZE){_49=_49-this.BLOCK_SIZE;col++;}col=col%this.GRIDSQUARE_SET_COL_SIZE;return this.lettersHelper(this.findSet(_45),row,col);},findSet:function(_4a){_4a=parseInt(_4a,10);_4a=_4a%6;switch(_4a){case 0:return 6;break;case 1:return 1;break;case 2:return 2;break;case 3:return 3;break;case 4:return 4;break;case 5:return 5;break;default:return -1;break;}},lettersHelper:function(set,row,col){if(row==0){row=this.GRIDSQUARE_SET_ROW_SIZE-1;}else{row--;}if(col==0){col=this.GRIDSQUARE_SET_COL_SIZE-1;}else{col--;}var l1;var l2;switch(set){case 1:l1="ABCDEFGH";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 2:l1="JKLMNPQR";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;case 3:l1="STUVWXYZ";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 4:l1="ABCDEFGH";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;case 5:l1="JKLMNPQR";l2="ABCDEFGHJKLMNPQRSTUV";return l1.charAt(col)+l2.charAt(row);break;case 6:l1="STUVWXYZ";l2="FGHJKLMNPQRSTUVABCDE";return l1.charAt(col)+l2.charAt(row);break;}},UTMLetterDesignator:function(lat){lat=parseFloat(lat);var _4b;if((84>=lat)&&(lat>=72)){_4b="X";}else{if((72>lat)&&(lat>=64)){_4b="W";}else{if((64>lat)&&(lat>=56)){_4b="V";}else{if((56>lat)&&(lat>=48)){_4b="U";}else{if((48>lat)&&(lat>=40)){_4b="T";}else{if((40>lat)&&(lat>=32)){_4b="S";}else{if((32>lat)&&(lat>=24)){_4b="R";}else{if((24>lat)&&(lat>=16)){_4b="Q";}else{if((16>lat)&&(lat>=8)){_4b="P";}else{if((8>lat)&&(lat>=0)){_4b="N";}else{if((0>lat)&&(lat>=-8)){_4b="M";}else{if((-8>lat)&&(lat>=-16)){_4b="L";}else{if((-16>lat)&&(lat>=-24)){_4b="K";}else{if((-24>lat)&&(lat>=-32)){_4b="J";}else{if((-32>lat)&&(lat>=-40)){_4b="H";}else{if((-40>lat)&&(lat>=-48)){_4b="G";}else{if((-48>lat)&&(lat>=-56)){_4b="F";}else{if((-56>lat)&&(lat>=-64)){_4b="E";}else{if((-64>lat)&&(lat>=-72)){_4b="D";}else{if((-72>lat)&&(lat>=-80)){_4b="C";}else{_4b="Z";}}}}}}}}}}}}}}}}}}}}return _4b;}});});