//>>built
require({cache:{"url:esriviewer/ui/configure/template/ConfigureViewerTemplate.html":"<div class=\"configureViewerContainer\">\r\n    <div class=\"defaultTabContainer\" data-bind=\"visible: persistedViewEnabled\">\r\n        <span  data-bind=\"click:showAddEntriesView, css: {selectedTab: addEntriesVisible}\">Add Data</span>\r\n        <span data-bind=\"click:showPersistedEntriesView, css: {selectedTab: persistedEntriesVisible}\">Saved Data</span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"persistedEntriesContainer\" data-bind=\"visible: persistedEntriesVisible\">\r\n    </div>\r\n    <div data-dojo-attach-point=\"addConfigurationEntriesContainer\" data-bind=\"visible: addEntriesVisible\">\r\n        <div data-bind=\"visible: showBasemapsConfiguration\"\r\n             class=\"configureViewerEntry fivePixelBorderRadius defaultBackground defaultBorder blueBoxShadow configureViewerFirstEntry\">\r\n            <div class=\"configureViewerEntryHeader\">Base Maps</div>\r\n            <div class=\"configureViewerEntryContent\">\r\n                <div class=\"configureViewerEntryLabel\">Base Map URL:</div>\r\n                <div data-dojo-attach-point=\"basemapAddInput\" style=\"width: 80%\"\r\n                     data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-event=\"onKeyUp:handleBasemapInputKeyUp\"></div>\r\n                <div data-dojo-attach-point=\"referenceMapsAddInput\"\r\n                     data-dojo-attach-event=\"onClick:handleAddManualBasemap\"\r\n                     data-dojo-type=\"dijit/form/Button\"> Add Base Map\r\n                </div>\r\n                <div class=\"configureViewerWarning\">Cached map services will be added as tiled if they are in\r\n                    the same spatial reference as the map.\r\n                </div>\r\n                <div data-dojo-attach-point=\"basemapAddedLayersContainer\" class=\"basemapAddedLayersContainer\"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"configureViewerEntry fivePixelBorderRadius defaultBackground defaultBorder blueBoxShadow \">\r\n            <div class=\"configureViewerEntryHeader\">Reference Maps</div>\r\n            <div class=\"configureViewerEntryContent\">\r\n                <div class=\"configureViewerEntryLabel\">Reference Map URL:</div>\r\n                <div data-dojo-attach-point=\"referenceMapsAddInput\" style=\"width: 80%\"\r\n                     data-dojo-type=\"dijit/form/TextBox\"\r\n                     data-dojo-attach-event=\"onKeyUp:handleReferenceLayerInputKeyUp\"></div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:handleAddReferenceLayer\"> Add\r\n                    Reference Map\r\n                </div>\r\n                <div class=\"configureViewerWarning\">Reference maps will be toggled with the \"Labels\" toolbar button\r\n                </div>\r\n                <div data-dojo-attach-point=\"referenceAddedLayersContainer\" class=\"referenceAddedLayersContainer\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"configureViewerEntry fivePixelBorderRadius defaultBackground defaultBorder blueBoxShadow \"\r\n             data-bind=\"visible: showLocatorsConfiguration\">\r\n            <div class=\"configureViewerEntryHeader\">Locators</div>\r\n            <div class=\"configureViewerEntryContent\">\r\n                <div class=\"configureViewerEntryLabel\">Locator URL:</div>\r\n                <div data-dojo-attach-point=\"locatorAddInput\" data-dojo-attach-event=\"onKeyUp:handleLocatorInputKeyUp\"\r\n                     style=\"width: 80%\" data-dojo-type=\"dijit/form/TextBox\"></div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:handleAddLocatorService\"> Add\r\n                    Locator\r\n                </div>\r\n                <div class=\"configureViewerWarning\">Locator service must accept a single line address for finding\r\n                    candidates.\r\n                </div>\r\n                <div data-dojo-attach-point=\"addedLocatorsContainer\" class=\"addedLocatorsContainer\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</div>"}});define("esriviewer/ui/configure/ConfigureViewerWidget",["dojo/_base/declare","dojo/text!./template/ConfigureViewerTemplate.html","dojo/topic","dojo/on","dojo/_base/lang","dojo/dom-construct","dojo/dom-style","../base/UITemplatedWidget","../tooltip/ConfirmTooltip","./ConfigureViewerLocalStorageMixin","./model/ConfigureViewerViewModel","./ConfigureViewerPersistedListWidget","dijit/form/TextBox","dijit/form/Button"],function(_1,_2,_3,on,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _1([_7,_9],{templateString:_2,constructor:function(){this.basemapsInConfiguration={};this.locatorsInConfiguration={};this.referenceLayersInConfiguration={};this.showBasemapsConfiguration=true;this.showLocatorsConfiguration=true;this.addedBasemaps={};this.addedReferenceLayers={};this.addedLocators={};this.basemapAddedCallback=_4.hitch(this,this.handleManualBasemapAdded);this.basemapAddErrorCallback=_4.hitch(this,this.handleManualBasemapAdded);this.referenceLayerAddedCallback=_4.hitch(this,this.handleManualReferenceLayerAdded);this.referenceLayerAddErrorCallback=_4.hitch(this,this.handleManualReferenceLayerAddError);this.locatorAddedCallback=_4.hitch(this,this.handleManualLocatorAdded);},postCreate:function(){this.inherited(arguments);this.viewModel=new _a();this.viewModel.persistedViewEnabled(this.localStoragePersistSupported);if(!this.showBasemapsConfiguration){this.viewModel.showBasemapsConfiguration(false);}if(!this.showLocatorsConfiguration){this.viewModel.showLocatorsConfiguration(false);}ko.applyBindings(this.viewModel,this.domNode);if(this.localStoragePersistSupported){this.createViewerPersistedListWidget();}},loadViewerConfigurationData:function(){var _e=null;_3.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"toolsBar",function(_f){_e=_f;});if(_e!=null&&_4.isObject(_e)){if(_e.showConfigureLocatorsIcon!=null&&_e.showConfigureLocatorsIcon==false){this.showLocatorsConfiguration=false;}}var _10=null;_3.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"map",function(_11){_10=_11;});if(_10&&_4.isObject(_10)){var key;if(_10.useBasemapGallery==true){this.showBasemapsConfiguration=false;}if(_10.referenceLayers!=null&&_4.isObject(_10.referenceLayers)){var _12;var _13;for(key in _10.referenceLayers){_12=_10.referenceLayers[key];_13=VIEWER_UTILS.getLayerUniqueId(_12);if(_13){this.referenceLayersInConfiguration[_13]=_13;}}}if(this.showBasemapsConfiguration&&_10.basemaps!=null&&_4.isObject(_10.basemaps)){var _14;var _15;for(key in _10.basemaps){_14=_10.basemaps[key];if(_14.url!=null&&_14.url!=""){_15=VIEWER_UTILS.getLayerUniqueId(_14);if(_15!=null){this.basemapsInConfiguration[_15]=_15;}}}}}var _16=null;_3.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"locators",function(_17){_16=_17;});if(_16&&_4.isObject(_16)){var _18;var _19;for(key in _16){_18=_16[key];_19=_18.url.toLowerCase();this.locatorsInConfiguration[_19]=_19;}}},createViewerPersistedListWidget:function(){if(this.userPersistedViewerConfigurationListWidget==null){this.userPersistedViewerConfigurationListWidget=new _b();this.userPersistedViewerConfigurationListWidget.placeAt(this.persistedEntriesContainer);this.userPersistedViewerConfigurationListWidget.on("removeReferenceLayer",_4.hitch(this,this.handlePersistedReferenceLayerRemoved));this.userPersistedViewerConfigurationListWidget.on("addReferenceLayer",_4.hitch(this,this.handleAddPersistedReferenceLayer));this.userPersistedViewerConfigurationListWidget.addExistingPersistedReferenceLayerItems(this.persistedReferenceLayers);if(!this.showBasemapsConfiguration){this.userPersistedViewerConfigurationListWidget.hideSavedBookmarks();}else{this.userPersistedViewerConfigurationListWidget.on("removeBasemap",_4.hitch(this,this.handlePersistedBasemapRemoved));this.userPersistedViewerConfigurationListWidget.on("addBasemap",_4.hitch(this,this.handleAddPersistedBasemap));this.userPersistedViewerConfigurationListWidget.addExistingPersistedBasemapItems(this.persistedBasemaps);}if(!this.showLocatorsConfiguration){this.userPersistedViewerConfigurationListWidget.hideSavedLocators();}else{this.userPersistedViewerConfigurationListWidget.on("addLocator",_4.hitch(this,this.handleAddPersistedLocator));this.userPersistedViewerConfigurationListWidget.on("removeLocator",_4.hitch(this,this.handlePersistedLocatorRemoved));this.userPersistedViewerConfigurationListWidget.addExistingPersistedLocatorItems(this.persistedLocators);}this.userPersistedViewerConfigurationListWidget.applyBindings();}},handleAddPersistedBasemap:function(_1a){if(_1a!=null&&_4.isObject(_1a)&&_1a.url!=null&&_1a.url!=""){this._addBasemapLayer(_1a.url);}},handleAddPersistedLocator:function(_1b){if(_1b!=null&&_4.isObject(_1b)&&_1b.url!=null&&_1b.url!=""){this._addLocatorService(_1b.url);}},handleAddPersistedReferenceLayer:function(_1c){if(_1c!=null&&_4.isObject(_1c)&&_1c.url!=null&&_1c.url!=""){this._addReferenceLayer(_1c.url);}},handlePersistedReferenceLayerRemoved:function(_1d){this.deleteUserPersistedReferenceLayer(_1d);},handlePersistedLocatorRemoved:function(_1e){this.deleteUserPersistedLocator(_1e);},handlePersistedBasemapRemoved:function(_1f){this.deleteUserPersistedBasemap(_1f);},saveBasemap:function(_20){var _21=this.persistBasemap(_20);if(_21){this.userPersistedViewerConfigurationListWidget.addBasemap(_21);}},saveLocator:function(_22){var _23=this.persistLocator(_22);if(_23){this.userPersistedViewerConfigurationListWidget.addLocator(_23);}},saveReferenceLayer:function(_24){var _25=this.persistReferenceLayer(_24);if(_25){this.userPersistedViewerConfigurationListWidget.addReferenceLayer(_25);}},handleBasemapInputKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handleAddManualBasemap();}},handleAddManualBasemap:function(){var _26=this.basemapAddInput.get("value");if(_26==null||_26==""){return;}this._addBasemapLayer(_26);},_addBasemapLayer:function(_27){var _28=_27.toLowerCase();if(this.addedBasemaps[_28]!=null||this.basemapsInConfiguration[_28]!=null){VIEWER_UTILS.log("Cannot add basemap. Basemap already exists.",VIEWER_GLOBALS.LOG_TYPE.WARNING);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Basemap already added");return;}var _29=VIEWER_UTILS.getServiceTypeFromUrl(_27);if(_27!=""){if(_29==VIEWER_GLOBALS.SERVICE_TYPES.MAP_SERVER){VIEWER_UTILS.log("Attempting to add base map: "+_27,VIEWER_GLOBALS.LOG_TYPE.INFO);_3.publish(VIEWER_GLOBALS.EVENTS.MAP.BASEMAP.ADD,_27,this.basemapAddedCallback,this.basemapAddErrorCallback);}else{VIEWER_UTILS.log("Cannot add type: "+_29+" as a base map",VIEWER_GLOBALS.LOG_TYPE.ERROR);}}},handleReferenceLayerInputKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handleAddReferenceLayer();}},handleAddReferenceLayer:function(){var _2a=this.referenceMapsAddInput.get("value");if(_2a==null||_2a==""){return;}this._addReferenceLayer(_2a);},_addReferenceLayer:function(_2b){var _2c=_2b.toLowerCase();if(this.addedReferenceLayers[_2c]!=null||this.referenceLayersInConfiguration[_2c]!=null){VIEWER_UTILS.log("Cannot add reference layer. Reference layer already exists.",VIEWER_GLOBALS.LOG_TYPE.WARNING);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Reference layer already added");return;}var _2d=VIEWER_UTILS.getServiceTypeFromUrl(_2b);if(_2b==""||_2d==null){return;}_3.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD_REFERENCE_LAYER,{type:"dynamic",url:_2b},this.referenceLayerAddedCallback,this.referenceLayerAddErrorCallback);},_createAddedEntry:function(_2e,_2f){var _30=_5.create("div",{className:"viewerConfigurationAddedElement"});var _31=_5.create("span",{innerHTML:_2e,className:"addedElementLabel"});var _32=_5.create("div",{className:"commonIcons16 remove configureEntryRemoveIcon"});_5.place(_32,_30);_5.place(_31,_30);_5.place(_30,_2f);return ({container:_30,removeIcon:_32});},handleManualBasemapAdded:function(_33){if(_33==null||!_4.isObject(_33)){VIEWER_UTILS.log("Cannot add basemap",VIEWER_GLOBALS.LOG_TYPE.ERROR);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Cannot add basemap");return;}var _34=_33.url.toLowerCase();this.addedBasemaps[_34]=_34;this.basemapAddInput.set("value","");var _35=this._createAddedEntry(_33.label,this.basemapAddedLayersContainer);on(_35.removeIcon,"click",_4.hitch(this,this.handleRemoveBasemapRequest,_33,_35));if(this.localStoragePersistSupported){this.saveBasemap({label:_33.label,url:_33.url});}},handleManualBasemapAddError:function(err){VIEWER_UTILS.log("Cannot add basemap",VIEWER_GLOBALS.LOG_TYPE.ERROR);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Cannot add basemap");},handleManualReferenceLayerAdded:function(_36){if(_36==null||!_4.isObject(_36)){VIEWER_UTILS.log("Cannot add reference layer",VIEWER_GLOBALS.LOG_TYPE.ERROR);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Cannot add reference layer");return;}var _37;if(_36.url){_37=_36.url.toLowerCase();}else{_37=_36.id;}if(_37==null){return;}this.addedReferenceLayers[_37]=_37;this.referenceMapsAddInput.set("value","");var _38=REG_EXP_UTILS.getServiceNameFromUrl(_36.url);var _39=this._createAddedEntry(_38,this.referenceAddedLayersContainer);on(_39.removeIcon,"click",_4.hitch(this,this.handleRemoveReferenceLayerRequest,_36,_39));if(this.localStoragePersistSupported){this.saveReferenceLayer({label:_38,url:_36.url});}},handleManualReferenceLayerAddError:function(err){this.referenceMapsAddInput.set("value","");VIEWER_UTILS.log("Cannot add reference layer",VIEWER_GLOBALS.LOG_TYPE.ERROR);VIEWER_UTILS.log("Cannot add reference layer",VIEWER_GLOBALS.LOG_TYPE.ERROR);},handleLocatorInputKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handleAddLocatorService();}},handleManualLocatorAdded:function(id,_3a){var _3b=_3a.toLowerCase();this.addedLocators[_3b]=_3b;VIEWER_UTILS.log("Added locator: "+_3a,VIEWER_GLOBALS.LOG_TYPE.INFO);this.locatorAddInput.set("value","");var _3c=REG_EXP_UTILS.getServiceNameFromUrl(_3a);var _3d=this._createAddedEntry(_3c,this.addedLocatorsContainer);on(_3d.removeIcon,"click",_4.hitch(this,this.handleRemoveLocatorRequest,id,_3d));if(this.localStoragePersistSupported){this.saveLocator({label:_3c,url:_3a});}},handleAddLocatorService:function(){var _3e=this.locatorAddInput.get("value");if(_3e==null||_3e==""){return;}this._addLocatorService(_3e);},_addLocatorService:function(_3f){var _40=_3f.toLowerCase();if(this.addedLocators[_40]!=null||this.locatorsInConfiguration[_40]!=null){VIEWER_UTILS.log("Cannot add locator. Locator already exists.",VIEWER_GLOBALS.LOG_TYPE.WARNING);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Locator already added");return;}var _41=VIEWER_UTILS.getServiceTypeFromUrl(_3f);if(_41==VIEWER_GLOBALS.SERVICE_TYPES.GEOCODE_SERVER){_3.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.ADD_LOCATOR,_3f,this.locatorAddedCallback);}},createConfirmDeleteEntryTooltip:function(){this.confirmDeleteEntryTooltip=new _8({confirmCallback:_4.hitch(this,this.handleConfirmedEntryDelete)});this.confirmDeleteEntryTooltip.on("hide",_4.hitch(this,function(){this.deleteEntryConfirmedCallback=null;}));},handleConfirmedEntryDelete:function(){if(this.deleteEntryConfirmedCallback!=null&&_4.isFunction(this.deleteEntryConfirmedCallback)){this.deleteEntryConfirmedCallback();}this.deleteEntryConfirmedCallback=null;},showDeleteEntryTooltip:function(_42){if(_42==null){return;}if(this.confirmDeleteEntryTooltip==null){this.createConfirmDeleteEntryTooltip();}if(this.confirmDeleteEntryTooltip){this.confirmDeleteEntryTooltip.setAroundNode(_42);this.confirmDeleteEntryTooltip.show();}},handleRemoveBasemapRequest:function(_43,_44){this.deleteEntryConfirmedCallback=_4.hitch(this,this._removeBasemap,_43,_44);this.showDeleteEntryTooltip(_44.removeIcon);},handleRemoveLocatorRequest:function(_45,_46){this.deleteEntryConfirmedCallback=_4.hitch(this,this._removeLocator,_45,_46);this.showDeleteEntryTooltip(_46.removeIcon);},handleRemoveReferenceLayerRequest:function(_47,_48){this.deleteEntryConfirmedCallback=_4.hitch(this,this._removeReferenceLayer,_47,_48);this.showDeleteEntryTooltip(_48.removeIcon);},_removeBasemap:function(_49,_4a){_3.publish(VIEWER_GLOBALS.EVENTS.MAP.BASEMAP.REMOVE,_49.id);var _4b=_49.url.toLowerCase();this.addedBasemaps[_4b]=_4b;_5.destroy(_4a.container);},_removeLocator:function(_4c,_4d){_3.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.REMOVE_LOCATOR,_4c);_5.destroy(_4d.container);},_removeReferenceLayer:function(_4e,_4f){_3.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVE_REFERENCE_LAYER,_4e);var _50=null;if(_4e.url){_50=_4e.url.toLowerCase();}else{_50=_4e.id;}if(_50==null){return;}delete this.addedReferenceLayers[_50];_5.destroy(_4f.container);},hidePopups:function(){if(this.confirmDeleteEntryTooltip){this.confirmDeleteEntryTooltip.hide();}}});});