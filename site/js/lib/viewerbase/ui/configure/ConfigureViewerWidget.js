//>>built
require({cache:{"url:esriviewer/ui/configure/template/ConfigureViewerTemplate.html":"<div class=\"configureViewerContainer\">\r\n    <div class=\"defaultTabContainer\" data-bind=\"visible: persistedViewEnabled\">\r\n        <span data-bind=\"click:showPersistedEntriesView, css: {selectedTab: persistedEntriesVisible}\">Saved Data</span>\r\n        <span data-bind=\"click:showAddEntriesView, css: {selectedTab: addEntriesVisible}\">Add Data</span>\r\n    </div>\r\n\r\n    <div data-dojo-attach-point=\"persistedEntriesContainer\" data-bind=\"visible: persistedEntriesVisible\">\r\n        <div class=\"configureViewerEntry fivePixelBorderRadius defaultBackground defaultBorder blueBoxShadow \">\r\n            <div class=\"configurePersistedViewerEntryLabel\">Stored data (requires reload)</div>\r\n            <div class=\"configureClearDataLbl\" data-bind=\"click:clearPortalToken\">Clear Portal Token\r\n            </div>\r\n            <div class=\"configureClearDataLbl\" data-bind=\"click:clearBookmarks\">Clear Saved Bookmarks</div>\r\n            <div class=\"configureClearDataLbl\" data-bind=\"click:clearSavedLayers\">Clear Saved layers</div>\r\n            <!--<div class=\"configureClearDataLbl\" data-bind=\"click:clearSavedGraphics\">Clear Saved Graphics</div>-->\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"addConfigurationEntriesContainer\" data-bind=\"visible: addEntriesVisible\">\r\n        <div data-bind=\"visible: showBasemapsConfiguration\"\r\n             class=\"configureViewerEntry fivePixelBorderRadius defaultBackground defaultBorder blueBoxShadow configureViewerFirstEntry\">\r\n            <div class=\"configureViewerEntryHeader\">Base Maps</div>\r\n            <div class=\"configureViewerEntryContent\">\r\n                <div class=\"configureViewerEntryLabel\">Base Map URL:</div>\r\n                <div data-dojo-attach-point=\"basemapAddInput\" style=\"width: 80%\"\r\n                     data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-event=\"onKeyUp:handleBasemapInputKeyUp\"></div>\r\n                <div data-dojo-attach-point=\"referenceMapsAddInput\"\r\n                     data-dojo-attach-event=\"onClick:handleAddManualBasemap\"\r\n                     data-dojo-type=\"dijit/form/Button\"> Add Base Map\r\n                </div>\r\n                <div class=\"configureViewerWarning\">Cached map services will be added as tiled if they are in\r\n                    the same spatial reference as the map.\r\n                </div>\r\n                <div data-dojo-attach-point=\"basemapAddedLayersContainer\" class=\"basemapAddedLayersContainer\"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"configureViewerEntry fivePixelBorderRadius defaultBackground defaultBorder blueBoxShadow \">\r\n            <div class=\"configureViewerEntryHeader\">Reference Maps</div>\r\n            <div class=\"configureViewerEntryContent\">\r\n                <div class=\"configureViewerEntryLabel\">Reference Map URL:</div>\r\n                <div data-dojo-attach-point=\"referenceMapsAddInput\" style=\"width: 80%\"\r\n                     data-dojo-type=\"dijit/form/TextBox\"\r\n                     data-dojo-attach-event=\"onKeyUp:handleReferenceLayerInputKeyUp\"></div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:handleAddReferenceLayer\"> Add\r\n                    Reference Map\r\n                </div>\r\n                <div class=\"configureViewerWarning\">Reference maps will be toggled with the \"Labels\" toolbar button\r\n                </div>\r\n                <div data-dojo-attach-point=\"referenceAddedLayersContainer\" class=\"referenceAddedLayersContainer\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"configureViewerEntry fivePixelBorderRadius defaultBackground defaultBorder blueBoxShadow \"\r\n             data-bind=\"visible: showLocatorsConfiguration\">\r\n            <div class=\"configureViewerEntryHeader\">Locators</div>\r\n            <div class=\"configureViewerEntryContent\">\r\n                <div class=\"configureViewerEntryLabel\">Locator URL:</div>\r\n                <div data-dojo-attach-point=\"locatorAddInput\" data-dojo-attach-event=\"onKeyUp:handleLocatorInputKeyUp\"\r\n                     style=\"width: 80%\" data-dojo-type=\"dijit/form/TextBox\"></div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:handleAddLocatorService\"> Add\r\n                    Locator\r\n                </div>\r\n                <div class=\"configureViewerWarning\">Locator service must accept a single line address for finding\r\n                    candidates.\r\n                </div>\r\n                <div data-dojo-attach-point=\"addedLocatorsContainer\" class=\"addedLocatorsContainer\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</div>"}});define("esriviewer/ui/configure/ConfigureViewerWidget",["dojo/_base/declare","dojo/text!./template/ConfigureViewerTemplate.html","dojo/topic","dojo/on","dojo/_base/lang","dojo/dom-construct","../base/UITemplatedWidget","../tooltip/ConfirmTooltip","./ConfigureViewerLocalStorageMixin","./model/ConfigureViewerViewModel","./ConfigureViewerPersistedListWidget","dijit/form/TextBox","dijit/form/Button"],function(_1,_2,_3,on,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1([_6,_8],{templateString:_2,constructor:function(){this.basemapsInConfiguration={};this.locatorsInConfiguration={};this.referenceLayersInConfiguration={};this.showBasemapsConfiguration=true;this.showLocatorsConfiguration=true;this.addedBasemaps={};this.addedReferenceLayers={};this.addedLocators={};this.basemapAddedCallback=_4.hitch(this,this.handleManualBasemapAdded);this.basemapAddErrorCallback=_4.hitch(this,this.handleManualBasemapAdded);this.referenceLayerAddedCallback=_4.hitch(this,this.handleManualReferenceLayerAdded);this.referenceLayerAddErrorCallback=_4.hitch(this,this.handleManualReferenceLayerAddError);this.locatorAddedCallback=_4.hitch(this,this.handleManualLocatorAdded);},postCreate:function(){this.inherited(arguments);this.viewModel=new _9();this.viewModel.persistedViewEnabled(this.localStoragePersistSupported);if(!this.showBasemapsConfiguration){this.viewModel.showBasemapsConfiguration(false);}if(!this.showLocatorsConfiguration){this.viewModel.showLocatorsConfiguration(false);}ko.applyBindings(this.viewModel,this.domNode);if(this.localStoragePersistSupported){this.createViewerPersistedListWidget();}},loadViewerConfigurationData:function(){var _d=null;_3.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"toolsBar",function(_e){_d=_e;});if(_d!=null&&_4.isObject(_d)){if(_d.showConfigureLocatorsIcon!=null&&_d.showConfigureLocatorsIcon==false){this.showLocatorsConfiguration=false;}}var _f=null;_3.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"map",function(_10){_f=_10;});if(_f&&_4.isObject(_f)){var key;if(_f.useBasemapGallery==true){this.showBasemapsConfiguration=false;}if(_f.referenceLayers!=null&&_4.isObject(_f.referenceLayers)){var _11;var _12;for(key in _f.referenceLayers){_11=_f.referenceLayers[key];_12=VIEWER_UTILS.getLayerUniqueId(_11);if(_12){this.referenceLayersInConfiguration[_12]=_12;}}}if(this.showBasemapsConfiguration&&_f.basemaps!=null&&_4.isObject(_f.basemaps)){var _13;var _14;for(key in _f.basemaps){_13=_f.basemaps[key];if(_13.url!=null&&_13.url!=""){_14=VIEWER_UTILS.getLayerUniqueId(_13);if(_14!=null){this.basemapsInConfiguration[_14]=_14;}}}}}var _15=null;_3.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"locators",function(_16){_15=_16;});if(_15&&_4.isObject(_15)){var _17;var _18;for(key in _15){_17=_15[key];_18=_17.url.toLowerCase();this.locatorsInConfiguration[_18]=_18;}}},createViewerPersistedListWidget:function(){if(this.userPersistedViewerConfigurationListWidget==null){this.userPersistedViewerConfigurationListWidget=new _a();this.userPersistedViewerConfigurationListWidget.placeAt(this.persistedEntriesContainer);this.userPersistedViewerConfigurationListWidget.on("removeReferenceLayer",_4.hitch(this,this.handlePersistedReferenceLayerRemoved));this.userPersistedViewerConfigurationListWidget.on("addReferenceLayer",_4.hitch(this,this.handleAddPersistedReferenceLayer));this.userPersistedViewerConfigurationListWidget.addExistingPersistedReferenceLayerItems(this.persistedReferenceLayers);if(!this.showBasemapsConfiguration){this.userPersistedViewerConfigurationListWidget.hideSavedBookmarks();}else{this.userPersistedViewerConfigurationListWidget.on("removeBasemap",_4.hitch(this,this.handlePersistedBasemapRemoved));this.userPersistedViewerConfigurationListWidget.on("addBasemap",_4.hitch(this,this.handleAddPersistedBasemap));this.userPersistedViewerConfigurationListWidget.addExistingPersistedBasemapItems(this.persistedBasemaps);}if(!this.showLocatorsConfiguration){this.userPersistedViewerConfigurationListWidget.hideSavedLocators();}else{this.userPersistedViewerConfigurationListWidget.on("addLocator",_4.hitch(this,this.handleAddPersistedLocator));this.userPersistedViewerConfigurationListWidget.on("removeLocator",_4.hitch(this,this.handlePersistedLocatorRemoved));this.userPersistedViewerConfigurationListWidget.addExistingPersistedLocatorItems(this.persistedLocators);}this.userPersistedViewerConfigurationListWidget.applyBindings();}},handleAddPersistedBasemap:function(_19){if(_19!=null&&_4.isObject(_19)&&_19.url!=null&&_19.url!=""){this._addBasemapLayer(_19.url);}},handleAddPersistedLocator:function(_1a){if(_1a!=null&&_4.isObject(_1a)&&_1a.url!=null&&_1a.url!=""){this._addLocatorService(_1a.url);}},handleAddPersistedReferenceLayer:function(_1b){if(_1b!=null&&_4.isObject(_1b)&&_1b.url!=null&&_1b.url!=""){this._addReferenceLayer(_1b.url);}},handlePersistedReferenceLayerRemoved:function(_1c){this.deleteUserPersistedReferenceLayer(_1c);},handlePersistedLocatorRemoved:function(_1d){this.deleteUserPersistedLocator(_1d);},handlePersistedBasemapRemoved:function(_1e){this.deleteUserPersistedBasemap(_1e);},saveBasemap:function(_1f){var _20=this.persistBasemap(_1f);if(_20){this.userPersistedViewerConfigurationListWidget.addBasemap(_20);}},saveLocator:function(_21){var _22=this.persistLocator(_21);if(_22){this.userPersistedViewerConfigurationListWidget.addLocator(_22);}},saveReferenceLayer:function(_23){var _24=this.persistReferenceLayer(_23);if(_24){this.userPersistedViewerConfigurationListWidget.addReferenceLayer(_24);}},handleBasemapInputKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handleAddManualBasemap();}},handleAddManualBasemap:function(){var _25=this.basemapAddInput.get("value");if(_25==null||_25==""){return;}this._addBasemapLayer(_25);},_addBasemapLayer:function(_26){var _27=_26.toLowerCase();if(this.addedBasemaps[_27]!=null||this.basemapsInConfiguration[_27]!=null){VIEWER_UTILS.log("Cannot add basemap. Basemap already exists.",VIEWER_GLOBALS.LOG_TYPE.WARNING);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Basemap already added");return;}var _28=VIEWER_UTILS.getServiceTypeFromUrl(_26);if(_26!=""){if(_28==VIEWER_GLOBALS.SERVICE_TYPES.MAP_SERVER){VIEWER_UTILS.log("Attempting to add base map: "+_26,VIEWER_GLOBALS.LOG_TYPE.INFO);_3.publish(VIEWER_GLOBALS.EVENTS.MAP.BASEMAP.ADD,_26,this.basemapAddedCallback,this.basemapAddErrorCallback);}else{VIEWER_UTILS.log("Cannot add type: "+_28+" as a base map",VIEWER_GLOBALS.LOG_TYPE.ERROR);}}},handleReferenceLayerInputKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handleAddReferenceLayer();}},handleAddReferenceLayer:function(){var _29=this.referenceMapsAddInput.get("value");if(_29==null||_29==""){return;}this._addReferenceLayer(_29);},_addReferenceLayer:function(_2a){var _2b=_2a.toLowerCase();if(this.addedReferenceLayers[_2b]!=null||this.referenceLayersInConfiguration[_2b]!=null){VIEWER_UTILS.log("Cannot add reference layer. Reference layer already exists.",VIEWER_GLOBALS.LOG_TYPE.WARNING);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Reference layer already added");return;}var _2c=VIEWER_UTILS.getServiceTypeFromUrl(_2a);if(_2a==""||_2c==null){return;}_3.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD_REFERENCE_LAYER,{type:"dynamic",url:_2a},this.referenceLayerAddedCallback,this.referenceLayerAddErrorCallback);},_createAddedEntry:function(_2d,_2e){var _2f=_5.create("div",{className:"viewerConfigurationAddedElement"});var _30=_5.create("span",{innerHTML:_2d,className:"addedElementLabel"});var _31=_5.create("div",{className:"commonIcons16 remove configureEntryRemoveIcon"});_5.place(_31,_2f);_5.place(_30,_2f);_5.place(_2f,_2e);return ({container:_2f,removeIcon:_31});},handleManualBasemapAdded:function(_32){if(_32==null||!_4.isObject(_32)){VIEWER_UTILS.log("Cannot add basemap",VIEWER_GLOBALS.LOG_TYPE.ERROR);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Cannot add basemap");return;}var _33=_32.url.toLowerCase();this.addedBasemaps[_33]=_33;this.basemapAddInput.set("value","");var _34=this._createAddedEntry(_32.label,this.basemapAddedLayersContainer);on(_34.removeIcon,"click",_4.hitch(this,this.handleRemoveBasemapRequest,_32,_34));if(this.localStoragePersistSupported){this.saveBasemap({label:_32.label,url:_32.url});}},handleManualBasemapAddError:function(err){VIEWER_UTILS.log("Cannot add basemap",VIEWER_GLOBALS.LOG_TYPE.ERROR);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Cannot add basemap");},handleManualReferenceLayerAdded:function(_35){if(_35==null||!_4.isObject(_35)){VIEWER_UTILS.log("Cannot add reference layer",VIEWER_GLOBALS.LOG_TYPE.ERROR);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Cannot add reference layer");return;}var _36;if(_35.url){_36=_35.url.toLowerCase();}else{_36=_35.id;}if(_36==null){return;}this.addedReferenceLayers[_36]=_36;this.referenceMapsAddInput.set("value","");var _37=REG_EXP_UTILS.getServiceNameFromUrl(_35.url);var _38=this._createAddedEntry(_37,this.referenceAddedLayersContainer);on(_38.removeIcon,"click",_4.hitch(this,this.handleRemoveReferenceLayerRequest,_35,_38));if(this.localStoragePersistSupported){this.saveReferenceLayer({label:_37,url:_35.url});}},handleManualReferenceLayerAddError:function(err){this.referenceMapsAddInput.set("value","");VIEWER_UTILS.log("Cannot add reference layer",VIEWER_GLOBALS.LOG_TYPE.ERROR);VIEWER_UTILS.log("Cannot add reference layer",VIEWER_GLOBALS.LOG_TYPE.ERROR);},handleLocatorInputKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handleAddLocatorService();}},handleManualLocatorAdded:function(id,_39){var _3a=_39.toLowerCase();this.addedLocators[_3a]=_3a;VIEWER_UTILS.log("Added locator: "+_39,VIEWER_GLOBALS.LOG_TYPE.INFO);this.locatorAddInput.set("value","");var _3b=REG_EXP_UTILS.getServiceNameFromUrl(_39);var _3c=this._createAddedEntry(_3b,this.addedLocatorsContainer);on(_3c.removeIcon,"click",_4.hitch(this,this.handleRemoveLocatorRequest,id,_3c));if(this.localStoragePersistSupported){this.saveLocator({label:_3b,url:_39});}},handleAddLocatorService:function(){var _3d=this.locatorAddInput.get("value");if(_3d==null||_3d==""){return;}this._addLocatorService(_3d);},_addLocatorService:function(_3e){var _3f=_3e.toLowerCase();if(this.addedLocators[_3f]!=null||this.locatorsInConfiguration[_3f]!=null){VIEWER_UTILS.log("Cannot add locator. Locator already exists.",VIEWER_GLOBALS.LOG_TYPE.WARNING);_3.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Locator already added");return;}var _40=VIEWER_UTILS.getServiceTypeFromUrl(_3e);if(_40==VIEWER_GLOBALS.SERVICE_TYPES.GEOCODE_SERVER){_3.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.ADD_LOCATOR,_3e,this.locatorAddedCallback);}},createConfirmDeleteEntryTooltip:function(){this.confirmDeleteEntryTooltip=new _7({confirmCallback:_4.hitch(this,this.handleConfirmedEntryDelete)});this.confirmDeleteEntryTooltip.on("hide",_4.hitch(this,function(){this.deleteEntryConfirmedCallback=null;}));},handleConfirmedEntryDelete:function(){if(this.deleteEntryConfirmedCallback!=null&&_4.isFunction(this.deleteEntryConfirmedCallback)){this.deleteEntryConfirmedCallback();}this.deleteEntryConfirmedCallback=null;},showDeleteEntryTooltip:function(_41){if(_41==null){return;}if(this.confirmDeleteEntryTooltip==null){this.createConfirmDeleteEntryTooltip();}if(this.confirmDeleteEntryTooltip){this.confirmDeleteEntryTooltip.setAroundNode(_41);this.confirmDeleteEntryTooltip.show();}},handleRemoveBasemapRequest:function(_42,_43){this.deleteEntryConfirmedCallback=_4.hitch(this,this._removeBasemap,_42,_43);this.showDeleteEntryTooltip(_43.removeIcon);},handleRemoveLocatorRequest:function(_44,_45){this.deleteEntryConfirmedCallback=_4.hitch(this,this._removeLocator,_44,_45);this.showDeleteEntryTooltip(_45.removeIcon);},handleRemoveReferenceLayerRequest:function(_46,_47){this.deleteEntryConfirmedCallback=_4.hitch(this,this._removeReferenceLayer,_46,_47);this.showDeleteEntryTooltip(_47.removeIcon);},_removeBasemap:function(_48,_49){_3.publish(VIEWER_GLOBALS.EVENTS.MAP.BASEMAP.REMOVE,_48.id);var _4a=_48.url.toLowerCase();this.addedBasemaps[_4a]=_4a;_5.destroy(_49.container);},_removeLocator:function(_4b,_4c){_3.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.REMOVE_LOCATOR,_4b);_5.destroy(_4c.container);},_removeReferenceLayer:function(_4d,_4e){_3.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVE_REFERENCE_LAYER,_4d);var _4f=null;if(_4d.url){_4f=_4d.url.toLowerCase();}else{_4f=_4d.id;}if(_4f==null){return;}delete this.addedReferenceLayers[_4f];_5.destroy(_4e.container);},hidePopups:function(){if(this.confirmDeleteEntryTooltip){this.confirmDeleteEntryTooltip.hide();}}});});