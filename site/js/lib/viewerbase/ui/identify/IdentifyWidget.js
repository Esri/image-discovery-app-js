//>>built
require({cache:{"url:esriviewer/ui/identify/theme/IdentifyWidgetTheme.css":".identifyWidgetSelect{width:100%;}.identifyLayerContainer{width:210px;float:left;}.identifyWidgetLabel{margin-bottom:3px;}.identifyResultList{list-style-type:none;margin:5px 0;padding:0;}.identifyResultContainer{margin:10px 0;padding:10px;width:90%;}.identifyResultListAttributes{list-style-type:none;padding:0;}.identifyResultListContainer{max-height:200px;overflow:auto;}.identifyResultListAttributes li{margin:3px 0;font-size:9pt;font-family:tahoma, sans-serif;}.identifyResultNameLbl{color:#AEAEAE;}.identifyResultHeader{border-bottom:1px solid #666666;padding-left:3px;margin-left:-5px;color:#666666;margin-bottom:5px;}.identifyResultListCloseIcon{float:right;}.identifyResultListCloseIconContainer{height:16px;}.identifyDrawActionsContainer{float:right;margin-left:15px;margin-top:15px;}.identifyServiceContainer{margin-top:5px;}.identifyWindowContent{padding-top:0 !important;}.identifyResultsClearText{cursor:pointer;text-decoration:underline;text-align:right;color:blue;margin-bottom:5px;}.identifyWidgetTabContainer{margin-bottom:10px !important;}.identifyOptionsToggleContainer{cursor:pointer;margin:10px 0;}","url:esriviewer/ui/identify/template/IdentifyWigetTemplate.html":"<div>\r\n    <div class=\"defaultTabContainer identifyWidgetTabContainer\" data-bind=\"visible: showTabContainer\">\r\n        <span data-bind=\"click:showQuery, css: {selectedTab: identifyQueryVisible}\">Identify</span>\r\n        <span data-bind=\"click:showResults, css: {selectedTab: identifyResultsVisible}\">Results</span>\r\n    </div>\r\n    <div class=\"identifyQueryContainer\" data-bind=\"visible: identifyQueryVisible\">\r\n        <div class=\"identifyServiceContainer\">\r\n            <div class=\"identifyWidgetLabel\">Map Service</div>\r\n            <select class=\"identifyWidgetSelect\"\r\n                    data-bind=\" options: services ,value:selectedService, optionsText: 'label', optionsValue: 'value', optionsCaption: 'Select A Service'\"></select>\r\n        </div>\r\n        <div class=\"identifyLayerContainer\" data-bind=\"visible:currentServiceIsMapService\">\r\n            <div class=\"identifyWidgetLabel\">Layer</div>\r\n            <select class=\"identifyWidgetSelect\"\r\n                    data-bind=\"options: layers ,value:selectedLayer, optionsText: 'label', optionsValue: 'value'\"></select>\r\n        </div>\r\n        <div class=\"identifyDrawActionsContainer\" data-bind=\"visible: showDrawContainer\">\r\n            <div class=\"commonIcons32 rectangleUnselected fivePixelBorderRadius\"\r\n                 data-bind=\"click: toggleDrawActive, css:{rectangleSelected: drawActive}\"></div>\r\n        </div>\r\n        <div class=\"identifyAdvancedOptionsContainer\" data-bind=\"visible:hasSelectedService\">\r\n            <div class=\"identifyOptionsToggleContainer\" data-bind=\"click:toggleIdentifyAdvancedOptions\">\r\n                <div style=\"float: left\" class=\"commonIcons16 up\"\r\n                     data-bind=\"css: {down: identifyAdvancedOptionsVisible() == true}\"></div>\r\n                <span>Advanced Options</span>\r\n            </div>\r\n            <div data-dojo-attach-point=\"identifyDisplayFieldsContainer\"\r\n                 data-bind=\"visible: identifyAdvancedOptionsVisible() == true\">\r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"identifyResultsContainer\" data-dojo-attach-point=\"identifyResultsContainer\"\r\n         data-bind=\"visible: identifyResultsVisible\">\r\n        <div class=\"identifyResultsClearText\" data-bind=\"visible:showClearResults, click:clearResults\">clear results\r\n        </div>\r\n\r\n\r\n    </div>\r\n\r\n</div>"}});define("esriviewer/ui/identify/IdentifyWidget",["dojo/_base/declare","xstyle/css!./theme/IdentifyWidgetTheme.css","dojo/text!./template/IdentifyWigetTemplate.html","dojo/_base/lang","dojo/_base/Color","dojo/topic","../base/UITemplatedWidget","./model/IdentifyWidgetViewModel","../draw/base/MapDrawSupport","./IdentifyResultsContents","./IdentifyAdvancedOptionsWidget","../../map/base/LayerQueryParameters","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/KMLLayer","esri/layers/WMSLayer","esri/layers/WMSLayer","esri/layers/FeatureLayer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13){return _1([_7,_9],{maxResults:50,firstResultSet:true,templateString:_3,postCreate:function(){this.inherited(arguments);this.layerInfoForAdvancedFieldsCallback=_4.hitch(this,this.handleLayerInfoForAdvancedFieldsLoaded);this.initSymbology();this.viewModel=new _8();this.viewModel.drawActive.subscribe(_4.hitch(this,this.handleDrawActiveChange));this.viewModel.on(this.viewModel.CLEAR_RESULTS,_4.hitch(this,this.handleClearResults));this.viewModel.showDrawContainer.subscribe(_4.hitch(this,this.handleDrawContainerVisibilityChanged));this.viewModel.selectedService.subscribe(_4.hitch(this,this.handleSelectedServiceChanged));this.loadServices();ko.applyBindings(this.viewModel,this.domNode);this.queryResponseCallback=_4.hitch(this,this.handleQueryResponse);this.queryErrorCallback=_4.hitch(this,this.handleQueryError);var _14;_6.publish(VIEWER_GLOBALS.EVENTS.MAP.GET,function(map){_14=map;});this.map=_14;this.identifyResponseContents=new _a();this.identifyResponseContents.placeAt(this.identifyResultsContainer);this.createIdentifyOptionsWidget();},loadViewerConfigurationData:function(){var _15;_6.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"identifyWidget",function(_16){_15=_16;});if(_15!=null&&_4.isObject(_15)&&_15.maxResults!=null){this.maxResults=_15.maxResults;}},handleSelectedServiceChanged:function(_17){if(_17==null){if(this.identifyOptionsWidget){this.identifyOptionsWidget.clearFields();}return;}var _18=this.viewModel.currentServiceIsMapService();var _19=this.viewModel.selectedLayer();if(_18&&_19!=null){if(_17!=null){VIEWER_UTILS.getLayerInfoFromService(_17.url,_19,this.layerInfoForAdvancedFieldsCallback);}}else{if(_17.fields!=null&&_4.isArray(_17.fields)){this.identifyOptionsWidget.setFields(_17.fields);}else{this.identifyOptionsWidget.clearFields();}}},handleLayerInfoForAdvancedFieldsLoaded:function(_1a){if(_1a&&_1a.fields!=null&&_4.isArray(_1a.fields)){this.identifyOptionsWidget.setFields(_1a.fields);}else{this.identifyOptionsWidget.clearFields();}},createIdentifyOptionsWidget:function(){this.identifyOptionsWidget=new _b();this.identifyOptionsWidget.placeAt(this.identifyDisplayFieldsContainer);},initSymbology:function(){this.polygonSymbol=new _e(_e.STYLE_SOLID,new _d(_d.STYLE_SOLID,new _5([0,255,0]),1),new _5([0,255,0,0]));},handleDrawActiveChange:function(_1b){if(_1b){this.handleRectangleDraw();}else{this.clearDraw();}},handleRectangleDraw:function(){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_RECTANGLE);},handleDrawContainerVisibilityChanged:function(_1c){if(!_1c){this.clearDraw();}},clearDraw:function(){this.inherited(arguments);_6.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.DRAW_CANCEL);this.viewModel.drawActive(false);},initListeners:function(){_6.subscribe(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADDED,_4.hitch(this,this.handleLayerAdded));_6.subscribe(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVED,_4.hitch(this,this.handleLayerRemoved));},handleLayerAdded:function(_1d){if(!this._isValidIdentifyLayer(_1d)){return;}if(_1d instanceof _10||_1d instanceof _13){if(_1d==null||_1d.serviceDescription==null||!_4.isObject(_1d.serviceDescription)||_1d.serviceDescription.capabilities==null||_1d.serviceDescription.capabilities==""){return;}if(_1d.serviceDescription.capabilities.indexOf("Query")<0){return;}}if(this.viewModel.serviceExists(_1d.url)){return;}var _1e=VIEWER_UTILS.getLayerNameFromLayer(_1d);this.viewModel.services.push({label:_1e,value:_1d});},handleLayerRemoved:function(_1f){if(this.viewModel.serviceExists(_1f.url)){this.viewModel.removeService(_1f.url);}},loadServices:function(){var _20;_6.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.OPERATIONAL.GET,function(_21){_20=_21;});if(_20!=null&&_4.isArray(_20)){var _22;for(var i=0;i<_20.length;i++){_22=_20[i];if(!this._isValidIdentifyLayer(_22)){continue;}if(_22 instanceof _10||_22 instanceof _13){if(_22==null||_22.serviceDescription==null||!_4.isObject(_22.serviceDescription)||_22.serviceDescription.capabilities==null||_22.serviceDescription.capabilities==""){continue;}if(_22.serviceDescription.capabilities.indexOf("Query")<0){continue;}}if(!this.viewModel.serviceExists(_22.url)){var _23=VIEWER_UTILS.getLayerNameFromLayer(_22);this.viewModel.services.push({label:_23,value:_22});}}}},_isValidIdentifyLayer:function(_24){return !(_24==null||_24 instanceof _f||_24 instanceof _11||_24 instanceof _12);},geometryAdded:function(_25){var _26=null;if(this.viewModel.currentServiceIsMapService()){_26=this.viewModel.selectedLayer();}var _27=new _c({whereClause:"",layer:this.viewModel.selectedService(),layerId:_26,returnGeometry:false,outFields:["*"],geometry:_25,callback:this.queryResponseCallback,errback:this.queryErrorCallback});_6.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.QUERY_LAYER,_27);this.handleRectangleDraw();},reset:function(){this.viewModel.drawActive(false);this.identifyResponseContents.clearResults();},showQueryView:function(){this.viewModel.showTabContainer(false);this.viewModel.showQuery();},handleQueryResponse:function(_28){this.identifyResponseContents.clearResults();if(_28&&_28.features!=null&&_4.isArray(_28.features)){var _29;var _2a;var _2b=_28.features.length>this.maxResults?(this.maxResults+1):_28.features.length;var _2c=this.identifyOptionsWidget.getSelectedFields();for(var i=0;i<_2b;i++){var _2d=[];_29=_28.features[i];for(var key in _29.attributes){if(_2c[key]!=null){_2a=_29.attributes[key]==null?"":_29.attributes[key].toString();_2d.push({name:key,value:_2a});}}this.identifyResponseContents.addResult({attributes:_2d});}}if(this.firstResultSet){this.firstResultSet=false;this.identifyResponseContents.startup();}this.viewModel.showResults();var _2e=_28&&_28.features&&_4.isArray(_28.features)&&_28.features.length>0;this.viewModel.showClearResults(_2e);},handleClearResults:function(){this.identifyResponseContents.clearResults();},handleQueryError:function(err){_6.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Could not complete query");VIEWER_UTILS.log("Could not complete query. Query Failed.",VIEWER_GLOBALS.LOG_TYPE.ERROR);}});});