//>>built
require({cache:{"url:esriviewer/ui/portal/theme/PortalSearchWidgetTheme.css":".searchPortalContentContainer{margin-top:10px;}.searchPortalResultCountContainer{margin-bottom:5px;}.portalResultsListContainer{max-height:250px;overflow:auto;}.searchPortalActions{margin:5px 0;}.portalSearchWindowContent{padding-top:0 !important;}","url:esriviewer/ui/portal/template/PortalSearchWidgetTemplate.html":"<div>\r\n    <div class=\"defaultTabContainer\">\r\n        <span  data-bind=\"click:showSearch, css: {selectedTab: searchVisible}\">Search</span>\r\n        <span data-bind=\"click:showResults, css: {selectedTab: resultsVisible}\">Results</span>\r\n    </div>\r\n    <div class=\"searchPortalContentContainer\">\r\n        <div data-bind=\"visible:searchVisible\">\r\n            <div style=\"width: 45%;vertical-align: -3px\" data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-event=\"onKeyUp: onQueryStringKeyUp\" data-dojo-attach-point=\"portalQueryString\"></div>\r\n            <select data-bind=\"options: portalSearchTypes ,value:selectedPortalSearchType\"></select>\r\n\r\n            <div class=\"searchPortalActions\">\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:handlePerformSearch\">Search\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-bind=\"visible:resultsVisible\">\r\n            <div class=\"searchPortalResultCountContainer\">\r\n                <span>Results: </span>\r\n                <span data-bind=\"text: resultCount\"></span>\r\n            </div>\r\n            <div data-dojo-attach-point=\"portalResultsListContainer\" class=\"portalResultsListContainer\">\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"}});define("esriviewer/ui/portal/PortalSearchWidget",["dojo/_base/declare","xstyle/css!./theme/PortalSearchWidgetTheme.css","dojo/text!./template/PortalSearchWidgetTemplate.html","dojo/_base/lang","dojo/topic","../base/UITemplatedWidget","./model/PortalSearchWidgetViewModel","./base/PortalResultsListWidget","dijit/form/TextBox","dijit/form/Button"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1([_6],{allowLocatorSearch:false,templateString:_3,postCreate:function(){this.inherited(arguments);this.viewModel=new _7();if(this.allowLocatorSearch){}ko.applyBindings(this.viewModel,this.domNode);this.handlePortalResponseCallback=_4.hitch(this,this.handlePortalResponse);this.handlePortalResponseErrback=_4.hitch(this,this.handlePortalResponseError);this.manualServiceLoadedSuccessCallback=_4.hitch(this,this.handleManualServiceLoadedCallback);this.manualServiceLoadedErrCallback=_4.hitch(this,this.handleManualServiceLoadErrorCallback);this.createPortalResultsWidget();},loadViewerConfigurationData:function(){var _b=null;_5.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"toolsBar",function(_c){_b=_c;});if(_b!=null&&_4.isObject(_b)&&_b.showConfigureLocatorsIcon==true){this.allowLocatorSearch=true;}},handlePerformSearch:function(){var _d=this.portalQueryString.get("value");if(_d==null||_d==""){return;}this.itemType=this.viewModel.selectedPortalSearchType();if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.MAP_SERVICE){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_MAP_SERVICES,_d,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}else{if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.FEATURE_SERVICE){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_FEATURE_SERVICES,_d,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}else{if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.IMAGE_SERVICE){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_IMAGE_SERVICES,_d,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}else{if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.FEATURE_SERVICE_LAYER){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_FEATURE_SERVICE_LAYERS,_d,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}else{if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.GEOCODE_SERVICE){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_GEOCODE_SERVICES,_d,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}}}}}},handlePortalResponse:function(_e){this.portalResultsWidget.clearResults();if(_e!=null&&_4.isObject(_e)){this.viewModel.showResults();this.viewModel.resultCount(_e.results.length);if(_e.results!=null&&_4.isArray(_e.results)&&_e.results.length>0){var _f;for(var i=0;i<_e.results.length;i++){_f=_e.results[i];this.portalResultsWidget.addResult({label:_f.title,resultItem:_f});}}}else{VIEWER_UTILS.log("Error Searching Portal",VIEWER_GLOBALS.LOG_TYPE.ERROR);_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Error Searching Portal");}},focusQueryString:function(){this.portalQueryString.focus();},onQueryStringKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handlePerformSearch();}},createPortalResultsWidget:function(){this.portalResultsWidget=new _8();this.portalResultsWidget.placeAt(this.portalResultsListContainer);this.portalResultsWidget.on("addResultToMap",_4.hitch(this,this.handleAddResult));},handleAddResult:function(_10){var _11=VIEWER_UTILS.getServiceTypeFromUrl(_10);if(_11!=null){if(_11===VIEWER_GLOBALS.SERVICE_TYPES.GEOCODE_SERVER){_5.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.ADD_LOCATOR,_10,this.manualServiceLoadedSuccessCallback,this.manualServiceLoadedErrCallback);}else{_5.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD_FROM_URL,_10,{isOperationalLayer:true,canRemove:true},this.manualServiceLoadedSuccessCallback,this.manualServiceLoadedErrCallback);}}},handlePortalResponseError:function(err){if(err!=null&&_4.isString(err)){VIEWER_UTILS.log("Portal Search Error: "+err,VIEWER_GLOBALS.LOG_TYPE.ERROR);_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,err);}else{VIEWER_UTILS.log("Error Searching Portal",VIEWER_GLOBALS.LOG_TYPE.ERROR);_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Error Searching Portal");}},handleManualServiceLoadedCallback:function(){_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Service Added");VIEWER_UTILS.log("Layer Added",VIEWER_GLOBALS.LOG_TYPE.INFO);},handleManualServiceLoadErrorCallback:function(msg){if(msg!=null&&_4.isString(msg)){_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,msg);VIEWER_UTILS.log("Could not add service: "+msg,VIEWER_GLOBALS.LOG_TYPE.ERROR);}else{_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Add Service Failed");VIEWER_UTILS.log("Add Layer Failed",VIEWER_GLOBALS.LOG_TYPE.ERROR);}},reset:function(){this.viewModel.showSearch();}});});