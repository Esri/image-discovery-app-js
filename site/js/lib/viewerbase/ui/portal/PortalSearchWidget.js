//>>built
require({cache:{"url:esriviewer/ui/portal/theme/PortalSearchWidgetTheme.css":".searchPortalContentContainer{margin-top:10px;}.searchPortalResultCountContainer{margin-bottom:5px;}.portalResultsListContainer{max-height:250px;overflow:auto;}.searchPortalActions{margin:5px 0;}.portalSearchWindowContent{padding-top:0 !important;}.searchPortalUrlLabel{float:left;}.portalSearchLoginClickContent{position:absolute;right:0;height:20px;margin-right:20px;cursor:pointer;text-decoration:underline;}.searchPortalActionsContent{height:20px;}.searchPortalTabContainer{line-height:26px;font-weight:normal;}.searchPortalTabContainer span{border:1px solid #DFDFDF;border-top:0;cursor:pointer;padding:5px;margin:0 3px;-moz-border-radius:0 0 3px 3px;-webkit-border-radius:0 0 3px 3px;border-radius:0 0 3px 3px;}.searchPortalAccountLockIcon{display:inline-block;}","url:esriviewer/ui/portal/template/PortalSearchWidgetTemplate.html":"<div>\r\n    <div class=\"searchPortalTabContainer\">\r\n        <span  data-bind=\"click:showSearch, css: {selectedTab: searchVisible}\">Search</span>\r\n        <span data-bind=\"click:showResults, css: {selectedTab: resultsVisible}\">Results</span>\r\n\r\n    </div>\r\n\r\n    <div class=\"searchPortalActionsContent\">\r\n        <div data-bind=\"text: portalSearchUrl\" class=\"searchPortalUrlLabel\"></div>\r\n        <div class=\"portalSearchLoginClickContent\" data-bind=\"click:logPortalUserIn, visible: noUserLoggedIn\">\r\n            <div class=\"commonIcons16 lockGo searchPortalAccountLockIcon\">\r\n            </div>\r\n            <span>Log In</span>\r\n        </div>\r\n        <div class=\"portalSearchLoginClickContent\" data-bind=\"click:logPortalUserOut, visible: userLoggedIn\">\r\n            <div class=\"commonIcons16 lockGo searchPortalAccountLockIcon\">\r\n            </div>\r\n            <span>Log Out</span>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"searchPortalContentContainer\">\r\n        <div data-bind=\"visible:searchVisible\">\r\n            <div style=\"width: 45%;vertical-align: -3px\" data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-event=\"onKeyUp: onQueryStringKeyUp\" data-dojo-attach-point=\"portalQueryString\"></div>\r\n            <select data-bind=\"options: portalSearchTypes ,value:selectedPortalSearchType\"></select>\r\n\r\n            <div class=\"searchPortalActions\">\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:handlePerformSearch\">Search\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-bind=\"visible:resultsVisible\">\r\n            <div class=\"searchPortalResultCountContainer\">\r\n                <span>Results: </span>\r\n                <span data-bind=\"text: resultCount\"></span>\r\n            </div>\r\n            <div data-dojo-attach-point=\"portalResultsListContainer\" class=\"portalResultsListContainer\">\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"}});define("esriviewer/ui/portal/PortalSearchWidget",["dojo/_base/declare","xstyle/css!./theme/PortalSearchWidgetTheme.css","dojo/text!./template/PortalSearchWidgetTemplate.html","dojo/_base/lang","dojo/topic","../base/UITemplatedWidget","./model/PortalSearchWidgetViewModel","./base/PortalResultsListWidget","dijit/form/TextBox","dijit/form/Button","esri/IdentityManager"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _1([_6],{allowLocatorSearch:false,templateString:_3,postCreate:function(){this.inherited(arguments);this.viewModel=new _7();if(this.allowLocatorSearch){}ko.applyBindings(this.viewModel,this.domNode);this.handlePortalResponseCallback=_4.hitch(this,this.handlePortalResponse);this.handlePortalResponseErrback=_4.hitch(this,this.handlePortalResponseError);this.manualServiceLoadedSuccessCallback=_4.hitch(this,this.handleManualServiceLoadedCallback);this.manualServiceLoadedErrCallback=_4.hitch(this,this.handleManualServiceLoadErrorCallback);this.createPortalResultsWidget();if(_b!=null&&_b.credentials!=null&&_b.credentials.length>0){this.viewModel.logPortalUserIn();}},initListeners:function(){this.inherited(arguments);_5.subscribe(VIEWER_GLOBALS.EVENTS.PORTAL.LOG_OUT,_4.hitch(this,this.setNoUserLoggedIn));_5.subscribe(VIEWER_GLOBALS.EVENTS.PORTAL.USER_LOGGED_IN,_4.hitch(this,this.setUserLoggedIn));},loadViewerConfigurationData:function(){var _c=null;_5.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"toolsBar",function(_d){_c=_d;});if(_c!=null&&_4.isObject(_c)&&_c.showConfigureLocatorsIcon==true){this.allowLocatorSearch=true;}},setUserLoggedIn:function(_e){if(_e!=null){this.currentPortalUser=_e;var _f=this.currentPortalUser.portal;if(_f!=null&&_4.isObject(_f)){this.viewModel.portalSearchUrl(_f.portalHostname);}this.viewModel.setUserLoggedIn();}else{this.setNoUserLoggedIn();}},setNoUserLoggedIn:function(){this.viewModel.setNoUserLoggedIn();this.currentPortalUser=null;this.viewModel.portalSearchUrl("");},handlePerformSearch:function(){var _10=this.portalQueryString.get("value");if(_10==null||_10==""){return;}this.itemType=this.viewModel.selectedPortalSearchType();if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.MAP_SERVICE){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_MAP_SERVICES,_10,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}else{if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.FEATURE_SERVICE){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_FEATURE_SERVICES,_10,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}else{if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.IMAGE_SERVICE){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_IMAGE_SERVICES,_10,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}else{if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.FEATURE_SERVICE_LAYER){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_FEATURE_SERVICE_LAYERS,_10,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}else{if(this.itemType==VIEWER_GLOBALS.AGS_PORTAL_TYPES.GEOCODE_SERVICE){_5.publish(VIEWER_GLOBALS.EVENTS.PORTAL.SEARCH_GEOCODE_SERVICES,_10,null,null,null,this.handlePortalResponseCallback,this.handlePortalResponseErrback);}}}}}},handlePortalResponse:function(_11){this.portalResultsWidget.clearResults();if(_11!=null&&_4.isObject(_11)){this.viewModel.showResults();this.viewModel.resultCount(_11.results.length);if(_11.results!=null&&_4.isArray(_11.results)&&_11.results.length>0){var _12;for(var i=0;i<_11.results.length;i++){_12=_11.results[i];this.portalResultsWidget.addResult({label:_12.title,resultItem:_12});}}}else{VIEWER_UTILS.log("Error Searching Portal",VIEWER_GLOBALS.LOG_TYPE.ERROR);_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Error Searching Portal");}},focusQueryString:function(){this.portalQueryString.focus();},onQueryStringKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handlePerformSearch();}},createPortalResultsWidget:function(){this.portalResultsWidget=new _8();this.portalResultsWidget.placeAt(this.portalResultsListContainer);this.portalResultsWidget.on("addResultToMap",_4.hitch(this,this.handleAddResult));},handleAddResult:function(_13){var _14=VIEWER_UTILS.getServiceTypeFromUrl(_13);if(_14!=null){VIEWER_UTILS.validateUrl(_13).then(_4.hitch(this,function(){if(_14===VIEWER_GLOBALS.SERVICE_TYPES.GEOCODE_SERVER){_5.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.ADD_LOCATOR,_13,this.manualServiceLoadedSuccessCallback,this.manualServiceLoadedErrCallback);}else{_5.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD_FROM_URL,_13,{isOperationalLayer:true,canRemove:true},this.manualServiceLoadedSuccessCallback,this.manualServiceLoadedErrCallback);}}));}},handlePortalResponseError:function(err){if(err!=null&&_4.isString(err)){VIEWER_UTILS.log("Portal Search Error: "+err,VIEWER_GLOBALS.LOG_TYPE.ERROR);_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,err);}else{VIEWER_UTILS.log("Error Searching Portal",VIEWER_GLOBALS.LOG_TYPE.ERROR);_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Error Searching Portal");}},handleManualServiceLoadedCallback:function(){_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Service Added");VIEWER_UTILS.log("Layer Added",VIEWER_GLOBALS.LOG_TYPE.INFO);},handleManualServiceLoadErrorCallback:function(err){if(err!=null){if(_4.isObject(err)){if(err.message){var msg="Could not add service: "+err.message;_5.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,msg);VIEWER_UTILS.log(msg,VIEWER_GLOBALS.LOG_TYPE.ERROR);}}}var x="";},reset:function(){this.viewModel.showSearch();}});});