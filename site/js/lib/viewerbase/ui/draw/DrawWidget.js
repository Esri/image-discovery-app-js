//>>built
require({cache:{"url:esriviewer/ui/draw/theme/drawTheme.css":".drawFreehandContainer{margin-top:10px;}.drawWindowInputIconsContainer{height:32px;margin-top:14px;}.drawWindowInputIconsContainer div{margin:0 10px;}.drawFreehandContainer{margin-left:15px;}.drawFreehandCheckboxLabel{vertical-align:bottom;cursor:pointer;}.drawWindowContent{padding-top:0 !important;}","url:esriviewer/ui/draw/template/DrawWidgetTemplate.html":"<div class=\"drawWindow\">\r\n    <div class=\"defaultTabContainer\">\r\n        <span  data-bind=\"click:showDraw, css: {selectedTab: drawVisible}\">Create</span>\r\n        <span data-bind=\"click:showConfiguration, css: {selectedTab: configurationVisible}\">Configure</span>\r\n        <span  data-bind=\"visible:showGraphicsListTab, click:showGraphicsList, css: {selectedTab: graphicsListVisible}\">Added</span>\r\n        <span data-bind=\"visible:showSavedGraphicsTab, click:showUserPersistedGraphics, css: {selectedTab: userPersistedGraphicsVisible}\">Saved</span>\r\n    </div>\r\n    <div class=\"drawWindowInputIconsContainer\" data-dojo-attach-point=\"drawWindowInputIconsContainer\"\r\n         data-bind=\"visible: drawVisible\">\r\n        <div class=\"threePixelBorderRadius commonIcons32 pointUnselected\"\r\n             data-bind=\"visible: showDrawPointIcon, css: {pointSelected: pointActive}\"\r\n             title=\"Draw Point\" data-dojo-attach-event=\"onclick:handlePointDrawClick\"></div>\r\n        <div class=\"threePixelBorderRadius commonIcons32 lineUnselected\"\r\n             data-bind=\"visible: showDrawLineIcon, css: {lineSelected: lineActive}\"\r\n             title=\"Draw Line\" data-dojo-attach-event=\"onclick:handleLineDrawClick\"></div>\r\n        <div class=\"threePixelBorderRadius commonIcons32 polylineUnselected\"\r\n                data-bind=\"visible: showDrawPolylineIcon, css: {polylineSelected: polylineActive}\"\r\n                title=\"Draw Polyline\" data-dojo-attach-event=\"onclick:handlePolylineDrawClick\"></div>\r\n        <div data-bind=\"visible: showDrawPolygonIcon, css: {polygonSelected: polygonActive}\"\r\n             class=\"threePixelBorderRadius commonIcons32 polygonUnselected\"\r\n             title=\"Draw Polygon\" data-dojo-attach-event=\"onclick:handlePolygonDrawClick\"></div>\r\n        <div data-bind=\"visible: showDrawRectangleIcon,css: {rectangleSelected: rectangleActive}\"\r\n             class=\"threePixelBorderRadius commonIcons32 rectangleUnselected\"\r\n             title=\"Draw Rectangle\" data-dojo-attach-event=\"onclick:handleRectangleDrawClick\"></div>\r\n        <div class=\"threePixelBorderRadius commonIcons32 textUnselected\"\r\n             data-bind=\"visible: showDrawTextIcon,css: {textSelected: textActive}\"\r\n             title=\"Draw Text\" data-dojo-attach-event=\"onclick:handleTextDrawClick\"></div>\r\n    </div>\r\n    <div class=\"drawFreehandContainer\"\r\n         data-bind=\"visible: freehandContainerVisible\">\r\n        <span data-dojo-type=\"dijit/form/CheckBox\" data-dojo-attach-event=\"onChange:handleFreehandToggled\"\r\n              data-dojo-attach-point=\"freeHandDrawCheckbox\"></span>\r\n        <span class=\"drawFreehandCheckboxLabel\" data-dojo-attach-event=\"onclick:toggleFreehand\">Freehand</span>\r\n    </div>\r\n    <div class=\"drawWindowConfigureContainer\" data-bind=\"visible: configurationVisible\"\r\n         data-dojo-attach-point=\"drawWindowConfigureContainer\">\r\n    </div>\r\n    <div class=\"drawWindowGraphicsListContainer\" data-dojo-attach-point=\"drawWindowGraphicsListContainer\"\r\n         data-bind=\"visible: graphicsListVisible\">\r\n    </div>\r\n    <div class=\"drawWindowUserPersistedGraphicsContainer\"\r\n         data-dojo-attach-point=\"drawWindowUserPersistedGraphicsContainer\"\r\n         data-bind=\"visible: userPersistedGraphicsVisible\">\r\n    </div>\r\n</div>"}});define("esriviewer/ui/draw/DrawWidget",["dojo/_base/declare","xstyle/css!./theme/drawTheme.css","dojo/text!./template/DrawWidgetTemplate.html","dojo/topic","dojo/_base/lang","../base/UITemplatedWidget","./base/MapDrawSupport","./configure/ConfigureDrawWidget","./base/GraphicsListWidget","./model/DrawWidgetViewModel","./base/GraphicsLocalStorageMixin","./base/UserPersistsedGraphicsListWidget","dijit/form/CheckBox","esri/layers/GraphicsLayer","esri/graphic"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return _1([_6,_7,_b],{bindingsApplied:false,templateString:_3,constructor:function(){this.freehandActive=false;},initListeners:function(){this.inherited(arguments);_4.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.GET_USER_GRAPHICS,_5.hitch(this,this.getUserGraphics));},postCreate:function(){this.viewModel=new _a();this.viewModel.drawVisible.subscribe(_5.hitch(this,this.handleDrawVisibilityChanged));this.viewModel.configurationVisible.subscribe(_5.hitch(this,this.handleConfigurationVisibilityChanged));this.viewModel.graphicsListVisible.subscribe(_5.hitch(this,this.handleGraphicsListtVisibilityChanged));this.viewModel.userPersistedGraphicsVisible.subscribe(_5.hitch(this,this.handleUserPersistedVisibilityChanged));this.viewModel.showUserPersistedGraphicsIcon(this.localStoragePersistSupported);var _10=false;for(var key in this.persistedUserGraphics){_10=true;break;}this.viewModel.showSavedGraphicsTab(_10);this.applyBindings();this.createConfigureDrawWidget();this.createGraphicsListWidget();if(this.localStoragePersistSupported){this.createUserPersistedGraphicsListWidget();}this.inherited(arguments);this.drawGraphicsLayer=_e();_4.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD_EXTERNAL_MANAGED_LAYER,this.drawGraphicsLayer);_4.publish(VIEWER_GLOBALS.EVENTS.DRAW.DRAW_GRAPHICS_LAYER_CREATED);},handleConfigurationVisibilityChanged:function(_11){this._handleContentAnimation(_11,this.drawWindowConfigureContainer);},handleGraphicsListtVisibilityChanged:function(_12){this._handleContentAnimation(_12,this.drawWindowGraphicsListContainer);},handleUserPersistedVisibilityChanged:function(_13){this._handleContentAnimation(_13,this.drawWindowUserPersistedGraphicsContainer);},handleDrawVisibilityChanged:function(_14){this._handleContentAnimation(_14,this.drawWindowInputIconsContainer);},applyBindings:function(){if(!this.bindingsApplied){this._applyBindings();}},_applyBindings:function(){if(!this.bindingsApplied){ko.applyBindings(this.viewModel,this.domNode);this.bindingsApplied=true;}},createConfigureDrawWidget:function(){if(this.configureDrawWidget==null){this.configureDrawWidget=new _8();this.configureDrawWidget.placeAt(this.drawWindowConfigureContainer);this.configureDrawWidget.on("pointSymbolChanged",_5.hitch(this,this.handlePointSymbolChanged));this.configureDrawWidget.on("lineSymbolChanged",_5.hitch(this,this.handleLineSymbolChanged));this.configureDrawWidget.on("polygonSymbolChanged",_5.hitch(this,this.handlePolygonSymbolChanged));this.configureDrawWidget.on("rectangleSymbolChanged",_5.hitch(this,this.handleRectangleSymbolChanged));this.configureDrawWidget.on("textSymbolChanged",_5.hitch(this,this.handleTextSymbolChanged));this.pointSymbol=this.configureDrawWidget.pointConfigurationWidget.getSymbol();this.lineSymbol=this.configureDrawWidget.lineConfigurationWidget.getSymbol();this.envelopeSymbol=this.configureDrawWidget.rectangleConfigurationWidget.getSymbol();this.textSymbol=this.configureDrawWidget.configureTextWidget.getSymbol();this.polygonSymbol=this.configureDrawWidget.configurePolygonWidget.getSymbol();}},handlePointSymbolChanged:function(_15){this.pointSymbol=_15;},handleLineSymbolChanged:function(_16){this.lineSymbol=_16;},handlePolygonSymbolChanged:function(_17){this.polygonSymbol=_17;},handleRectangleSymbolChanged:function(_18){this.envelopeSymbol=_18;},handleTextSymbolChanged:function(_19){this.textSymbol=_19;},createUserPersistedGraphicsListWidget:function(){if(this.userPersistedGraphicsListWidget==null){this.userPersistedGraphicsListWidget=new _c();this.userPersistedGraphicsListWidget.placeAt(this.drawWindowUserPersistedGraphicsContainer);this.userPersistedGraphicsListWidget.on("removeUserPersistedGraphics",_5.hitch(this,this.removeUserPersistedGraphics));this.userPersistedGraphicsListWidget.on("addUserPersistedGraphicsToMap",_5.hitch(this,this.addUserPersistedGraphicsToMap));this.userPersistedGraphicsListWidget.addExistingPersistedGraphicsItems(this.persistedUserGraphics);}},createGraphicsListWidget:function(){if(this.graphicsListWidget==null){this.graphicsListWidget=new _9({saveSupported:this.localStoragePersistSupported});this.graphicsListWidget.placeAt(this.drawWindowGraphicsListContainer);this.graphicsListWidget.viewModel.hasGraphics.subscribe(_5.hitch(this,this.handleCheckForExistingGraphics));this.graphicsListWidget.on("removeAllGraphics",_5.hitch(this,this.removeAllGraphics));this.graphicsListWidget.on("removeGraphic",_5.hitch(this,this.removeGraphic));this.graphicsListWidget.on("saveGraphics",_5.hitch(this,this.saveUserGraphics));}},saveUserGraphics:function(_1a,_1b){var _1c=this.persistUserGraphics(_1a,_1b);if(_1c){this.userPersistedGraphicsListWidget.addUserPersistedGraphics(_1c);this.viewModel.showSavedGraphicsTab(true);}},addUserPersistedGraphicsToMap:function(_1d){if(_1d==null||!_5.isObject(_1d)){return;}if(_1d.graphics==null||!_5.isArray(_1d.graphics)){return;}var _1e;for(var i=0;i<_1d.graphics.length;i++){_1e=_1d.graphics[i].graphic;var _1f=new _f(_1e);var _20={label:_1d.graphics[i].label,graphic:_1f};this.onAnnotationCreated(_20);}},removeUserPersistedGraphics:function(_21){var _22=this.deleteUserPersistedGraphics(_21);this.viewModel.showSavedGraphicsTab(_22);},removeAllGraphics:function(){this.drawGraphicsLayer.clear();},removeGraphic:function(_23){if(_23){this.drawGraphicsLayer.remove(_23);}},getUserGraphics:function(_24){if(_24&&_5.isFunction(_24)){_24(this.graphicsListWidget.getGraphics());}},handleCheckForExistingGraphics:function(_25){if(!_25){this.viewModel.graphicsListTabVisible(false);this.viewModel.showDraw();}else{this.viewModel.graphicsListTabVisible(true);}},handlePointDrawClick:function(){var _26=this.viewModel.pointActive();this.clearDraw();if(!_26){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT);this.viewModel.setDrawMode(this.viewModel.drawModes.point);}},handleTextDrawClick:function(){var _27=this.viewModel.textActive();this.clearDraw();if(!_27){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT);this.viewModel.setDrawMode(this.viewModel.drawModes.text);}},handleLineDrawClick:function(){var _28=this.viewModel.lineActive();this.clearDraw();if(!_28){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_LINE);this.viewModel.setDrawMode(this.viewModel.drawModes.line);}},handlePolylineDrawClick:function(){var _29=this.viewModel.polylineActive();this.clearDraw();if(!_29){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYLINE);this.viewModel.setDrawMode(this.viewModel.drawModes.polyline);}},handlePolygonDrawClick:function(){var _2a=this.viewModel.polygonActive();this.clearDraw();if(!_2a){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON);this.viewModel.setDrawMode(this.viewModel.drawModes.polygon);}},handleRectangleDrawClick:function(){var _2b=this.viewModel.rectangleActive();this.clearDraw();if(!_2b){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_RECTANGLE);this.viewModel.setDrawMode(this.viewModel.drawModes.rectangle);}},clearDraw:function(){this.inherited(arguments);this.viewModel.setDrawMode(null);_4.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.DRAW_CANCEL);},geometryAdded:function(_2c){this.inherited(arguments);var _2d=this.viewModel.getCurrentDrawType();this.clearDraw();if(_2d!=null){if(_2d===this.viewModel.drawModes.rectangle){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_RECTANGLE);this.viewModel.setDrawMode(this.viewModel.drawModes.rectangle);}if(_2d===this.viewModel.drawModes.point){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT);this.viewModel.setDrawMode(this.viewModel.drawModes.point);}if(_2d===this.viewModel.drawModes.polygon){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON);this.viewModel.setDrawMode(this.viewModel.drawModes.polygon);}if(_2d===this.viewModel.drawModes.polyline){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYLINE);this.viewModel.setDrawMode(this.viewModel.drawModes.polyline);}if(_2d===this.viewModel.drawModes.line){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_LINE);this.viewModel.setDrawMode(this.viewModel.drawModes.line);}if(_2d===this.viewModel.drawModes.text){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT);this.viewModel.setDrawMode(this.viewModel.drawModes.text);}}},toggleFreehand:function(){this.freeHandDrawCheckbox.set("checked",!this.freeHandDrawCheckbox.get("checked"));},handleFreehandToggled:function(){this.freehandActive=this.freeHandDrawCheckbox.get("checked");var _2e=this.viewModel.getCurrentDrawType();if(_2e===this.viewModel.drawModes.polygon){this.clearDraw();this.viewModel.setDrawMode(this.viewModel.drawModes.polygon);this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON);}if(_2e===this.viewModel.drawModes.polyline){this.clearDraw();this.viewModel.setDrawMode(this.viewModel.drawModes.polyline);this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYLINE);}},onAnnotationCreated:function(_2f){this.inherited(arguments);this.graphicsListWidget.addGraphic(_2f);this.drawGraphicsLayer.add(_2f.graphic);},hidePopups:function(){if(this.graphicsListWidget){this.graphicsListWidget.hidePopups();}}});});