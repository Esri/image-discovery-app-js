//>>built
require({cache:{"url:esriviewer/ui/draw/template/DrawWidgetTemplate.html":"<div class=\"drawWindow\">\r\n    <div class=\"defaultTabContainer\">\r\n        <span  data-bind=\"click:showDraw, css: {selectedTab: drawVisible}\">Create</span>\r\n        <span data-bind=\"click:showConfiguration, css: {selectedTab: configurationVisible}\">Configure</span>\r\n        <span  data-bind=\"visible:showGraphicsListTab, click:showGraphicsList, css: {selectedTab: graphicsListVisible}\">Added</span>\r\n        <span data-bind=\"visible:showSavedGraphicsTab, click:showUserPersistedGraphics, css: {selectedTab: userPersistedGraphicsVisible}\">Saved</span>\r\n    </div>\r\n    <div class=\"drawWindowInputIconsContainer\" data-dojo-attach-point=\"drawWindowInputIconsContainer\"\r\n         data-bind=\"visible: drawVisible\">\r\n        <div class=\"threePixelBorderRadius commonIcons32 pointUnselected\"\r\n             data-bind=\"visible: showDrawPointIcon, css: {pointSelected: pointActive}\"\r\n             title=\"Draw Point\" data-dojo-attach-event=\"onclick:handlePointDrawClick\"></div>\r\n        <div class=\"threePixelBorderRadius commonIcons32 lineUnselected\"\r\n             data-bind=\"visible: showDrawLineIcon, css: {lineSelected: lineActive}\"\r\n             title=\"Draw Line\" data-dojo-attach-event=\"onclick:handleLineDrawClick\"></div>\r\n        <div class=\"threePixelBorderRadius commonIcons32 polylineUnselected\"\r\n                data-bind=\"visible: showDrawPolylineIcon, css: {polylineSelected: polylineActive}\"\r\n                title=\"Draw Polyline\" data-dojo-attach-event=\"onclick:handlePolylineDrawClick\"></div>\r\n        <div data-bind=\"visible: showDrawPolygonIcon, css: {polygonSelected: polygonActive}\"\r\n             class=\"threePixelBorderRadius commonIcons32 polygonUnselected\"\r\n             title=\"Draw Polygon\" data-dojo-attach-event=\"onclick:handlePolygonDrawClick\"></div>\r\n        <div data-bind=\"visible: showDrawRectangleIcon,css: {rectangleSelected: rectangleActive}\"\r\n             class=\"threePixelBorderRadius commonIcons32 rectangleUnselected\"\r\n             title=\"Draw Rectangle\" data-dojo-attach-event=\"onclick:handleRectangleDrawClick\"></div>\r\n        <div class=\"threePixelBorderRadius commonIcons32 textUnselected\"\r\n             data-bind=\"visible: showDrawTextIcon,css: {textSelected: textActive}\"\r\n             title=\"Draw Text\" data-dojo-attach-event=\"onclick:handleTextDrawClick\"></div>\r\n    </div>\r\n    <div class=\"drawFreehandContainer\"\r\n         data-bind=\"visible: freehandContainerVisible\">\r\n        <span data-dojo-type=\"dijit/form/CheckBox\" data-dojo-attach-event=\"onChange:handleFreehandToggled\"\r\n              data-dojo-attach-point=\"freeHandDrawCheckbox\"></span>\r\n        <span class=\"drawFreehandCheckboxLabel\" data-dojo-attach-event=\"onclick:toggleFreehand\">Freehand</span>\r\n    </div>\r\n    <div class=\"drawWindowConfigureContainer\" data-bind=\"visible: configurationVisible\"\r\n         data-dojo-attach-point=\"drawWindowConfigureContainer\">\r\n    </div>\r\n    <div class=\"drawWindowGraphicsListContainer\" data-dojo-attach-point=\"drawWindowGraphicsListContainer\"\r\n         data-bind=\"visible: graphicsListVisible\">\r\n    </div>\r\n    <div class=\"drawWindowUserPersistedGraphicsContainer\"\r\n         data-dojo-attach-point=\"drawWindowUserPersistedGraphicsContainer\"\r\n         data-bind=\"visible: userPersistedGraphicsVisible\">\r\n    </div>\r\n</div>"}});define("esriviewer/ui/draw/DrawWidget",["dojo/_base/declare","dojo/text!./template/DrawWidgetTemplate.html","dojo/topic","dojo/_base/lang","../base/UITemplatedWidget","./base/MapDrawSupport","./configure/ConfigureDrawWidget","./base/GraphicsListWidget","./model/DrawWidgetViewModel","./base/GraphicsLocalStorageMixin","./base/UserPersistsedGraphicsListWidget","dijit/form/CheckBox","esri/layers/GraphicsLayer","esri/graphic"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _1([_5,_6,_a],{bindingsApplied:false,templateString:_2,constructor:function(){this.freehandActive=false;},initListeners:function(){this.inherited(arguments);_3.subscribe(VIEWER_GLOBALS.EVENTS.DRAW.USER.GET_USER_GRAPHICS,_4.hitch(this,this.getUserGraphics));},postCreate:function(){this.viewModel=new _9();this.viewModel.showUserPersistedGraphicsIcon(this.localStoragePersistSupported);var _f=false;for(var key in this.persistedUserGraphics){_f=true;break;}this.viewModel.showSavedGraphicsTab(_f);this.applyBindings();this.createConfigureDrawWidget();this.createGraphicsListWidget();if(this.localStoragePersistSupported){this.createUserPersistedGraphicsListWidget();}this.inherited(arguments);this.drawGraphicsLayer=_d();_3.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD_EXTERNAL_MANAGED_LAYER,this.drawGraphicsLayer);_3.publish(VIEWER_GLOBALS.EVENTS.DRAW.DRAW_GRAPHICS_LAYER_CREATED);},applyBindings:function(){if(!this.bindingsApplied){this._applyBindings();}},_applyBindings:function(){if(!this.bindingsApplied){ko.applyBindings(this.viewModel,this.domNode);this.bindingsApplied=true;}},createConfigureDrawWidget:function(){if(this.configureDrawWidget==null){this.configureDrawWidget=new _7();this.configureDrawWidget.placeAt(this.drawWindowConfigureContainer);this.configureDrawWidget.on("pointSymbolChanged",_4.hitch(this,this.handlePointSymbolChanged));this.configureDrawWidget.on("lineSymbolChanged",_4.hitch(this,this.handleLineSymbolChanged));this.configureDrawWidget.on("polygonSymbolChanged",_4.hitch(this,this.handlePolygonSymbolChanged));this.configureDrawWidget.on("rectangleSymbolChanged",_4.hitch(this,this.handleRectangleSymbolChanged));this.configureDrawWidget.on("textSymbolChanged",_4.hitch(this,this.handleTextSymbolChanged));this.pointSymbol=this.configureDrawWidget.pointConfigurationWidget.getSymbol();this.lineSymbol=this.configureDrawWidget.lineConfigurationWidget.getSymbol();this.envelopeSymbol=this.configureDrawWidget.rectangleConfigurationWidget.getSymbol();this.textSymbol=this.configureDrawWidget.configureTextWidget.getSymbol();this.polygonSymbol=this.configureDrawWidget.configurePolygonWidget.getSymbol();}},handlePointSymbolChanged:function(_10){this.pointSymbol=_10;},handleLineSymbolChanged:function(_11){this.lineSymbol=_11;},handlePolygonSymbolChanged:function(_12){this.polygonSymbol=_12;},handleRectangleSymbolChanged:function(_13){this.envelopeSymbol=_13;},handleTextSymbolChanged:function(_14){this.textSymbol=_14;},createUserPersistedGraphicsListWidget:function(){if(this.userPersistedGraphicsListWidget==null){this.userPersistedGraphicsListWidget=new _b();this.userPersistedGraphicsListWidget.placeAt(this.drawWindowUserPersistedGraphicsContainer);this.userPersistedGraphicsListWidget.on("removeUserPersistedGraphics",_4.hitch(this,this.removeUserPersistedGraphics));this.userPersistedGraphicsListWidget.on("addUserPersistedGraphicsToMap",_4.hitch(this,this.addUserPersistedGraphicsToMap));this.userPersistedGraphicsListWidget.addExistingPersistedGraphicsItems(this.persistedUserGraphics);}},createGraphicsListWidget:function(){if(this.graphicsListWidget==null){this.graphicsListWidget=new _8({saveSupported:this.localStoragePersistSupported});this.graphicsListWidget.placeAt(this.drawWindowGraphicsListContainer);this.graphicsListWidget.viewModel.hasGraphics.subscribe(_4.hitch(this,this.handleCheckForExistingGraphics));this.graphicsListWidget.on("removeAllGraphics",_4.hitch(this,this.removeAllGraphics));this.graphicsListWidget.on("removeGraphic",_4.hitch(this,this.removeGraphic));this.graphicsListWidget.on("saveGraphics",_4.hitch(this,this.saveUserGraphics));}},saveUserGraphics:function(_15,_16){var _17=this.persistUserGraphics(_15,_16);if(_17){this.userPersistedGraphicsListWidget.addUserPersistedGraphics(_17);this.viewModel.showSavedGraphicsTab(true);}},addUserPersistedGraphicsToMap:function(_18){if(_18==null||!_4.isObject(_18)){return;}if(_18.graphics==null||!_4.isArray(_18.graphics)){return;}var _19;for(var i=0;i<_18.graphics.length;i++){_19=_18.graphics[i].graphic;var _1a=new _e(_19);var _1b={label:_18.graphics[i].label,graphic:_1a};this.onAnnotationCreated(_1b);}},removeUserPersistedGraphics:function(_1c){var _1d=this.deleteUserPersistedGraphics(_1c);this.viewModel.showSavedGraphicsTab(_1d);},removeAllGraphics:function(){this.drawGraphicsLayer.clear();},removeGraphic:function(_1e){if(_1e){this.drawGraphicsLayer.remove(_1e);}},getUserGraphics:function(_1f){if(_1f&&_4.isFunction(_1f)){_1f(this.graphicsListWidget.getGraphics());}},handleCheckForExistingGraphics:function(_20){if(!_20){this.viewModel.graphicsListTabVisible(false);this.viewModel.showDraw();}else{this.viewModel.graphicsListTabVisible(true);}},handlePointDrawClick:function(){var _21=this.viewModel.pointActive();this.clearDraw();if(!_21){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT);this.viewModel.setDrawMode(this.viewModel.drawModes.point);}},handleTextDrawClick:function(){var _22=this.viewModel.textActive();this.clearDraw();if(!_22){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT);this.viewModel.setDrawMode(this.viewModel.drawModes.text);}},handleLineDrawClick:function(){var _23=this.viewModel.lineActive();this.clearDraw();if(!_23){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_LINE);this.viewModel.setDrawMode(this.viewModel.drawModes.line);}},handlePolylineDrawClick:function(){var _24=this.viewModel.polylineActive();this.clearDraw();if(!_24){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYLINE);this.viewModel.setDrawMode(this.viewModel.drawModes.polyline);}},handlePolygonDrawClick:function(){var _25=this.viewModel.polygonActive();this.clearDraw();if(!_25){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON);this.viewModel.setDrawMode(this.viewModel.drawModes.polygon);}},handleRectangleDrawClick:function(){var _26=this.viewModel.rectangleActive();this.clearDraw();if(!_26){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_RECTANGLE);this.viewModel.setDrawMode(this.viewModel.drawModes.rectangle);}},clearDraw:function(){this.inherited(arguments);this.viewModel.setDrawMode(null);_3.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.DRAW_CANCEL);},geometryAdded:function(_27){this.inherited(arguments);var _28=this.viewModel.getCurrentDrawType();this.clearDraw();if(_28!=null){if(_28===this.viewModel.drawModes.rectangle){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_RECTANGLE);this.viewModel.setDrawMode(this.viewModel.drawModes.rectangle);}if(_28===this.viewModel.drawModes.point){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT);this.viewModel.setDrawMode(this.viewModel.drawModes.point);}if(_28===this.viewModel.drawModes.polygon){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON);this.viewModel.setDrawMode(this.viewModel.drawModes.polygon);}if(_28===this.viewModel.drawModes.polyline){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYLINE);this.viewModel.setDrawMode(this.viewModel.drawModes.polyline);}if(_28===this.viewModel.drawModes.line){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_LINE);this.viewModel.setDrawMode(this.viewModel.drawModes.line);}if(_28===this.viewModel.drawModes.text){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT);this.viewModel.setDrawMode(this.viewModel.drawModes.text);}}},toggleFreehand:function(){this.freeHandDrawCheckbox.set("checked",!this.freeHandDrawCheckbox.get("checked"));},handleFreehandToggled:function(){this.freehandActive=this.freeHandDrawCheckbox.get("checked");var _29=this.viewModel.getCurrentDrawType();if(_29===this.viewModel.drawModes.polygon){this.clearDraw();this.viewModel.setDrawMode(this.viewModel.drawModes.polygon);this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON);}if(_29===this.viewModel.drawModes.polyline){this.clearDraw();this.viewModel.setDrawMode(this.viewModel.drawModes.polyline);this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYLINE);}},onAnnotationCreated:function(_2a){this.inherited(arguments);this.graphicsListWidget.addGraphic(_2a);this.drawGraphicsLayer.add(_2a.graphic);},hidePopups:function(){if(this.graphicsListWidget){this.graphicsListWidget.hidePopups();}}});});