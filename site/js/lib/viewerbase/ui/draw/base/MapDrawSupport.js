//>>built
define("esriviewer/ui/draw/base/MapDrawSupport",["dojo/_base/declare","dojo/topic","dojo/_base/Color","dojo/_base/lang","dojo/dom-construct","dijit/form/TextBox","dijit/TooltipDialog","esri/geometry/Point","esri/geometry/Polyline","esri/geometry/Polygon","esri/geometry/Extent","esri/geometry/screenUtils","esri/graphic","esri/symbols/TextSymbol","esri/symbols/Font"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return _1([],{constructor:function(){this.polygonOptions={};this.pointOptions={};this.envelopeOptions={};this.lineOptions={};this.geometryAddedCallback=_4.hitch(this,this.geometryAdded);},clearDraw:function(){this.currentDrawType=null;},setDraw:function(_10){if(_10==VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT){this.activatePointDraw();}else{if(_10==VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYLINE){this.activatePolylineDraw(this.freehandActive);}else{if(_10==VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_LINE){this.activateLineDraw();}else{if(_10==VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON){this.activatePolygonDraw(this.freehandActive);}else{if(_10==VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_RECTANGLE){this.activateRectangleDraw();}else{if(_10==VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT){this.activatePointDraw();}}}}}}this.currentDrawType=_10;},activatePointDraw:function(){this.cancelDrawChangeListener();_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.POINT_INPUT,this.geometryAddedCallback,this.pointOptions);this.setupClearDrawCallback();},activateLineDraw:function(){this.cancelDrawChangeListener();_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.LINE_INPUT,this.geometryAddedCallback,this.lineOptions);this.setupClearDrawCallback();},activatePolylineDraw:function(_11){this.cancelDrawChangeListener();if(_11==null||_11===false){_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.POLYLINE_INPUT,this.geometryAddedCallback,this.lineOptions);}else{_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.FREEHAND_POLYLINE_INPUT,this.geometryAddedCallback,this.lineOptions);}this.setupClearDrawCallback();},activatePolygonDraw:function(_12){this.cancelDrawChangeListener();if(_12==null||_12===false){_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.POLYGON_INPUT,this.geometryAddedCallback,this.polygonOptions);}else{_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.FREEHAND_POLYGON_INPUT,this.geometryAddedCallback,this.polygonOptions);}this.setupClearDrawCallback();},activateRectangleDraw:function(){this.cancelDrawChangeListener();_2.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.RECTANGLE_INPUT,this.geometryAddedCallback,this.envelopeOptions);this.setupClearDrawCallback();},cancelDrawChangeListener:function(){if(this.toolChangeConnect){this.toolChangeConnect.remove();this.toolChangeConnect=null;}},geometryAdded:function(_13){if(_13==null){return;}var _14=null;var _15=null;if(_13 instanceof _8){_15=VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT;if(this.currentDrawType==VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT){_15=VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT;_14=this.cloneTextSymbol(this.textSymbol);_14.setText("");var _16;var _17;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.DIMENSIONS.GET,function(_18){_16=_18;});_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_EXTENT,function(_19){_17=_19;});var _1a=_c.toScreenPoint(_17,_16.width,_16.height,_13);this.showTextSymbolTooltip(_1a);}else{_15=VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT;_14=this.pointSymbol;}}else{if(_13 instanceof _9){_14=this.lineSymbol;_15=VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYLINE;}else{if(_13 instanceof _a){_14=this.polygonSymbol;_15=VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON;}else{if(_13 instanceof _b){_14=this.envelopeSymbol;_15=VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_RECTANGLE;}}}}if(_14!=null&&_15!=null){if(_15===VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT){this.currentTextGraphic=new _d(_13,_14);}else{var _1b=new _d(_13,_14);var _1c=VIEWER_UTILS.generateUUID();this.onAnnotationCreated({id:_1c,type:_15,graphic:_1b});}}},onClearDraw:function(){},onAnnotationCreated:function(_1d){},setupClearDrawCallback:function(){this.toolChangeConnect=_2.subscribe(VIEWER_GLOBALS.EVENTS.MAP.ACTIONS.TOOL_CHANGED,_4.hitch(this,this.handleClearDraw));},handleClearDraw:function(){this.cancelDrawChangeListener();this.clearDraw();this.onClearDraw();},createTextSymbolLabelTooltip:function(){var _1e=_5.create("div");var _1f=_5.create("span",{innerHTML:"Label: ",className:"textSymbolInputLabel"});this.textSymbolLabelInput=new _6({value:"Label"});this.textSymbolLabelInput.on("keyUp",_4.hitch(this,this.handleTextSymbolKeyUp));_5.place(_1f,_1e);_5.place(this.textSymbolLabelInput.domNode,_1e);this.textSymbolLabelTooltip=new _7({content:_1e});},handleTextSymbolKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.finalizeTextSymbol();this.hideTextSymbolTooltip();}},finalizeTextSymbol:function(){if(this.currentTextGraphic==null||this.currentTextGraphic.symbol==null){return;}var _20=this.textSymbolLabelInput.get("value");if(_20==""){_20="Label";}this.currentTextGraphic.symbol.setText(_20);var _21=VIEWER_UTILS.generateUUID();this.onAnnotationCreated({id:_21,type:VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_TEXT,graphic:this.currentTextGraphic});this.currentTextSymbol=null;},showTextSymbolTooltip:function(_22){if(this.textSymbolLabelTooltip==null){this.createTextSymbolLabelTooltip();}if(this.textSymbolLabelTooltip){dijit.popup.open({popup:this.textSymbolLabelTooltip,x:_22.x,y:_22.y});this.textSymbolLabelInput.set("value","");this.textSymbolLabelInput.focus();}},hideTextSymbolTooltip:function(){if(this.textSymbolLabelTooltip){dijit.popup.close(this.textSymbolLabelTooltip);}},cloneTextSymbol:function(){var _23=new _e("");_23.setColor(new _3(this.textSymbol.color));_23.setAlign(this.textSymbol.align);_23.setAngle(this.textSymbol.angle);_23.setFont(new _f(this.textSymbol.font.size));_23.font.setWeight(this.textSymbol.font.weight);_23.font.setStyle(this.textSymbol.font.style);return _23;}});});