//>>built
require({cache:{"url:esriviewer/ui/social/base/flickr/template/FlickrWidgetTemplate.html":"<div>\r\n    <div class=\"socialMediaDescriptionLabel\">Search Flickr for photos</div>\r\n    <div class=\"socialMediaSearchEntry\">\r\n        <div class=\"socialMediaSearchEntryLabel\">Use this keyword:</div>\r\n        <input type=\"text\" data-bind=\"value:searchTerm, valueUpdate: 'afterkeydown',  event:{keyup:checkForSearchEnter}\"/>\r\n    </div>\r\n    <div class=\"socialMediaSearchEntry\">\r\n        <div class=\"socialMediaSearchEntryLabel\">At this location:</div>\r\n        <span class=\"socialMediaLocationDisplayContainer\">\r\n            <span>\r\n            <span>lon:</span>\r\n            <span data-bind=\"text:searchLocationLon\"></span>\r\n                </span>\r\n                <span>\r\n                    <span>lat:</span>\r\n                    <span data-bind=\"text:searchLocationLat\"></span>\r\n                </span>\r\n        </span>\r\n    </div>\r\n    <div class=\"socialMediaSearchEntry socialMediaSearchDistanceEntryContainer\">\r\n        <div class=\"socialMediaSearchEntryLabel\">Within this distance:</div>\r\n        <div data-dojo-attach-point=\"distanceSliderContainer\" class=\"socialMediaDistanceSliderContainer\">\r\n\r\n        </div>\r\n        <span data-bind=\"text:searchDistance\"></span>\r\n        <span>km</span>\r\n    </div>\r\n    <div class=\"socialMediaSearchEntry\">\r\n        <div class=\"socialMediaSearchEntryLabel\">Within these dates:</div>\r\n        <div class=\"socialMediaSearchDateRangeContainer\">\r\n            <span data-dojo-attach-point=\"startDateContainer\">\r\n\r\n            </span>\r\n            <span>to</span>\r\n\r\n            <span data-dojo-attach-point=\"endDateContainer\">\r\n\r\n            </span>\r\n        </div>\r\n    </div>\r\n    <div class=\"socialMediaSearchButtonsContainer\">\r\n        <button class=\"dijitButtonNode\" data-bind=\"click:handleClear\">Clear</button>\r\n        <button class=\"dijitButtonNode\"  data-bind=\"click:handleSearch\">Search</button>\r\n    </div>\r\n</div>"}});define("esriviewer/ui/social/base/flickr/FlickrWidget",["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/topic","dojo/text!./template/FlickrWidgetTemplate.html","dojo/dom-construct","dijit/form/DateTextBox","../socialmediabase/BaseSocialMediaSearchWidget","../../../../base/DataLoaderSupport","./model/FlickrWidgetViewModel","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/graphic","esri/InfoTemplate","esri/SpatialReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return _1([_8,_9],{urlReplaceTemplates:{farmId:"{farm-id}",serverId:"{server-id}",secret:"{secret}",id:"{id}"},apiDateFormat:"yyyy-MM-dd hh:mm:ss",currentPage:0,apiUrl:"",dateTextInputWidth:"7em",__defaultDisplayFormats:{date:"yyyy-MM-dd"},displayFormats:{date:"yyyy-MM-dd"},templateString:_5,constructor:function(){this.searchResultGraphics=[];},postCreate:function(){this.inherited(arguments);this.searchResponseCallback=_2.hitch(this,this.handleSearchResponse);this.searchResponsErrorback=_2.hitch(this,this.handleSearchError);this.viewModel=new _a();this.viewModel.on(this.viewModel.SEARCH,_2.hitch(this,this.handleSearch));this.viewModel.on(this.viewModel.CLEAR,_2.hitch(this,this.handleClearSearch));this.viewModel.searchTerm(this.defaultSearchKeyword);ko.applyBindings(this.viewModel,this.domNode);this.createDateSelects();},handleClearSearch:function(){this.currentPage=0;this.clearResultGraphics();},clearResultGraphics:function(){for(var i=0;i<this.searchResultGraphics.length;i++){this.onRemoveGraphic(this.searchResultGraphics[i]);}this.searchResultGraphics=[];},handleSearch:function(){this.handleClearSearch();var _10=this.getSearchParameters();_10[this.apiParameterNames.apiKey]=this.apiKey;_2.mixin(_10,this.defaultAPIUrlValues||{});this.loadJsonP(this.apiUrl,_10,this.searchResponseCallback,this.searchResponsErrorback,this.callbackParameterName);},handleSearchResponse:function(_11){if(_11&&_11.photos&&_11.photos.photo&&_2.isArray(_11.photos.photo)){if(_11.photos.photo.length==0){_4.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"No results were returned");return;}_4.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Search Result Count: "+_11.photos.photo.length);var _12,i;for(i=0;i<_11.photos.photo.length;i++){_12=_11.photos.photo[i];var _13=new _b(_12.longitude,_12.latitude,new _f({wkid:PROJECTION_UTILS.WGS_84_WKID}));var _14=_c(this.mapIcon.url,this.mapIcon.width,this.mapIcon.height);var _15=new _d(_13,_14);_15.setInfoTemplate(this.getInfoTemplate(_12));this.searchResultGraphics.push(_15);}PROJECTION_UTILS.graphicsToMapSpatialReference(this.searchResultGraphics);for(i=0;i<this.searchResultGraphics.length;i++){this.onAddGraphic(this.searchResultGraphics[i]);}}else{_4.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"There was an error searching Flickr");}},handleSearchError:function(){_4.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"There was an error searching Flickr");},getSearchParameters:function(){var _16=this.inherited(arguments);var _17=this.viewModel.searchTerm();if(_17){_16[this.apiParameterNames.keyword]=_17;}var _18=this.viewModel.searchDistance();if(_18){_16[this.apiParameterNames.searchRadius]=_18;_16[this.apiParameterNames.searchUnits]=this._searchUnits;}var _19=this.viewModel.getSearchPoint();if(_19&&_19.x!=null&&_19.y!=null){_16[this.apiParameterNames.latitude]=_19.y;_16[this.apiParameterNames.longitude]=_19.x;}var _1a=this.startDateTextBox.get("value");if(_1a!=null){_16[this.apiParameterNames.startDate]=this._formatDateForAPIQuery(_1a);}var _1b=this.endDateTextBox.get("value");if(_1b!=null){_16[this.apiParameterNames.endDate]=this._formatDateForAPIQuery(_1b);}_16[this.apiParameterNames.page]=this.currentPage++;_16[this.apiParameterNames.resultsPerPage]=this.resultsPerPage;return _16;},createDateSelects:function(){var _1c=this.displayFormats&&this.displayFormats.date?this.displayFormats.date:this.__defaultDisplayFormats.date;this.startDateTextBox=new _7({style:{width:this.dateTextInputWidth},constraints:{datePattern:_1c}});this.endDateTextBox=new _7({style:{width:this.dateTextInputWidth},constraints:{datePattern:_1c}});_6.place(this.startDateTextBox.domNode,this.startDateContainer);_6.place(this.endDateTextBox.domNode,this.endDateContainer);},_formatDateForAPIQuery:function(_1d){return _3.format(_1d,{selector:"date",datePattern:this.apiDateFormat});},getInfoTemplate:function(_1e){var _1f=new _e();_1f.setTitle(_1e.title);var _20=this.imageThumbUrlTemplate.replace(this.urlReplaceTemplates.farmId,_1e.farm).replace(this.urlReplaceTemplates.serverId,_1e.server);_20=_20.replace(this.urlReplaceTemplates.id,_1e.id).replace(this.urlReplaceTemplates.secret,_1e.secret);var _21=this.imageUrlTemplate.replace(this.urlReplaceTemplates.farmId,_1e.farm).replace(this.urlReplaceTemplates.serverId,_1e.server);_21=_21.replace(this.urlReplaceTemplates.id,_1e.id).replace(this.urlReplaceTemplates.secret,_1e.secret);var _22=_6.create("div");var _23=_6.create("img",{style:{cursor:"pointer"},src:_20,onclick:"window.open('"+_21+"')"});_6.place(_23,_22);if(this.infoWindowDisplayFields!=null&&_2.isArray(this.infoWindowDisplayFields)&&this.infoWindowDisplayFields.length>0){var _24=_6.create("ul",{style:{listStyleType:"none",margin:"0",marginLeft:"2px",padding:"0"}});var _25;var _26=false;for(var i=0;i<this.infoWindowDisplayFields.length;i++){_25=this.infoWindowDisplayFields[i];if(_1e[_25]!=null){var _27=_6.create("li",{innerHTML:_25+": "+_1e[_25]});_6.place(_27,_24);}_26=true;}if(_26){_6.place(_24,_22);}}_1f.setContent(_22.innerHTML);return _1f;},onRemoveGraphic:function(_28){},onAddGraphic:function(_29){}});});