//>>built
require({cache:{"url:esriviewer/ui/time/theme/timeSliderTheme.css":".timeSliderCurrentValueDisplay{color:#767676;margin:5px 5px 7px;}.timeSliderCurrentValueLabel{margin-bottom:3px;color:black;}.timeSliderUseRangeContainer{margin:0 0 15px;}.timeSlidersLayerSelectContainer{margin:13px 2px;}.timeSliderCurrentValuesAndActionsContainer{float:right;}.timeSliderLayerActions{height:16px;}.timeSliderDayOnlyMode{margin-right:40%;}","url:esriviewer/ui/time/template/TimeSliderContentTemplate.html":"<div>\r\n    <div class=\"timeSliderContentDisabled\" data-bind=\"visible: isDisabled, text:disabledTimeSliderText\"></div>\r\n    <div class=\"timeSliderContent\" data-bind=\"visible: isEnabled\">\r\n        <div class=\"timeSliderCurrentValuesAndActionsContainer\">\r\n            <div data-bind=\"visible: timeSliderCurrentValueVisible, css:{timeSliderDayOnlyMode: dayOnlyMode}\"\r\n                 class=\"timeSliderCurrentValueDisplay\">\r\n                <div class=\"timeSliderCurrentValueLabel\">Displaying ${featureTypeLabel} From:</div>\r\n                <div class=\"timeSliderCurrentValueValues\">\r\n                    <span data-bind=\"text: currentTimeStartValue\"></span>\r\n                    <span class=\"timeSliderCurrentValueValuesSeperator\"> - </span>\r\n                    <span data-bind=\"text: currentTimeEndValue\"></span>\r\n                </div>\r\n            </div>\r\n            <div class=\"timeSliderLayerActions\" data-bind=\"visible:timeSliderLayerActionsVisible\">\r\n                <div class=\"commonIcons16 locationGoTo\" title=\"Zoom To Layer Extent\"\r\n                     data-bind=\"visible:zoomToLayerVisible\"\r\n                     data-dojo-attach-event=\"onclick:handleZoomToLayerExtent\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"timeSliderUseRangeContainer\">\r\n            <span class=\"timeSliderUseRangeLabel\" data-bind=\"text:useRangeLabel\"></span>\r\n            <input type=\"checkbox\" data-bind=\"checked: useRangeSlider\"/>\r\n        </div>\r\n        <div class=\"timeSliderInputsContainer\">\r\n                <span class=\"timeSliderRangeBreaksContainer\">\r\n                    <span class=\"timeSliderRangeBreaksLabel\" data-bind=\"text:intervalsLabel\"></span>\r\n                    <select data-bind=\"options: intervals ,value:selectedInterval\">\r\n                    </select>\r\n                    <select data-bind=\"options: unitValue ,value:selectedUnits, optionsText: 'label', optionsValue: 'value'\">\r\n                    </select>\r\n                </span>\r\n\r\n            <div class=\"timeSlidersLayerSelectContainer\" data-bind=\"visible: layersSelectContainerVisible\">\r\n\r\n                <select data-bind=\"options: layers ,value:selectedLayer, optionsText: 'label', optionsValue: 'value', optionsCaption: 'Select A Layer...'\">\r\n\r\n                </select>\r\n            </div>\r\n        </div>\r\n        <div class=\"timeSlidersContainer\" data-dojo-attach-point=\"timeSlidersContainer\"\r\n             data-bind=\"visible: timeSliderVisible\">\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("esriviewer/ui/time/TimeSliderWidget",["dojo/_base/declare","xstyle/css!./theme/timeSliderTheme.css","dojo/text!./template/TimeSliderContentTemplate.html","dojo/topic","dojo/_base/lang","dojo/dom-attr","dojo/dom-style","dojo/dom-class","dojo/dom-construct","../base/UITemplatedWidget","./model/TimeSliderWidgetViewModel","esri/dijit/TimeSlider","esri/layers/TimeInfo","esri/geometry/Extent"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _1([_a],{bindingsApplied:false,playButtonClassName:"tsPlayButton",maxLayerNameLength:47,templateString:_3,featureTypeLabel:"Features",constructor:function(){this.timeSliderLayerLookup={};},postCreate:function(){this.inherited(arguments);this.createViewModel();this._loadTimeEnabledServices();},createViewModel:function(){this.viewModel=new _b();this.applyBindings();},applyBindings:function(){if(!this.bindingsApplied){this.viewModel.useRangeSlider.subscribe(_5.hitch(this,this.handleReloadSliders));this.viewModel.selectedInterval.subscribe(_5.hitch(this,this.handleReloadSliders));this.viewModel.selectedLayer.subscribe(_5.hitch(this,this.handleTimeSliderLayerChanged));ko.applyBindings(this.viewModel,this.domNode);this.bindingsApplied=true;this.viewModel.selectedUnits.subscribe(_5.hitch(this.viewModel,this.viewModel.handleSelectedUnitsChanged));}},initListeners:function(){_4.subscribe(VIEWER_GLOBALS.EVENTS.MAP.TIME.TIME_LAYER_FOUND,_5.hitch(this,this.processTimeEnabledService));},_loadTimeEnabledServices:function(){_4.publish(VIEWER_GLOBALS.EVENTS.MAP.TIME.GET_TIME_ENABLED_SERVICES,_5.hitch(this,this._setLoadedTimeEnabledService));},_setLoadedTimeEnabledService:function(_f){if(_5.isArray(_f)){for(var i=0;i<_f.length;i++){this.processTimeEnabledService(_f[i]);}}},processTimeEnabledService:function(_10){if(_10){if(_5.isArray(_10.layerInfos)){for(var i=0;i<_10.layerInfos.length;i++){var _11=_10.layerInfos[i];var _12=_11.id;var _13=_5.hitch(this,_5.hitch(this,this.addTimeEnabledLayerFromServiceDescription,_10));VIEWER_UTILS.getLayerInfoFromService(_10.url,_12,_13);}}else{this.addTimeEnabledLayer(_10);}}},addTimeEnabledLayer:function(_14){var id=_14.url.toLowerCase();if(this.timeSliderLayerLookup[id]!=null){return;}var _15=_14.timeInfo;if(_15 instanceof _d){var _16=new _e(_14.extent);this.timeSliderLayerLookup[id]={timeInfo:_15,name:_14.name,extent:_16};this.timeSliderLayerLookup[id]={timeInfo:_15,name:_14.name,extent:_16};var _17=_14.name;if(_17.length>this.maxLayerNameLength){var _18=_17.substring(0,(this.maxLayerNameLength-3));_17=_18+"...";}var _19={label:_17,value:id};this.viewModel.layers.push(_19);}else{VIEWER_UTILS.log("Layer was published as time enabled but does not have time info: "+_14.name,VIEWER_GLOBALS.LOG_TYPE.WARNING);}},addTimeEnabledLayerFromServiceDescription:function(_1a,_1b){var _1c=VIEWER_UTILS.getLayerUniqueId(_1a);var id=_1c+"_"+_1b.name.toLowerCase();if(this.timeSliderLayerLookup[id]!=null){return;}if(_1b&&_1b.timeInfo){var _1d=_1b.timeInfo;if(_5.isArray(_1d.timeExtent)&&_1d.timeExtent.length===2){var _1e=_1d.timeExtent[0];var _1f=_1d.timeExtent[1];if(!((_1e<0||_1f<0)||(_1f===_1e))){var _20=new _d(_1d);var _21=new _e(_1b.extent);this.timeSliderLayerLookup[id]={timeInfo:_20,name:_1b.name,extent:_21};var _22=_1b.name;if(_22.length>this.maxLayerNameLength){var _23=_22.substring(0,(this.maxLayerNameLength-3));_22=_23+"...";}var _24={label:_22,value:id};this.viewModel.layers.push(_24);}}}},handleReloadSliders:function(){var _25=this.viewModel.selectedLayer();if(_25!=null){var _26=this.timeSliderLayerLookup[_25];if(_26){this.createTimeSlider(_26);}}},handleTimeSliderLayerChanged:function(_27){if(_27==null){this.viewModel.timeSliderVisible(false);this.viewModel.timeSliderCurrentValueVisible(false);this.viewModel.zoomToLayerVisible(false);this.disableMapSlider();}else{var _28=this.timeSliderLayerLookup[_27];if(_28!=null){this.viewModel.disabled(false);this.viewModel.timeSliderVisible(true);this.viewModel.timeSliderCurrentValueVisible(true);this.viewModel.zoomToLayerVisible(true);this.createTimeSlider(_28);}}},disableMapSlider:function(){_4.publish(VIEWER_GLOBALS.EVENTS.MAP.TIME.CLEAR_TIME_EXTENT);},createTimeSlider:function(_29){var _2a=this.viewModel.selectedInterval();if(_2a==null){return;}if(_29){if(this.currentTimeSlider){this.currentTimeSlider.destroy();}this.currentTimeSlider=null;var _2b=_29.timeInfo.timeExtent;var _2c=_9.create("div");_9.place(_2c,this.timeSlidersContainer);this.currentTimeSlider=new _c({},_2c);this.currentTimeSlider._createHorizRule=function(){return;};this.currentTimeSlider.on("timeExtentChange",_5.hitch(this,this.onTimeExtentChange));_7.set(this.currentTimeSlider.domNode,"color","white");this.currentTimeSlider.setThumbCount(this.viewModel.useRangeSlider()?2:1);var _2d=this.viewModel.selectedUnits();var _2e=_2d.units;if(_2e==null||_2e==""){this.currentTimeSlider.createTimeStopsByCount(_2b,_2a);}else{this.currentTimeSlider.createTimeStopsByTimeInterval(_2b,_2a,_2e);}_29.sliderWidget=this.currentTimeSlider;this.currentTimeSlider.startup();_4.publish(VIEWER_GLOBALS.EVENTS.MAP.TIME.SET_MAP_TIME_SLIDER,this.currentTimeSlider);}},onTimeExtentChange:function(_2f){if(_2f==null){return;}_4.publish(VIEWER_GLOBALS.EVENTS.MAP.TIME.MAP_TIME_CHANGED,_2f);var _30=(_2f.startTime.getUTCMonth()+1);var _31=_2f.startTime.getUTCDate();var _32=_2f.startTime.getFullYear();var _33=_2f.startTime.getUTCHours();var _34=_2f.startTime.getUTCMinutes();var _35=_2f.startTime.getUTCSeconds();if(_30<10){_30="0"+_30;}if(_31<10){_31="0"+_31;}if(_33<10){_33="0"+_33;}if(_34<10){_34="0"+_34;}if(_35<10){_35="0"+_35;}var _36;if(this.viewModel.dayOnlyMode()){_36=_31+"-"+_30+"-"+_32;}else{_36=_31+"-"+_30+"-"+_32+" "+_33+":"+_34+":"+_35;}var _37=(_2f.endTime.getUTCMonth()+1);var _38=_2f.endTime.getUTCDate();var _39=_2f.endTime.getFullYear();var _3a=_2f.endTime.getUTCHours();var _3b=_2f.endTime.getUTCMinutes();var _3c=_2f.endTime.getUTCSeconds();if(_37<10){_37="0"+_37;}if(_38<10){_38="0"+_38;}if(_3a<10){_3a="0"+_3a;}if(_3b<10){_3b="0"+_3b;}if(_3c<10){_3c="0"+_3c;}var _3d;if(this.viewModel.dayOnlyMode()){_3d=_38+"-"+_37+"-"+_39;}else{_3d=_38+"-"+_37+"-"+_39+" "+_3a+":"+_3b+":"+_3c;}this.viewModel.currentTimeStartValue(_36);this.viewModel.currentTimeEndValue(_3d);},handleZoomToLayerExtent:function(){var _3e=this.viewModel.selectedLayer();if(_3e!=null){var _3f=this.timeSliderLayerLookup[_3e];if(_3f){_4.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_3f.extent);}}},clearTimeSlider:function(){this.viewModel.selectedLayer(null);}});});