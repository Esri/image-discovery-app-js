//>>built
require({cache:{"url:esriviewer/ui/time/template/TimeSliderContentTemplate.html":"<div>\r\n    <div class=\"timeSliderContentDisabled\" data-bind=\"visible: isDisabled, text:disabledTimeSliderText\"></div>\r\n    <div class=\"timeSliderContent\" data-bind=\"visible: isEnabled\">\r\n        <div class=\"timeSliderCurrentValuesAndActionsContainer\">\r\n            <div data-bind=\"visible: timeSliderCurrentValueVisible, css:{timeSliderDayOnlyMode: dayOnlyMode}\"\r\n                 class=\"timeSliderCurrentValueDisplay\">\r\n                <div class=\"timeSliderCurrentValueLabel\">Displaying ${featureTypeLabel} From:</div>\r\n                <div class=\"timeSliderCurrentValueValues\">\r\n                    <span data-bind=\"text: currentTimeStartValue\"></span>\r\n                    <span class=\"timeSliderCurrentValueValuesSeparator\"> - </span>\r\n                    <span data-bind=\"text: currentTimeEndValue\"></span>\r\n                </div>\r\n            </div>\r\n            <div class=\"timeSliderLayerActions\" data-bind=\"visible:timeSliderLayerActionsVisible\">\r\n                <div class=\"commonIcons16 locationGoTo\" title=\"Zoom To Layer Extent\"\r\n                     data-bind=\"visible:zoomToLayerVisible\"\r\n                     data-dojo-attach-event=\"onclick:handleZoomToLayerExtent\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"timeSliderUseRangeContainer\">\r\n            <span class=\"timeSliderUseRangeLabel\" data-bind=\"text:useRangeLabel\"></span>\r\n            <input type=\"checkbox\" data-bind=\"checked: useRangeSlider\"/>\r\n        </div>\r\n        <div class=\"timeSliderInputsContainer\">\r\n                <span class=\"timeSliderRangeBreaksContainer\">\r\n                    <span class=\"timeSliderRangeBreaksLabel\" data-bind=\"text:intervalsLabel\"></span>\r\n                    <select data-bind=\"options: intervals ,value:selectedInterval\">\r\n                    </select>\r\n                    <select data-bind=\"options: unitValue ,value:selectedUnits, optionsText: 'label', optionsValue: 'value'\">\r\n                    </select>\r\n                </span>\r\n\r\n            <div class=\"timeSlidersLayerSelectContainer\" data-bind=\"visible: layersSelectContainerVisible\">\r\n\r\n                <select data-bind=\"options: layers ,value:selectedLayer, optionsText: 'label', optionsValue: 'value', optionsCaption: 'Select A Layer...'\">\r\n\r\n                </select>\r\n            </div>\r\n        </div>\r\n        <div class=\"timeSlidersContainer\" data-dojo-attach-point=\"timeSlidersContainer\"\r\n             data-bind=\"visible: timeSliderVisible\">\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("esriviewer/ui/time/TimeSliderWidget",["dojo/_base/declare","dojo/text!./template/TimeSliderContentTemplate.html","dojo/topic","dojo/_base/lang","dojo/dom-style","dojo/dom-construct","../base/UITemplatedWidget","./model/TimeSliderWidgetViewModel","esri/dijit/TimeSlider","esri/layers/TimeInfo","esri/geometry/Extent"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _1([_7],{bindingsApplied:false,playButtonClassName:"tsPlayButton",maxLayerNameLength:47,templateString:_2,featureTypeLabel:"Features",constructor:function(){this.timeSliderLayerLookup={};},postCreate:function(){this.inherited(arguments);this.createViewModel();this._loadTimeEnabledServices();},createViewModel:function(){this.viewModel=new _8();this.applyBindings();},applyBindings:function(){if(!this.bindingsApplied){this.bindingsApplied=true;ko.applyBindings(this.viewModel,this.domNode);this.viewModel.useRangeSlider.subscribe(_4.hitch(this,this.handleReloadSliders));this.viewModel.selectedInterval.subscribe(_4.hitch(this,this.handleReloadSliders));this.viewModel.selectedLayer.subscribe(_4.hitch(this,this.handleTimeSliderLayerChanged));this.viewModel.selectedUnits.subscribe(_4.hitch(this.viewModel,this.viewModel.handleSelectedUnitsChanged));}},initListeners:function(){_3.subscribe(VIEWER_GLOBALS.EVENTS.MAP.TIME.TIME_LAYER_FOUND,_4.hitch(this,this.processTimeEnabledService));},_loadTimeEnabledServices:function(){_3.publish(VIEWER_GLOBALS.EVENTS.MAP.TIME.GET_TIME_ENABLED_SERVICES,_4.hitch(this,this._setLoadedTimeEnabledService));},_setLoadedTimeEnabledService:function(_c){if(_4.isArray(_c)){for(var i=0;i<_c.length;i++){this.processTimeEnabledService(_c[i]);}}},processTimeEnabledService:function(_d){if(_d){if(_4.isArray(_d.layerInfos)){for(var i=0;i<_d.layerInfos.length;i++){var _e=_d.layerInfos[i];var _f=_e.id;var _10=_4.hitch(this,_4.hitch(this,this.addTimeEnabledLayerFromServiceDescription,_d));VIEWER_UTILS.getLayerInfoFromService(_d.url,_f,_10);}}else{this.addTimeEnabledLayer(_d);}}},addTimeEnabledLayer:function(_11){var id=_11.url.toLowerCase();if(this.timeSliderLayerLookup[id]!=null){return;}var _12=_11.timeInfo;if(_12 instanceof _a){var _13=new _b(_11.extent);this.timeSliderLayerLookup[id]={timeInfo:_12,name:_11.name,extent:_13};this.timeSliderLayerLookup[id]={timeInfo:_12,name:_11.name,extent:_13};var _14=_11.name;if(_14.length>this.maxLayerNameLength){var _15=_14.substring(0,(this.maxLayerNameLength-3));_14=_15+"...";}var _16={label:_14,value:id};this.viewModel.layers.push(_16);}else{VIEWER_UTILS.log("Layer was published as time enabled but does not have time info: "+_11.name,VIEWER_GLOBALS.LOG_TYPE.WARNING);}},addTimeEnabledLayerFromServiceDescription:function(_17,_18){var _19=VIEWER_UTILS.getLayerUniqueId(_17);var id=_19+"_"+_18.name.toLowerCase();if(this.timeSliderLayerLookup[id]!=null){return;}if(_18&&_18.timeInfo){var _1a=_18.timeInfo;if(_4.isArray(_1a.timeExtent)&&_1a.timeExtent.length===2){var _1b=_1a.timeExtent[0];var _1c=_1a.timeExtent[1];if(!((_1b<0||_1c<0)||(_1c===_1b))){var _1d=new _a(_1a);var _1e=new _b(_18.extent);this.timeSliderLayerLookup[id]={timeInfo:_1d,name:_18.name,extent:_1e};var _1f=_18.name;if(_1f.length>this.maxLayerNameLength){var _20=_1f.substring(0,(this.maxLayerNameLength-3));_1f=_20+"...";}var _21={label:_1f,value:id};this.viewModel.layers.push(_21);}}}},handleReloadSliders:function(){var _22=this.viewModel.selectedLayer();if(_22!=null){var _23=this.timeSliderLayerLookup[_22];if(_23){this.createTimeSlider(_23);}}},handleTimeSliderLayerChanged:function(_24){if(_24==null){this.viewModel.timeSliderVisible(false);this.viewModel.timeSliderCurrentValueVisible(false);this.viewModel.zoomToLayerVisible(false);this.disableMapSlider();}else{var _25=this.timeSliderLayerLookup[_24];if(_25!=null){this.viewModel.disabled(false);this.viewModel.timeSliderVisible(true);this.viewModel.timeSliderCurrentValueVisible(true);this.viewModel.zoomToLayerVisible(true);this.createTimeSlider(_25);}}},disableMapSlider:function(){_3.publish(VIEWER_GLOBALS.EVENTS.MAP.TIME.CLEAR_TIME_EXTENT);},createTimeSlider:function(_26){var _27=this.viewModel.selectedInterval();if(_27==null){return;}if(_26){if(this.currentTimeSlider){this.currentTimeSlider.destroy();}this.currentTimeSlider=null;var _28=_26.timeInfo.timeExtent;var _29=_6.create("div");_6.place(_29,this.timeSlidersContainer);this.currentTimeSlider=new _9({},_29);this.currentTimeSlider._createHorizRule=function(){return;};this.currentTimeSlider.on("time-extent-change",_4.hitch(this,this.onTimeExtentChange));_5.set(this.currentTimeSlider.domNode,"color","white");this.currentTimeSlider.setThumbCount(this.viewModel.useRangeSlider()?2:1);var _2a=this.viewModel.selectedUnits();var _2b=_2a.units;if(_2b==null||_2b==""){this.currentTimeSlider.createTimeStopsByCount(_28,_27);}else{this.currentTimeSlider.createTimeStopsByTimeInterval(_28,_27,_2b);}_26.sliderWidget=this.currentTimeSlider;this.currentTimeSlider.startup();_3.publish(VIEWER_GLOBALS.EVENTS.MAP.TIME.SET_MAP_TIME_SLIDER,this.currentTimeSlider);}},onTimeExtentChange:function(_2c){if(_2c==null){return;}_3.publish(VIEWER_GLOBALS.EVENTS.MAP.TIME.MAP_TIME_CHANGED,_2c);var _2d=(_2c.startTime.getUTCMonth()+1);var _2e=_2c.startTime.getUTCDate();var _2f=_2c.startTime.getFullYear();var _30=_2c.startTime.getUTCHours();var _31=_2c.startTime.getUTCMinutes();var _32=_2c.startTime.getUTCSeconds();if(_2d<10){_2d="0"+_2d;}if(_2e<10){_2e="0"+_2e;}if(_30<10){_30="0"+_30;}if(_31<10){_31="0"+_31;}if(_32<10){_32="0"+_32;}var _33;if(this.viewModel.dayOnlyMode()){_33=_2e+"-"+_2d+"-"+_2f;}else{_33=_2e+"-"+_2d+"-"+_2f+" "+_30+":"+_31+":"+_32;}var _34=(_2c.endTime.getUTCMonth()+1);var _35=_2c.endTime.getUTCDate();var _36=_2c.endTime.getFullYear();var _37=_2c.endTime.getUTCHours();var _38=_2c.endTime.getUTCMinutes();var _39=_2c.endTime.getUTCSeconds();if(_34<10){_34="0"+_34;}if(_35<10){_35="0"+_35;}if(_37<10){_37="0"+_37;}if(_38<10){_38="0"+_38;}if(_39<10){_39="0"+_39;}var _3a;if(this.viewModel.dayOnlyMode()){_3a=_35+"-"+_34+"-"+_36;}else{_3a=_35+"-"+_34+"-"+_36+" "+_37+":"+_38+":"+_39;}this.viewModel.currentTimeStartValue(_33);this.viewModel.currentTimeEndValue(_3a);},handleZoomToLayerExtent:function(){var _3b=this.viewModel.selectedLayer();if(_3b!=null){var _3c=this.timeSliderLayerLookup[_3b];if(_3c){_3.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_3c.extent);}}},clearTimeSlider:function(){this.viewModel.selectedLayer(null);}});});