//>>built
require({cache:{"url:esriviewer/ui/legend/template/MapLegendTemplate.html":"<div class=\"legendWindowContent\">\r\n    <div class=\"legendWidgetContainer\">\r\n        <div data-dojo-attach-point=\"legendWidgetContents\" class=\"legendWidgetContent\"></div>\r\n    </div>\r\n</div>"}});define("esriviewer/ui/legend/MapLegendWidget",["dojo/_base/declare","dojo/text!./template/MapLegendTemplate.html","dojo/topic","dojo/_base/lang","../base/UITemplatedWidget","esri/dijit/Legend"],function(_1,_2,_3,_4,_5,_6){return _1([_5],{startupCalled:false,templateString:_2,initListeners:function(){_3.subscribe(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVED,_4.hitch(this,this.handleRefreshLegend));_3.subscribe(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADDED,_4.hitch(this,this.handleRefreshLegend));this.operationalLayerResponseCallback=_4.hitch(this,this._handleLegendOperationalLayersResponse);},handleRefreshLegend:function(){if(this.legendWidget!=null){if(!this.startupCalled){this.startup();}_3.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.OPERATIONAL.GET,this.operationalLayerResponseCallback);}},_handleLegendOperationalLayersResponse:function(_7){if(_7){var _8=[];for(var _9 in _7){if(_7.hasOwnProperty(_9)){_8.push({layer:_7[_9]});}}}this.legendWidget.refresh(_8);},postCreate:function(){this.inherited(arguments);var _a=[];_3.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.OPERATIONAL.GET,function(_b){for(var _c in _b){if(_b.hasOwnProperty(_c)){_a.push({layer:_b[_c]});}}});var _d;_3.publish(VIEWER_GLOBALS.EVENTS.MAP.GET,function(_e){_d=_e;});var _f={map:_d};if(_a.length>0){_f.layerInfos=_a;}this.legendWidget=new _6(_f,this.legendWidgetContents);},startup:function(){if(!this.startupCalled){try{this.legendWidget.startup();this.startupCalled=true;}catch(err){}}}});});