//>>built
define("esriviewer/ui/toolbar/base/LocatorToolbarSupportMixin",["dojo/_base/declare","dojo/topic","dojo/_base/lang","dojo/on","dojo/dom-attr","dojo/dom-construct","dojo/dom-style","../../../base/LocationSupport","dijit/TooltipDialog","dijit/form/RadioButton","esri/geometry/Extent","esri/SpatialReference"],function(_1,_2,_3,on,_4,_5,_6,_7,_8,_9,_a,_b){return _1([_7],{showLocator:true,pointAddressAttributeLabel:"PointAddress",candidateAttributeLocationWKID:4326,constructor:function(){this.locatorLookup={};},onLocateBlur:function(){var _c=_4.get(this.locateTextBox,"value");if(_c==""){_4.set(this.locateTextBox,"value",this.locateDefaultInput);_6.set(this.locateTextBox,"color","#878787");}},initLocatorListeners:function(){on(this.locateTextBox,"blur",_3.hitch(this,this.onLocateBlur));on(this.locateTextBox,"focus",_3.hitch(this,this.onLocateFocus));on(this.locateTextBox,"keyup",_3.hitch(this,this.onLocateTextKeyUp));on(this.locateButton,"click",_3.hitch(this,this.handleLocationSearchRequest));_2.subscribe(VIEWER_GLOBALS.EVENTS.LOCATOR.LOCATOR_ADDED,_3.hitch(this,this.handleLocatorAdded));_2.subscribe(VIEWER_GLOBALS.EVENTS.LOCATOR.LOCATOR_REMOVED,_3.hitch(this,this.handleLocatorRemoved));},loadCurrentLocators:function(){var _d=null;_2.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.GET_LOCATORS,function(_e){_d=_e;});if(_d!=null&&_3.isArray(_d)&&_d.length>0){for(var i=0;i<_d.length;i++){this._addLocatorToLocatorConfiguration(_d[i].locator,_d[i].label);}if(this.showLocator){_6.set(this.locateToolbarContainer,"display","inline");}}else{}},handleLocatorAdded:function(_f){if(this.showLocator){_6.set(this.locateToolbarContainer,"display","inline");}this._addLocatorToLocatorConfiguration(_f.locator,_f.label);},_addLocatorToLocatorConfiguration:function(_10,_11){if(this.configureLocatorTooltip==null){this.createConfigureLocatorTooltip();}var _12=_10.url.toLowerCase();if(this.locatorLookup[_12]!=null){return;}var _13=new _9({name:"locatorConfigureRadioEntry"});var _14=(_11!=null&&_11!="")?_11:REG_EXP_UTILS.getServiceNameFromUrl(_10.url);var _15=_5.create("span",{innerHTML:_14,className:"locatorConfigurationEntryLabel"});var _16=_5.create("div",{className:"locatorConfigurationEntry"});_5.place(_13.domNode,_16);_5.place(_15,_16);_5.place(_16,this.configureLocatorContent);_6.set(this.configureLocatorNoLocatorsText,"display","none");this.locatorLookup[_12]={locator:_10,container:_16,radio:_13};var _17=0;for(var key in this.locatorLookup){_17++;}if(_17==1){_13.set("checked","true");}},handleLocatorRemoved:function(_18){if(this.locatorLookup[_18]!=null){_5.destroy(this.locatorLookup[_18].container);delete this.locatorLookup[_18];var _19=false;for(var key in this.locatorLookup){_19=true;break;}if(_19){_6.set(this.configureLocatorNoLocatorsText,"display","none");}else{_6.set(this.configureLocatorNoLocatorsText,"display","block");}}},onLocateFocus:function(){var val=_4.get(this.locateTextBox,"value");if(val==this.locateDefaultInput){_4.set(this.locateTextBox,"value","");_6.set(this.locateTextBox,"color","black");}},onLocateTextKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.handleLocationSearchRequest();}},handleLocationSearchRequest:function(){var _1a=_4.get(this.locateTextBox,"value");if(_1a!=null&&_1a!=""&&_1a!=this.locateDefaultInput){var _1b;var _1c;for(var key in this.locatorLookup){_1b=this.locatorLookup[key];if(_1b.radio.get("checked")){_1c=_1b;break;}}if(_1c){this.handleLocate(_1a,_1c.locator);}}},handleLocationResponse:function(_1d){if(_3.isArray(_1d)&&_1d.length>0){var _1e=_1d[0];if(_3.isObject(_1e.attributes)){var _1f;var _20;var _21;var _22;var _23;if(_1e.attributes.North_Lat!=null&&_1e.attributes.South_Lat!=null&&_1e.attributes.West_Lon!=null&&_1e.attributes.East_Lon!=null){try{_1f=parseFloat(_1e.attributes.West_Lon);_20=parseFloat(_1e.attributes.South_Lat);_21=parseFloat(_1e.attributes.East_Lon);_22=parseFloat(_1e.attributes.North_Lat);_23=new _a(_1f,_20,_21,_22,new _b(this.candidateAttributeLocationWKID));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_23);return;}catch(err){}}if(_1e.attributes.Ymax!=null&&_1e.attributes.Xmax!=null&&_1e.attributes.Xmin!=null&&_1e.attributes.Ymin!=null){try{_1f=parseFloat(_1e.attributes.Xmin);_20=parseFloat(_1e.attributes.Ymin);_21=parseFloat(_1e.attributes.Xmax);_22=parseFloat(_1e.attributes.Ymax);_23=new _a(_1f,_20,_21,_22,new _b(this.candidateAttributeLocationWKID));_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_23);return;}catch(err){}}if(_1e.attributes.MatchLevel!=null&&_1e.location){var _24=_1e.attributes.MatchLevel;var _25=null;if(_24!=null){if(_24===this.pointAddressAttributeLabel){_25={};_25.deepest=true;}}_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PAN_TO,_1e.location,_25);return;}}if(_1e.location!=null){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.PAN_TO,_1e.location);}}},createConfigureLocatorTooltip:function(){this.configureLocatorContent=_5.create("div");this.configureLocatorNoLocatorsText=_5.create("div",{className:"noLocatorsText",innerHTML:"No Locators Configured"});_5.place(this.configureLocatorNoLocatorsText,this.configureLocatorContent);this.configureLocatorTooltip=new _8({content:this.configureLocatorContent});},toggleConfigureLocatorTooltip:function(){if(!this.configureLocatorTooltipVisible){this.showConfigureLocatorTooltip();this.configureLocatorTooltipVisible=true;}else{this.hideConfigureLocatorTooltip();this.configureLocatorTooltipVisible=false;}},showConfigureLocatorTooltip:function(){if(this.configureLocatorTooltip==null){this.createConfigureLocatorTooltip();}if(this.configureLocatorTooltip){dijit.popup.open({popup:this.configureLocatorTooltip,around:this.configureLocateButton});}},hideConfigureLocatorTooltip:function(){if(this.configureLocatorTooltip){dijit.popup.close(this.configureLocatorTooltip);}}});});