//>>built
require({cache:{"url:esriviewer/ui/measure/theme/MeasureTheme.css":".measurementIconSelected{border-bottom:2px solid blue;}.measurementSpacer{display:inline;margin-left:10px;margin-right:2px;padding-top:2px;}.measurementResultsContainer{margin-top:10px;}.measureIcon{float:left;margin-left:10px;cursor:pointer;}","url:esriviewer/ui/measure/template/MeasureWidgetTemplate.html":"<div class=\"measurementWidget\">\r\n    <div class=\"measureIcon areaIcon\"\r\n         title=\"Area\"\r\n         data-bind=\"click:handleAreaButtonClick, css: {measurementIconSelected: areaActive}\"></div>\r\n    <div class=\"measureIcon distanceIcon\"\r\n         title=\"Distance\"\r\n         data-bind=\"click:handleDistanceButtonClick, css: {measurementIconSelected: distanceActive}\"></div>\r\n    <div class=\"measureIcon locationIcon\"\r\n         title=\"Location\"\r\n         data-bind=\"click:handleLocationButtonClick, css: {measurementIconSelected: locationActive}\"></div>\r\n    <div class=\"measurementSpacer\">|</div>\r\n    <select data-bind=\"visible: areaActive, options: areaMeasurementUnits ,value:selectedAreaUnits, optionsText: 'label', optionsValue: 'value'\">\r\n    </select>\r\n    <select data-bind=\"visible: distanceActive, options: distanceMeasurementUnits ,value:selectedDistanceUnits, optionsText: 'label', optionsValue: 'value'\">\r\n    </select>\r\n    <select data-bind=\"visible: locationActive, options: locationUnits ,value:selectedLocationUnits, optionsText: 'label', optionsValue: 'value'\">\r\n    </select>\r\n\r\n\r\n    <div class=\"measurementResultsContainer\">\r\n        <span data-bind=\"text: measureMethodText\" class=\"measureMethodText\"></span>\r\n        <span data-bind=\"text: resultsText\" class=\"measureResultsText\"></span>\r\n        <span data-bind=\"text: unitsText\"  class=\"measureUnitsText\"></span>\r\n    </div>\r\n</div>"}});define("esriviewer/ui/measure/MeasureWidget",["dojo/_base/declare","xstyle/css!./theme/MeasureTheme.css","dojo/_base/lang","dojo/_base/Color","dojo/topic","../base/UITemplatedWidget","dojo/text!./template/MeasureWidgetTemplate.html","./model/MeasureWidgetViewModel","../draw/base/MapDrawSupport","esri/geometry/Point","esri/geometry/Polyline","esri/geometry/Polygon","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return _1([_6,_9],{measureFloatPrecision:2,locationFloatPrecision:3,templateString:_7,AREA:"area",DISTANCE:"distance",LOCATION:"location",constructor:function(){this.currentGeometry=null;this.currentGraphic=null;},postCreate:function(){this.distanceResponseCallback=_3.hitch(this,this.handleDistanceResponse);this.areaResponseCallback=_3.hitch(this,this.handleAreaResponse);this.locationResponseCallback=_3.hitch(this,this.handleLocationResponse);this.initSymbology();this.viewModel=new _8();this.viewModel.areaActive.subscribe(_3.hitch(this,this.handleAreaActiveChanged));this.viewModel.distanceActive.subscribe(_3.hitch(this,this.handleDistanceActiveChanged));this.viewModel.locationActive.subscribe(_3.hitch(this,this.handleLocationActiveChanged));this.viewModel.selectedAreaUnits.subscribe(_3.hitch(this,this.handleSelectedAreaUnitsChanged));this.viewModel.selectedDistanceUnits.subscribe(_3.hitch(this,this.handleSelectedDistanceUnitsChanged));this.viewModel.selectedLocationUnits.subscribe(_3.hitch(this,this.handleSelectedLocationUnitsChanged));ko.applyBindings(this.viewModel,this.domNode);},handleSelectedLocationUnitsChanged:function(_10){if(this.currentGeometry&&this.currentGeometry instanceof _a){_5.publish(VIEWER_GLOBALS.EVENTS.GEOMETRY_SERVICE.TASKS.PROJECT_TO_LAT_LON,this.currentGeometry,this.locationResponseCallback);}},handleSelectedDistanceUnitsChanged:function(_11){if(this.currentGeometry&&this.currentGeometry instanceof _b){_5.publish(VIEWER_GLOBALS.EVENTS.GEOMETRY_SERVICE.TASKS.CALCULATE_DISTANCE,this.currentGeometry,_11,this.distanceResponseCallback);}},handleSelectedAreaUnitsChanged:function(_12){if(this.currentGeometry&&this.currentGeometry instanceof _c){_5.publish(VIEWER_GLOBALS.EVENTS.GEOMETRY_SERVICE.TASKS.CALCULATE_AREA,this.currentGeometry,_12,this.areaResponseCallback);}},initSymbology:function(){this.polygonSymbol=new _d(_d.STYLE_SOLID,new _e(_e.STYLE_SOLID,new _4([0,0,255]),1),new _4([0,0,255,0]));this.pointSymbol=new _f(_f.STYLE_X,1,new _e(_e.STYLE_SOLID,new _4("blue")));this.lineSymbol=new _e(_e.STYLE_SOLID,new _4([0,0,255]),1);},handleAreaActiveChanged:function(_13){if(_13){this.handlePolygonDraw();this.activeMode=this.AREA;}else{if(this.activeMode==this.AREA){this.activeMode="";this.clearCurrentGraphic();this.clearDraw();}}},handleDistanceActiveChanged:function(_14){if(_14){this.handleLineDraw();this.activeMode=this.DISTANCE;}else{if(this.activeMode==this.DISTANCE){this.activeMode="";this.clearCurrentGraphic();this.clearDraw();}}},handleLocationActiveChanged:function(_15){if(_15){this.handlePointDraw();this.activeMode=this.LOCATION;}else{if(this.activeMode==this.LOCATION){this.activeMode="";this.clearCurrentGraphic();this.clearDraw();}}},clearDraw:function(){this.inherited(arguments);this.viewModel.areaActive(false);this.viewModel.distanceActive(false);this.viewModel.locationActive(false);this.viewModel.measureMethodText("");this.viewModel.unitsText("");this.viewModel.resultsText("");_5.publish(VIEWER_GLOBALS.EVENTS.DRAW.USER.DRAW_CANCEL);},clearCurrentGraphic:function(){if(this.currentGraphic){_5.publish(VIEWER_GLOBALS.EVENTS.MAP.GRAPHICS.REMOVE,this.currentGraphic);this.currentGraphic=null;}},handleLineDraw:function(){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_LINE);},handlePolygonDraw:function(){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON);},handlePointDraw:function(){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT);},geometryAdded:function(_16){this.currentGeometry=_16;this.inherited(arguments);if(this.viewModel.locationActive()){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POINT);_5.publish(VIEWER_GLOBALS.EVENTS.GEOMETRY_SERVICE.TASKS.PROJECT_TO_LAT_LON,_16,this.locationResponseCallback);}if(this.viewModel.areaActive()){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_POLYGON);_5.publish(VIEWER_GLOBALS.EVENTS.GEOMETRY_SERVICE.TASKS.CALCULATE_AREA,_16,this.viewModel.selectedAreaUnits(),this.areaResponseCallback);}if(this.viewModel.distanceActive()){this.setDraw(VIEWER_GLOBALS.EVENTS.MAP.TOOLS.DRAW_LINE);_5.publish(VIEWER_GLOBALS.EVENTS.GEOMETRY_SERVICE.TASKS.CALCULATE_DISTANCE,_16,this.viewModel.selectedDistanceUnits(),this.distanceResponseCallback);}},handleDistanceResponse:function(_17){if(_17==null||!_3.isObject(_17)||_17.lengths==null||!_3.isArray(_17.lengths)||_17.lengths.length<1){return;}this.viewModel.measureMethodText("Distance: ");this.viewModel.resultsText(REG_EXP_UTILS.numberToStringWithCommas(_17.lengths[0].toFixed(this.measureFloatPrecision)));this.viewModel.unitsText(this.viewModel.getLabelForDistanceValue(this.viewModel.selectedDistanceUnits()));},handleAreaResponse:function(_18){if(_18==null||!_3.isObject(_18)||_18.areas==null||!_3.isArray(_18.areas)||_18.areas.length<1){return;}var _19=_18.areas[0];this.viewModel.measureMethodText("Area: ");this.viewModel.unitsText(this.viewModel.getLabelForAreaValue(this.viewModel.selectedAreaUnits()));this.viewModel.resultsText(REG_EXP_UTILS.numberToStringWithCommas(_19.toFixed(this.measureFloatPrecision)));},handleLocationResponse:function(_1a){if(_1a==null||!_3.isArray(_1a)||_1a.length<1){return;}var pt=_1a[0];this.viewModel.measureMethodText("");this.viewModel.unitsText("");if(this.viewModel.selectedLocationUnits()==VIEWER_GLOBALS.ESRI_UNITS.DEGREE_MINUTE_SECONDS){this.viewModel.resultsText("Latitude: "+GEOMETRY_UTILS.ddToDMSString(pt.y)+" Longitude:"+GEOMETRY_UTILS.ddToDMSString(pt.x));}else{this.viewModel.resultsText("Latitude: "+pt.y.toFixed(this.locationFloatPrecision)+" Longitude: "+pt.x.toFixed(this.locationFloatPrecision));}},onAnnotationCreated:function(_1b){if(_1b!=null&&_1b.graphic!=null){this.inherited(arguments);this.clearCurrentGraphic();this.currentGraphic=_1b.graphic;_5.publish(VIEWER_GLOBALS.EVENTS.MAP.GRAPHICS.ADD,_1b.graphic);}},reset:function(){this.clearCurrentGraphic();this.clearDraw();}});});