//>>built
require({cache:{"url:esriviewer/ui/layers/template/LayersTocWidgetTemplate.html":"<div>\r\n    <div class=\"tocRightClickLbl\">Right click for actions</div>\r\n    <div data-dojo-attach-point=\"tocContainer\" class=\"tocContainer\">\r\n\r\n\r\n    </div>\r\n</div>"}});define("esriviewer/ui/layers/LayersTocWidget",["dojo/_base/declare","dojo/text!./template/LayersTocWidgetTemplate.html","dojo/_base/array","dojo/_base/lang","dojo/dom-style","dojo/dom-construct","dijit/Tree","dijit/tree/ForestStoreModel","dojo/data/ItemFileWriteStore","./base/LayersTocWidgetContextMenu","../base/UITemplatedWidget","esri/layers/ArcGISTiledMapServiceLayer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1([_b],{templateString:_2,constructor:function(){this.treeStore=new _9({data:{items:[],identifier:"id",label:"label"}});this.treeModel=new _8({store:this.treeStore,openOnClick:true});this.tree=new _7({model:this.treeModel,getIconClass:_4.hitch(this,this.getTreeIcon),showRoot:false});_5.set(this.tree.domNode,"height","100%");this.treeContextMenu=new _a({tree:this.tree});this.treeContextMenu.bindNodeToNoContentMenu(this.tree.rootNode.domNode);},postCreate:function(){this.inherited(arguments);_6.place(this.tree.domNode,this.tocContainer);},initListeners:function(){this.tree.on("click",_4.hitch(this,this.treeClickHandler));},getNodeFromItem:function(_d){var _e=_d.id[0];return this.tree._itemNodesMap[_e][0];},getTreeIcon:function(_f,_10){if(_f.root){return "tocIcons layerService";}var _11=null;var _12=null;if(_f.layer){_11=this.treeStore.getValue(_f,"layer");}if(_f.layerId){_12=this.treeStore.getValue(_f,"layerId");}if(_11){if(_12!=null){var _13=this.treeStore.getValue(_f,"info");if(_4.isArray(_13.subLayerIds)&&_13.subLayerIds.length>0){if(_10){return "tocIcons folderOpen";}else{return "tocIcons folderClosed";}}else{var _14=_3.indexOf(_11.visibleLayers,_12)>-1;if(_4.isObject(_13.metadata)){var _15=_13.metadata;if(_15.geometryType!=""){if(_15.geometryType==VIEWER_GLOBALS.ESRI_GEOMETRY_TYPES.POINT){if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){return "tocIcons layerPoint";}if(_14){return "tocIcons layerPointChecked";}else{return "tocIcons layerPointUnchecked";}}else{if(_15.geometryType==VIEWER_GLOBALS.ESRI_GEOMETRY_TYPES.LINE){if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){return "tocIcons layerLine";}if(_14){return "tocIcons layerLineChecked";}else{return "tocIcons layerLineUnchecked";}}else{if(_15.geometryType==VIEWER_GLOBALS.ESRI_GEOMETRY_TYPES.POLYGON){if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){return "tocIcons layerPolygon";}if(_14){return "tocIcons layerPolygonChecked";}else{return "tocIcons layerPolygonUnchecked";}}else{if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){return "tocIcons layerGeneric";}if(_14){return "layerGenericChecked";}else{return "layerGenericUnchecked";}}}}}else{if(_15.type==VIEWER_GLOBALS.ESRI_LAYER_TYPES.RASTER){if(_11 instanceof _c){return "tocIcons layerRasterIcon";}if(_14){return "tocIcons layerRasterIconChecked";}else{return "tocIcons layerRasterIconUnchecked";}}else{return _14?"tocIcons layerGenericChecked":"tocIcons layerGenericUnchecked";}}}else{if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.IMAGE_SERVICE){return "genericLayerIcon";}else{return _14?"tocIcons layerGenericChecked":"tocIcons layerGenericUnchecked";}}}}else{if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.IMAGE_SERVICE){if(_11.visible){return "tocIcons imageServiceChecked";}else{return "tocIcons imageServiceUnchecked";}}else{if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.DYNAMIC_MAP_SERVICE){if(_11.visible){return "tocIcons globeChecked";}else{return "tocIcons globeUnchecked";}}else{if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){if(_11.visible){return "tocIcons layerRasterChecked";}else{return "tocIcons layerRasterUnchecked";}}else{if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.FEATURE_LAYER){if(_11.visible){return "tocIcons layerGenericChecked";}else{return "tocIcons layerGenericUnchecked";}}else{if(_11.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.GRAPHICS_LAYER){if(_11.visible){return "tocIcons graphicsLayerChecked";}else{return "tocIcons graphicsLayerUnchecked";}}else{if(_11.visible){return "tocIcons layerGenericChecked";}else{return "tocIcons layerGenericUnchecked";}}}}}}}}return "tocIcons layerGeneric";},addTreeNode:function(_16,_17){var _18={children:[]};_18.parent=_17;if(_17.children!=null){_18.attribute="children";}return this.treeStore.newItem(_16,_18);},addLayer:function(_19){if(_19==null||!_19.isOperationalLayer){return;}var _1a=VIEWER_UTILS.getLayerNameFromLayer(_19);var _1b={label:_1a,serviceId:_19.id,layer:_19,id:VIEWER_UTILS.generateUUID()};if(_4.isArray(_19.layerInfos)&&_19.layerInfos.length>0){_1b.children=[];}var _1c=this.addTreeNode(_1b,this.tree.rootNode);var _1d=this.getNodeFromItem(_1c);if(!(_19.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.GRAPHICS_LAYER)||(_19.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.FEATURE_LAYER)){this.treeContextMenu.bindNodeToServerMenu(_1d.domNode);}else{this.treeContextMenu.bindNodeToGraphicsLayerMenu(_1d.domNode);}this.checkForChildLayers(_19,_1c);},checkForChildLayers:function(_1e,_1f){var _20={};var _21=_1e.layerInfos;if(_4.isArray(_21)){var _22=_1f;var _23;for(var i=0;i<_21.length;i++){_23=false;var _24=_21[i];if(_24==null){continue;}var _25=_24.name;var _26={id:VIEWER_UTILS.generateUUID(),label:_25,layerId:_24.id,serviceId:_1e.id,layer:_1e,info:_24};if(_4.isArray(_24.subLayerIds)){_26.children=[];_23=true;}if(_24.parentLayerId>-1){_22=_20[_24.parentLayerId];if(_22==null){return;}}else{_22=_1f;}var _27=this.addTreeNode(_26,_22);var _28=this.getNodeFromItem(_27);if(_23){_20[_24.id]=_27;this.treeContextMenu.bindNodeToGroupMenu(_28.domNode);}else{this.treeContextMenu.bindNodeToLayerMenu(_28.domNode);}}}},removeLayer:function(_29){if(_29==null){return;}var _2a;this.treeStore.fetch({query:{serviceId:_29.id},queryOptions:{deep:false},onComplete:_4.hitch(this,this.deleteNodes)});},deleteNodes:function(_2b){for(var i=0;i<_2b.length;i++){this.deleteNode(_2b[i]);}},deleteChildNodes:function(_2c){var _2d=this.treeStore.getValue(_2c,"isPersistedToCookie");if(_2d){var url=this.treeStore.getValue(_2c,"url");}var _2e=this.getNodeFromItem(_2c);var _2f=_2e.getChildren();for(var i=0;i<_2f.length;i++){this.deleteNode(_2f[i].item);}this.treeStore.save();},deleteNode:function(_30){this.deleteChildNodes(_30);this.treeStore.deleteItem(_30);this.treeStore.save();},treeClickHandler:function(_31,_32,_33){var _34=null;var _35=null;if(_31.layer){_34=this.treeStore.getValue(_31,"layer");}if(_31.layerId){_35=this.treeStore.getValue(_31,"layerId");}if(_34 instanceof _c&&_31.layerId!=null){return;}if(_34&&_35==null){if(_34.visible){_34.hide();}else{_34.show();}}else{if(_34&&_35!=null){this.toggleDynamicSubLayerItem(_34,_35);this.processVisibleLayers(_34);}}_32._updateItemClasses(_31);},processVisibleLayers:function(_36){if(_36.visibleLayers.length==0){_36.setVisibleLayers([-1]);}else{var _37=VIEWER_UTILS.sortIntegerArray(_36.visibleLayers);_36.setVisibleLayers(_37);}},toggleDynamicSubLayerItem:function(_38,_39){if(_38==null){return;}var _3a=_3.indexOf(_38.visibleLayers,_39)>-1;if(_3a){var _3b=_3.indexOf(_38.visibleLayers,_39);if(_3b>-1){_38.visibleLayers.splice(_3b,1);}}else{_38.visibleLayers.push(_39);}}});});