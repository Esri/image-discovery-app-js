//>>built
require({cache:{"url:esriviewer/ui/layers/theme/LayersTocTheme.css":".tocRightClickLbl{font-size:8pt;margin:5px 0;}.tocContainer{max-height:275px;overflow:auto;}.tocIcons{width:16px;height:16px;background:transparent url(data:image/png;base64,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) no-repeat;}.folderClosed{background-position:-51px -68px;}.folderOpen{background-position:-17px -85px;}.globeChecked{background-position:0 -68px;}.globeUnchecked{background-position:0 -34px;}.graphicsLayerChecked{background-position:0 -17px;}.graphicsLayerUnchecked{background-position:-17px -68px;}.imageServiceChecked{background-position:-34px -34px;}.imageServiceUnchecked{background-position:-17px -17px;}.layerGeneric{background-position:-51px -34px;}.layerGenericChecked{background-position:0 -85px;}.layerGenericUnchecked{background-position:-34px -68px;}.layerLine{background-position:-51px -51px;}.layerLineChecked{background-position:-17px 0;}.layerLineUnchecked{background-position:-34px -51px;}.layerPoint{background-position:-34px 0;}.layerPointChecked{background-position:-51px 0;}.layerPointUnchecked{background-position:-51px -83px;}.layerPolygon{background-position:-51px -17px;}.layerPolygonChecked{background-position:-34px -17px;}.layerPolygonUnchecked{background-position:0 0;}.layerRasterIcon{background-position:-17px -51px;}.layerRasterChecked{background-position:-34px -85px;}.layerRasterUnchecked{background-position:-17px -34px;}.layerService{background-position:0 -51px;}","url:esriviewer/ui/layers/template/LayersTocWidgetTemplate.html":"<div>\r\n    <div class=\"tocRightClickLbl\">Right click for actions</div>\r\n    <div data-dojo-attach-point=\"tocContainer\" class=\"tocContainer\">\r\n\r\n\r\n    </div>\r\n</div>"}});define("esriviewer/ui/layers/LayersTocWidget",["dojo/_base/declare","xstyle/css!./theme/LayersTocTheme.css","dojo/text!./template/LayersTocWidgetTemplate.html","dojo/_base/array","dojo/topic","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dijit/Tree","dijit/tree/ForestStoreModel","dijit/tree/dndSource","dojo/dnd/Avatar","dojo/dnd/Manager","dojo/data/ItemFileWriteStore","./base/LayersTocWidgetContextMenu","../base/UITemplatedWidget","esri/layers/ArcGISTiledMapServiceLayer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12){return _1([_11],{templateString:_3,constructor:function(){this.treeStore=new _f({data:{items:[],identifier:"id",label:"label"}});this.treeModel=new _b({store:this.treeStore,openOnClick:true});this.tree=new _a({model:this.treeModel,getIconClass:_6.hitch(this,this.getTreeIcon),showRoot:false});_7.set(this.tree.domNode,"height","100%");this.treeContextMenu=new _10({tree:this.tree});this.treeContextMenu.bindNodeToNoContentMenu(this.tree.rootNode.domNode);},postCreate:function(){this.inherited(arguments);_9.place(this.tree.domNode,this.tocContainer);},initListeners:function(){this.tree.on("click",_6.hitch(this,this.treeClickHandler));},getNodeFromItem:function(_13){var _14=_13.id[0];return this.tree._itemNodesMap[_14][0];},getTreeIcon:function(_15,_16){if(_15.root){return "tocIcons layerService";}var _17=null;var _18=null;if(_15.layer){_17=this.treeStore.getValue(_15,"layer");}if(_15.layerId){_18=this.treeStore.getValue(_15,"layerId");}if(_17){if(_18!=null){var _19=this.treeStore.getValue(_15,"info");if(_6.isArray(_19.subLayerIds)&&_19.subLayerIds.length>0){if(_16){return "tocIcons folderOpen";}else{return "tocIcons folderClosed";}}else{var _1a=_4.indexOf(_17.visibleLayers,_18)>-1;if(_6.isObject(_19.metadata)){var _1b=_19.metadata;if(_1b.geometryType!=""){if(_1b.geometryType==VIEWER_GLOBALS.ESRI_GEOMETRY_TYPES.POINT){if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){return "tocIcons layerPoint";}if(_1a){return "tocIcons layerPointChecked";}else{return "tocIcons layerPointUnchecked";}}else{if(_1b.geometryType==VIEWER_GLOBALS.ESRI_GEOMETRY_TYPES.LINE){if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){return "tocIcons layerLine";}if(_1a){return "tocIcons layerLineChecked";}else{return "tocIcons layerLineUnchecked";}}else{if(_1b.geometryType==VIEWER_GLOBALS.ESRI_GEOMETRY_TYPES.POLYGON){if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){return "tocIcons layerPolygon";}if(_1a){return "tocIcons layerPolygonChecked";}else{return "tocIcons layerPolygonUnchecked";}}else{if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){return "tocIcons layerGeneric";}if(_1a){return "layerGenericChecked";}else{return "layerGenericUnchecked";}}}}}else{if(_1b.type==VIEWER_GLOBALS.ESRI_LAYER_TYPES.RASTER){if(_17 instanceof _12){return "tocIcons layerRasterIcon";}if(_1a){return "tocIcons layerRasterIconChecked";}else{return "tocIcons layerRasterIconUnchecked";}}else{return _1a?"tocIcons layerGenericChecked":"tocIcons layerGenericUnchecked";}}}else{if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.IMAGE_SERVICE){return "genericLayerIcon";}else{return _1a?"tocIcons layerGenericChecked":"tocIcons layerGenericUnchecked";}}}}else{if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.IMAGE_SERVICE){if(_17.visible){return "tocIcons imageServiceChecked";}else{return "tocIcons imageServiceUnchecked";}}else{if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.DYNAMIC_MAP_SERVICE){if(_17.visible){return "tocIcons globeChecked";}else{return "tocIcons globeUnchecked";}}else{if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.TILED_MAP_SERVICE){if(_17.visible){return "tocIcons layerRasterChecked";}else{return "tocIcons layerRasterUnchecked";}}else{if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.FEATURE_LAYER){if(_17.visible){return "tocIcons layerGenericChecked";}else{return "tocIcons layerGenericUnchecked";}}else{if(_17.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.GRAPHICS_LAYER){if(_17.visible){return "tocIcons graphicsLayerChecked";}else{return "tocIcons graphicsLayerUnchecked";}}else{if(_17.visible){return "tocIcons layerGenericChecked";}else{return "tocIcons layerGenericUnchecked";}}}}}}}}return "tocIcons layerGeneric";},addTreeNode:function(_1c,_1d){var _1e={children:[]};_1e.parent=_1d;if(_1d.children!=null){_1e.attribute="children";}return this.treeStore.newItem(_1c,_1e);},addLayer:function(_1f){if(_1f==null||!_1f.isOperationalLayer){return;}var _20=VIEWER_UTILS.getLayerNameFromLayer(_1f);var _21={label:_20,serviceId:_1f.id,layer:_1f,id:VIEWER_UTILS.generateUUID()};if(_6.isArray(_1f.layerInfos)&&_1f.layerInfos.length>0){_21.children=[];}var _22=this.addTreeNode(_21,this.tree.rootNode);var _23=this.getNodeFromItem(_22);if(!(_1f.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.GRAPHICS_LAYER)||(_1f.declaredClass==VIEWER_GLOBALS.ESRI_LAYER_DECLARED_CLASSES.FEATURE_LAYER)){this.treeContextMenu.bindNodeToServerMenu(_23.domNode);}else{this.treeContextMenu.bindNodeToGraphicsLayerMenu(_23.domNode);}this.checkForChildLayers(_1f,_22);},checkForChildLayers:function(_24,_25){var _26={};var _27=_24.layerInfos;if(_6.isArray(_27)){var _28=_25;var _29;for(var i=0;i<_27.length;i++){_29=false;var _2a=_27[i];if(_2a==null){continue;}var _2b=_2a.name;var _2c={id:VIEWER_UTILS.generateUUID(),label:_2b,layerId:_2a.id,serviceId:_24.id,layer:_24,info:_2a};if(_6.isArray(_2a.subLayerIds)){_2c.children=[];_29=true;}if(_2a.parentLayerId>-1){_28=_26[_2a.parentLayerId];if(_28==null){return;}}var _2d=this.addTreeNode(_2c,_28);var _2e=this.getNodeFromItem(_2d);if(_29){_26[_2a.id]=_2d;this.treeContextMenu.bindNodeToGroupMenu(_2e.domNode);}else{this.treeContextMenu.bindNodeToLayerMenu(_2e.domNode);}}}},removeLayer:function(_2f){if(_2f==null){return;}var _30;this.treeStore.fetch({query:{serviceId:_2f.id},queryOptions:{deep:false},onComplete:_6.hitch(this,this.deleteNodes)});},deleteNodes:function(_31){for(var i=0;i<_31.length;i++){this.deleteNode(_31[i]);}},deleteChildNodes:function(_32){var _33=this.treeStore.getValue(_32,"isPersistedToCookie");if(_33){var url=this.treeStore.getValue(_32,"url");}var _34=this.getNodeFromItem(_32);var _35=_34.getChildren();for(var i=0;i<_35.length;i++){this.deleteNode(_35[i].item);}this.treeStore.save();},deleteNode:function(_36){this.deleteChildNodes(_36);this.treeStore.deleteItem(_36);this.treeStore.save();},treeClickHandler:function(_37,_38,_39){var _3a=null;var _3b=null;if(_37.layer){_3a=this.treeStore.getValue(_37,"layer");}if(_37.layerId){_3b=this.treeStore.getValue(_37,"layerId");}if(_3a instanceof _12&&_37.layerId!=null){return;}if(_3a&&_3b==null){if(_3a.visible){_3a.hide();}else{_3a.show();}}else{if(_3a&&_3b!=null){this.toggleDynamicSubLayerItem(_3a,_3b);this.processVisibleLayers(_3a);}}_38._updateItemClasses(_37);},processVisibleLayers:function(_3c){if(_3c.visibleLayers.length==0){_3c.setVisibleLayers([-1]);}else{var _3d=VIEWER_UTILS.sortIntegerArray(_3c.visibleLayers);_3c.setVisibleLayers(_3d);}},toggleDynamicSubLayerItem:function(_3e,_3f){if(_3e==null){return;}var _40=_4.indexOf(_3e.visibleLayers,_3f)>-1;if(_40){var _41=_4.indexOf(_3e.visibleLayers,_3f);if(_41>-1){_3e.visibleLayers.splice(_41,1);}}else{_3e.visibleLayers.push(_3f);}}});});