//>>built
require({cache:{"url:esriviewer/ui/layers/theme/layersWidgetTheme.css":".viewerAddLayerLabel{color:#767676;margin-bottom:3px;}.addLayerContainer{background:white;height:100%;margin-left:10%;width:80%;}.viewerAddLayerUrlLabel{margin-top:5px;}.addLayerContainerInner{margin-top:10%;}.viewerAddLayerActions{margin-top:10px;}.viewerAddLayerButtonActions{float:right;margin-top:5%;margin-right:20px;text-align:right;width:100%;}.layerTypeContainer{float:left;width:100%;}.viewerAddLayerWorkingWKIDContainer{margin-bottom:10px;}.addedUserPersistedLayersListContainer{max-height:250px;overflow:auto;}.userPersistedLayersInfoIconIEHack{position:absolute;right:15px;}.userPersistedLayersInfoIcon{float:right;margin-right:4px;}.userPersistsedLayersClearLbl{float:right;font-size:8pt;cursor:pointer;font-family:tahoma, sans-serif;color:blue;text-decoration:underline;}.userPersistsedLayersClearContainer{height:17px;margin-top:2px;}.layersWindowContent{padding-top:0 !important;}.layersWindow{width:27%;}","url:esriviewer/ui/layers/template/LayersWidgetTemplate.html":"<div>\r\n    <div class=\"defaultTabContainer\" data-dojo-attach-point=\"layersTabContainer\">\r\n        <span data-dojo-attach-point=\"layersTab\"\r\n              data-bind=\"click:showLayersList, css: {selectedTab: layersListVisible}\">Layers</span>\r\n        <span data-dojo-attach-point=\"addLayersTab\"\r\n              data-bind=\"click:showAddLayers, css: {selectedTab: addlayersVisible}\">Add Layer</span>\r\n        <span data-dojo-attach-point=\"persistsedLayersTab\"\r\n              data-bind=\"click:showUserPersistedLayers, css: {selectedTab: persistedLayersVisible}\">Saved Layers</span>\r\n    </div>\r\n    <div data-bind=\"visible:addlayersVisible\" class=\"addLayerContainer\" data-dojo-attach-point=\"addLayerContainer\">\r\n        <div class=\"addLayerContainerInner\">\r\n            <div class=\"viewerAddLayerWorkingWKIDContainer\" data-bind=\"visible:showWKIDInAddLayers\">\r\n                <span class=\"viewerAddLayerLabel \">Map WKID:</span>\r\n                <span class=\"viewerAddLayerWorkingWKIDLabel\" data-bind=\"text: viewerWKID\"></span>\r\n            </div>\r\n            <div class=\"viewerAddLayerLabel viewerAddLayerUrlLabel \">URL:</div>\r\n            <div data-dojo-type=\"dijit/form/TextBox\" style=\"width: 100%\" data-dojo-attach-point=\"addLayerTextInput\"\r\n                 data-dojo-attach-event=\"onKeyUp:handleLayerAddUrlKeyUp\"></div>\r\n            <div class=\"viewerAddLayerLabel viewerAddLayerUrlLabel \">Label:</div>\r\n            <div data-dojo-type=\"dijit/form/TextBox\" style=\"width: 100%\" data-dojo-attach-point=\"addLayerLabelInput\"\r\n                 value=\"Added Layer\"></div>\r\n            <div class=\"viewerAddLayerActions\">\r\n                <div class=\"layerTypeContainer\">\r\n                    <div class=\"viewerAddLayerLabel\">Type:</div>\r\n                    <select data-dojo-type=\"dijit/form/Select\" style=\"width: 100%\"\r\n                            data-dojo-attach-point=\"addLayerTypeSelect\"\r\n                            style=\"width: 15em\"></select>\r\n                </div>\r\n                <div class=\"viewerAddLayerButtonActions\">\r\n                    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:addManualLayer\">Add Layer\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"layerTocContainer\" data-bind=\"visible:layersListVisible\">\r\n\r\n    </div>\r\n    <div data-bind=\"visible:persistedLayersVisible\" data-dojo-attach-point=\"userPersistedLayersContainer\">\r\n    </div>\r\n</div>"}});define("esriviewer/ui/layers/LayersWidget",["dojo/_base/declare","xstyle/css!./theme/layersWidgetTheme.css","dojo/text!./template/LayersWidgetTemplate.html","dojo/topic","dojo/_base/connect","dojo/_base/lang","dojo/on","dojo/dom-style","dojo/dom-class","dojo/dom-construct","../base/UITemplatedWidget","../tooltip/ConfirmTooltip","./base/LayersLocalStorageMixin","./model/LayersWidgetViewModel","./LayersTocWidget","./base/UserPersistedLayersListWidget","dijit/form/TextBox","dijit/form/Select","dijit/form/Button"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12){return _1([_a,_c],{firstAddLayerDisplay:true,errorMessageDelay:5000,successMessageDelay:2000,allowAddLayers:true,templateString:_3,constructor:function(_13){_6.mixin(this,_13||{});this.addedLayers={};},postCreate:function(){this.inherited(arguments);this.viewModel=new _d();this.viewModel.showUserPersistedLayersIcon(this.localStoragePersistSupported);this.viewModel.layersListVisible.subscribe(_6.hitch(this,this.handleLayerListVisibilityChanged));this.viewModel.addlayersVisible.subscribe(_6.hitch(this,this.handleAddLayersVisibilityChanged));this.viewModel.persistedLayersVisible.subscribe(_6.hitch(this,this.handlePersistedLayersVisibilityChanged));this.viewModel.on(this.viewModel.ADD_LAYERS_VISIBLE,_6.hitch(this,this.handleAddLayersVisible));ko.applyBindings(this.viewModel,this.domNode);this.createLayersTocWidget();_7.set(this.domNode,"minHeight","250px");if(this.allowAddLayers){this.populateLayerTypesDropdown();}else{_7.set(this.layersTabContainer,"display","none");}this.manualLayerLoadedSuccessCallback=_6.hitch(this,this.handleManualLayerLoadedCallback);this.manualLayerLoadedErrCallback=_6.hitch(this,this.handleManualLayerLoadErrorCallback);if(this.localStoragePersistSupported){this.createUserPersistedLayerListWidget();}},handleLayerListVisibilityChanged:function(_14){this._handleContentAnimation(_14,this.layerTocContainer);},handleAddLayersVisibilityChanged:function(_15){this._handleContentAnimation(_15,this.addLayerContainer);},handlePersistedLayersVisibilityChanged:function(_16){this._handleContentAnimation(_16,this.userPersistedLayersContainer);},handleAddLayersVisible:function(){this.addLayerTextInput.set("value","");this.addLayerLabelInput.set("value","");this.addLayerTextInput.focus();},createLayersTocWidget:function(){this.layersTocWidget=new _e();_9.place(this.layersTocWidget.domNode,this.layerTocContainer);},createUserPersistedLayerListWidget:function(){if(this.userPersistedLayersListWidget==null){this.userPersistedLayersListWidget=new _f();this.userPersistedLayersListWidget.placeAt(this.userPersistedLayersContainer);this.userPersistedLayersListWidget.on("removeUserPersistedGraphics",_6.hitch(this,this.handleRemoveUserPersistedLayer));this.userPersistedLayersListWidget.on("addUserPersistedLayerToMap",_6.hitch(this,this.handleAddUserPersistedLayerToMap));this.userPersistedLayersListWidget.on("removeAllUserPersistedGraphics",_6.hitch(this,this.handleRemoveAllUserPersistedLayers));this.userPersistedLayersListWidget.addExistingPersistedLayerItems(this.persistedUserLayers);}},showLayerList:function(){this.viewModel.showLayersList();},handleRemoveAllUserPersistedLayers:function(){this.removeAllLayers();},handleRemoveUserPersistedLayer:function(_17){if(_17!=null&&_17!=""){this.deleteUserPersistedLayer(_17);}},handleAddUserPersistedLayerToMap:function(_18,_19){if(_18!=null&&_18!=""){this._addLayer(_18,_19);}},loadViewerConfigurationData:function(){var _1a=null;_4.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"layersWidget",function(_1b){_1a=_1b;});if(_1a){for(var key in _1a){if(key==null||key.toString()==null){continue;}if(key.toString().toLowerCase()=="allowAddLayers".toLowerCase()){this.allowAddLayers=_1a[key];}else{if(key.toString().toLowerCase()=="showWKIDInAddLayers".toLowerCase()){if(_1a[key]==false){this.viewModel.showWKIDInAddLayers(false);}}}}}},handleManualLayerLoadedCallback:function(){_4.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Layer Added");VIEWER_UTILS.log("Layer Added",VIEWER_GLOBALS.LOG_TYPE.INFO);},handleManualLayerLoadErrorCallback:function(msg){if(msg!=null&&_6.isString(msg)){VIEWER_UTILS.log("Could not add layer: "+msg,VIEWER_GLOBALS.LOG_TYPE.ERROR);}else{VIEWER_UTILS.log("Add Layer Failed",VIEWER_GLOBALS.LOG_TYPE.ERROR);}},initListeners:function(){this.inherited(arguments);_4.subscribe(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADDED,_6.hitch(this,this.addLayer));_4.subscribe(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVED,_6.hitch(this,this.handleLayerRemoved));},populateLayerTypesDropdown:function(){var _1c;for(var key in VIEWER_GLOBALS.LAYER_TYPES){_1c=VIEWER_GLOBALS.LAYER_TYPES[key];var _1d={label:_1c.LABEL,value:_1c.VALUE};this.addLayerTypeSelect.addOption(_1d);}},handleAddLayers:function(_1e){if(_1e!=null&&_6.isArray(_1e)){for(var i=0;i<_1e.length;i++){this.addLayer(_1e[i]);}}},addLayer:function(_1f){if(_1f==null){return;}var _20=VIEWER_UTILS.getLayerUniqueId(_1f);if(_20==null||this.addedLayers[_20]!=null){return;}this.layersTocWidget.addLayer(_1f);this.addedLayers[_20]={layer:_1f};if(_1f.url&&this.localStoragePersistSupported){this.saveLayer(_1f);}},saveLayer:function(_21){var _22=this.persistUserLayer(_21);if(_22&&_22.url){this.userPersistedLayersListWidget.addPersistedLayer(_22);}},handleToggleLayerVisibility:function(_23){if(_23.visible){_23.hide();}else{_23.show();}},handleZoomToLayer:function(_24){_4.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_24.fullExtent);},handleLayerAddUrlKeyUp:function(e){if(VIEWER_UTILS.isEnterKey(e)){this.addManualLayer();}else{var url=this.addLayerTextInput.get("value");if(url==""){return;}var _25=VIEWER_UTILS.getServiceTypeFromUrl(url);if(_25!=null){if(_25===VIEWER_GLOBALS.SERVICE_TYPES.IMAGE_SERVER){this.addLayerTypeSelect.set("value",VIEWER_GLOBALS.LAYER_TYPES.IMAGE_SERVER.VALUE);}else{if(_25===VIEWER_GLOBALS.SERVICE_TYPES.FEATURE_SERVER){this.addLayerTypeSelect.set("value",VIEWER_GLOBALS.LAYER_TYPES.FEATURE_LAYER.VALUE);}else{if(_25===VIEWER_GLOBALS.SERVICE_TYPES.KML){this.addLayerTypeSelect.set("value",VIEWER_GLOBALS.LAYER_TYPES.KML.VALUE);}else{if(_25===VIEWER_GLOBALS.SERVICE_TYPES.MAP_SERVER){var _26=REG_EXP_UTILS.featureLayerRegExp.test(url);if(_26){this.addLayerTypeSelect.set("value",VIEWER_GLOBALS.LAYER_TYPES.FEATURE_LAYER.VALUE);}else{this.addLayerTypeSelect.set("value",VIEWER_GLOBALS.LAYER_TYPES.MAP_SERVER.VALUE);}}}}}}}},addManualLayer:function(){var url=this.addLayerTextInput.get("value");if(url!=""){if(VIEWER_UTILS.endsWith(url,"/")){url=url.substring(0,url.length-1);}this._addLayer(url);}},_addLayer:function(_27,_28){var _29=_28;if(_29==null||_29==""){_29=this.addLayerLabelInput.get("value");}_4.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD_FROM_URL,_27,{isOperationalLayer:true,canRemove:true,label:_29},this.manualLayerLoadedSuccessCallback,this.manualLayerLoadedErrCallback);},showConfirmDeleteLayerTooltip:function(_2a,_2b){this.deleteLayerConfirmedCallback=_6.hitch(this,this.handleRemoveLayerFromClick,_2a);this.showDeleteLayerTooltip(_2b);},handleRemoveLayerFromClick:function(_2c){_4.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVE,_2c);},createConfirmDeleteLayerTooltip:function(){this.confirmDeleteLayerTooltip=new _b({confirmCallback:_6.hitch(this,this.handleConfirmedLayerDelete)});this.confirmDeleteLayerTooltip.on("hide",_6.hitch(this,function(){this.deleteLayerConfirmedCallback=null;}));},handleConfirmedLayerDelete:function(){if(_6.isFunction(this.deleteLayerConfirmedCallback)){this.deleteLayerConfirmedCallback();}this.deleteLayerConfirmedCallback=null;},showDeleteLayerTooltip:function(_2d){if(_2d==null){return;}if(this.confirmDeleteLayerTooltip==null){this.createConfirmDeleteLayerTooltip();}if(this.confirmDeleteLayerTooltip){this.confirmDeleteLayerTooltip.setAroundNode(_2d);this.confirmDeleteLayerTooltip.show();}},handleLayerRemoved:function(_2e){if(_2e==null){return;}var _2f=VIEWER_UTILS.getLayerUniqueId(_2e);if(_2f==null){return;}if(this.addedLayers[_2f]!=null){this.layersTocWidget.removeLayer(_2e);delete this.addedLayers[_2f];}},hidePopups:function(){if(this.confirmDeleteLayerTooltip){this.confirmDeleteLayerTooltip.hide();}}});});