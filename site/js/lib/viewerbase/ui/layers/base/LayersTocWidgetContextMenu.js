//>>built
define("esriviewer/ui/layers/base/LayersTocWidgetContextMenu",["dojo/_base/declare","dojo/topic","dojo/on","dojo/_base/lang","dojo/dom-style","dijit/Menu","dijit/MenuItem","dijit/PopupMenuItem","dijit/registry","dojo/_base/connect","esri/layers/ArcGISImageServiceLayer","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer"],function(_1,_2,on,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1([],{createQueryBuilderMenuItems:false,showRemoveMenuItems:true,constructor:function(_d){_3.mixin(this,_d);this.initialize();},initialize:function(){this.loadViewerConfigurationData();this.createServerMenu();this.createGroupLayerMenu();this.createLayerMenu();this.createGraphicsLayerMenu();this.initListeners();},initListeners:function(){this.zoomToExtentMenuItem.on("click",_3.hitch(this,this.handleZoomToExtent));if(this.createQueryBuilderMenuItems){this.queryServiceMenuItem.on("click",_3.hitch(this,this.handleQueryBuilderServiceClick));this.queryLayerMenuItem.on("click",_3.hitch(this,this.handleQueryBuilderLayerClick));}this.openMapServiceDescriptionMenu.on("click",_3.hitch(this,this.handleOpenMapServerDescriptionMenuRequest));this.confirmRemoveLayerMenuItem.on("click",_3.hitch(this,this.handleRemoveLayer));this.confirmRemoveGraphicLayerMenuItem.on("click",_3.hitch(this,this.handleRemoveGraphicsLayer));_9.connect(this.serverNodeMenu,"_openMyself",_3.hitch(this,this.handleServerMenuOpen));_9.connect(this.groupNodeMenu,"_openMyself",_3.hitch(this,this.handleGroupMenuOpen));_9.connect(this.graphicsLayerMenu,"_openMyself",_3.hitch(this,this.handleGraphicsLayerMenuOpen));_9.connect(this.layerNodeMenu,"_openMyself",_3.hitch(this,this.handleLayerMenuOpen));},loadViewerConfigurationData:function(){var _e=null;_2.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"queryBuilder",function(_f){_e=_f;});if(_e&&_3.isObject(_e)){this.createQueryBuilderMenuItems=_e.create===true;}},createServerMenu:function(){this.serverNodeMenu=new _5();this.zoomToExtentMenuItem=new _6({label:"Zoom To Extent",iconClass:"commonIcons16 locationGoTo"});this.serverNodeMenu.addChild(this.zoomToExtentMenuItem);if(this.createQueryBuilderMenuItems){this.queryServiceMenuItem=new _6({label:"Query Builder",iconClass:"commonIcons16 sql"});this.serverNodeMenu.addChild(this.queryServiceMenuItem);}this.openMapServiceDescriptionMenu=new _6({label:"View Service Description",iconClass:"serviceDescriptionIcon"});this.serverNodeMenu.addChild(this.openMapServiceDescriptionMenu);var _10=new _5();this.confirmRemoveLayerMenuItem=new _6({label:"Confirm",iconClass:"commonIcons16 question"});_10.addChild(this.confirmRemoveLayerMenuItem);this.removeServiceMenuItem=new _7({iconClass:"commonIcons16 delete",label:"Remove Layer",popup:_10});this.serverNodeMenu.addChild(this.removeServiceMenuItem);this.serverNodeMenu.startup();},createGraphicsLayerMenu:function(){this.graphicsLayerMenu=new _5();var _11=new _5();this.confirmRemoveGraphicLayerMenuItem=new _6({label:"Confirm",iconClass:"commonIcons16 question"});_11.addChild(this.confirmRemoveGraphicLayerMenuItem);this.removeGraphicLayerMenuItem=new _7({iconClass:"commonIcons16 delete",label:"Remove Graphics Layer",popup:_11});this.graphicsLayerMenu.addChild(this.removeGraphicLayerMenuItem);this.graphicsLayerMenu.startup();},createLayerMenu:function(){this.layerNodeMenu=new _5();if(this.createQueryBuilderMenuItems){this.queryLayerMenuItem=new _6({label:"Query Builder",iconClass:"commonIcons16 sql"});this.layerNodeMenu.addChild(this.queryLayerMenuItem);}this.layerNodeMenu.startup();},createGroupLayerMenu:function(){this.groupNodeMenu=new _5();this.groupNodeMenu.startup();_4.set(this.groupNodeMenu.domNode,"display","none");},handleGroupMenuOpen:function(){_4.set(this.groupNodeMenu.domNode,"display","none");return false;},bindNodeToGraphicsLayerMenu:function(_12){this.bindNode(_12,this.graphicsLayerMenu);},bindNodeToServerMenu:function(_13){this.bindNode(_13,this.serverNodeMenu);},bindNodeToGroupMenu:function(_14){this.bindNode(_14,this.groupNodeMenu);},bindNodeToLayerMenu:function(_15){this.bindNode(_15,this.layerNodeMenu);},bindNodeToNoContentMenu:function(_16){on(_16,"contextmenu",function(e){e.stopPropagation();});},bindNode:function(_17,_18){if(_17&&_18&&_18.bindDomNode){_18.bindDomNode(_17);}},handleRemoveGraphicsLayer:function(){if(this.currentGraphicsLayerNodeFromMenu&&this.currentGraphicsLayerNodeFromMenu.item){var _19=this.getTreeStore().getValue(this.currentGraphicsLayerNodeFromMenu.item,"layer");if(_19){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVE,_19);}}},handleGraphicsLayerMenuOpen:function(e){this.currentGraphicsLayerNodeFromMenu=_8.getEnclosingWidget(e.target);if(this.currentGraphicsLayerNodeFromMenu&&this.currentGraphicsLayerNodeFromMenu.item){var _1a=this.getTreeStore().getValue(this.currentGraphicsLayerNodeFromMenu.item,"layer");if(_1a){if(_1a.removable!=null&&_1a.removable===true){this.removeGraphicLayerMenuItem.attr("disabled",false);}else{this.removeGraphicLayerMenuItem.attr("disabled",true);}}}},handleLayerMenuOpen:function(e){if(this.queryLayerMenuItem){this.currentLayerNodeFromMenu=_8.getEnclosingWidget(e.target);if(this.currentLayerNodeFromMenu&&this.currentLayerNodeFromMenu.item){var _1b=this.getTreeStore().getValue(this.currentLayerNodeFromMenu.item,"layer");if(_1b){this.queryLayerMenuItem.attr("disabled",_1b.capabilities.indexOf("Query")<0);}}}},handleServerMenuOpen:function(e){this.currentServerNodeFromMenu=_8.getEnclosingWidget(e.target);if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _1c=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_1c){if(_1c.canRemove!=null&&_1c.canRemove===true){this.removeServiceMenuItem.attr("disabled",false);}else{this.removeServiceMenuItem.attr("disabled",true);}if(this.queryServiceMenuItem){var _1d=false;if(_1c instanceof _c){_1d=false;}else{_1d=_1c instanceof _a||(_1c.capabilities&&_1c.capabilities.indexOf("Query")>-1);}this.queryServiceMenuItem.attr("disabled",!_1d);}}}},handleZoomToExtent:function(){if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _1e=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_1e&&_1e.initialExtent&&!isNaN(_1e.initialExtent.xmin)&&!isNaN(_1e.initialExtent.xmax)&&!isNaN(_1e.initialExtent.xmax)&&!isNaN(_1e.initialExtent.ymax)){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_1e.initialExtent);}}this.currentServerNodeFromMenu=null;},handleRemoveLayer:function(){if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _1f=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_1f){if(_1f.canRemove!=null&&_1f.canRemove===true){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVE,_1f);}}}this.currentServerNodeFromMenu=null;},handleOpenMapServerDescriptionMenuRequest:function(){if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _20=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_20&&_20.url){this.openUrlInWindow(_20.url);}}this.currentMapServerNodeFromMenu=null;},handleQueryBuilderServiceClick:function(){if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _21=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_21){if(_21 instanceof _a){_2.publish(VIEWER_GLOBALS.EVENTS.QUERY_BUILDER.SET_IMAGE_SERVICE_LAYER,_21);}else{if(_21 instanceof _b){_2.publish(VIEWER_GLOBALS.EVENTS.QUERY_BUILDER.SET_FEATURE_SERVICE_LAYER,_21);}}}}this.currentMapServerNodeFromMenu=null;},handleQueryBuilderLayerClick:function(){if(this.currentLayerNodeFromMenu&&this.currentLayerNodeFromMenu.item){var _22=this.getTreeStore().getValue(this.currentLayerNodeFromMenu.item,"layer");var _23=this.getTreeStore().getValue(this.currentLayerNodeFromMenu.item,"info");_2.publish(VIEWER_GLOBALS.EVENTS.QUERY_BUILDER.SET_MAP_SERVICE_LAYER,_22,_23);}this.currentMapServerNodeFromMenu=null;},openUrlInWindow:function(url){if(url){window.open(url);}},getTreeStore:function(){return this.tree.model.store;}});});