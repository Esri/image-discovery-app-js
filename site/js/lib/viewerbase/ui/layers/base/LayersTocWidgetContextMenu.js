//>>built
define("esriviewer/ui/layers/base/LayersTocWidgetContextMenu",["dojo/_base/declare","dojo/topic","dojo/on","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dijit/Menu","dijit/MenuItem","dijit/PopupMenuItem","dijit/registry","dojo/_base/connect","esri/layers/ArcGISImageServiceLayer","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer"],function(_1,_2,on,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _1([],{createQueryBuilderMenuItems:false,showRemoveMenuItems:true,constructor:function(_e){_3.mixin(this,_e);this.initialize();},initialize:function(){this.loadViewerConfigurationData();this.createServerMenu();this.createGroupLayerMenu();this.createLayerMenu();this.createGraphicsLayerMenu();this.initListeners();},initListeners:function(){this.zoomToExtentMenuItem.on("click",_3.hitch(this,this.handleZoomToExtent));if(this.createQueryBuilderMenuItems){this.queryServiceMenuItem.on("click",_3.hitch(this,this.handleQueryBuilderServiceClick));this.queryLayerMenuItem.on("click",_3.hitch(this,this.handleQueryBuilderLayerClick));}this.openMapServiceDescriptionMenu.on("click",_3.hitch(this,this.handleOpenMapServerDescriptionMenuRequest));this.confirmRemoveLayerMenuItem.on("click",_3.hitch(this,this.handleRemoveLayer));this.confirmRemoveGraphicLayerMenuItem.on("click",_3.hitch(this,this.handleRemoveGraphicsLayer));_a.connect(this.serverNodeMenu,"_openMyself",_3.hitch(this,this.handleServerMenuOpen));_a.connect(this.groupNodeMenu,"_openMyself",_3.hitch(this,this.handleGroupMenuOpen));_a.connect(this.graphicsLayerMenu,"_openMyself",_3.hitch(this,this.handleGraphicsLayerMenuOpen));_a.connect(this.layerNodeMenu,"_openMyself",_3.hitch(this,this.handleLayerMenuOpen));},loadViewerConfigurationData:function(){var _f=null;_2.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"queryBuilder",function(_10){_f=_10;});if(_f&&_3.isObject(_f)){this.createQueryBuilderMenuItems=_f.create===true;}},createServerMenu:function(){this.serverNodeMenu=new _6();this.zoomToExtentMenuItem=new _7({label:"Zoom To Extent",iconClass:"commonIcons16 locationGoTo"});this.serverNodeMenu.addChild(this.zoomToExtentMenuItem);if(this.createQueryBuilderMenuItems){this.queryServiceMenuItem=new _7({label:"Query Builder",iconClass:"commonIcons16 sql"});this.serverNodeMenu.addChild(this.queryServiceMenuItem);}this.openMapServiceDescriptionMenu=new _7({label:"View Service Description",iconClass:"serviceDescriptionIcon"});this.serverNodeMenu.addChild(this.openMapServiceDescriptionMenu);var _11=new _6();this.confirmRemoveLayerMenuItem=new _7({label:"Confirm",iconClass:"commonIcons16 question"});_11.addChild(this.confirmRemoveLayerMenuItem);this.removeServiceMenuItem=new _8({iconClass:"commonIcons16 delete",label:"Remove Layer",popup:_11});this.serverNodeMenu.addChild(this.removeServiceMenuItem);this.serverNodeMenu.startup();},createGraphicsLayerMenu:function(){this.graphicsLayerMenu=new _6();var _12=new _6();this.confirmRemoveGraphicLayerMenuItem=new _7({label:"Confirm",iconClass:"commonIcons16 question"});_12.addChild(this.confirmRemoveGraphicLayerMenuItem);this.removeGraphicLayerMenuItem=new _8({iconClass:"commonIcons16 delete",label:"Remove Graphics Layer",popup:_12});this.graphicsLayerMenu.addChild(this.removeGraphicLayerMenuItem);this.graphicsLayerMenu.startup();},createLayerMenu:function(){this.layerNodeMenu=new _6();if(this.createQueryBuilderMenuItems){this.queryLayerMenuItem=new _7({label:"Query Builder",iconClass:"commonIcons16 sql"});this.layerNodeMenu.addChild(this.queryLayerMenuItem);}this.layerNodeMenu.startup();},createGroupLayerMenu:function(){this.groupNodeMenu=new _6();this.groupNodeMenu.startup();_4.set(this.groupNodeMenu.domNode,"display","none");},handleGroupMenuOpen:function(){_4.set(this.groupNodeMenu.domNode,"display","none");return false;},bindNodeToGraphicsLayerMenu:function(_13){this.bindNode(_13,this.graphicsLayerMenu);},bindNodeToServerMenu:function(_14){this.bindNode(_14,this.serverNodeMenu);},bindNodeToGroupMenu:function(_15){this.bindNode(_15,this.groupNodeMenu);},bindNodeToLayerMenu:function(_16){this.bindNode(_16,this.layerNodeMenu);},bindNodeToNoContentMenu:function(_17){on(_17,"contextmenu",function(e){e.stopPropagation();});},bindNode:function(_18,_19){if(_18&&_19&&_19.bindDomNode){_19.bindDomNode(_18);}},handleRemoveGraphicsLayer:function(){if(this.currentGraphicsLayerNodeFromMenu&&this.currentGraphicsLayerNodeFromMenu.item){var _1a=this.getTreeStore().getValue(this.currentGraphicsLayerNodeFromMenu.item,"layer");if(_1a){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVE,_1a);}}},handleGraphicsLayerMenuOpen:function(e){this.currentGraphicsLayerNodeFromMenu=_9.getEnclosingWidget(e.target);if(this.currentGraphicsLayerNodeFromMenu&&this.currentGraphicsLayerNodeFromMenu.item){var _1b=this.getTreeStore().getValue(this.currentGraphicsLayerNodeFromMenu.item,"layer");if(_1b){if(_1b.removable!=null&&_1b.removable===true){this.removeGraphicLayerMenuItem.attr("disabled",false);}else{this.removeGraphicLayerMenuItem.attr("disabled",true);}}}},handleLayerMenuOpen:function(e){if(this.queryLayerMenuItem){this.currentLayerNodeFromMenu=_9.getEnclosingWidget(e.target);if(this.currentLayerNodeFromMenu&&this.currentLayerNodeFromMenu.item){var _1c=this.getTreeStore().getValue(this.currentLayerNodeFromMenu.item,"layer");if(_1c){this.queryLayerMenuItem.attr("disabled",_1c.capabilities.indexOf("Query")<0);}}}},handleServerMenuOpen:function(e){this.currentServerNodeFromMenu=_9.getEnclosingWidget(e.target);if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _1d=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_1d){if(_1d.canRemove!=null&&_1d.canRemove===true){this.removeServiceMenuItem.attr("disabled",false);}else{this.removeServiceMenuItem.attr("disabled",true);}if(this.queryServiceMenuItem){var _1e=false;if(_1d instanceof _d){_1e=false;}else{_1e=_1d instanceof _b||(_1d.capabilities&&_1d.capabilities.indexOf("Query")>-1);}this.queryServiceMenuItem.attr("disabled",!_1e);}}}},handleZoomToExtent:function(){if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _1f=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_1f){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.SET_EXTENT,_1f.initialExtent);}}this.currentServerNodeFromMenu=null;},handleRemoveLayer:function(){if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _20=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_20){if(_20.canRemove!=null&&_20.canRemove===true){_2.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.REMOVE,_20);}}}this.currentServerNodeFromMenu=null;},handleOpenMapServerDescriptionMenuRequest:function(){if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _21=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_21&&_21.url){this.openUrlInWindow(_21.url);}}this.currentMapServerNodeFromMenu=null;},handleQueryBuilderServiceClick:function(){if(this.currentServerNodeFromMenu&&this.currentServerNodeFromMenu.item){var _22=this.getTreeStore().getValue(this.currentServerNodeFromMenu.item,"layer");if(_22){if(_22 instanceof _b){_2.publish(VIEWER_GLOBALS.EVENTS.QUERY_BUILDER.SET_IMAGE_SERVICE_LAYER,_22);}else{if(_22 instanceof _c){_2.publish(VIEWER_GLOBALS.EVENTS.QUERY_BUILDER.SET_FEATURE_SERVICE_LAYER,_22);}}}}this.currentMapServerNodeFromMenu=null;},handleQueryBuilderLayerClick:function(){if(this.currentLayerNodeFromMenu&&this.currentLayerNodeFromMenu.item){var _23=this.getTreeStore().getValue(this.currentLayerNodeFromMenu.item,"layer");var _24=this.getTreeStore().getValue(this.currentLayerNodeFromMenu.item,"info");_2.publish(VIEWER_GLOBALS.EVENTS.QUERY_BUILDER.SET_MAP_SERVICE_LAYER,_23,_24);}this.currentMapServerNodeFromMenu=null;},openUrlInWindow:function(url){if(url){window.open(url);}},getTreeStore:function(){return this.tree.model.store;}});});