//>>built
require({cache:{"url:esriviewer/ui/query/theme/queryBuilderTheme.css":".queryBuilderFields, .queryBuilderSqlContainer, .queryBuilderUniqueValues{width:95%;margin-left:2.5%;margin-bottom:8px;margin-top:9px;}.queryBuilderUniqueValues, .queryBuilderFields{height:150px;}.queryBuilderUniqueValues{width:95%;margin-right:2.5%;margin-bottom:8px;}.queryBuilderUniqueValues{font-size:8pt;}.queryBuilderUniqueValuesToggleLabel{font-size:9pt;}.queryBuilderToggleUniqueValuesImg{vertical-align:middle;float:left;}.queryBuilderUniqueValuesToggleContainer{margin-left:5px;margin-top:10px;cursor:pointer;}.queryBuilderButtons{margin:auto;text-align:center;}.queryActionButtonsLeft{float:left;margin-bottom:10px;}.queryActionButtonsRight{float:right;margin-bottom:10px;}.queryActionButtons{margin-bottom:10px;}.queryBuilderButtons .dijitButton{padding:0;margin:5px 1px;}.queryLayerNameContainer{margin-left:10px;margin-top:5px;}.toggleQueryUniqueValuesButton{float:left;}","url:esriviewer/ui/query/template/QueryBuilderTemplate.html":"<div>\r\n    <div class=\"queryLayerNameContainer\"><span>Query Layer: </span><span\r\n            data-dojo-attach-point=\"queryLayerNameLabel\"></span></div>\r\n    <select data-dojo-attach-point=\"queryBuilderFields\"\r\n            data-bind=\"event: {dblclick: queryFieldDoubleClick},options: queryBuilderFields ,value:selectedQueryBuilderField, optionsText: 'label', optionsValue: 'value'\"\r\n            class=\"queryBuilderFields\" size=\"7\">\r\n    </select>\r\n\r\n    <div class=\"queryBuilderButtons\">\r\n        <div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"equalsOperatorButton\"\r\n                 disabled=\"disabled\">=\r\n            </div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"greaterThanOperatorButton\"\r\n                 disabled=\"disabled\">&gt;</div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"lessThanOperatorButton\"\r\n                 disabled=\"disabled\">&lt;</div>\r\n            <div data-dojo-type=\"dijit/form/Button\"\r\n                 data-dojo-attach-point=\"lessThanGreaterThanOperatorButton\" disabled=\"disabled\">&lt;\r\n                &gt;</div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"greaterThanEqualsOperatorButton\"\r\n                 disabled=\"disabled\">&gt;=\r\n            </div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"lessThanEqualsOperatorButton\"\r\n                 disabled=\"disabled\">&lt;=\r\n            </div>\r\n        </div>\r\n        <div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"likeAppenderButton\"\r\n                 disabled=\"disabled\">LIKE\r\n            </div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"notAppenderButton\"\r\n                 disabled=\"disabled\">NOT\r\n            </div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"isAppenderButton\"\r\n                 disabled=\"disabled\">IS\r\n            </div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"andAppenderButton\"\r\n                 disabled=\"disabled\">AND\r\n            </div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"orAppenderButton\"\r\n                 disabled=\"disabled\">OR\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"queryBuilderUniqueValuesToggleContainer\">\r\n        <div class=\"togglerContainer\" data-dojo-attach-event=\"onclick: toggleUniqueValuesContainer\">\r\n            <div data-dojo-attach-point=\"queryBuilderToggleUniqueValuesImg\"\r\n                 class=\"commonIcons16 up toggleQueryUniqueValuesButton\"\r\n                 title=\"Toggle Unique Values\"></div>\r\n            <span class=\"queryBuilderUniqueValuesToggleLabel\">Unique Values</span>\r\n        </div>\r\n                    <span data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"loadUniqueValuesButton\"\r\n                          style=\"float:right;margin-right: 15px;display:none\"\r\n                          data-dojo-attach-event=\"onClick: handleGetUniqueValues\">Populate</span>\r\n\r\n    </div>\r\n    <div class=\"queryBuilderUniqueValuesContainer\"\r\n         data-dojo-attach-point=\"queryBuilderUniqueValuesContainer\" style=\"display:none;text-align:right\">\r\n        <select data-dojo-attach-point=\"queryBuilderUniqueValuesSelect\" class=\"queryBuilderUniqueValues\"\r\n                data-dojo-attach-event=\"ondblclick: addUniqueValueToQueryString\"\r\n                size=\"7\"></select>\r\n    </div>\r\n    <div class=\"queryBuilderSqlContainer\" data-dojo-attach-point=\"queryBuilderSqlContainer\">\r\n        <div data-dojo-type=\"dijit/form/Textarea\" data-dojo-attach-point=\"queryBuilderSql\"\r\n             disabled=\"disabled\"></div>\r\n    </div>\r\n    <div class=\"queryActionButtons\">\r\n        <div class=\"queryActionButtonsLeft\">\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"backButton\" disabled=\"disabled\"\r\n                 data-dojo-attach-event=\"onClick:stepQueryBack\"\r\n                    >\r\n                Back\r\n            </div>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"clearButton\"\r\n                 data-dojo-attach-event=\"onClick:clearQuery\"\r\n                    >\r\n                Clear\r\n            </div>\r\n        </div>\r\n        <div class=\"queryActionButtonsRight\">\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"submitButton\"\r\n                 data-dojo-attach-event=\"onClick:submitQuery\"\r\n                    >\r\n                Submit\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("esriviewer/ui/query/QueryBuilderWidget",["dojo/_base/declare","xstyle/css!./theme/queryBuilderTheme.css","dojo/text!./template/QueryBuilderTemplate.html","dojo/_base/json","dojo/_base/connect","dojo/has","dojo/on","dojo/topic","dojo/dom-class","dojo/dom-attr","dojo/dom-style","dojo/_base/lang","dojo/dom-construct","dojo/_base/Color","../base/UITemplatedWidget","./QueryBuilderData","./model/QueryBuilderViewModel","dijit/form/Textarea","dijit/form/Button","esri/layers/GraphicsLayer","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/renderers/SimpleRenderer","esri/renderers/UniqueValueRenderer","esri/renderers/ClassBreaksRenderer","esri/tasks/query","esri/tasks/QueryTask","esri/InfoTemplate"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c){return _1([_e],{bindingsApplied:false,defaultUniqueValuesFieldType:"esriFieldTypeString",fieldTypeWrappers:{esriFieldTypeString:{prefix:"'",suffix:"'"},esriFieldTypeDate:{prefix:"date '",suffix:"'"}},uniqueValuesDirty:false,returnGeometry:true,basicMode:true,sortUniqueValues:true,templateString:_3,queryUrlWithLayerId:null,constructor:function(_1d){this.uniqueFieldValuesLookup={};this.queryLayer=null;this.queryFields=null;_b.mixin(this,_1d||{});this.queryData=new _f();},initListeners:function(){this.inherited(arguments);this.connects.push(on(this.equalsOperatorButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"=")));this.connects.push(on(this.greaterThanOperatorButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,">")));this.connects.push(on(this.lessThanOperatorButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"<")));this.connects.push(on(this.lessThanGreaterThanOperatorButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"<>")));this.connects.push(on(this.greaterThanEqualsOperatorButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,">=")));this.connects.push(on(this.lessThanEqualsOperatorButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"<=")));this.connects.push(on(this.likeAppenderButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"LIKE")));this.connects.push(on(this.notAppenderButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"NOT")));this.connects.push(on(this.isAppenderButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"IS")));this.connects.push(on(this.andAppenderButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.APPENDER,"AND")));this.connects.push(on(this.orAppenderButton,"click",_b.hitch(this,this.updateQueryString,this.queryData.APPENDER,"OR")));},applyBindings:function(){if(!this.bindingsApplied){ko.applyBindings(this.viewModel,this.domNode);this.bindingsApplied=true;}},postCreate:function(){this.inherited(arguments);this.viewModel=new _10();this.viewModel.on(this.viewModel.QUERY_FIELD_DOUBLE_CLICK,_b.hitch(this,this.addColumnToQuery,this.queryData.COLUMN));this.viewModel.selectedQueryBuilderField.subscribe(_b.hitch(this,this.handleQueryBuilderFieldChanged));this.queryResponseCallback=_b.hitch(this,this.handleQueryResponse);this.queryResponseErrback=_b.hitch(this,this.handleQueryError);this.initSymbology();this.operatorButtons=[this.equalsOperatorButton,this.greaterThanOperatorButton,this.lessThanOperatorButton,this.lessThanGreaterThanOperatorButton,this.greaterThanEqualsOperatorButton,this.lessThanEqualsOperatorButton,this.likeAppenderButton,this.notAppenderButton,this.isAppenderButton];this.appenderButtons=[this.andAppenderButton,this.orAppenderButton];if(this.basicMode){this.queryData.setBasicMode();this.loadBasicView();}else{this.queryData.setAdvancedMode();}this.setupQueryLayer();if(this.queryFields!=null&&_b.isArray(this.queryFields)&&this.queryFields.length>0){this.addOptions(this.queryFields);this.viewModel.sortFieldNames();this.applyBindings();}if(this.queryUrlWithLayerId!=null){VIEWER_UTILS.getLayerInfoFromService(this.queryLayer.url,this.queryLayer.layerId,_b.hitch(this,this.handleLayerInfoLoaded));}if(!this.queryData.isBasicMode()){this._enableAllInputs();}this.tweakUI();this.createResultGraphicsLayer();},createResultGraphicsLayer:function(){if(this.resultsGraphicsLayer==null){this.resultsGraphicsLayer=_13();_5.connect(this.resultsGraphicsLayer,"onMouseOver",function(evt){_a.set(evt.target,"cursor","pointer");});_7.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD_EXTERNAL_MANAGED_LAYER,this.resultsGraphicsLayer);}},initSymbology:function(){this.polygonSymbol=new _14(_14.STYLE_SOLID,new _15(_15.STYLE_SOLID,new _d([0,0,255]),1),new _d([0,0,255,0]));this.pointSymbol=new _16(_16.STYLE_X,1,new _15(_15.STYLE_SOLID,new _d("blue")));this.lineSymbol=new _15(_15.STYLE_SOLID,new _d([0,0,255]),1);},setupQueryLayer:function(){this.queryUrlWithLayerId=this.queryLayer.url;if(!(/\/$/.test(this.queryUrlWithLayerId))){this.queryUrlWithLayerId+="/";}this.queryUrlWithLayerId+=this.queryLayer.layerId;},loadViewerConfigurationData:function(){var _1e=null;_7.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"queryBuilder",function(_1f){_1e=_1f;});if(_1e&&_1e.configuration!=null&&_b.isObject(_1e.configuration)){_b.mixin(this,_1e.configuration);this.returnGeometry=true;}},tweakUI:function(){if(_6("ie")<8){_a.set(this.queryBuilderSqlContainer,"marginLeft","0");}},toggleUniqueValuesContainer:function(){if(_8.contains(this.queryBuilderToggleUniqueValuesImg,"up")){var _20=null;if((this.queryBuilderFields.selectedIndex>-1)&&(this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex]!=null)){_20=this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex];}if(_20==null){this.hideUniqueValuesContent();}else{this.showUniqueValuesContent();}}else{this.hideUniqueValuesContent();}},handleLayerInfoLoaded:function(_21){if(_21&&_b.isObject(_21)){if(this.queryFields==null||(_b.isArray(this.queryFields)&&this.queryFields.length==0)){this.populateLayerFields(_21);}if(_21.drawingInfo&&_21.drawingInfo.renderer){var _22=_21.drawingInfo.renderer;if(_22.type==VIEWER_GLOBALS.ESRI_RENDERER_TYPES.SIMPLE){this.graphicsRenderer=new _17(_22);}else{if(_22.type==VIEWER_GLOBALS.ESRI_RENDERER_TYPES.UNIQUE_VALUE){this.graphicsRenderer=new _18(_22);}else{if(_22.type==VIEWER_GLOBALS.ESRI_RENDERER_TYPES.CLASS_BREAKS){this.graphicsRenderer=new _19(_22);}}}}}},populateLayerFields:function(_23){if(_23&&_23.fields){_9.set(this.queryLayerNameLabel,"innerHTML",_23.name);var _24=[];var i;for(i=0;i<_23.fields.length;i++){this.viewModel.queryBuilderFields.push({value:_23.fields[i].name,label:_23.fields[i].name});}this.viewModel.sortFieldNames();}this.applyBindings();},showUniqueValuesContent:function(){_8.remove(this.queryBuilderToggleUniqueValuesImg,"up");_8.add(this.queryBuilderToggleUniqueValuesImg,"down");_a.set(this.queryBuilderUniqueValuesContainer,"display","block");var _25=null;if((this.queryBuilderFields.selectedIndex>-1)&&(this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex]!=null)){_25=this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex];}if(this.uniqueFieldValuesLookup[_25.value]==null){_a.set(this.loadUniqueValuesButton.domNode,"display","block");}if(this.uniqueValuesDirty){this.handleQueryBuilderFieldChanged();}},hideUniqueValuesContent:function(){_8.add(this.queryBuilderToggleUniqueValuesImg,"up");_8.remove(this.queryBuilderToggleUniqueValuesImg,"down");_a.set(this.queryBuilderUniqueValuesContainer,"display","none");_a.set(this.loadUniqueValuesButton.domNode,"display","none");},handleGetUniqueValues:function(){if(this.queryBuilderFields.selectedIndex<0||this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex]===null){return;}var _26=this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex].value;if(_26!=null&&_26!=""){this.getUniqueValuesForField(_26,_b.hitch(this,this._setUniqueQueryValues));}},reset:function(){this.queryData.currentMode=this.BASIC_MODE;this.queryData.queryCacheArray=new Array();this.queryData.clearQueryCache();this.queryData.setQueryMode(this.queryData.COLUMN);this.loadBasicView();},getUniqueValuesForField:function(_27,_28){if(_28==null||!_b.isFunction(_28)){return;}if(this.uniqueFieldValuesLookup[_27]!=null){_28(this.uniqueFieldValuesLookup[_27]);}else{if(this.queryLayer&&_27!=null){if(this.queryUrlWithLayerId!=null){if(this.uniqueValuesQueryTask==null){this._createUniqueValuesQueryTask();}}if(this.uniqueValuesQueryTask!=null){var _29=new _1a();_29.where="1=1";_29.outFields=[_27];var _2a=_b.hitch(this,this._handleUniqueValuesResponse,_28);this.uniqueValuesQueryTask.execute(_29,_2a);}}}},stepQueryBack:function(){var _2b=this.queryData.popLastQuery();if(_2b==null){return;}if(this.queryData.isBasicMode()){var _2c=this.queryData.getQueryMode();if(this.queryData.isBasicMode()){this.disableQueryInput();this.disableUniqueValueSelect();this.disableOperatorButtons();this.disableAppenderButtons();this.disableColumnSelector();}if(_2b==""){this.noCacheQueryStringRevert(_2b,this.queryData.RESET_BASIC);}else{if(_2c==this.queryData.OPERATOR){this.enableOperatorButtons();this.queryData.setQueryMode(this.queryData.COLUMN);}else{if(_2c==this.queryData.APPENDER){if(this.queryData.isBasicMode()){this.enableAppenderButtons();this.enableQueryInput();this.enableUniqueValueSelect();}this.queryData.setQueryMode(this.queryData.USER_INPUT);}else{if(_2c==this.queryData.COLUMN){if(this.queryData.isBasicMode()){this.enableColumnSelector();}this.queryData.setQueryMode(this.queryData.APPENDER);}else{if(_2c==this.queryData.USER_INPUT){if(this.queryData.isBasicMode()){this.enableQueryInput();this.enableUniqueValueSelect();this.enableAppenderButtons();}this.queryData.setQueryMode(this.queryData.OPERATOR);}}}}}}else{this.setQueryString(_2b);}if(!this.queryData.hasMoreCachedQueries()){this.backButton.attr("disabled",true);}else{if(this.queryData.hasMoreCachedQueries()){this.backButton.attr("disabled",false);}}this.setQueryString(_2b);},_enableAllInputs:function(){this.enableAppenderButtons();this.enableOperatorButtons();this.enableQueryInput();this.enableUniqueValueSelect();this.enableColumnSelector();},addOptions:function(_2d){for(var i=0;i<_2d.length;i++){var _2e=_2d[i];this.addOption(_2e);}},addOption:function(_2f){if(_2f!=null&&_b.isString(_2f)){_2f={label:_2f,value:_2f};}if(_2f.value!=null&&_2f.label!=null){this.viewModel.queryBuilderFields.push(_2f);}},handleQueryBuilderFieldChanged:function(){if(this.uniqueValuesContainerVisible()){var _30=this.queryBuilderFields[this.queryBuilderFields.selectedIndex].value;if(this.uniqueFieldValuesLookup[_30]!=null){this._setUniqueQueryValues(this.uniqueFieldValuesLookup[_30]);}else{this._clearUniqueQueryValues();}this.uniqueValuesDirty=false;}else{this.uniqueValuesDirty=true;this._clearUniqueQueryValues();}},addUniqueValueToQueryString:function(){var _31=_9.get(this.queryBuilderUniqueValuesSelect,"value");this.updateQueryString(this.queryData.USER_INPUT,_31);},addColumnToQuery:function(_32){var _33=this.viewModel.selectedQueryBuilderField();if(_33==null){return;}this.updateQueryString(_32,_33);},updateQueryString:function(_34,_35){var _36=this.queryBuilderSql.value?this.queryBuilderSql.value:"";this.queryData.cacheQuery(_36);this.backButton.attr("disabled",false);var _37="";if(_36){_37=_36;if(!(/ $/.test(_37))){_37+=" ";}}this.queryBuilderSql.attr("value",_37+=_35);if(this.queryData.isBasicMode()){this.setViewMode(_34);}},setViewMode:function(_38){this.queryData.setQueryMode(_38);if(_38==this.queryData.OPERATOR){if(this.queryData.isBasicMode()){this.disableOperatorButtons();this.enableQueryInput();this.enableUniqueValueSelect();this.enableAppenderButtons();this.enableSqlTextArea();}var _39=this.queryBuilderSql.attr("value");this.queryBuilderSql.attr("value",_39+" ");}else{if(_38==this.queryData.APPENDER){if(this.queryData.isBasicMode()){this.disableQueryInput();this.disableUniqueValueSelect();this.disableAppenderButtons();this.enableColumnSelector();}}else{if(_38==this.queryData.COLUMN){if(this.queryData.isBasicMode()){this.disableColumnSelector();this.enableOperatorButtons();}}else{if(_38==this.queryData.RESET_BASIC){this.loadBasicView();}}}}},enableQueryInput:function(){this.queryBuilderSql.attr("disabled",false);},disableQueryInput:function(){this.queryBuilderSql.attr("disabled",true);},enableUniqueValueSelect:function(){this.queryBuilderUniqueValuesSelect.disabled=false;},disableUniqueValueSelect:function(){this.queryBuilderUniqueValuesSelect.disabled=true;},disableAppenderButtons:function(){for(var i=0;i<this.appenderButtons.length;i++){this.appenderButtons[i].attr("disabled",true);}},enableAppenderButtons:function(){for(var i=0;i<this.appenderButtons.length;i++){this.appenderButtons[i].attr("disabled",false);}},disableOperatorButtons:function(){for(var i=0;i<this.operatorButtons.length;i++){this.operatorButtons[i].attr("disabled",true);}},enableOperatorButtons:function(){for(var i=0;i<this.operatorButtons.length;i++){this.operatorButtons[i].attr("disabled",false);}},disableColumnSelector:function(){this.queryBuilderFields.disabled=true;},enableColumnSelector:function(){this.queryBuilderFields.disabled=false;},clearQuery:function(){this.queryData.clearQueryCache();this.queryData.setQueryMode(this.queryData.COLUMN);if(this.queryData.isBasicMode()){this.loadBasicView();}else{this.queryBuilderSql.attr("value","");}this.clearGraphics();},loadBasicView:function(){this.queryBuilderSql.attr("value","");if(this.queryData.isBasicMode()){this.enableColumnSelector();this.disableAppenderButtons();this.disableOperatorButtons();this.disableQueryInput();this.disableUniqueValueSelect();}},noCacheQueryStringRevert:function(_3a,_3b){this.setViewMode(_3b);this.setQueryString(_3a);},setQueryString:function(_3c){this.queryBuilderSql.attr("value",_3c);},enableSqlTextArea:function(){this.queryBuilderSql.focus();},_clearUniqueQueryValues:function(){_c.empty(this.queryBuilderUniqueValuesSelect);if(this.uniqueValuesContainerVisible()){_a.set(this.loadUniqueValuesButton.domNode,"display","block");}},_setUniqueQueryValues:function(_3d){if(!this.sortUniqueValues){this._setUniqueQueryValuesUnsorted(_3d);}else{this._setUniqueQueryValuesSorted(_3d);}_a.set(this.loadUniqueValuesButton.domNode,"display","none");},_setUniqueQueryValuesSorted:function(_3e){this._clearUniqueQueryValues();var _3f=[];for(var key in _3e){var _40=document.createElement("option");_40.text=key;_40.value=_3e[key];_3f.push({option:_40,name:key});}if(this.sortUniqueValues){_3f.sort(function(a,b){return a.name>b.name;});for(var i=0;i<_3f.length;i++){try{this.queryBuilderUniqueValuesSelect.add(_3f[i].option,this.queryBuilderUniqueValuesSelect.options[null]);}catch(e){this.queryBuilderUniqueValuesSelect.add(_3f[i].option,null);}}}_a.set(this.loadUniqueValuesButton.domNode,"display","none");},_setUniqueQueryValuesUnsorted:function(_41){this._clearUniqueQueryValues();for(var key in _41){if(!this.sortUniqueValues){var _42=_c.create("option",{"value":_41[key],"innerHTML":key});_c.place(_42,this.queryBuilderUniqueValuesSelect);}}},_handleUniqueValuesResponse:function(_43,_44){if(_44&&_44.features){var _45=(_44&&_44.fields!=null&&_b.isArray(_44.fields)&&_44.fields.length>0)?_44.fields[0].name:"UNKNOWN";var _46=(_44&&_44.fields!=null&&_b.isArray(_44.fields)&&_44.fields.length>0)?_44.fields[0].type:this.defaultUniqueValuesFieldType;var _47={};for(var i=0;i<_44.features.length;i++){var _48=_44.features[i];for(var key in _48.attributes){var _49=_48.attributes[key];if(_49!=null){var _4a=(this.fieldTypeWrappers[_46]!=null)?this.fieldTypeWrappers[_46].prefix:"";var _4b=(this.fieldTypeWrappers[_46]!=null)?this.fieldTypeWrappers[_46].suffix:"";if(_47[_49]==null){_47[_49]=_4a+_49.toString().replace(/'/g,"\\/")+_4b;}}}}this.uniqueFieldValuesLookup[_45]=_47;}if(_43!=null&&_b.isFunction(_43)){_43(_47);}},_createUniqueValuesQueryTask:function(){this.uniqueValuesQueryTask=new _1b(this.queryUrlWithLayerId);},submitQuery:function(){var _4c=this.queryBuilderSql.attr("value");if(_4c==""){return;}if(this.queryTask==null){this.queryTask=new _1b(this.queryUrlWithLayerId);}var _4d=new _1a();_4d.outFields=["*"];_4d.where=_4c;var _4e;_7.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_EXTENT,function(ext){_4e=ext;});if(_4e!=null&&_4e.spatialReference!=null){_4d.outSpatialReference={wkid:_4e.spatialReference.wkid};}_4d.returnGeometry=this.returnGeometry;if(this.queryTask){VIEWER_UTILS.log("Performing SQL query:",VIEWER_GLOBALS.LOG_TYPE.INFO);VIEWER_UTILS.log(_4c,VIEWER_GLOBALS.LOG_TYPE.INFO);this.queryTask.execute(_4d,this.queryResponseCallback,this.queryResponseErrback);}},clearGraphics:function(){if(this.resultsGraphicsLayer){this.resultsGraphicsLayer.clear();}},handleQueryResponse:function(_4f){this.clearGraphics();if(this.resultsGraphicsLayer){}if(_4f==null||_4f.features==null||!_b.isArray(_4f.features)){this.handleQueryError();}var _50=_4f.features.length===1?"Result":"Results";_7.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Query Complete ("+_4f.features.length+" "+_50+")");var _51=this.pointSymbol;if(_4f.geometryType==VIEWER_GLOBALS.ESRI_GEOMETRY_TYPES.POLYGON){_51=this.polygonSymbol;}else{if(_4f.geometryType==VIEWER_GLOBALS.ESRI_GEOMETRY_TYPES.LINE){_51=this.lineSymbol;}}var _52;for(var i=0;i<_4f.features.length;i++){_52=_4f.features[i];if(this.graphicsRenderer==null){_52.setSymbol(_51);}else{_52.setSymbol(this.graphicsRenderer.getSymbol(_52));}_52.setInfoTemplate(this.getInfoTemplate(_52));this.resultsGraphicsLayer.add(_52);}VIEWER_UTILS.log("SQL Query Returned "+_4f.features.length+" "+_50,VIEWER_GLOBALS.LOG_TYPE.INFO);},handleQueryError:function(){VIEWER_UTILS.log("There was an error performing query. Check your SQL",VIEWER_GLOBALS.LOG_TYPE.ERROR);_7.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"There was an error performing query. Check your SQL");},uniqueValuesContainerVisible:function(){var _53=_a.get(this.queryBuilderUniqueValuesContainer,"display");return _53.toLowerCase()==="block";},getInfoTemplate:function(_54){var _55=new _1c();_55.setTitle("Result");var _56=_c.create("div");var _57=_c.create("div");_c.place(_57,_56);var _58;var _59=_54.attributes;for(var key in _59){var _5a=_c.create("div",{className:"infoTemplateEntry"});var _5b=_c.create("span",{className:"infoTemplateEntryLbl",innerHTML:key+":"});_58=_59[key];var _5c=_c.create("span",{className:"infoTemplateEntryValue",innerHTML:_58});_c.place(_5b,_5a);_c.place(_5c,_5a);_c.place(_5a,_57);}_55.setContent(_56.innerHTML);return _55;}});});