//>>built
require({cache:{"url:esriviewer/ui/query/template/QueryBuilderTemplate.html":"<div style=\"height: 100%\">\r\n    <div data-bind=\"visible:showTabs\" class=\"defaultTabContainer addCatalogTabContainer\">\r\n        <span data-bind=\"click:showQueryBuilderInput, css: {selectedTab: queryBuilderInputVisible}\">Build Query</span>\r\n        <span data-bind=\"visible:showQueryBuilderResultsTab, click:showQueryBuilderResults, css: {selectedTab: queryBuilderResultsVisible}\">Results</span>\r\n        <span data-bind=\"visible:showQueryBuilderSymbologyTab, click:showQueryBuilderSymbology, css: {selectedTab: queryBuilderSymbologyVisible}\">Symbology</span>\r\n    </div>\r\n\r\n    <div data-bind=\"visible:queryBuilderInputVisible\" data-dojo-attach-point=\"queryBuilderInputContainer\">\r\n        <div data-bind=\"visible:showHowToQueryContent\" class=\"howToQueryContent\">\r\n            <div class=\"howToQueryHeader\">To perform a query:</div>\r\n            <div>right click a layer/service in the table of contents and select \"Query Builder\"</div>\r\n        </div>\r\n\r\n        <div data-bind=\"visible:showQueryLayerName\" class=\"queryLayerNameContainer\">\r\n            <span>Query Layer: </span>\r\n            <span data-dojo-attach-point=\"queryLayerNameLabel\"></span>\r\n        </div>\r\n        <select data-dojo-attach-point=\"queryBuilderFields\"\r\n                data-bind=\"event: {dblclick: queryFieldDoubleClick},options: queryBuilderFields ,value:selectedQueryBuilderField, optionsText: 'label', optionsValue: 'value'\"\r\n                class=\"queryBuilderFields\" size=\"7\">\r\n        </select>\r\n\r\n        <div class=\"queryBuilderButtons\">\r\n            <div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"equalsOperatorButton\"\r\n                     disabled=\"disabled\">=\r\n                </div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"greaterThanOperatorButton\"\r\n                     disabled=\"disabled\">&gt;</div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"lessThanOperatorButton\"\r\n                     disabled=\"disabled\">&lt;</div>\r\n                <div data-dojo-type=\"dijit/form/Button\"\r\n                     data-dojo-attach-point=\"lessThanGreaterThanOperatorButton\" disabled=\"disabled\">&lt;\r\n                    &gt;</div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"greaterThanEqualsOperatorButton\"\r\n                     disabled=\"disabled\">&gt;=\r\n                </div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"lessThanEqualsOperatorButton\"\r\n                     disabled=\"disabled\">&lt;=\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"likeAppenderButton\"\r\n                     disabled=\"disabled\">LIKE\r\n                </div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"notAppenderButton\"\r\n                     disabled=\"disabled\">NOT\r\n                </div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"isAppenderButton\"\r\n                     disabled=\"disabled\">IS\r\n                </div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"andAppenderButton\"\r\n                     disabled=\"disabled\">AND\r\n                </div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"orAppenderButton\"\r\n                     disabled=\"disabled\">OR\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"queryBuilderUniqueValuesToggleContainer\">\r\n            <div class=\"togglerContainer\" data-dojo-attach-event=\"onclick: toggleUniqueValuesContainer\">\r\n                <div data-dojo-attach-point=\"queryBuilderToggleUniqueValuesImg\"\r\n                     class=\"commonIcons16 up toggleQueryUniqueValuesButton\"\r\n                     title=\"Toggle Unique Values\"></div>\r\n                <span class=\"queryBuilderUniqueValuesToggleLabel\">Unique Values</span>\r\n            </div>\r\n                    <span data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"loadUniqueValuesButton\"\r\n                          style=\"float:right;margin-right: 15px;display:none\"\r\n                          data-dojo-attach-event=\"onClick: handleGetUniqueValues\">Populate</span>\r\n\r\n        </div>\r\n        <div class=\"queryBuilderUniqueValuesContainer\"\r\n             data-dojo-attach-point=\"queryBuilderUniqueValuesContainer\" style=\"display:none;text-align:right\">\r\n            <select data-dojo-attach-point=\"queryBuilderUniqueValuesSelect\" class=\"queryBuilderUniqueValues\"\r\n                    data-dojo-attach-event=\"ondblclick: addUniqueValueToQueryString\"\r\n                    size=\"7\"></select>\r\n        </div>\r\n        <div class=\"queryBuilderSqlContainer\" data-dojo-attach-point=\"queryBuilderSqlContainer\">\r\n            <div data-dojo-type=\"dijit/form/Textarea\" data-dojo-attach-point=\"queryBuilderSql\"\r\n                 disabled=\"disabled\"></div>\r\n        </div>\r\n        <div class=\"queryActionButtons\">\r\n            <div class=\"queryActionButtonsLeft\">\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"backButton\" disabled=\"disabled\"\r\n                     data-dojo-attach-event=\"onClick:stepQueryBack\"\r\n                        >\r\n                    Back\r\n                </div>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"clearButton\"\r\n                     data-dojo-attach-event=\"onClick:clearQuery\"\r\n                        >\r\n                    Clear\r\n                </div>\r\n            </div>\r\n            <div class=\"queryActionButtonsRight\">\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"submitButton\"\r\n                     data-dojo-attach-event=\"onClick:submitQuery\"\r\n                        >\r\n                    Submit\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"queryBuilderResultsContainer\" style=\"min-height:300px\"\r\n         data-dojo-attach-point=\"queryBuilderResultsContainer\"\r\n         data-bind=\"visible:queryBuilderResultsVisible\">\r\n    </div>\r\n\r\n    <div class=\"queryBuilderSymbologyContainer\" style=\"min-height:300px\"\r\n         data-dojo-attach-point=\"queryBuilderSymbologyContainer\"\r\n         data-bind=\"visible:queryBuilderSymbologyVisible\">\r\n    </div>\r\n\r\n</div>\r\n","url:esriviewer/ui/query/theme/queryBuilderTheme.css":".queryBuilderFields, .queryBuilderSqlContainer, .queryBuilderUniqueValues{width:95%;margin-left:2.5%;margin-bottom:8px;margin-top:9px;}.queryBuilderUniqueValues, .queryBuilderFields{height:75px;}.queryBuilderUniqueValues{width:95%;margin-right:2.5%;margin-bottom:8px;}.queryBuilderUniqueValues{font-size:8pt;}.queryBuilderUniqueValuesToggleLabel{font-size:9pt;}.queryBuilderUniqueValuesToggleContainer{margin-left:5px;margin-top:10px;cursor:pointer;}.queryBuilderButtons{margin:auto;text-align:center;}.queryActionButtonsLeft{float:left;margin-bottom:10px;}.queryActionButtonsRight{float:right;margin-bottom:10px;}.queryActionButtons{margin-bottom:10px;}.queryBuilderButtons .dijitButton{padding:0;margin:5px 1px;}.queryLayerNameContainer{margin-left:10px;margin-top:5px;}.toggleQueryUniqueValuesButton{float:left;}.queryBuilderWindowContent{padding-top:0 !important;}.howToQueryHeader{margin-bottom:5px;font-size:12pt;}.howToQueryContent{color:green;}"}});define("esriviewer/ui/query/QueryBuilderWidget",["dojo/_base/declare","xstyle/css!./theme/queryBuilderTheme.css","dojo/text!./template/QueryBuilderTemplate.html","dojo/_base/json","dojo/has","dojo/on","dojo/topic","dojo/dom-class","dojo/dom-attr","dojo/dom-style","dojo/_base/lang","dojo/date/locale","dojo/dom-construct","../base/UITemplatedWidget","./QueryBuilderData","./model/QueryBuilderViewModel","./QueryBuilderResultsWidget","dijit/form/Textarea","dijit/form/Button","esri/tasks/query","esri/tasks/QueryTask","../draw/configure/ConfigureDrawWidget","../../map/base/DistinctValuesQueryParameters"],function(_1,_2,_3,_4,_5,on,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16){return _1([_d],{useCustomResultGraphics:false,bindingsApplied:false,defaultUniqueValuesFieldType:"esriFieldTypeString",fieldTypeWrappers:{esriFieldTypeString:{prefix:"'",suffix:"'"},esriFieldTypeDate:{prefix:"date '",suffix:"'"},esriFieldTypeGUID:{prefix:"'",suffix:"'"}},__defaultDisplayFormats:{date:"dd-MM-yyyy"},displayFormats:{date:"dd-MM-yyyy"},_distinctLayerVersionSupported:10.1,maxResults:300,uniqueValuesDirty:false,returnGeometry:true,basicMode:true,sortUniqueValues:true,templateString:_3,queryEndpointUrl:null,constructor:function(_17){this.uniqueFieldValuesLookup={};this.queryFields=null;_a.mixin(this,_17||{});this.queryData=new _e();},initListeners:function(){this.inherited(arguments);this.connects.push(on(this.equalsOperatorButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"=")));this.connects.push(on(this.greaterThanOperatorButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,">")));this.connects.push(on(this.lessThanOperatorButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"<")));this.connects.push(on(this.lessThanGreaterThanOperatorButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"<>")));this.connects.push(on(this.greaterThanEqualsOperatorButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,">=")));this.connects.push(on(this.lessThanEqualsOperatorButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"<=")));this.connects.push(on(this.likeAppenderButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"LIKE")));this.connects.push(on(this.notAppenderButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"NOT")));this.connects.push(on(this.isAppenderButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.OPERATOR,"IS")));this.connects.push(on(this.andAppenderButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.APPENDER,"AND")));this.connects.push(on(this.orAppenderButton,"click",_a.hitch(this,this.updateQueryString,this.queryData.APPENDER,"OR")));},applyBindings:function(){if(!this.bindingsApplied){ko.applyBindings(this.viewModel,this.domNode);this.bindingsApplied=true;}},_createViewModel:function(){var _18=new _f();_18.queryBuilderSymbologyVisible.subscribe(_a.hitch(this,this.handleSymbologyVisibilityChanged));_18.queryBuilderResultsVisible.subscribe(_a.hitch(this,this.handleQueryBuilderResultsVisibilityChanged));_18.queryBuilderInputVisible.subscribe(_a.hitch(this,this.handleQueryBuilderVisibilityChanged));_18.showQueryBuilderSymbologyTab(this.useCustomResultGraphics);_18.on(_18.QUERY_FIELD_DOUBLE_CLICK,_a.hitch(this,this.addColumnToQuery,this.queryData.COLUMN));_18.selectedQueryBuilderField.subscribe(_a.hitch(this,this.handleQueryBuilderFieldChanged));return _18;},postCreate:function(){this.inherited(arguments);this.viewModel=this._createViewModel();this.applyBindings();this.queryResponseCallback=_a.hitch(this,this.handleQueryResponse);this.queryResponseErrback=_a.hitch(this,this.handleQueryError);this.operatorButtons=[this.equalsOperatorButton,this.greaterThanOperatorButton,this.lessThanOperatorButton,this.lessThanGreaterThanOperatorButton,this.greaterThanEqualsOperatorButton,this.lessThanEqualsOperatorButton,this.likeAppenderButton,this.notAppenderButton,this.isAppenderButton];this.appenderButtons=[this.andAppenderButton,this.orAppenderButton];this._initializeMode();this.createQueryBuilderResultsWidget();if(!this.queryData.isBasicMode()){this._enableAllInputs();}if(this.useCustomResultGraphics){this.createSymbologyWidget();}this.tweakUI();},_initializeMode:function(){if(this.basicMode){this.queryData.setBasicMode();this.loadBasicView();}else{this.queryData.setAdvancedMode();}},handleSymbologyVisibilityChanged:function(_19){this._handleContentAnimation(_19,this.queryBuilderSymbologyContainer);},handleQueryBuilderVisibilityChanged:function(_1a){this._handleContentAnimation(_1a,this.queryBuilderInputContainer);},handleQueryBuilderResultsVisibilityChanged:function(_1b){this._handleContentAnimation(_1b,this.queryBuilderResultsContainer);},createSymbologyWidget:function(){this.queryBuilderSymbologyWidget=new _15({showTextIcon:false,showEnvelopeIcon:false});this.queryBuilderSymbologyWidget.on("pointSymbolChanged",_a.hitch(this,this._handlePointSymbolChanged));this.queryBuilderSymbologyWidget.on("lineSymbolChanged",_a.hitch(this,this._handleLineSymbolChanged));this.queryBuilderSymbologyWidget.on("polygonSymbolChanged",_a.hitch(this,this._handlePolygonSymbolChanged));this.queryBuilderSymbologyWidget.placeAt(this.queryBuilderSymbologyContainer);},_handlePointSymbolChanged:function(_1c){this.queryBuilderResultsWidget.handlePointSymbolChanged(_1c);},_handleLineSymbolChanged:function(_1d){this.queryBuilderResultsWidget.handleLineSymbolChanged(_1d);},_handlePolygonSymbolChanged:function(_1e){this.queryBuilderResultsWidget.handlePolygonSymbolChanged(_1e);},_destroyResults:function(){this.queryBuilderResultsWidget.destroyResultsGrid();},_setLayerGraphicInfo:function(_1f){this.queryBuilderResultsWidget.setLayerGraphicInfo(_1f);},setMapServiceLayer:function(_20,_21){if(_20==null||_21==null||_20.url==null){return;}this.viewModel.showQueryBuilderInput();this.clearQuery();this._clearQueryTasks();this._destroyResults();this.uniqueFieldValuesLookup={};this.queryEndpointVersion=_20.version;this.queryEndpointUrl=VIEWER_UTILS.joinUrl(_20.url,_21.id);this.viewModel.selectedQueryBuilderField("");this.viewModel.queryBuilderFields.removeAll();VIEWER_UTILS.getLayerInfoFromService(_20.url,_21.id,_a.hitch(this,this.handleLayerInfoLoaded));this.viewModel.showHowToQueryContent(false);},setFeatureServiceLayer:function(_22){this._setQueryLayer(_22);},setImageServiceLayer:function(_23){this._setQueryLayer(_23);},_setQueryLayer:function(_24){if(_24==null||_24.fields==null||_24.url==null){return;}this.viewModel.showQueryBuilderInput();this._destroyResults();this.clearQuery();this._clearQueryTasks();this.uniqueFieldValuesLookup={};this.queryEndpointVersion=_24.version;this.queryEndpointUrl=VIEWER_UTILS.joinUrl(_24.url,"query");this.viewModel.selectedQueryBuilderField("");this.viewModel.queryBuilderFields.removeAll();this.populateLayerFields(_24);this.viewModel.showHowToQueryContent(false);},_clearQueryTasks:function(){this.uniqueValuesQueryTask=null;this.queryTask=null;},loadViewerConfigurationData:function(){var _25=null;_6.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"queryBuilder",function(_26){_25=_26;});if(_25&&_25.configuration!=null&&_a.isObject(_25.configuration)){_a.mixin(this,_25.configuration);this.returnGeometry=true;}},tweakUI:function(){if(_5("ie")<8){_9.set(this.queryBuilderSqlContainer,"marginLeft","0");}},toggleUniqueValuesContainer:function(){if(_7.contains(this.queryBuilderToggleUniqueValuesImg,"up")){var _27=null;if((this.queryBuilderFields.selectedIndex>-1)&&(this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex]!=null)){_27=this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex];}if(_27==null){this.hideUniqueValuesContent();}else{this.showUniqueValuesContent();}}else{this.hideUniqueValuesContent();}},handleLayerInfoLoaded:function(_28){if(_28&&_a.isObject(_28)){if(this.queryFields==null||(_a.isArray(this.queryFields)&&this.queryFields.length==0)){this.populateLayerFields(_28);}this._setLayerGraphicInfo(_28);}},populateLayerFields:function(_29){if(_29&&_29.fields){_8.set(this.queryLayerNameLabel,"innerHTML",_29.name);var _2a=[];var i;for(i=0;i<_29.fields.length;i++){this.viewModel.queryBuilderFields.push({value:_29.fields[i].name,label:_29.fields[i].name});}this.viewModel.sortFieldNames();}},showUniqueValuesContent:function(){_7.remove(this.queryBuilderToggleUniqueValuesImg,"up");_7.add(this.queryBuilderToggleUniqueValuesImg,"down");_9.set(this.queryBuilderUniqueValuesContainer,"display","block");var _2b=null;if((this.queryBuilderFields.selectedIndex>-1)&&(this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex]!=null)){_2b=this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex];}if(this.uniqueFieldValuesLookup[_2b.value]==null){_9.set(this.loadUniqueValuesButton.domNode,"display","block");}if(this.uniqueValuesDirty){this.handleQueryBuilderFieldChanged();}},hideUniqueValuesContent:function(){_7.add(this.queryBuilderToggleUniqueValuesImg,"up");_7.remove(this.queryBuilderToggleUniqueValuesImg,"down");_9.set(this.queryBuilderUniqueValuesContainer,"display","none");_9.set(this.loadUniqueValuesButton.domNode,"display","none");},handleGetUniqueValues:function(){if(this.queryBuilderFields.selectedIndex<0||this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex]===null){return;}var _2c=this.queryBuilderFields.options[this.queryBuilderFields.selectedIndex].value;if(_2c!=null&&_2c!=""){this.getUniqueValuesForField(_2c,_a.hitch(this,this._setUniqueQueryValues));}},reset:function(){this.queryData.currentMode=this.BASIC_MODE;this.queryData.queryCacheArray=[];this.queryData.clearQueryCache();this.queryData.setQueryMode(this.queryData.COLUMN);this.loadBasicView();},getUniqueValuesForField:function(_2d,_2e){if(_2e==null||!_a.isFunction(_2e)){return;}if(this.uniqueFieldValuesLookup[_2d]!=null){_2e(this.uniqueFieldValuesLookup[_2d]);}else{if(_2d!=null){if(this.queryEndpointUrl!=null){var _2f=_a.hitch(this,this._handleUniqueValuesResponse,_2e,_2d);if(this.queryEndpointVersion<this._distinctLayerVersionSupported){if(this.uniqueValuesQueryTask==null){this._createUniqueValuesQueryTask();}}if(this.uniqueValuesQueryTask!=null){var _30=new _13();_30.where="1=1";_30.outFields=[_2d];this.uniqueValuesQueryTask.execute(_30,_2f);}else{var _31=new _16({});_6.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.GET_DISTINCT_FIELD_VALUES,{callback:_2f,layer:{url:this.queryEndpointUrl},distinctField:_2d,processResponse:false});}}}}},stepQueryBack:function(){var _32=this.queryData.popLastQuery();if(_32==null){return;}if(this.queryData.isBasicMode()){var _33=this.queryData.getQueryMode();if(this.queryData.isBasicMode()){this.disableQueryInput();this.disableUniqueValueSelect();this.disableOperatorButtons();this.disableAppenderButtons();this.disableColumnSelector();}if(_32==""){this.noCacheQueryStringRevert(_32,this.queryData.RESET_BASIC);}else{if(_33==this.queryData.OPERATOR){this.enableOperatorButtons();this.queryData.setQueryMode(this.queryData.COLUMN);}else{if(_33==this.queryData.APPENDER){if(this.queryData.isBasicMode()){this.enableAppenderButtons();this.enableQueryInput();this.enableUniqueValueSelect();}this.queryData.setQueryMode(this.queryData.USER_INPUT);}else{if(_33==this.queryData.COLUMN){if(this.queryData.isBasicMode()){this.enableColumnSelector();}this.queryData.setQueryMode(this.queryData.APPENDER);}else{if(_33==this.queryData.USER_INPUT){if(this.queryData.isBasicMode()){this.enableQueryInput();this.enableUniqueValueSelect();this.enableAppenderButtons();}this.queryData.setQueryMode(this.queryData.OPERATOR);}}}}}}else{this.setQueryString(_32);}if(!this.queryData.hasMoreCachedQueries()){this.backButton.attr("disabled",true);}else{if(this.queryData.hasMoreCachedQueries()){this.backButton.attr("disabled",false);}}this.setQueryString(_32);},_enableAllInputs:function(){this.enableAppenderButtons();this.enableOperatorButtons();this.enableQueryInput();this.enableUniqueValueSelect();this.enableColumnSelector();},addOptions:function(_34){for(var i=0;i<_34.length;i++){var _35=_34[i];this.addOption(_35);}},addOption:function(_36){if(_36!=null&&_a.isString(_36)){_36={label:_36,value:_36};}if(_36.value!=null&&_36.label!=null){this.viewModel.queryBuilderFields.push(_36);}},handleQueryBuilderFieldChanged:function(){if(this.uniqueValuesContainerVisible()){if(this.queryBuilderFields==null||this.queryBuilderFields.selectedIndex==null||this.queryBuilderFields[this.queryBuilderFields.selectedIndex]==null){this._clearUniqueQueryValues();this.uniqueValuesDirty=false;return;}var _37=this.queryBuilderFields[this.queryBuilderFields.selectedIndex].value;if(this.uniqueFieldValuesLookup[_37]!=null){this._setUniqueQueryValues(this.uniqueFieldValuesLookup[_37]);}else{this._clearUniqueQueryValues();}this.uniqueValuesDirty=false;}else{this.uniqueValuesDirty=true;this._clearUniqueQueryValues();}},addUniqueValueToQueryString:function(){var _38=_8.get(this.queryBuilderUniqueValuesSelect,"value");this.updateQueryString(this.queryData.USER_INPUT,_38);},addColumnToQuery:function(_39){var _3a=this.viewModel.selectedQueryBuilderField();if(_3a==null){return;}this.updateQueryString(_39,_3a);},updateQueryString:function(_3b,_3c){var _3d=this.queryBuilderSql.value?this.queryBuilderSql.value:"";this.queryData.cacheQuery(_3d);this.backButton.attr("disabled",false);var _3e="";if(_3d){_3e=_3d;if(!(/ $/.test(_3e))){_3e+=" ";}}this.queryBuilderSql.attr("value",_3e+=_3c);if(this.queryData.isBasicMode()){this.setViewMode(_3b);}},setViewMode:function(_3f){this.queryData.setQueryMode(_3f);if(_3f==this.queryData.OPERATOR){if(this.queryData.isBasicMode()){this.disableOperatorButtons();this.enableQueryInput();this.enableUniqueValueSelect();this.enableAppenderButtons();this.enableSqlTextArea();}var _40=this.queryBuilderSql.attr("value");this.queryBuilderSql.attr("value",_40+" ");}else{if(_3f==this.queryData.APPENDER){if(this.queryData.isBasicMode()){this.disableQueryInput();this.disableUniqueValueSelect();this.disableAppenderButtons();this.enableColumnSelector();}}else{if(_3f==this.queryData.COLUMN){if(this.queryData.isBasicMode()){this.disableColumnSelector();this.enableOperatorButtons();}}else{if(_3f==this.queryData.RESET_BASIC){this.loadBasicView();}}}}},enableQueryInput:function(){this.queryBuilderSql.attr("disabled",false);},disableQueryInput:function(){this.queryBuilderSql.attr("disabled",true);},enableUniqueValueSelect:function(){this.queryBuilderUniqueValuesSelect.disabled=false;},disableUniqueValueSelect:function(){this.queryBuilderUniqueValuesSelect.disabled=true;},disableAppenderButtons:function(){for(var i=0;i<this.appenderButtons.length;i++){this.appenderButtons[i].attr("disabled",true);}},enableAppenderButtons:function(){for(var i=0;i<this.appenderButtons.length;i++){this.appenderButtons[i].attr("disabled",false);}},disableOperatorButtons:function(){for(var i=0;i<this.operatorButtons.length;i++){this.operatorButtons[i].attr("disabled",true);}},enableOperatorButtons:function(){for(var i=0;i<this.operatorButtons.length;i++){this.operatorButtons[i].attr("disabled",false);}},disableColumnSelector:function(){this.queryBuilderFields.disabled=true;},enableColumnSelector:function(){this.queryBuilderFields.disabled=false;},clearQuery:function(){this.queryData.clearQueryCache();this.queryData.setQueryMode(this.queryData.COLUMN);if(this.queryData.isBasicMode()){this.loadBasicView();}else{this.queryBuilderSql.attr("value","");}this.queryBuilderResultsWidget.clearResults();},loadBasicView:function(){this.queryBuilderSql.attr("value","");if(this.queryData.isBasicMode()){this.enableColumnSelector();this.disableAppenderButtons();this.disableOperatorButtons();this.disableQueryInput();this.disableUniqueValueSelect();}},noCacheQueryStringRevert:function(_41,_42){this.setViewMode(_42);this.setQueryString(_41);},setQueryString:function(_43){this.queryBuilderSql.attr("value",_43);},enableSqlTextArea:function(){this.queryBuilderSql.focus();},_clearUniqueQueryValues:function(){_c.empty(this.queryBuilderUniqueValuesSelect);if(this.uniqueValuesContainerVisible()){_9.set(this.loadUniqueValuesButton.domNode,"display","block");}},_setUniqueQueryValues:function(_44){if(!this.sortUniqueValues){this._setUniqueQueryValuesUnsorted(_44);}else{this._setUniqueQueryValuesSorted(_44);}_9.set(this.loadUniqueValuesButton.domNode,"display","none");},_setUniqueQueryValuesSorted:function(_45){this._clearUniqueQueryValues();var _46=[];for(var key in _45){var _47=document.createElement("option");_47.text=key;_47.value=_45[key];_46.push({option:_47,name:key});}if(this.sortUniqueValues){_46.sort(function(a,b){return a.name>b.name;});for(var i=0;i<_46.length;i++){try{this.queryBuilderUniqueValuesSelect.add(_46[i].option,this.queryBuilderUniqueValuesSelect.options[null]);}catch(e){this.queryBuilderUniqueValuesSelect.add(_46[i].option,null);}}}_9.set(this.loadUniqueValuesButton.domNode,"display","none");},_setUniqueQueryValuesUnsorted:function(_48){this._clearUniqueQueryValues();for(var key in _48){if(!this.sortUniqueValues){var _49=_c.create("option",{"value":_48[key],"innerHTML":key});_c.place(_49,this.queryBuilderUniqueValuesSelect);}}},_handleUniqueValuesResponse:function(_4a,_4b,_4c){if(_4c&&_4c.features){var i;if(_4b==null){_4b=(_4c&&_4c.fields!=null&&_a.isArray(_4c.fields)&&_4c.fields.length>0)?_4c.fields[0].name:"UNKNOWN";}var _4d=null;for(i=0;i<_4c.fields.length;i++){if(_4c.fields[i].name===_4b){_4d=_4c.fields[i].type;break;}}if(_4d==null){_6.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"There was an error retrieving unique fields.");return;}var _4e={};for(i=0;i<_4c.features.length;i++){var _4f=_4c.features[i];if(_4f.attributes[_4b]!=null){var _50=_4f.attributes[_4b];var _51=_50;if(_4d==VIEWER_GLOBALS.ESRI_FIELD_TYPES.DATE){_51=this._formatDate(_50);_50=_51;}else{_50=_50.toString().replace(/'/g,"\\/");}if(_50!=null){var _52=(this.fieldTypeWrappers[_4d]!=null)?this.fieldTypeWrappers[_4d].prefix:"";var _53=(this.fieldTypeWrappers[_4d]!=null)?this.fieldTypeWrappers[_4d].suffix:"";if(_4e[_51]==null){_4e[_51]=_52+_50+_53;}}}}this.uniqueFieldValuesLookup[_4b]=_4e;}if(_4a!=null&&_a.isFunction(_4a)){_4a(_4e);}},_formatDate:function(_54){var _55=new Date(_54);var _56=this.displayFormats.date!=null?this.displayFormats.date:this.__defaultDisplayFormats.date;return _b.format(_55,{selector:"date",datePattern:_56});},_createUniqueValuesQueryTask:function(){this.uniqueValuesQueryTask=new _14(this.queryEndpointUrl);},submitQuery:function(){var _57=this.queryBuilderSql.attr("value");if(_57==""){return;}if(this.queryTask==null){this.queryTask=new _14(this.queryEndpointUrl);}var _58=new _13();_58.outFields=["*"];_58.where=_57;var _59;_6.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_EXTENT,function(ext){_59=ext;});if(_59!=null&&_59.spatialReference!=null){_58.outSpatialReference={wkid:_59.spatialReference.wkid};}_58.returnGeometry=this.returnGeometry;if(this.queryTask){VIEWER_UTILS.log("Performing SQL query:",VIEWER_GLOBALS.LOG_TYPE.INFO);VIEWER_UTILS.log(_57,VIEWER_GLOBALS.LOG_TYPE.INFO);this.queryTask.execute(_58,this.queryResponseCallback,this.queryResponseErrback);}},handleQueryResponse:function(_5a){this.viewModel.showQueryBuilderResults();this.queryBuilderResultsWidget.handleQueryResponse(_5a);},handleQueryError:function(){VIEWER_UTILS.log("There was an error performing query. Check your SQL",VIEWER_GLOBALS.LOG_TYPE.ERROR);_6.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"There was an error performing query. Check your SQL");},uniqueValuesContainerVisible:function(){var _5b=_9.get(this.queryBuilderUniqueValuesContainer,"display");return _5b.toLowerCase()==="block";},createQueryBuilderResultsWidget:function(){if(this.queryBuilderResultsWidget==null){this.queryBuilderResultsWidget=new _10({maxResults:this.maxResults});this.queryBuilderResultsWidget.placeAt(this.queryBuilderResultsContainer);}},clearGraphics:function(){if(this.queryBuilderResultsWidget&&_a.isFunction(this.queryBuilderResultsWidget.clearGraphics)){this.queryBuilderResultsWidget.clearGraphics();}}});});