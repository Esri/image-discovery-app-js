//>>built
require({cache:{"url:esriviewer/ui/pointupload/theme/pointUploadTheme.css":".uploadDndContainer{border:1px dashed gray;background:#F7F7F7;height:100%;margin-top:10px;width:100%;}.uploadImageHtml5DropInner{text-align:center;height:100%;padding:7%;font-size:13pt;color:gray;}.uploadImageDivYellow{background:#FFF6D1;color:green;}.validCoordsCSVPointUploadContainer{margin-top:5px;}.validCoordsCSVPointUploadLbl{color:gray;}.validCoordsCSVPointUploadValue{color:blue;margin-left:10px;}","url:esriviewer/ui/pointupload/template/PointUploadTemplate.html":"<div>\r\n    <div>\r\n        <div class=\"validCoordsCSVPointUploadContainer\">\r\n            <div class=\"validCoordsCSVPointUploadLbl\" >Valid Latitude fields:</span>\r\n                <div class=\"validCoordsCSVPointUploadValue\" data-bind=\"text:validLatFields\"></div>\r\n            </div>\r\n            <div class=\"validCoordsCSVPointUploadContainer\">\r\n                <div class=\"validCoordsCSVPointUploadLbl\">Valid Longitude fields:</div>\r\n                <div  class=\"validCoordsCSVPointUploadValue\" data-bind=\"text:validLonFields\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"uploadDndContainer threePixelBorderRadius\"\r\n             data-dojo-attach-point=\"uploadDndContainer\">\r\n            <div class=\"uploadImageHtml5DropInner\" data-dojo-attach-point=\"uploadImageHtml5DropInner\">\r\n                <span>Drop CSV</span>\r\n            </div>\r\n        </div>\r\n    </div>"}});define("esriviewer/ui/pointupload/PointUploadWidget",["dojo/_base/declare","xstyle/css!./theme/pointUploadTheme.css","dojo/text!./template/PointUploadTemplate.html","dojo/topic","dojo/string","dojo/_base/array","dojo/dom-class","dojo/_base/connect","dojo/_base/lang","../base/UITemplatedWidget","esri/geometry/Point","dojox/data/CsvStore","esri/layers/FeatureLayer","esri/InfoTemplate","./model/PointUploadViewModel","esri/geometry/Extent","esri/SpatialReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11){return _1([_a],{_defaultLatFields:["lat","latitude","y","ycenter"],_defaultLonFields:["lon","long","longitude","x","xcenter"],templateString:_3,postCreate:function(){this.validLatFields=this._defaultLatFields;this.validLonFields=this._defaultLonFields;this.inherited(arguments);var _12=this.validLatFields.join(", ");var _13=this.validLonFields.join(", ");this.viewModel=new _f();this.viewModel.validLatFields(_12);this.viewModel.validLonFields(_13);ko.applyBindings(this.viewModel,this.domNode);},initListeners:function(){this.inherited(arguments);_8.connect(this.uploadImageHtml5DropInner,"dragleave",this,_9.hitch(this.handleFileDragOut));_8.connect(this.uploadImageHtml5DropInner,"dragover",this,_9.hitch(this.handleFileDragOver));_8.connect(this.uploadImageHtml5DropInner,"drop",this,_9.hitch(this,this.handleFileDropped));},loadViewerConfigurationData:function(){var _14=null;_4.publish(VIEWER_GLOBALS.EVENTS.CONFIGURATION.GET_ENTRY,"pointUploadWidget",function(_15){_14=_15;});if(_14!=null&&_9.isObject(_14)){if(_14.validLatFields!=null&&_9.isArray(_14.validLatFields)){this.validLatFields=_14.validLatFields;}if(_14.validLonFields!=null&&_9.isArray(_14.validLonFields)){this.validLonFields=_14.validLonFields;}}},handleFileDragOut:function(evt){evt.stopPropagation();evt.preventDefault();_7.remove(this.uploadDndContainer,"uploadImageDivYellow");},handleFileDragOver:function(evt){evt.stopPropagation();evt.preventDefault();_7.add(this.uploadDndContainer,"uploadImageDivYellow");evt.dataTransfer.dropEffect="copy";},handleFileDropped:function(evt){evt.stopPropagation();evt.preventDefault();_7.remove(this.uploadDndContainer,"uploadImageDivYellow");var _16=evt.dataTransfer.files;if(_16.length==0){return;}var _17=[];var _18=_16[0].name;if(_16.length>0){_18=_16[0].name;var _19=_16[0].type;if(!(_19==="application/vnd.ms-excel"||_19==="text/plain")){_4.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"File must be plain text CSV.");return;}var _1a=new FileReader();_1a.onload=_9.hitch(this,this._handleFileReadComplete,_1a);_1a.readAsText(_16[0]);}},_handleFileReadComplete:function(_1b){if(_1b&&_1b.result!=null){this.processCsvData(_1b.result);}},processCsvData:function(_1c){var _1d=_1c.indexOf("\n");var _1e=_5.trim(_1c.substr(0,_1d));var _1f=this._getSeparator(_1e);var _20=new _c({data:_1c,separator:_1f});var _21=this;_20.fetch({onComplete:function(_22,_23){var _24=0;var _25=_21._generateFeatureCollectionTemplateCsv(_20,_22);var _26=_21._generateDefaultPopupInfo(_25);var _27=new _e(_21._buildInfoTemplate(_26));var _28,_29;var _2a=_20.getAttributes(_22[0]);_6.forEach(_2a,function(_2b){var _2c;_2c=_6.indexOf(_21.validLatFields,_2b.toLowerCase());if(_2c!==-1){_28=_2b;}_2c=_6.indexOf(_21.validLonFields,_2b.toLowerCase());if(_2c!==-1){_29=_2b;}});var _2d=180;var _2e=90;var _2f=-180;var _30=-90;_6.forEach(_22,function(_31,_32){var _33=_20.getAttributes(_31),_34={};_6.forEach(_33,function(_35){var _36=Number(_20.getValue(_31,_35));if(isNaN(_36)){_34[_35]=_20.getValue(_31,_35);}else{_34[_35]=_36;}});_34["__OBJECTID"]=_24;_24++;var _37=parseFloat(_34[_28]);var _38=parseFloat(_34[_29]);if(isNaN(_37)||isNaN(_38)){return;}if(_37>_30){_30=_37;}if(_37<_2e){_2e=_37;}if(_38>_2f){_2f=_38;}if(_38<_2d){_2d=_38;}var _39=PROJECTION_UTILS.geometryToMapSpatialReference(new _b(_38,_37))[0];var _3a={"geometry":_39.toJson(),"attributes":_34};_25.featureSet.features.push(_3a);});var _3b;if(_2d>_2f||_2d==_2f||_2e>_30||_2e==_30){_2d=-180;_2f=180;_2e=-90;_30=90;}var _3c=new _10(_2d,_2e,_2f,_30,new _11({wkid:4326}));_3b=PROJECTION_UTILS.geometryToMapSpatialReference(_3c)[0];var id="csvLayer_ "+VIEWER_UTILS.generateUUID();var _3d=new _d(_25,{infoTemplate:_27,id:id});_3d.initialExtent=_3b;_3d.name="CSV Layer "+VIEWER_UTILS.getTimeStamp();_3d.__popupInfo=_26;_4.publish(VIEWER_GLOBALS.EVENTS.MAP.LAYERS.ADD,_3d,{isOperationalLayer:true,canRemove:true});_4.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Layer Added");},onError:function(_3e){_4.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Error loading CSV data.");}});},_getSeparator:function(_3f){var _40=[",","      ",";","|"];var _41=0;var _42="";_6.forEach(_40,function(_43){var _44=_3f.split(_43).length;if(_44>_41){_41=_44;_42=_43;}});return _42;},_generateFeatureCollectionTemplateCsv:function(_45,_46){var _47={"layerDefinition":null,"featureSet":{"features":[],"geometryType":"esriGeometryPoint"}};_47.layerDefinition={"geometryType":"esriGeometryPoint","objectIdField":"__OBJECTID","type":"Feature Layer","typeIdField":"","drawingInfo":{"renderer":{"type":"simple","symbol":{"type":"esriPMS","url":"http://static.arcgis.com/images/Symbols/Basic/RedSphere.png","imageData":"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","contentType":"image/png","width":15,"height":15}}},"fields":[{"name":"__OBJECTID","alias":"__OBJECTID","type":"esriFieldTypeOID","editable":false,"domain":null}],"types":[],"capabilities":"Query"};var _48=_45.getAttributes(_46[0]);_6.forEach(_48,function(_49){var _4a=_45.getValue(_46[0],_49);var _4b=Number(_4a);if(isNaN(_4b)){_47.layerDefinition.fields.push({"name":_49,"alias":_49,"type":"esriFieldTypeString","editable":true,"domain":null});}else{_47.layerDefinition.fields.push({"name":_49,"alias":_49,"type":"esriFieldTypeDouble","editable":true,"domain":null});}});return _47;},_generateDefaultPopupInfo:function(_4c){var _4d=_4c.layerDefinition.fields;var _4e={"esriFieldTypeDouble":1,"esriFieldTypeSingle":1};var _4f={"esriFieldTypeInteger":1,"esriFieldTypeSmallInteger":1};var dt={"esriFieldTypeDate":1};var _50=null;var _51=_6.map(_4d,_9.hitch(this,function(_52,_53){if(_52.name.toUpperCase()==="NAME"){_50=_52.name;}var _54=(_52.type!=="esriFieldTypeOID"&&_52.type!=="esriFieldTypeGlobalID"&&_52.type!=="esriFieldTypeGeometry");var _55=null;if(_54){var f=_52.name.toLowerCase();var _56=",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";if(_56.indexOf(","+f+",")>-1||f.indexOf("area")>-1||f.indexOf("length")>-1||f.indexOf("shape")>-1||f.indexOf("perimeter")>-1||f.indexOf("objectid")>-1||f.indexOf("_")==f.length-1||f.indexOf("_i")==f.length-2){_54=false;}if(_52.type in _4f){_55={places:0,digitSeparator:true};}else{if(_52.type in _4e){_55={places:2,digitSeparator:true};}else{if(_52.type in dt){_55={dateFormat:"shortDateShortTime"};}}}}return _9.mixin({},{fieldName:_52.name,label:_52.alias,isEditable:false,tooltip:"",visible:_54,format:_55,stringFieldOption:"textbox"});}));var _57={title:_50?"{"+_50+"}":"",fieldInfos:_51,description:null,showAttachments:false,mediaInfos:[]};return _57;},_buildInfoTemplate:function(_58){var _59={content:"<table>"};_6.forEach(_58.fieldInfos,function(_5a){if(_5a.visible){_59.content+="<tr><td valign='top'>"+_5a.label+": </td><td valign='top'>${"+_5a.fieldName+"}</td></tr>";}});_59.content+="</table>";return _59;}});});