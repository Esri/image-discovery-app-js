//>>built
require({cache:{"esri/layers/FeatureEditResult":function(){define("esri/layers/FeatureEditResult",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_1,_2,_3,_4){var _5=_1(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(_6){if(_6&&_2.isObject(_6)){this.objectId=_6.objectId;this.success=_6.success;if(!_6.success){var _7=_6.error;this.error=new Error();this.error.code=_7.code;this.error.message=_7.description;}}}});if(_3("extend-esri")){_2.setObject("layers.FeatureEditResult",_5,_4);}return _5;});},"esri/layers/MapImageLayer":function(){define("esri/layers/MapImageLayer",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/sniff","esri/domUtils","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/layers/layer"],function(_8,_9,_a,_b,_c,_d,_e,_f,has,_10,_11,_12,_13){var _14=_8([_13],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(_15){this.inherited(arguments,[null,_15]);this._mapImages=[];var _16=_a.hitch;this._panStart=_16(this,this._panStart);this._pan=_16(this,this._pan);this._extentChange=_16(this,this._extentChange);this._zoom=_16(this,this._zoom);this._zoomStart=_16(this,this._zoomStart);this._scale=_16(this,this._scale);this._resize=_16(this,this._resize);_9.connect(this,"onSuspend",this,this._onSuspend);_9.connect(this,"onResume",this,this._onResume);this.loaded=true;this.onLoad(this);},opacity:1,_transform:_e._getDOMAccessor("transform"),addImage:function(_17){var _18=this._mapImages.push(_17);_18=_18-1;_17._idx=_18;_17._layer=this;if(this._div){this._createImage(_17,_18);}},removeImage:function(_19){if(_19){var idx=_19._idx,_1a=this._mapImages;if(_1a[idx]===_19){delete _1a[idx];var _1b=_19._node;if(_1b){this._clearEvents(_1b);_1b.e_idx=_1b.e_bl=_1b.e_tr=_1b.e_l=_1b.e_t=_1b.e_w=_1b.e_h=null;if(_1b.parentNode){_1b.parentNode.removeChild(_1b);_c.destroy(_1b);}}_19._node=_19._idx=_19._layer=null;}}},removeAllImages:function(){var _1c=this._mapImages,i,len=_1c.length;for(i=0;i<len;i++){var _1d=_1c[i];if(_1d){this.removeImage(_1d);}}this._mapImages=[];},getImages:function(){var _1e=this._mapImages,_1f=[],i,len=_1e.length;for(i=0;i<len;i++){if(_1e[i]){_1f.push(_1e[i]);}}return _1f;},setOpacity:function(_20){if(this.opacity!=_20){this._opacityChanged(this.opacity=_20);this.onOpacityChange();}},onOpacityChange:function(){},_opacityChanged:function(_21){var div=this._div,i,len,_22;if(div){if(!has("ie")||has("ie")>8){_d.set(div,"opacity",_21);}else{_22=div.childNodes;len=_22.length;for(i=0;i<len;i++){_d.set(_22[i],"opacity",_21);}}}},_createImage:function(_23,idx){var _24=_c.create("img");_d.set(_24,{position:"absolute"});if(has("ie")<=8){_d.set(_24,"opacity",this.opacity);}if(_23.rotation){var _25="rotate("+(360-_23.rotation)+"deg)";if(has("ie")<9){}else{_d.set(_24,this._transform,_25);_d.set(_24,"transform",_25);}}_23._node=_24;_24.e_idx=idx;_24.e_layer=this;_24.e_load=_9.connect(_24,"onload",_14.prototype._imageLoaded);_24.e_error=_9.connect(_24,"onerror",_14.prototype._imageError);_24.e_abort=_9.connect(_24,"onabort",_14.prototype._imageError);_24.src=_23.href;},_imageLoaded:function(evt,img){var _26=img||evt.target||evt.currentTarget,_27=_26.e_layer,_28=_27._mapImages[_26.e_idx],map=_27._map;if(map&&(map.__zooming||map.__panning||!_27._sr)){_27._standby.push(_26);return;}_27._clearEvents(_26);if(!_28||_28._node!==_26){return;}if(map){_27._attach(_28);}},_imageError:function(evt){var _29=evt.target||evt.currentTarget,_2a=_29.e_layer,_2b=_2a._mapImages[_29.e_idx];_2a._clearEvents(_29);if(_2b){_2b._node=null;}},_clearEvents:function(_2c){var _2d=_9.disconnect;_2d(_2c.e_load);_2d(_2c.e_error);_2d(_2c.e_abort);_2c.e_load=_2c.e_error=_2c.e_abort=_2c.e_layer=null;},_attach:function(_2e){var _2f=_2e.extent,_30=_2f.spatialReference,_31=this._sr,div=this._div,_32=_2e._node,_33=new _11({x:_2f.xmin,y:_2f.ymin,spatialReference:_30}),_34=new _11({x:_2f.xmax,y:_2f.ymax,spatialReference:_30});if(!_31.equals(_30)){if(_31.isWebMercator()&&_30.wkid===4326){_33=_12.geographicToWebMercator(_33);_34=_12.geographicToWebMercator(_34);}else{if(_30.isWebMercator()&&_31.wkid===4326){_33=_12.webMercatorToGeographic(_33);_34=_12.webMercatorToGeographic(_34);}}}_32.e_bl=_33;_32.e_tr=_34;if(_2e.visible){this._setPos(_32,div._left,div._top);(this._active||div).appendChild(_32);}},_setPos:function(_35,_36,_37){var _38=_35.e_bl,_39=_35.e_tr,map=this._map;_38=map.toScreen(_38);_39=map.toScreen(_39);var _3a=_38.x-_36,top=_39.y-_37,_3b=Math.abs(_39.x-_38.x),_3c=Math.abs(_38.y-_39.y),css={width:_3b+"px",height:_3c+"px"},_3d=this._mapImages[_35.e_idx];if(map.navigationMode==="css-transforms"){css[_e._css.names.transform]=_e._css.translate(_3a,top)+(_3d.rotation?(" "+_e._css.rotate(360-_3d.rotation)):"");}else{css.left=_3a+"px";css.top=top+"px";}_d.set(_35,css);_35.e_l=_3a;_35.e_t=top;_35.e_w=_3b;_35.e_h=_3c;},managedSuspension:true,_setMap:function(map,_3e){this.inherited(arguments);var div=this._div=_c.create("div",null,_3e),_3f=_e._css.names,css={position:"absolute"},vd=map.__visibleDelta;if(!has("ie")||has("ie")>8){css.opacity=this.opacity;}if(map.navigationMode==="css-transforms"){css[_3f.transform]=_e._css.translate(vd.x,vd.y);_d.set(div,css);div._left=vd.x;div._top=vd.y;css={position:"absolute",width:map.width+"px",height:map.height+"px",overflow:"visible"};this._active=_c.create("div",null,div);_d.set(this._active,css);this._passive=_c.create("div",null,div);_d.set(this._passive,css);}else{div._left=0;div._top=0;_d.set(div,css);}this._standby=[];var _40=this._mapImages,i,len=_40.length;for(i=0;i<len;i++){var _41=_40[i],_42=_41._node;if(!_42){this._createImage(_41,_41._idx);}}_10.hide(div);return div;},_unsetMap:function(map,_43){this._disconnect();var div=this._div;if(div){var _44=this._mapImages,i,len=_44.length;for(i=0;i<len;i++){var _45=_44[i];if(_45){var _46=_45._node;if(_46){this._clearEvents(_46);_46.e_idx=_46.e_bl=_46.e_tr=_46.e_l=_46.e_t=_46.e_w=_46.e_h=null;}_45._node=null;}}_43.removeChild(div);_c.destroy(div);}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments);},_onSuspend:function(){this._disconnect();_10.hide(this._div);},_onResume:function(evt){if(evt.firstOccurrence){this._sr=this._map.spatialReference;this._processStandbyList();}var map=this._map,div=this._div,vd=map.__visibleDelta;if(map.navigationMode==="css-transforms"){div._left=vd.x;div._top=vd.y;_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}this._redraw(map.navigationMode==="css-transforms");this._connect(map);_10.show(div);},_connect:function(map){if(!this._connections){var _47=_9.connect,_48=(map.navigationMode==="css-transforms");this._connections=[_47(map,"onPanStart",this._panStart),_47(map,"onPan",this._pan),_47(map,"onExtentChange",this._extentChange),_48&&_47(map,"onZoomStart",this._zoomStart),_48?_47(map,"onScale",this._scale):_47(map,"onZoom",this._zoom),_48&&_47(map,"onResize",this._resize)];}},_disconnect:function(){if(this._connections){_b.forEach(this._connections,_9.disconnect);this._connections=null;}},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top;},_pan:function(_49,_4a){var div=this._div;div._left=this._panL+_4a.x;div._top=this._panT+_4a.y;if(this._map.navigationMode==="css-transforms"){_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}else{_d.set(div,{left:div._left+"px",top:div._top+"px"});}},_extentChange:function(_4b,_4c,_4d){if(_4d){this._redraw(this._map.navigationMode==="css-transforms");}else{if(_4c){this._pan(_4b,_4c);}}this._processStandbyList();},_processStandbyList:function(){var i,_4e=this._standby;if(_4e&&_4e.length){for(i=_4e.length-1;i>=0;i--){this._imageLoaded(null,_4e[i]);_4e.splice(i,1);}}},_redraw:function(_4f){if(_4f){var _50=this._passive,_51=_e._css.names;_d.set(_50,_51.transition,"none");this._moveImages(_50,this._active);_d.set(_50,_51.transform,"none");}var div=this._active||this._div,_52=this._div._left,_53=this._div._top,i,len=div.childNodes.length,_54;for(i=0;i<len;i++){_54=div.childNodes[i];this._setPos(_54,_52,_53);}},_zoom:function(_55,_56,_57){var div=this._div,_58=div._left,_59=div._top,i,len=div.childNodes.length,_5a;for(i=0;i<len;i++){_5a=div.childNodes[i];var _5b=_5a.e_w*_56,_5c=_5a.e_h*_56,_5d=(_57.x-_58-_5a.e_l)*(_5b-_5a.e_w)/_5a.e_w,_5e=(_57.y-_59-_5a.e_t)*(_5c-_5a.e_h)/_5a.e_h;_5d=isNaN(_5d)?0:_5d;_5e=isNaN(_5e)?0:_5e;_d.set(_5a,{left:(_5a.e_l-_5d)+"px",top:(_5a.e_t-_5e)+"px",width:_5b+"px",height:_5c+"px"});}},_zoomStart:function(){this._moveImages(this._active,this._passive);},_moveImages:function(_5f,_60){var _61=_5f.childNodes,i,len=_61.length;if(len>0){for(i=len-1;i>=0;i--){_60.appendChild(_61[i]);}}},_scale:function(mtx,_62){var css={},_63=_e._css.names,_64=this._passive;_d.set(_64,_63.transition,_62?"none":(_63.transformName+" "+_f.defaults.map.zoomDuration+"ms ease"));css[_63.transform]=_e._css.matrix(mtx);_d.set(_64,_63.transform,_e._css.matrix(mtx));},_resize:function(_65,_66,_67){_d.set(this._active,{width:_66+"px",height:_67+"px"});_d.set(this._passive,{width:_66+"px",height:_67+"px"});}});if(has("extend-esri")){_a.setObject("layers.MapImageLayer",_14,_e);}return _14;});},"esri/layers/WebTiledLayer":function(){define("esri/layers/WebTiledLayer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/has","dojo/string","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/TiledMapServiceLayer","esri/layers/TileInfo"],function(_68,_69,_6a,Url,has,_6b,_6c,_6d,_6e,_6f,_70,_71){var _72=_68(_70,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(_73,_74){if(!_74){_74={};}this.urlTemplate=_73;var _75=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));var _76=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));this.initialExtent=_74.initialExtent||_75;this.fullExtent=_74.fullExtent||_76;if(_74.tileInfo){this.tileInfo=_74.tileInfo;}else{var _77=[{"level":0,"resolution":156543.033928,"scale":591657527.591555},{"level":1,"resolution":78271.5169639999,"scale":295828763.795777},{"level":2,"resolution":39135.7584820001,"scale":147914381.897889},{"level":3,"resolution":19567.8792409999,"scale":73957190.948944},{"level":4,"resolution":9783.93962049996,"scale":36978595.474472},{"level":5,"resolution":4891.96981024998,"scale":18489297.737236},{"level":6,"resolution":2445.98490512499,"scale":9244648.868618},{"level":7,"resolution":1222.99245256249,"scale":4622324.434309},{"level":8,"resolution":611.49622628138,"scale":2311162.217155},{"level":9,"resolution":305.748113140558,"scale":1155581.108577},{"level":10,"resolution":152.874056570411,"scale":577790.554289},{"level":11,"resolution":76.4370282850732,"scale":288895.277144},{"level":12,"resolution":38.2185141425366,"scale":144447.638572},{"level":13,"resolution":19.1092570712683,"scale":72223.819286},{"level":14,"resolution":9.55462853563415,"scale":36111.909643},{"level":15,"resolution":4.77731426794937,"scale":18055.954822},{"level":16,"resolution":2.38865713397468,"scale":9027.977411},{"level":17,"resolution":1.19432856685505,"scale":4513.988705},{"level":18,"resolution":0.597164283559817,"scale":2256.994353},{"level":19,"resolution":0.298582141647617,"scale":1128.497176}];var _78=new _71({"rows":256,"cols":256,"origin":{"x":-20037508.342787,"y":20037508.342787},"spatialReference":{"wkid":102100},"lods":_77});this.tileInfo=_78;}this.spatialReference=new _6e(this.tileInfo.spatialReference.toJson());this.copyright=_74.copyright||"";var url=new Url(_73);var _79=url.scheme+"://"+url.authority+"/";this.urlPath=_73.substring(_79.length);this.tileServers=_74.tileServers||[];if(url.authority.indexOf("{subDomain}")===-1){this.tileServers.push(_79);}if(_74.subDomains&&_74.subDomains.length>0&&url.authority.split(".").length>1){this.subDomains=_74.subDomains;var _7a;_6a.forEach(_74.subDomains,function(_7b,idx){if(url.authority.indexOf("${subDomain}")>-1){_7a=url.scheme+"://"+_6b.substitute(url.authority,{subDomain:_7b})+"/";}else{if(url.authority.indexOf("{subDomain}")>-1){_7a=url.scheme+"://"+url.authority.replace(/\{subDomain\}/gi,_7b)+"/";}}this.tileServers.push(_7a);},this);}this.tileServers=_6a.map(this.tileServers,function(_7c){if(_7c.charAt(_7c.length-1)!=="/"){_7c+="/";}return _7c;});this._levelToLevelValue=[];_6a.forEach(this.tileInfo.lods,function(_7d){this._levelToLevelValue[_7d.level]=_7d.levelValue?_7d.levelValue:_7d.level;},this);this.loaded=true;this.onLoad(this);},getTileUrl:function(_7e,row,col){_7e=this._levelToLevelValue[_7e];var _7f=this.tileServers[row%this.tileServers.length];var _80=_7f+_6b.substitute(this.urlPath,{level:_7e,col:col,row:row});_80=_80.replace(/\{level\}/gi,_7e);_80=_80.replace(/\{row\}/gi,row);_80=_80.replace(/\{col\}/gi,col);return _6d.addProxy(_80);}});if(has("extend-esri")){_69.setObject("layers.WebTiledLayer",_72,_6c);}return _72;});},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("esri/layers/ServiceGeneratedFeatureCollection",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/renderers/SimpleRenderer","esri/layers/layer","esri/layers/FeatureLayer","esri/dijit/PopupTemplate"],function(_81,_82,_83,_84,_85,_86,has,_87,_88,_89,_8a,_8b,_8c,_8d,_8e){var _8f=_81([_8c],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(url,_90){this.pointSymbol=_90&&_90.pointSymbol;this.polylineSymbol=_90&&_90.polylineSymbol;this.polygonSymbol=_90&&_90.polygonSymbol;this._outSR=(_90&&(_90.outSpatialReference||_90.outSR))||new _88({wkid:4326});this._options=_90;},parse:function(){},getFeatureLayers:function(){var _91=[];if(this._fLayers){_91=_91.concat(this._fLayers);}return _91;},onRefresh:function(){},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._createLayer();},_createLayer:function(_92){var _93=this;this._fireUpdateStart();var _94=this.parse(_92);_94.addCallback(function(_95){_93._io=null;_93._initLayer(_95);});_94.addErrback(function(err){_93._io=null;err=_83.mixin(new Error(),err);err.message="Unable to load resource: "+_93.url+" "+(err.message||"");_93._fireUpdateEnd(err);_93.onError(err);});},_initLayer:function(_96){if(this.loaded){this._removeInternalLayers();}this.name=_96.name;this.description=_96.description;this.snippet=_96.snippet;if(_96.visibility!==undefined){this.defaultVisibility=this.visible=!!_96.visibility;}else{this.defaultVisibility=this.visible=true;}this.featureInfos=_96.featureInfos;this.fullExtent=this.initialExtent=new _89(_96.lookAtExtent);this.copyright=_96.author||_96.copyright;var _97;var _98=_83.getObject("featureCollection.layers",false,_96);if(_98&&_98.length>0){this._fLayers=[];_84.forEach(_98,function(_99,i){var _9a=_83.getObject("featureSet.features",false,_99),_9b;if(_9a&&_9a.length>0){_97=_83.mixin({outFields:["*"],infoTemplate:_99.popupInfo?new _8e(_99.popupInfo):null,editable:false},this._options);if(_97.id){_97.id=_97.id+"_"+i;}_99.layerDefinition.capabilities="Query,Data";_9b=new _8d(_99,_97);if(_9b.geometryType){this["_"+_9b.geometryType]=_9b;}this._fLayers.push(_9b);}},this);if(this._fLayers.length===0){delete this._fLayers;}}this.items=[];if(this._esriGeometryPoint){this.items=this.items.concat(this._esriGeometryPoint.graphics);if(this.pointSymbol){var _9c=new _8b(this.pointSymbol);this._esriGeometryPoint.setRenderer(_9c);}}if(this._esriGeometryPolyline){this.items=this.items.concat(this._esriGeometryPolyline.graphics);if(this.polylineSymbol){var _9d=new _8b(this.polylineSymbol);this._esriGeometryPolyline.setRenderer(_9d);}}if(this._esriGeometryPolygon){this.items=this.items.concat(this._esriGeometryPolygon.graphics);if(this.polygonSymbol){var _9e=new _8b(this.polygonSymbol);this._esriGeometryPolygon.setRenderer(_9e);}}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();var _9f=map.spatialReference,_a0=this._outSR,_a1;if(_9f.wkid){_a1=(_9f._isWebMercator()&&_a0._isWebMercator())||(_9f.wkid===_a0.wkid);}else{if(_9f.wkt){_a1=(_9f.wkt===_a0.wkt);}else{return;}}if(!_a1){if(_9f._isWebMercator()&&_a0.wkid===4326){this._converter=_8a.geographicToWebMercator;}else{if(_a0._isWebMercator()&&_9f.wkid===4326){this._converter=_8a.webMercatorToGeographic;}else{return;}}}var _a2=this._fLayers;if(_a2&&_a2.length>0){_84.forEach(_a2,function(_a3){if(this._converter){var _a4=_a3.graphics,i,_a5,len=_a4?_a4.length:0;for(i=0;i<len;i++){_a5=_a4[i].geometry;if(_a5){_a4[i].setGeometry(this._converter(_a5));}}}map.addLayer(_a3);},this);}this.setVisibility(this.visible);},_removeInternalLayers:function(){var map=this._map;if(map){_84.forEach(this.getFeatureLayers(),map.removeLayer,map);}},onVisibilityChange:function(_a6){this._fireUpdateStart();_84.forEach(this.getFeatureLayers(),function(_a7){_a7.setVisibility(_a6);});this._fireUpdateEnd();},_setMap:function(map,_a8){this.inherited(arguments);this._map=map;var div=this._div=_85.create("div",null,_a8);_86.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_a9){if(this._io){this._io.cancel();}_82.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_a9.removeChild(div);_85.destroy(div);}this._div=null;this.inherited(arguments);}});if(has("extend-esri")){_83.setObject("layers._ServiceGeneratedFeatureCollection",_8f,_87);}return _8f;});},"esri/layers/KMLGroundOverlay":function(){define("esri/layers/KMLGroundOverlay",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/layers/MapImage"],function(_aa,_ab,has,_ac,_ad,_ae){var _af=_aa([_ae],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(_b0){if(_ad.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){_ab.setObject("layers.KMLGroundOverlay",_af,_ac);}return _af;});},"dojo/data/util/simpleFetch":function(){define("dojo/data/util/simpleFetch",["../../_base/lang","../../_base/kernel","./sorter"],function(_b1,_b2,_b3){var _b4={};_b1.setObject("dojo.data.util.simpleFetch",_b4);_b4.errorHandler=function(_b5,_b6){if(_b6.onError){var _b7=_b6.scope||_b2.global;_b6.onError.call(_b7,_b5,_b6);}};_b4.fetchHandler=function(_b8,_b9){var _ba=_b9.abort||null,_bb=false,_bc=_b9.start?_b9.start:0,_bd=(_b9.count&&(_b9.count!==Infinity))?(_bc+_b9.count):_b8.length;_b9.abort=function(){_bb=true;if(_ba){_ba.call(_b9);}};var _be=_b9.scope||_b2.global;if(!_b9.store){_b9.store=this;}if(_b9.onBegin){_b9.onBegin.call(_be,_b8.length,_b9);}if(_b9.sort){_b8.sort(_b3.createSortFunction(_b9.sort,this));}if(_b9.onItem){for(var i=_bc;(i<_b8.length)&&(i<_bd);++i){var _bf=_b8[i];if(!_bb){_b9.onItem.call(_be,_bf,_b9);}}}if(_b9.onComplete&&!_bb){var _c0=null;if(!_b9.onItem){_c0=_b8.slice(_bc,_bd);}_b9.onComplete.call(_be,_c0,_b9);}};_b4.fetch=function(_c1){_c1=_c1||{};if(!_c1.store){_c1.store=this;}this._fetchItems(_c1,_b1.hitch(this,"fetchHandler"),_b1.hitch(this,"errorHandler"));return _c1;};return _b4;});},"esri/layers/KMLLayer":function(){define("esri/layers/KMLLayer",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/sniff","dojo/io-query","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/dijit/PopupTemplate","esri/layers/layer","esri/layers/KMLFolder","esri/layers/KMLGroundOverlay","esri/layers/MapImageLayer","esri/layers/FeatureLayer"],function(_c2,_c3,_c4,_c5,_c6,_c7,has,ioq,_c8,_c9,_ca,_cb,_cc,_cd,_ce,_cf,_d0,_d1,_d2,_d3,_d4,_d5){var _d6=_c3([_d1],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(url,_d7){if(!url){}this._outSR=(_d7&&_d7.outSR)||new _ce({wkid:4326});this._options=_d7;if(_cb.defaults.kmlService){this.serviceUrl=_cb.defaults.kmlService;}var _d8=(this.linkInfo=_d7&&_d7.linkInfo);if(_d8){this.visible=!!_d8.visibility;this._waitingForMap=!!_d8.viewFormat;}if(!_d8||(_d8&&_d8.visibility&&!this._waitingForMap)){this._parseKml();}this.refresh=_c5.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",true);},getFeature:function(_d9){if(!_d9){return;}var _da=_d9.type,id=_d9.id,_db,i,len;switch(_da){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var _dc=this["_"+_da];if(_dc){_db=_c5.getObject("_mode._featureMap."+id,false,_dc);}break;case "GroundOverlay":var _dd=this._groundLyr;if(_dd){var _de=_dd.getImages();len=_de.length;for(i=0;i<len;i++){if(_de[i].id===id){_db=_de[i];break;}}}break;case "ScreenOverlay":break;case "NetworkLink":_c6.some(this._links,function(_df){if(_df.linkInfo&&_df.linkInfo.id===id){_db=_df;return true;}else{return false;}});break;case "Folder":var _e0=this.folders;len=_e0?_e0.length:0;for(i=0;i<len;i++){if(_e0[i].id===id){_db=_e0[i];break;}}break;default:undefined;break;}return _db;},getLayers:function(){var _e1=[];if(this._groundLyr){_e1.push(this._groundLyr);}if(this._fLayers){_e1=_e1.concat(this._fLayers);}if(this._links){_c6.forEach(this._links,function(_e2){if(_e2.declaredClass){_e1.push(_e2);}});}return _e1;},setFolderVisibility:function(_e3,_e4){if(!_e3){return;}this._fireUpdateStart();_e3.visible=_e4;if(_e4){_e4=this._areLocalAncestorsVisible(_e3);}this._setState(_e3,_e4);this._fireUpdateEnd();},onRefresh:function(){},_parseKml:function(map){var _e5=this;this._fireUpdateStart();this._io=_cd({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(map),model:"simple",folders:"",refresh:this.loaded?true:undefined,outSR:_c7.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(_e6){_e5._io=null;_e5._initLayer(_e6);},error:function(err){_e5._io=null;err=_c5.mixin(new Error(),err);err.message="Unable to load KML: "+_e5.url+" "+(err.message||"");_e5._fireUpdateEnd(err);_e5.onError(err);}});},_initLayer:function(_e7){if(this.loaded){this._removeInternalLayers();}this.name=_e7.name;this.description=_e7.description;this.snippet=_e7.snippet;this.visibility=_e7.visibility;this.featureInfos=_e7.featureInfos;var i,len;var _e8=(this.folders=_e7.folders),_e9=[],_ea;if(_e8){len=_e8.length;for(i=0;i<len;i++){_ea=(_e8[i]=new _d2(_e8[i]));if(_ea.parentFolderId===-1){_e9.push(_ea);}}}var _eb=(this._links=_e7.networkLinks),_ec;len=_eb?_eb.length:0;for(i=0;i<len;i++){if(_eb[i].viewRefreshMode&&_eb[i].viewRefreshMode.toLowerCase().indexOf("onregion")!==-1){continue;}_ec=_c5.mixin({},this._options);_ec.linkInfo=_eb[i];if(_ec.id){_ec.id=_ec.id+"_"+i;}_eb[i]=new _d6(_eb[i].href,_ec);_eb[i]._parentLayer=this;_eb[i]._parentFolderId=this._getLinkParentId(_eb[i].linkInfo.id);}var _ed=_e7.groundOverlays;if(_ed&&_ed.length>0){_ec=_c5.mixin({},this._options);if(_ec.id){_ec.id=_ec.id+"_"+"mapImage";}var _ee=(this._groundLyr=new _d4(_ec));len=_ed.length;for(i=0;i<len;i++){_ee.addImage(new _d3(_ed[i]));}}var _ef=_c5.getObject("featureCollection.layers",false,_e7);if(_ef&&_ef.length>0){this._fLayers=[];_c6.forEach(_ef,function(_f0,i){var _f1=_c5.getObject("featureSet.features",false,_f0),_f2;if(_f1&&_f1.length>0){_ec=_c5.mixin({outFields:["*"],infoTemplate:_f0.popupInfo?new _d0(_f0.popupInfo):null,editable:false},this._options);if(_ec.id){_ec.id=_ec.id+"_"+i;}_f0.layerDefinition.capabilities="Query,Data";_f2=new _d5(_f0,_ec);if(_f2.geometryType){this["_"+_f2.geometryType]=_f2;}this._fLayers.push(_f2);}},this);if(this._fLayers.length===0){delete this._fLayers;}}len=_e9.length;for(i=0;i<len;i++){_ea=_e9[i];this._setState(_ea,_ea.visible);}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}else{this.loaded=true;this.onLoad(this);}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();if(this._links){_c6.forEach(this._links,function(_f3){if(_f3.declaredClass){map.addLayer(_f3);if(_f3._waitingForMap){_f3._waitingForMap=null;if(_f3.visible){_f3._parseKml(map);}else{_f3._wMap=map;}}}});}var _f4=map.spatialReference,_f5=this._outSR,_f6;if(!_f4.equals(_f5)){if(_f4.isWebMercator()&&_f5.wkid===4326){_f6=_cf.geographicToWebMercator;}else{if(_f5.isWebMercator()&&_f4.wkid===4326){_f6=_cf.webMercatorToGeographic;}else{return;}}}if(this._groundLyr){if(_f6){_c6.forEach(this._groundLyr.getImages(),function(_f7){_f7.extent=_f6(_f7.extent);});}map.addLayer(this._groundLyr);}var _f8=this._fLayers;if(_f8&&_f8.length>0){_c6.forEach(_f8,function(_f9){if(_f6){var _fa=_f9.graphics,i,_fb,len=_fa?_fa.length:0;for(i=0;i<len;i++){_fb=_fa[i].geometry;if(_fb){_fa[i].setGeometry(_f6(_fb));}}}map.addLayer(_f9);});}this.onVisibilityChange(this.visible);},_removeInternalLayers:function(){var map=this._map;if(this._links){_c6.forEach(this._links,function(_fc){if(_fc.declaredClass&&_fc._io){_fc._io.cancel();}});}if(map){_c6.forEach(this.getLayers(),map.removeLayer,map);}},_setState:function(_fd,_fe){var _ff=_fd.featureInfos,info,_100,i,len=_ff?_ff.length:0,_101=_fe?"show":"hide";for(i=0;i<len;i++){info=_ff[i];_100=this.getFeature(info);if(!_100){continue;}if(info.type==="Folder"){this._setState(_100,_fe&&_100.visible);}else{if(info.type==="NetworkLink"){this._setInternalVisibility(_100,_fe);}else{_100[_101]();}}}},_areLocalAncestorsVisible:function(_102){var _103=_102.parentFolderId,_104=_102.visible;while(_104&&_103!==-1){var _105=this.getFeature({type:"Folder",id:_103});_104=_104&&_105.visible;_103=_105.parentFolderId;}return _104;},_setInternalVisibility:function(_106,_107){var _108=_106._parentLayer,_109=_106._parentFolderId;_107=_107&&_106.visible;while(_107&&_108){_107=_107&&_108.visible;if(_109>-1){_107=_107&&_108._areLocalAncestorsVisible(_108.getFeature({type:"Folder",id:_109}));}_109=_108._parentFolderId;_108=_108._parentLayer;}this._setIntState(_106,_107);},_setIntState:function(link,_10a){if(!link){return;}_c6.forEach(link.getLayers(),function(_10b){if(_10b.linkInfo){link._setIntState(_10b,_10a&&_10b.visible&&link._areLocalAncestorsVisible(link.getFeature({type:"Folder",id:_10b._parentFolderId})));}else{_10b.setVisibility(_10a);}});},_getLinkParentId:function(id){var _10c=-1;if(this.folders){_c6.some(this.folders,function(_10d){if(_10d.networkLinkIds&&_c6.indexOf(_10d.networkLinkIds,id)!==-1){_10c=_10d.id;return true;}return false;});}return _10c;},_checkAutoRefresh:function(){var _10e=this.linkInfo;if(_10e){if(this.visible){if(this.loaded&&this._map){var _10f=_10e.refreshMode,_110=_10e.refreshInterval,_111=_10e.viewRefreshMode,_112=_10e.viewRefreshTime;if(_10f&&_10f.toLowerCase().indexOf("oninterval")!==-1&&_110>0){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,_110*1000);}if(_111&&_111.toLowerCase().indexOf("onstop")!==-1&&_112>0){if(!this._extChgHandle){this._extChgHandle=_c4.connect(this._map,"onExtentChange",this,this._extentChanged);}}}}else{this._stopAutoRefresh();_c4.disconnect(this._extChgHandle);delete this._extChgHandle;}}},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null;},_getQueryParameters:function(map){map=map||this._map;var _113={},_114=this.linkInfo,_115=map&&map.extent,_116;if(this._url.query){_c5.mixin(_113,this._url.query);_116=!!this._url.query.token;}if(_ca.id&&!_116){var _117=_ca.id.findCredential(this._url.path);if(_117){_113.token=_117.token;}}if(_114){var _118=_114.viewFormat,_119=_114.httpQuery,_11a=_114.viewBoundScale;if(_115&&_118){var _11b=_115,_11c=_115,sr=_115.spatialReference;if(sr){if(sr.isWebMercator()){_11b=_cf.webMercatorToGeographic(_115);}else{if(sr.wkid===4326){_11c=_cf.geographicToWebMercator(_115);}}}var _11d=_11b.getCenter(),_11e=Math.max(_11c.getWidth(),_11c.getHeight());if(_11a){_11b=_11b.expand(_11a);}_118=_118.replace(/\[bboxWest\]/ig,_11b.xmin).replace(/\[bboxEast\]/ig,_11b.xmax).replace(/\[bboxSouth\]/ig,_11b.ymin).replace(/\[bboxNorth\]/ig,_11b.ymax).replace(/\[lookatLon\]/ig,_11d.x).replace(/\[lookatLat\]/ig,_11d.y).replace(/\[lookatRange\]/ig,_11e).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,_11d.x).replace(/\[lookatTerrainLat\]/ig,_11d.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,_11d.x).replace(/\[cameraLat\]/ig,_11d.y).replace(/\[cameraAlt\]/ig,_11e).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,map.width).replace(/\[vertPixels\]/ig,map.height).replace(/\[terrainEnabled\]/ig,0);_c5.mixin(_113,ioq.queryToObject(_118));}if(_119){_119=_119.replace(/\[clientVersion\]/ig,_ca.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,_c2.locale);_c5.mixin(_113,ioq.queryToObject(_119));}}var _11f=[],_120;for(_120 in _113){if(_cc.isDefined(_113[_120])){_11f.push(_120+"="+_113[_120]);}}_11f=_11f.join("&");return _11f?("?"+_11f):"";},_setMap:function(map,_121){this._map=map;var div=this._div=_c8.create("div",null,_121);_c9.set(div,"position","absolute");this._addInternalLayers();return div;},_unsetMap:function(map,_122){if(this._io){this._io.cancel();}this._stopAutoRefresh();_c4.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_122.removeChild(div);_c8.destroy(div);}this._map=this._wMap=this._div=null;},onVisibilityChange:function(_123){if(!this.loaded){if(this.linkInfo&&_123){if(!this._waitingForMap){this._parseKml(this._wMap);}}return;}this._fireUpdateStart();this._setInternalVisibility(this,_123);this._checkAutoRefresh();this._fireUpdateEnd();},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._parseKml();},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,this.linkInfo.viewRefreshTime*1000);}});if(has("extend-esri")){_c5.setObject("layers.KMLLayer",_d6,_ca);}return _d6;});},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(lang){var _124={};lang.setObject("dojo.data.util.sorter",_124);_124.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_124.createSortFunction=function(_125,_126){var _127=[];function _128(attr,dir,comp,s){return function(_129,_12a){var a=s.getValue(_129,attr);var b=s.getValue(_12a,attr);return dir*comp(a,b);};};var _12b;var map=_126.comparatorMap;var bc=_124.basicComparator;for(var i=0;i<_125.length;i++){_12b=_125[i];var attr=_12b.attribute;if(attr){var dir=(_12b.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_127.push(_128(attr,dir,comp,_126));}}return function(rowA,rowB){var i=0;while(i<_127.length){var ret=_127[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _124;});},"esri/layers/OnDemandMode":function(){define("esri/layers/OnDemandMode",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/geometry/Point","esri/tasks/query","esri/layers/RenderMode","esri/layers/GridLayout"],function(_12c,_12d,lang,_12e,has,_12f,_130,_131,_132,_133){var _134=_12c([_132],{declaredClass:"esri.layers._OnDemandMode",constructor:function(_135){this.featureLayer=_135;this._featureMap={};this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},initialize:function(map){this.inherited(arguments);var _136=this.featureLayer,_137=_136._srInfo;this._gridLayer=new _133(new _130(_137?_137.valid[0]:map.extent.xmin,map.extent.ymax,map.spatialReference),{width:_136._tileWidth,height:_136._tileHeight},{width:map.width,height:map.height},_137);this._cellMap={};this._gridLayer.setResolution(map.extent);},startup:function(){this._ioQueue=[];if(!this.featureLayer.suspended){this._zoomHandler();this._enableConnectors();}},propertyChangeHandler:function(type){if(this._init){if(type<2){this._zoomHandler();}else{}}},destroy:function(){this._disableConnectors();this.inherited(arguments);},drawFeature:function(_138){var _139=this._gridLayer,geom=_138.geometry,_13a=[];if(!geom){return;}_13a=_139.getCellsInExtent((geom.type==="point")?{xmin:geom.x,ymin:geom.y,xmax:geom.x,ymax:geom.y}:geom.getExtent(),false).cells;var _13b=this._cellMap,i,cell,oid=_138.attributes[this.featureLayer.objectIdField],_13c,row,col;for(i=0;i<_13a.length;i++){cell=_13a[i];_13c=cell.latticeID;row=cell.row;col=cell.col;if(_13c){cell=(_13b[_13c]=(_13b[_13c]||cell));}else{_13b[row]=_13b[row]||{};cell=(_13b[row][col]=(_13b[row][col]||cell));}cell.features=cell.features||[];cell.features.push(_138);this._addFeatureIIf(oid,_138);this._incRefCount(oid);}},suspend:function(){if(!this._init){return;}this._disableConnectors();},resume:function(){if(!this._init){return;}this._enableConnectors();this._zoomHandler();},refresh:function(){this._zoomHandler();},_enableConnectors:function(){var map=this.map;this._zoomConnect=_12d.connect(map,"onZoomEnd",this,this._zoomHandler);this._panConnect=_12d.connect(map,"onPanEnd",this,this._panHandler);this._resizeConnect=_12d.connect(map,"onResize",this,this._panHandler);},_disableConnectors:function(){_12d.disconnect(this._zoomConnect);_12d.disconnect(this._panConnect);_12d.disconnect(this._resizeConnect);},_zoomHandler:function(){this._processIOQueue(true);var _13d=this.featureLayer,map=this.map;if(_13d.suspended){return;}_13d._fireUpdateStart();this._clearIIf();var _13e=_13d._trackManager;if(_13e){_13e.clearTracks();}this._cellMap={};this._gridLayer.setResolution(map.extent);this._sendRequest();},_panHandler:function(){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&arguments[0]);},_getRequestId:function(_13f,cell){var id="_"+_13f.name+_13f.layerId+_13f._ulid+"_"+cell.resolution+"_"+(cell.latticeID||(cell.row+"_"+cell.col));return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_sendRequest:function(_140){this._exceeds=false;var _141=this.featureLayer,map=this.map,_142=_140||map.extent,_143=this._gridLayer.getCellsInExtent(_142,_141.latticeTiling),_144=_143.cells;if(!_141.isEditable()){var _145=this._cellMap;_144=_12e.filter(_144,function(cell){if(cell.lattice){if(_145[cell.latticeID]){return false;}}else{if(_145[cell.row]&&_145[cell.row][cell.col]){return false;}}return true;});}var _146=_141.getOutFields(),_147=_141.getDefinitionExpression(),time=_141._getOffsettedTE(_141._mapTimeExtent),_148=_141._usePatch,_149=this._ioQueue,i,self=this,func=this._drawFeatures,cell,_14a,_14b;this._pending=this._pending||0;for(i=0;i<_144.length;i++){cell=_144[i];_14a=new _131();_14a.geometry=cell.extent||cell.lattice;_14a.outFields=_146;_14a.where=_147;if(_141.latticeTiling&&cell.extent){_14a.spatialRelationship=_131.SPATIAL_REL_CONTAINS;}_14a.returnGeometry=true;_14a.timeExtent=time;_14a.maxAllowableOffset=_141._maxOffset;if(_141._ts){_14a._ts=(new Date()).getTime();}_14b=null;if(_148){_14b=this._getRequestId(_141,cell);if(this._isPending(_14b)){continue;}}this._pending++;_149.push(_141._task.execute(_14a,function(){var _14c=cell;return function(_14d){func.apply(self,[_14d,_14c]);};}.call(this),this._queryErrorHandler,_14b));}this._removeOldCells(_142);this._endCheck();},_drawFeatures:function(_14e,cell){this._exceeds=this._exceeds||_14e.exceededTransferLimit;this._finalizeIO();var _14f=this.featureLayer,map=this.map,_150=map.extent,_151=cell.extent,row=cell.row,col=cell.col,_152=_14f.objectIdField,_153=_14e.features,_154=this._gridLayer,_155=this._cellMap,i,len,_156=cell.latticeID,_157=_156?_155[_156]:(_155[row]&&_155[row][col]);if((cell.resolution!=_154._resolution)||(_156?(_156!==_154.getLatticeID(_150)):(!_154.intersects(_151,_150)))){if(_157){this._removeCell(row,col,_156);}}else{if(_157){this._updateCell(_157,_153);}else{cell.features=_153;if(_156){_155[_156]=cell;}else{_155[row]=_155[row]||{};_155[row][col]=cell;}len=_153.length;for(i=0;i<len;i++){var _158=_153[i];var oid=_158.attributes[_152];this._addFeatureIIf(oid,_158);this._incRefCount(oid);}}}this._endCheck();},_queryErrorHandler:function(err){this._finalizeIO();this.featureLayer._errorHandler(err);this._endCheck(true);},_finalizeIO:function(){this._purgeRequests();this._pending--;},_endCheck:function(_159){if(this._pending===0){this._processIOQueue();var _15a=this.featureLayer,_15b=_15a._trackManager;if(_15b){_15b.clearTracks();_15b.addFeatures(_15a.graphics);if(_15a._ager){_12e.forEach(_15a.graphics,function(_15c){if(_15c._shape){_15a._repaint(_15c);}});}_15b.moveLatestToFront();_15b.drawTracks();}this.featureLayer._fireUpdateEnd(_159&&new Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:true}:null);if(this._exceeds){_15a.onQueryLimitExceeded();}}},_processIOQueue:function(_15d){this._ioQueue=_12e.filter(this._ioQueue,function(dfd){var keep=dfd.fired>-1?false:true;return keep;});if(_15d){_12e.forEach(this._ioQueue,this._cancelPendingRequest);}},_removeOldCells:function(_15e){var _15f=this._cellMap,_160=this._gridLayer,_161,_162;for(_161 in _15f){if(_15f[_161]){var row=_15f[_161],_163=row.latticeID,_164=0,_165=0;if(_163){_164++;if(_163!==_160.getLatticeID(_15e)){this._removeCell(null,null,_163);_165++;}}else{for(_162 in row){if(row[_162]){_164++;var _166=row[_162].extent;if(!_160.intersects(_166,_15e)){this._removeCell(_161,_162);_165++;}}}}if(_165===_164){delete _15f[_161];}}}},_updateCell:function(cell,_167){var _168=this.featureLayer,_169=_168.objectIdField,_16a=_168._selectedFeatures,i,len=_167.length;cell.features=cell.features||[];for(i=0;i<len;i++){var _16b=_167[i];var oid=_16b.attributes[_169];var _16c=this._addFeatureIIf(oid,_16b);if(_16c===_16b){this._incRefCount(oid);cell.features.push(_16c);}else{if(!(oid in _16a)){_16c.setGeometry(_16b.geometry);_16c.setAttributes(_16b.attributes);}}}},_removeCell:function(row,col,_16d){var _16e=this._cellMap,_16f=this.featureLayer,_170=_16f.objectIdField;var cell=_16d?_16e[_16d]:(_16e[row]&&_16e[row][col]);if(cell){if(_16d){delete _16e[_16d];}else{delete _16e[row][col];}var _171=cell.features,i;for(i=0;i<_171.length;i++){var _172=_171[i];var oid=_172.attributes[_170];this._decRefCount(oid);if(oid in _16f._selectedFeatures){continue;}this._removeFeatureIIf(oid);}}}});if(has("extend-esri")){lang.setObject("layers._OnDemandMode",_134,_12f);}return _134;});},"esri/arcgis/Portal":function(){define("esri/arcgis/Portal",["dojo/_base/declare","dojo/_base/lang","dojo/_base/kernel","dojo/_base/Deferred","dojo/_base/array","dojo/_base/sniff","dojo/Evented","dojo/DeferredList","esri/kernel","esri/lang","esri/request","esri/IdentityManager"],function(_173,lang,_174,_175,_176,has,_177,_178,_179,_17a,_17b){var _17c={"options":{"disableIdentityLookup":true},"requestParams":{"f":"json"}},_17d=function(_17e){if(!_17e){return _17e;}if(_17e.then){_17e=lang.delegate(_17e);}if(!_17e.total){_17e.total=_175.when(_17e,function(_17f){return _17a.isDefined(_17f.total)?_17f.total:(_17f.length||0);});}function _180(_181){if(!_17e[_181]){_17e[_181]=function(){var args=arguments;return _175.when(_17e,function(_182){Array.prototype.unshift.call(args,(_182.results||_182));return _17d(_176[_181].apply(_176,args));});};}};_180("forEach");_180("filter");_180("map");_180("some");_180("every");return _17e;},_183={useSSL:function(_184,url){return (_184.indexOf("https:")!==-1||(_17c.self&&_17c.self.allSSL))?url.replace("http:","https:"):url;},formatUrl:function(url){var _185=_17c.loggedInUser&&_17c.loggedInUser.credential&&_17c.loggedInUser.credential.token;return url.indexOf("null")!==-1?null:_183.useSSL(window.location.protocol,(_185?url+(url.indexOf("?")!==-1?"&":"?")+("token="+_185):url));},resultsToTypedArray:function(type,_186,_187){_187=_187?(_187.listings||_187.notifications||_187.userInvitations||_187.tags||_187.items||_187.groups||_187.comments||_187.results||_187):[];return _176.map(_187,function(_188){_188=lang.mixin(_188,_186||{});return type?new type(_188):_188;});},clearFieldsFromObject:function(flds,obj){var fld,i,l=flds.length;if(!lang.isArray(flds)){for(fld in flds){delete obj[fld];}}else{for(i=0;i<l;i++){delete obj[flds[i]];}}return obj;},requestToTypedArray:function(url,_189,_18a,type,_18b){return _17d(_183.request(url,_189,_18a).then(lang.partial(_183.resultsToTypedArray,type,_18b)));},request:function(url,_18c,_18d){_18c&&_18c.portal&&delete _18c.portal;var _18e=lang.mixin(lang.mixin({},_18c||{}),_17c.requestParams);var _18f=lang.mixin(_18d||{},_17c.options);return _17b({url:_183.useSSL(window.location.protocol,(url.url||url)),content:_18e,callbackParamName:"callback",timeout:(_18f&&_18f.timeout)||0},_18f);},formatQueryParams:function(_190,_191,_192){var qp=lang.mixin(lang.mixin({},_190),(lang.isString(_191)?{"q":_191}:(_191||{})));qp.q=!_192&&_17c.extraQuery?"("+qp.q+")"+_17c.extraQuery:qp.q;return qp;}},_193=_173([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(_194){lang.mixin(this,_194);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null;}}),_195=_173([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(_196){lang.mixin(this,_196);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null;}}),_197=_173([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(_198){lang.mixin(this,_198);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.itemUrl.replace("content",("content/users/"+this.owner)+(this.folderId?"/"+this.folderId:""));this.itemDataUrl=_183.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=_183.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null;},addComment:function(_199){var _19a=lang.isString(_199)?{"comment":_199}:_199;return _183.request(this.itemUrl+"/addComment",_19a,{"usePost":true}).then(lang.hitch(this,function(_19b){return _193(lang.mixin(_19a,{"id":_19b.commentId,"item":this}));}));},updateComment:function(_19c){if(_19c&&_19c.url&&_19c.comment){var _19d={"comment":_19c.comment};return _183.request(_19c.url+"/update",_19d,{"usePost":true}).then(function(_19e){_19c.id=_19e.commentId;return _19c;});}else{throw new Error();}},getComments:function(){return _183.requestToTypedArray(this.itemUrl+"/comments",null,null,_193,{"item":this});},deleteComment:function(_19f){if(_19f&&_19f.url){return _183.request(_19f.url+"/delete",null,{"usePost":true});}else{throw new Error();}},addRating:function(_1a0){var _1a1=lang.isObject(_1a0)?_1a0:{"rating":parseFloat(_1a0)};return _183.request(this.itemUrl+"/addRating",_1a1,{"usePost":true}).then(lang.hitch(this,function(_1a2){return new _195(lang.mixin(_1a1,{"id":_1a2.ratingId,"item":this}));}));},getRating:function(){return _183.request(this.itemUrl+"/rating").then(lang.hitch(this,function(_1a3){return new _195(lang.mixin(_1a3,{"item":this}));}));},deleteRating:function(){return _183.request(this.itemUrl+"/deleteRating",null,{"usePost":true});}}),_1a4=_173([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(_1a5){lang.mixin(this,_1a5);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.created=this.created?new Date(this.created):null;this.banner=_183.formatUrl(this.url+"/info/"+this.banner);this.thumbnail=_183.formatUrl(this.url+"/info/"+this.thumbnail);this.largeThumbnail=_183.formatUrl(this.url+"/info/"+this.largeThumbnail);this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.commentsUrl=(this.portal&&this.portal.portalUrl)+"/content/items/"+this.itemId+"/comments";this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:false,trialDuration:0,listingAccess:"private"};for(var prop in this.listingProperties){if(this[prop]){this.listingProperties[prop]=this[prop];}}this.properties=this.properties||{"systemRequirements":"","termsAndConditions":"","version":"1.0"};this.screenshots=_176.map(this.screenshots,lang.hitch(this,function(_1a6){return _183.formatUrl(this.url+"/info/"+_1a6);}));this.vendor.vendorPhone=this.vendor.vendorPhone;this.vendor.vendorEmail=this.vendor.vendorEmail;this.vendor.vendorUrl=this.vendor.vendorUrl;this.vendor.description=this.vendor.description;this.vendor.thumbnail=this.userItemUrl?_183.formatUrl(this.portal.portalUrl+"/accounts/self/resources/"+this.vendor.thumbnail):_183.formatUrl(this.url+"/info/"+this.vendor.thumbnail);},getComments:function(){return _183.requestToTypedArray(this.commentsUrl,null,null,_193,{"item":this});},getVendor:function(){return this.vendor;}}),_1a7=_173([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(_1a8){lang.mixin(this,_1a8);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&this.endDate!==-1?new Date(this.endDate):null;this.listing=_1a8.listing?new _1a4(lang.mixin(_1a8.listing,{"portal":this.portal})):null;}}),_1a9=_173([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(_1aa){lang.mixin(this,_1aa);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=_183.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null;},getMembers:function(){return _183.request(this.url+"/users");},queryItems:function(_1ab){_1ab=_183.formatQueryParams({},_1ab);_1ab.q="group:"+this.id+(_1ab.q?(" "+_1ab.q):"");return this.portal.queryItems(_1ab);}}),_1ac=_173([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(_1ad){lang.mixin(this,_1ad);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null;},getItems:function(){return _183.requestToTypedArray(this.url,null,null,_197,{"portal":this.portal,"folderId":this.id});}}),_1ae=_173([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(_1af){lang.mixin(this,_1af);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=_183.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null;},getGroups:function(){return _17d(_183.request(this.url).then(lang.hitch(this,function(_1b0){return _183.resultsToTypedArray(_1a9,{"portal":this.portal},_1b0.groups);})));},getNotifications:function(){return _183.requestToTypedArray(this.url+"/notifications",null,null,null,{"portal":this.portal});},getGroupInvitations:function(){return _183.requestToTypedArray(this.url+"/invitations",null,null,null,{"portal":this.portal});},getTags:function(){return _183.requestToTypedArray(this.url+"/tags",null,null,null,{"portal":this.portal});},getFolders:function(){return _17d(this.getContent().then(function(_1b1){return _1b1.folders;}));},getItems:function(_1b2){return _17d(this.getContent(_1b2).then(function(_1b3){return _1b3.items;}));},getItem:function(_1b4){var url=this.portal.portalUrl+"content/items/"+_1b4;return _183.request(url).then(lang.hitch(this,function(item){return new _197(lang.mixin(item,{"portal":this.portal}));}));},getContent:function(_1b5){var url=(this.url.replace("community","content"))+(_1b5?("/"+_1b5):"");return _183.request(url).then(lang.hitch(this,function(_1b6){_1b6.folders=_183.resultsToTypedArray(_1ac,{"portal":this.portal},_1b6.folders);_1b6.items=_183.resultsToTypedArray(_197,{"portal":this.portal,"folderId":_1b5},_1b6.items);return _1b6;}));}}),_1b7=_173([_177],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},constructor:function(url){lang.mixin(this,{"url":url});this.init(url).then(lang.hitch(this,function(){this.emit("ready",this);this.onLoad(this);}));},init:function(url,_1b8){url=(url||this.portalUrl).replace(/\/+$/,"");var idx=url.indexOf("/sharing");this.portalUrl=(idx!==-1?(url+"/"):(url+"/sharing/rest/"));return this._getSelf(this.portalUrl).then(lang.hitch(this,function(_1b9){_17c.self=lang.mixin({},_1b9);var _1ba=_1b9.user;if(_1ba){_1ba.portal=this;_1ba=new _1ae(_1ba);_17c.loggedInUser=lang.mixin({},lang.mixin(_1ba,{"credential":_1b8}));}if(_17c.self.id&&_17c.self.canSearchPublic===false){_17c.extraQuery=" AND orgid:"+_17c.self.id;}lang.mixin(this,_17c.self);this.thumbnailUrl=_183.formatUrl(this.portalUrl+"accounts/self/resources/"+this.thumbnail);this.isOrganization=(this.access&&this.access.length)||false;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this;}));},signIn:function(){if(_17c&&_17c.loggedInUser){var dfd=new _175();dfd.resolve(_17c.loggedInUser);return dfd;}else{_17c.options.disableIdentityLookup=false;return _179.id.getCredential(this.portalUrl).then(lang.hitch(this,"init",this.url)).then(function(){return _17c.loggedInUser;},function(_1bb){_17c.options.disableIdentityLookup=true;throw _1bb;});}},signOut:function(){_17c.loggedInUser.credential&&_17c.loggedInUser.credential.destroy();_17c.loggedInUser=null;_17c.options.disableIdentityLookup=true;_183.clearFieldsFromObject(_17c.self,this);_17c.self=null;return this.init(this.url);},getPortalUser:function(){return _17c.loggedInUser;},addResource:function(_1bc,_1bd){var _1be={"key":_1bc,"text":_1bd};return _183.request((this.portalUrl+"portals/self/addResource"),_1be,{"usePost":true});},update:function(_1bf){return _183.request((this.portalUrl+"portals/self/update"),_1bf,{"usePost":true});},queryGroups:function(_1c0){return this._queryPortal(this.portalUrl+"community/groups",_183.formatQueryParams({},_1c0),_1a9);},queryItems:function(_1c1){return this._queryPortal(this.portalUrl+"search",_183.formatQueryParams({},_1c1),_197);},queryListings:function(_1c2){var qp=_183.formatQueryParams({},_1c2,true),qs="";if(qp.q&&qp.q.toLowerCase().indexOf("mylistings:true")>-1){qp.q=qp.q.toLowerCase().replace("mylistings:true","");qs="?mylistings=true";}return this._queryPortal(this.portalUrl+"content/listings"+qs,qp,_1a4);},getPurchases:function(){return this.getCustomers().then(lang.hitch(this,function(_1c3){return _1c3.purchases;}));},getInterests:function(){return this.getCustomers().then(lang.hitch(this,function(_1c4){return _1c4.interests;}));},getTrials:function(){return this.getCustomers().then(lang.hitch(this,function(_1c5){return _1c5.trials;}));},getCustomers:function(){var url=((this.portalUrl)+"portals/self/customers");return _183.request(url);},getMyPurchases:function(){return this.getPurchases().then(function(_1c6){return _1c6.purchases;});},getMyInterests:function(){return this.getPurchases().then(function(_1c7){return _1c7.interests;});},getPurchases:function(){var url=((this.portalUrl)+"portals/self/purchases");return _183.request(url).then(lang.hitch(this,function(_1c8){_1c8.interests=_176.map(_1c8.interests,function(item){return lang.mixin(item.provision,{"listing":item.listing});});_1c8.purchases=_176.map(_1c8.purchases,function(item){return lang.mixin(item.provision,{"listing":item.listing});});_1c8.trials=_176.map(_1c8.trials,function(item){return lang.mixin(item.provision,{"listing":item.listing});});_1c8.interests=_183.resultsToTypedArray(_1a7,{"portal":this},_1c8.interests);_1c8.trials=_183.resultsToTypedArray(_1a7,{"portal":this},_1c8.trials);_1c8.purchases=_183.resultsToTypedArray(_1a7,{"portal":this},_1c8.purchases);return _1c8;}));},queryUsers:function(_1c9){return this._queryPortal(this.portalUrl+"community/users",_183.formatQueryParams({"sortField":"username"},_1c9),_1ae);},_getSelf:function(url){var _1ca=url+"accounts/self?"+"culture="+_174.locale;return _183.request(_1ca);},_queryPortal:function(url,_1cb,type){var _1cc=lang.mixin({"num":10,"start":0,"sortField":"title","sortOrder":"asc"},_1cb),_1cd=["start","query","num","nextStart"],dfd=_183.request(url,_1cc).then(lang.hitch(this,function(_1ce){_1ce.results=_183.resultsToTypedArray(type,{"portal":this},_1ce);_1ce.queryParams=lang.mixin({},_1cc);_1ce.nextQueryParams=lang.mixin(_1cc,{"start":_1ce.nextStart});return _183.clearFieldsFromObject(_1cd,_1ce);}));dfd=lang.delegate(dfd);dfd.queryParams=lang.mixin({},_1cc);dfd.nextQueryParams=_175.when(dfd,function(_1cf){return _1cf.nextQueryParams;});return _17d(dfd);}}),_1d0={Portal:_1b7,PortalFolder:_1ac,PortalGroup:_1a9,PortalItem:_197,PortalComment:_193,PortalRating:_195,PortalUtil:_183,PortalResult:_17d,PortalListing:_1a4};if(has("extend-esri")){lang.mixin(lang.getObject("arcgis",true,_179),_1d0);}return _1d0;});},"esriviewer/loader/esrirequires/EsriRequires":function(){define("esriviewer/loader/esrirequires/EsriRequires",["esri/arcgis/utils","esri/layers/FeatureLayer","esri/layers/KMLLayer","esri/layers/MapImageLayer","esri/layers/WMSLayer","esri/dijit/BasemapGallery","esri/dijit/OverviewMap","esri/arcgis/Portal"],function(_1d1){return _1d1([],{});});},"esri/layers/FeatureLayer":function(){define("esri/layers/FeatureLayer",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/date/locale","dojo/sniff","dojo/io-query","dojo/dom-construct","dojo/i18n","esri/kernel","esri/lang","esri/request","esri/deferredUtils","esri/SpatialReference","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/jsonUtils","esri/renderers/SimpleRenderer","esri/renderers/UniqueValueRenderer","esri/renderers/jsonUtils","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/FeatureSet","esri/geometry/Extent","esri/geometry/jsonUtils","esri/geometry/normalizeUtils","esri/layers/GraphicsLayer","esri/layers/Field","esri/layers/TimeInfo","esri/layers/FeatureType","esri/layers/FeatureTemplate","esri/layers/FeatureEditResult","esri/layers/SnapshotMode","esri/layers/OnDemandMode","esri/layers/SelectionMode","esri/layers/TrackManager","dojo/i18n!esri/nls/jsapi","dojo/has!extend-esri?esri/layers/agscommon"],function(_1d2,_1d3,lang,_1d4,_1d5,_1d6,_1d7,has,ioq,_1d8,i18n,_1d9,_1da,_1db,_1dc,_1dd,_1de,_1df,_1e0,_1e1,_1e2,_1e3,_1e4,_1e5,_1e6,_1e7,_1e8,_1e9,_1ea,_1eb,_1ec,_1ed,_1ee,_1ef,_1f0,_1f1,_1f2,_1f3,_1f4){var _1f5=_1d2(_1eb,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(url,_1f6){this.i18n=i18n.getLocalization("esri","jsapi");this._outFields=_1f6&&_1f6.outFields;this._loadCallback=_1f6&&_1f6.loadCallback;var _1f7=_1f6&&_1f6._usePatch;this._usePatch=(_1f7===null||_1f7===undefined)?true:_1f7;this._trackIdField=_1f6&&_1f6.trackIdField;this.objectIdField=_1f6&&_1f6.objectIdField;this._maxOffset=_1f6&&_1f6.maxAllowableOffset;this._optEditable=_1f6&&_1f6.editable;this._optAutoGen=_1f6&&_1f6.autoGeneralize;this.editSummaryCallback=_1f6&&_1f6.editSummaryCallback;this.userId=_1f6&&_1f6.userId;this.userIsAdmin=_1f6&&_1f6.userIsAdmin;this.useMapTime=(_1f6&&_1f6.hasOwnProperty("useMapTime"))?(!!_1f6.useMapTime):true;this.source=_1f6&&_1f6.source;this.gdbVersion=_1f6&&_1f6.gdbVersion;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var ctor=this.constructor,mode=this.mode=(_1da.isDefined(_1f6&&_1f6.mode)?_1f6.mode:ctor.MODE_ONDEMAND);switch(mode){case ctor.MODE_SNAPSHOT:this._mode=new _1f1(this);this._isSnapshot=true;break;case ctor.MODE_ONDEMAND:this._tileWidth=(_1f6&&_1f6.tileWidth)||512;this._tileHeight=(_1f6&&_1f6.tileHeight)||512;this._mode=new _1f2(this);var _1f8=_1f6&&_1f6.latticeTiling;this.latticeTiling=_1f8;break;case ctor.MODE_SELECTION:this._mode=new _1f3(this);this._isSelOnly=true;break;}this._initLayer=lang.hitch(this,this._initLayer);this._selectHandler=lang.hitch(this,this._selectHandler);this._editable=false;if(lang.isObject(url)&&url.layerDefinition){var json=url;this._collection=true;this.mode=ctor.MODE_SNAPSHOT;this._initLayer(json);return this;}this._task=new _1e5(this.url,{source:this.source,gdbVersion:this.gdbVersion});var _1f9=this._url.path;this._fserver=false;if(_1f9.search(/\/FeatureServer\//i)!==-1){this._fserver=true;}var _1fa=_1f6&&_1f6.resourceInfo;if(_1fa){this._initLayer(_1fa);}else{if(this.source){var _1fb={source:this.source.toJson()};this._url.query=lang.mixin(this._url.query,{layer:_1d5.toJson(_1fb)});}if(this.gdbVersion){this._url.query=lang.mixin(this._url.query,{gdbVersion:this.gdbVersion});}_1db({url:_1f9,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}this.registerConnectEvents();},_initLayer:function(_1fc,io){if(_1fc||io){this._json=_1fc;this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_1fc&&_1fc._ssl);if(ssl){this._useSSL();this._task._useSSL();}if(this._collection){this._mode=new _1f1(this);this._isSnapshot=true;this._featureSet=_1fc.featureSet;this._nextId=_1fc.nextObjectId;_1fc=_1fc.layerDefinition;}if(_1fc.hasOwnProperty("capabilities")){var _1fd=(this.capabilities=_1fc.capabilities);if(_1fd&&_1fd.toLowerCase().indexOf("editing")!==-1){this._editable=true;}else{this._editable=false;}}else{if(!this._collection){this._editable=this._fserver;}}if(_1da.isDefined(this._optEditable)){this._editable=this._optEditable;delete this._optEditable;}this._json=_1d5.toJson(this._json);if(this.isEditable()){delete this._maxOffset;}else{if(this.mode!==this.constructor.MODE_SNAPSHOT&&((_1fc.geometryType==="esriGeometryPolyline")||(_1fc.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_1da.isDefined(this._optAutoGen)?this._optAutoGen:(this.mode===this.constructor.MODE_ONDEMAND);delete this._optAutoGen;}}var _1fe=_1fc.effectiveMinScale||_1fc.minScale,_1ff=_1fc.effectiveMaxScale||_1fc.maxScale;if(!this._hasMin&&_1fe){this.setMinScale(_1fe);}if(!this._hasMax&&_1ff){this.setMaxScale(_1ff);}this.layerId=_1fc.id;this.name=_1fc.name;this.description=_1fc.description;this.copyright=_1fc.copyrightText;this.type=_1fc.type;this.geometryType=_1fc.geometryType;this.displayField=_1fc.displayField;this.defaultDefinitionExpression=_1fc.definitionExpression;this.fullExtent=new _1e8(_1fc.extent);this.initialExtent=new _1e8(this.fullExtent.toJson());if(this.fullExtent.spatialReference){this.spatialReference=new _1dd(this.fullExtent.spatialReference.toJson());}this.defaultVisibility=_1fc.defaultVisibility;if((this.geometryType==="esriGeometryPoint")||(this.geometryType==="esriGeometryMultipoint")){this.latticeTiling=false;}this.indexedFields=_1fc.indexedFields;this.maxRecordCount=_1fc.maxRecordCount;this.canModifyLayer=_1fc.canModifyLayer;this.supportsStatistics=_1fc.supportsStatistics;this.supportsAdvancedQueries=_1fc.supportsAdvancedQueries;this.hasLabels=_1fc.hasLabels;this.canScaleSymbols=_1fc.canScaleSymbols;this.supportsRollbackOnFailure=_1fc.supportsRollbackOnFailure;this.syncCanReturnChanges=_1fc.syncCanReturnChanges;this.isDataVersioned=_1fc.isDataVersioned;this.editFieldsInfo=_1fc.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=_1fc.ownershipBasedAccessControlForFeatures;if(this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures){this.creatorField=this.editFieldsInfo.creatorField;}this.relationships=_1fc.relationships;this.allowGeometryUpdates=_1da.isDefined(_1fc.allowGeometryUpdates)?_1fc.allowGeometryUpdates:true;this._isTable=(this.type==="Table");var _200=(this.fields=[]),_201=_1fc.fields,i;for(i=0;i<_201.length;i++){_200.push(new _1ec(_201[i]));}if(!this.objectIdField){this.objectIdField=_1fc.objectIdField;if(!this.objectIdField){_201=_1fc.fields;for(i=0;i<_201.length;i++){var _202=_201[i];if(_202.type==="esriFieldTypeOID"){this.objectIdField=_202.name;break;}}}if(!this.objectIdField){}}if(!_1da.isDefined(this._nextId)){var _203=this.objectIdField,_204=-1;if(this._collection&&_203){var fset=this._featureSet,_205=fset&&fset.features,il=_205?_205.length:0,oid,attr;for(i=0;i<il;i++){attr=_205[i].attributes;oid=attr&&attr[_203];if(oid>_204){_204=oid;}}}this._nextId=(_204+1);}this.globalIdField=_1fc.globalIdField;var _206=(this.typeIdField=_1fc.typeIdField),_207;if(_206){_207=!this._getField(_206)&&this._getField(_206,true);if(_207){this.typeIdField=_207.name;}}this.visibilityField=_1fc.visibilityField;var _208=_1fc.defaultSymbol;if(_208){this.defaultSymbol=_1e1.fromJson(_208);}var _209=this.types=[],_20a=_1fc.types,_20b,_20c,_20d,_20e=this.editFieldsInfo,_20f=_20e&&_20e.creatorField,_210=_20e&&_20e.editorField,fix=(_20f||_210),_211=[];if(_20a){for(i=0;i<_20a.length;i++){_20b=new _1ee(_20a[i]);_20c=_20b.templates;if(fix&&_20c&&_20c.length){_211=_211.concat(_20c);}_209.push(_20b);}}var _212=_1fc.templates,_213,_214=this.templates=[];if(_212){for(i=0;i<_212.length;i++){_213=new _1ef(_212[i]);if(fix){_211.push(_213);}_214.push(_213);}}for(i=0;i<_211.length;i++){_20d=lang.getObject("prototype.attributes",false,_211[i]);if(_20d){if(_20f){delete _20d[_20f];}if(_210){delete _20d[_210];}}}var _215=_1fc.timeInfo;if(_215){this.timeInfo=new _1ed(_215);this._startTimeField=_215.startTimeField;this._endTimeField=_215.endTimeField;if(this._startTimeField&&this._endTimeField){this._twoTimeFields=true;}if(this._trackIdField){_215.trackIdField=this._trackIdField;}else{this._trackIdField=_215.trackIdField;}}this.hasAttachments=(!this._collection&&_1fc.hasAttachments)?true:false;this.htmlPopupType=_1fc.htmlPopupType;var _216=_1fc.drawingInfo,_217;if(!this.renderer){if(_216&&_216.renderer){_217=_216.renderer;this.setRenderer(_1e4.fromJson(_217));if(_217.type==="classBreaks"){this.renderer.setMaxInclusive(true);}if(!this._collection){var _218=_217.type,_219=[];_217=this.renderer;switch(_218){case "simple":_219.push(_217.symbol);break;case "uniqueValue":case "classBreaks":_219.push(_217.defaultSymbol);_219=_219.concat(_1d4.map(_217.infos,function(info){return info.symbol;}));break;}_219=_1d4.filter(_219,_1da.isDefined);var _21a=this._url.path+"/images/",_21b=this._getToken();_1d4.forEach(_219,function(sym){var url=sym.url;if(url){if((url.search(/https?\:/)===-1)&&(url.indexOf("data:")===-1)){sym.url=_21a+url;}if(_21b&&sym.url.search(/https?\:/)!==-1){sym.url+=("?token="+_21b);}}});}}else{if(_208){_20a=this.types;if(_20a.length>0){_217=new _1e3(this.defaultSymbol,this.typeIdField);_1d4.forEach(_20a,function(type){_217.addValue(type.id,type.symbol);});}else{_217=new _1e2(this.defaultSymbol);}this.setRenderer(_217);}else{if(!this._isTable){var _21c;switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":_21c=new _1de();break;case "esriGeometryPolyline":_21c=new _1df();break;case "esriGeometryPolygon":_21c=new _1e0();break;}this.setRenderer(_21c?new _1e2(_21c):null);}}}}var _21d=(_216&&_216.transparency)||0;if(!_1da.isDefined(this.opacity)&&_21d>0){this.opacity=1-(_21d/100);}this.version=_1fc.currentVersion;if(!this.version){var ver;if("capabilities" in _1fc||"drawingInfo" in _1fc||"hasAttachments" in _1fc||"htmlPopupType" in _1fc||"relationships" in _1fc||"timeInfo" in _1fc||"typeIdField" in _1fc||"types" in _1fc){ver=10;}else{ver=9.3;}this.version=ver;}if((has("ie")||has("safari"))&&this.isEditable()&&this.version<10.02){this._ts=true;}this.loaded=true;this._fixRendererFields();this._checkFields();this._updateCaps();var _21e=function(){this.onLoad(this);var _21f=this._loadCallback;if(_21f){delete this._loadCallback;_21f(this);}};if(this._collection){this._fireUpdateStart();var _220=this._featureSet;delete this._featureSet;this._mode._drawFeatures(new _1e7(_220));this._fcAdded=true;_21e.call(this);}else{this._forceIdentity(_21e);}}},setRenderer:function(ren){this.inherited("setRenderer",arguments);var _221=this.renderer;if(_221){this._ager=(_221.declaredClass.indexOf("TemporalRenderer")!==-1&&_221.observationAger&&_221.observationRenderer);var _222=_1d4.filter([_221,_221.observationRenderer,_221.latestObservationRenderer,_221.trackRenderer],_1da.isDefined);var _223=[];_1d4.forEach(_222,function(rnd){if(!lang.isFunction(rnd.attributeField)){_223.push(rnd.attributeField);}_223.push(rnd.attributeField2);_223.push(rnd.attributeField3);},this);this._rendererFields=_1d4.filter(_223,_1da.isDefined);}else{this._ager=false;this._rendererFields=[];}if(this.loaded&&this._rendererFields.length>0){this._fixRendererFields();this._checkFields(this._rendererFields);}if(this.loaded&&this._collection){this._typesDirty=true;}},_setMap:function(map){var div=this.inherited(arguments),mode=this._mode;if(mode){mode.initialize(map);}return div;},_unsetMap:function(map){var mode=this._mode;if(mode){mode.suspend();}if(this._trackManager){this._trackManager.destroy();this._trackManager=null;}_1d3.disconnect(this._zoomConnect);this._zoomConnect=null;this._toggleTime(false);this.inherited("_unsetMap",arguments);},refresh:function(){var mode=this._mode;if(mode){mode.refresh();}},getOutFields:function(){return _1d4.filter(this._getOutFields(),function(_224){return (_224==="*"||!!this._getField(_224));},this);},setEditable:function(_225){if(!this._collection){return this;}if(!this.loaded){this._optEditable=_225;return this;}var _226=this._editable;this._editable=_225;this._updateCaps();if(_226!==_225){this.onCapabilitiesChange();}return this;},getEditCapabilities:function(_227){var _228={"canCreate":false,"canUpdate":false,"canDelete":false};if(!this.loaded||!this.isEditable()){return _228;}var _229=_227&&_227.feature,_22a=_227&&_227.userId,caps=_1d4.map((this.capabilities?this.capabilities.toLowerCase().split(","):[]),lang.trim),_22b=_1d4.indexOf(caps,"editing")>-1,_22c=_22b&&(_1d4.indexOf(caps,"create")>-1),_22d=_22b&&(_1d4.indexOf(caps,"update")>-1),_22e=_22b&&(_1d4.indexOf(caps,"delete")>-1),_22f=this.ownershipBasedAccessControlForFeatures,_230=this.editFieldsInfo,_231=_230&&_230.creatorField,_232=_230&&_230.realm,_233=_229&&_229.attributes,_234=(_233&&_231)?_233[_231]:undefined,_235,_236=!!this.userIsAdmin,_237=!_22f||_236||!!(_22f.allowOthersToUpdate||_22f.allowUpdateToOthers),_238=!_22f||_236||!!(_22f.allowOthersToDelete||_22f.allowDeleteToOthers);if(_236||(_22b&&!(_22c||_22d||_22e))){_22c=_22d=_22e=true;}_235={"canCreate":_22c,"canUpdate":_22d,"canDelete":_22e};if(_234===null){_235.canUpdate=_22d&&_237;_235.canDelete=_22e&&_238;}else{if(_234===""){return _235;}else{if(_234){_22a=_22a||this.getUserId();if(_22a&&_232){_22a=_22a+"@"+_232;}if(_22a.toLowerCase()===_234.toLowerCase()){return _235;}else{_235.canUpdate=_22d&&_237;_235.canDelete=_22e&&_238;}}}}return _235;},getUserId:function(){var _239;if(this.loaded){_239=(this.credential&&this.credential.userId)||this.userId||"";}return _239;},setUserIsAdmin:function(_23a){this.userIsAdmin=_23a;},setEditSummaryCallback:function(_23b){this.editSummaryCallback=_23b;},getEditSummary:function(_23c,_23d,_23e){_23e=_1da.isDefined(_23e)?_23e:(new Date()).getTime();var _23f="",info=this.getEditInfo(_23c,_23d,_23e),_240=(_23d&&_23d.callback)||this.editSummaryCallback;if(_240){info=_240(_23c,info)||"";}if(lang.isString(info)){_23f=info;}else{if(info){var _241=info.action,_242=info.userId,_243=info.timeValue,_244=0;if(_241){_244++;}if(_242){_244++;}if(_1da.isDefined(_243)){_244++;}if(_244>1){_23f=(_241==="edit"?"edit":"create")+(_242?"User":"")+(_1da.isDefined(_243)?info.displayPattern:"");}}_23f=_23f&&_1da.substitute(info,this.i18n.layers.FeatureLayer[_23f]);}return _23f;},getEditInfo:function(_245,_246,_247){if(!this.loaded){return;}_247=_1da.isDefined(_247)?_247:(new Date()).getTime();var _248=(_246&&_246.action)||"last",_249=this.editFieldsInfo,_24a=_249&&_249.creatorField,_24b=_249&&_249.creationDateField,_24c=_249&&_249.editorField,_24d=_249&&_249.editDateField,_24e=_249&&_249.realm,_24f=_245&&_245.attributes,_250=(_24f&&_24a)?_24f[_24a]:undefined,_251=(_24f&&_24b)?_24f[_24b]:null,_252=(_24f&&_24c)?_24f[_24c]:undefined,_253=(_24f&&_24d)?_24f[_24d]:null,_254=this._getEditData(_250,_251,_247),_255=this._getEditData(_252,_253,_247),_256;switch(_248){case "creation":_256=_254;break;case "edit":_256=_255;break;case "last":_256=_255||_254;break;}if(_256){_256.action=(_256===_255)?"edit":"creation";}return _256;},_getEditData:function(_257,_258,_259){var data,_25a,_25b,_25c=60000,_25d=3600000,_25e=2*_25d,_25f=24*_25d,_260=7*_25f;if(_1da.isDefined(_258)){_25a=_259-_258;if(_25a<0){_25b="Full";}else{if(_25a<_25c){_25b="Seconds";}else{if(_25a<(2*_25c)){_25b="Minute";}else{if(_25a<_25d){_25b="Minutes";}else{if(_25a<_25e){_25b="Hour";}else{if(_25a<_25f){_25b="Hours";}else{if(_25a<_260){_25b="WeekDay";}else{_25b="Full";}}}}}}}}if((_257!==undefined)||_25b){data=data||{};data.userId=_257;if(_25b){var _261=_1d7.format,_262=new Date(_258);data.minutes=Math.floor(_25a/_25c);data.hours=Math.floor(_25a/_25d);data.weekDay=_261(_262,{datePattern:"EEEE",selector:"date"});data.formattedDate=_261(_262,{selector:"date"});data.formattedTime=_261(_262,{selector:"time"});data.displayPattern=_25b;data.timeValue=_258;}}return data;},isEditable:function(){return !!(this._editable||this.userIsAdmin);},setMaxAllowableOffset:function(_263){if(!this.isEditable()){this._maxOffset=_263;}return this;},getMaxAllowableOffset:function(){return this._maxOffset;},setAutoGeneralize:function(_264){if(!this.loaded){this._optAutoGen=_264;}else{if(!this.isEditable()&&(this.mode!==this.constructor.MODE_SNAPSHOT)&&((this.geometryType==="esriGeometryPolyline")||(this.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_264;if(_264){var map=this._map;if(map&&map.loaded){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}else{delete this._maxOffset;}}}return this;},setGDBVersion:function(_265){if(!this._collection&&(_265!==this.gdbVersion)&&(_265||this.gdbVersion)){this.gdbVersion=_265;this._task.gdbVersion=_265;this._url.query=lang.mixin(this._url.query,{gdbVersion:_265});if(this.loaded){this.clearSelection();if(this._map){this.refresh();}}this.onGDBVersionChange();}return this;},setDefinitionExpression:function(expr){this._defnExpr=expr;var mode=this._mode;if(mode){mode.propertyChangeHandler(1);}return this;},getDefinitionExpression:function(){return this._defnExpr;},setTimeDefinition:function(_266){if(this._isSnapshot){this._timeDefn=_266;var mode=this._mode;if(mode){mode.propertyChangeHandler(2);}}else{}return this;},getTimeDefinition:function(){return this._timeDefn;},setTimeOffset:function(_267,_268){this._timeOffset=_267;this._timeOffsetUnits=_268;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}return this;},setUseMapTime:function(use){this.useMapTime=use;this._toggleTime(!this.suspended);var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},selectFeatures:function(_269,_26a,_26b,_26c){_26a=_26a||this.constructor.SELECTION_NEW;var _26d=this._getShallowClone(_269),map=this._map,_26e,dfd=_1dc._fixDfd(new _1d6(_1dc._dfdCanceller));_26d.outFields=this.getOutFields();_26d.returnGeometry=true;if(map){_26d.outSpatialReference=new _1dd(map.spatialReference.toJson());}if(!this._applyQueryFilters(_26d)){_26e={features:[]};this._selectHandler(_26e,_26a,_26b,_26c,dfd);return dfd;}var _26f=this._canDoClientSideQuery(_26d);if(_26f){_26e={features:this._doQuery(_26d,_26f)};this._selectHandler(_26e,_26a,_26b,_26c,dfd);return dfd;}else{if(this._collection){var err=new Error("FeatureLayer::selectFeatures - "+this.invalidParams);this._resolve([err],null,_26c,dfd,true);return dfd;}var self=this;if(this._ts){_26d._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task.execute(_26d);temp.addCallbacks(function(_270){self._selectHandler(_270,_26a,_26b,_26c,dfd);},function(err){self._resolve([err],null,_26c,dfd,true);});return dfd;}},getSelectedFeatures:function(){var _271=this._selectedFeatures,_272=[],item;for(item in _271){if(_271.hasOwnProperty(item)){_272.push(_271[item]);}}return _272;},clearSelection:function(_273){var _274=this._selectedFeatures,mode=this._mode,item;for(item in _274){if(_274.hasOwnProperty(item)){this._unSelectFeatureIIf(item,mode);mode._removeFeatureIIf(item);}}this._selectedFeatures={};if(this._isSelOnly){mode._applyTimeFilter(true);}if(!_273){this.onSelectionClear();}return this;},setSelectionSymbol:function(_275){this._selectionSymbol=_275;if(_275){var _276=this._selectedFeatures,item;for(item in _276){if(_276.hasOwnProperty(item)){_276[item].setSymbol(_275);}}}return this;},getSelectionSymbol:function(){return this._selectionSymbol;},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(adds,_277,_278,_279,_27a,_27b){var _27c=_27b.assembly,dfd=_27b.dfd;this._applyNormalized(adds,_27c&&_27c[0]);this._applyNormalized(_277,_27c&&_27c[1]);this.onBeforeApplyEdits(adds,_277,_278);var i,_27d={},_27e=this.objectIdField,_27f={f:"json"},_280=false;if(this._collection){var _281={};_281.addResults=adds?_1d4.map(adds,function(){_280=true;return {objectId:this._nextId++,success:true};},this):null;_281.updateResults=_277?_1d4.map(_277,function(_282){_280=true;var oid=_282.attributes[_27e];_27d[oid]=_282;return {objectId:oid,success:true};},this):null;_281.deleteResults=_278?_1d4.map(_278,function(_283){_280=true;return {objectId:_283.attributes[_27e],success:true};},this):null;if(_280){this._editHandler(_281,adds,_27d,_279,_27a,dfd);}return;}if(adds&&adds.length>0){_27f.adds=this._convertFeaturesToJson(adds,0,1);_280=true;}if(_277&&_277.length>0){for(i=0;i<_277.length;i++){var _284=_277[i];_27d[_284.attributes[_27e]]=_284;}_27f.updates=this._convertFeaturesToJson(_277,0,0,1);_280=true;}if(_278&&_278.length>0){var ids=[];for(i=0;i<_278.length;i++){ids.push(_278[i].attributes[_27e]);}_27f.deletes=ids.join(",");_280=true;}if(_280){var self=this;return _1db({url:this._url.path+"/applyEdits",content:lang.mixin(_27f,this._url.query),callbackParamName:"callback",load:function(_285){self._editHandler(_285,adds,_27d,_279,_27a,dfd);},error:function(err){self._resolve([err],null,_27a,dfd,true);}},{usePost:true});}},queryFeatures:function(_286,_287,_288){return this._query("execute","onQueryFeaturesComplete",_286,_287,_288);},queryRelatedFeatures:function(_289,_28a,_28b){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",_289,_28a,_28b);},queryIds:function(_28c,_28d,_28e){return this._query("executeForIds","onQueryIdsComplete",_28c,_28d,_28e);},queryCount:function(_28f,_290,_291){return this._query("executeForCount","onQueryCountComplete",_28f,_290,_291);},queryAttachmentInfos:function(_292,_293,_294){var url=this._url.path+"/"+_292+"/attachments",dfd=new _1d6(_1dc._dfdCanceller),self=this;dfd._pendingDfd=_1db({url:url,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(_295){var _296=_295.attachmentInfos,_297;_1d4.forEach(_296,function(info){_297=ioq.objectToQuery({gdbVersion:self._url.query&&self._url.query.gdbVersion,layer:self._url.query&&self._url.query.layer,token:self._getToken()});info.url=url+"/"+info.id+(_297?("?"+_297):"");info.objectId=_292;});self._resolve([_296],"onQueryAttachmentInfosComplete",_293,dfd);},error:function(err){self._resolve([err],null,_294,dfd,true);}});return dfd;},addAttachment:function(_298,_299,_29a,_29b){return this._sendAttachment("add",_298,_299,_29a,_29b);},updateAttachment:function(_29c,_29d,_29e,_29f,_2a0){_29e.appendChild(_1d8.create("input",{type:"hidden",name:"attachmentId",value:_29d}));return this._sendAttachment("update",_29c,_29e,_29f,_2a0);},deleteAttachments:function(_2a1,_2a2,_2a3,_2a4){var url=this._url.path+"/"+_2a1+"/deleteAttachments",dfd=new _1d6(_1dc._dfdCanceller),self=this,_2a5={f:"json",attachmentIds:_2a2.join(",")};dfd._pendingDfd=_1db({url:url,content:lang.mixin(_2a5,this._url.query),callbackParamName:"callback",load:lang.hitch(this,function(_2a6){var _2a7=_2a6.deleteAttachmentResults;_2a7=_1d4.map(_2a7,function(_2a8){var res=new _1f0(_2a8);res.attachmentId=res.objectId;res.objectId=_2a1;return res;});self._resolve([_2a7],"onDeleteAttachmentsComplete",_2a3,dfd);}),error:function(err){self._resolve([err],null,_2a4,dfd,true);}},{usePost:true});return dfd;},addType:function(_2a9){var _2aa=this.types;if(_2aa){var _2ab=_1d4.some(_2aa,function(type){if(type.id==_2a9.id){return true;}return false;});if(_2ab){return false;}else{_2aa.push(_2a9);}}else{this.types=[_2a9];}this._typesDirty=true;return true;},deleteType:function(_2ac){if(!this._collection){return;}var _2ad=this.types;if(_2ad){var _2ae=-1;_1d4.some(_2ad,function(type,_2af){if(type.id==_2ac){_2ae=_2af;return true;}return false;});if(_2ae>-1){this._typesDirty=true;return _2ad.splice(_2ae,1)[0];}}},toJson:function(){var _2b0=this._json,json=lang.isString(_2b0)?_1d5.fromJson(_2b0):lang.clone(_2b0);if(!json){return;}json=json.layerDefinition?json:{layerDefinition:json};var _2b1=json.layerDefinition,_2b2=this._collection;if(_2b2&&this._typesDirty){_2b1.types=_1d4.map(this.types||[],function(type){return type.toJson();});var _2b3=this.renderer,_2b4=_2b1.drawingInfo;if(_2b4&&_2b3&&_2b3.declaredClass.indexOf("TemporalRenderer")===-1){_2b4.renderer=_2b3.toJson();}}var _2b5=null;if(!(_2b2&&!this._fcAdded)){_2b5={geometryType:_2b1.geometryType,features:this._convertFeaturesToJson(this.graphics,true)};}json.featureSet=lang.mixin({},json.featureSet||{},_2b5);if(_2b2){json.nextObjectId=this._nextId;_2b1.capabilities=this.capabilities;}return json;},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(_2b6){var self=this,path=this._url&&this._url.path;if((this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&path&&_1d9.id&&_1d9.id._hasPortalSession()&&_1d9.id._doPortalSignIn(path)){_1d9.id.getCredential(path).then(function(){self._findCredential();_2b6.call(self);},function(){_2b6.call(self);});}else{_2b6.call(this);}},_updateCaps:function(){var _2b7=this._editable,_2b8=lang.trim(this.capabilities||""),_2b9=_1d4.map((_2b8?_2b8.split(","):[]),lang.trim),caps=_1d4.map((_2b8?_2b8.toLowerCase().split(","):[]),lang.trim),_2ba=_1d4.indexOf(caps,"editing"),cap,i,_2bb,_2bc={"Create":_1d4.indexOf(caps,"create"),"Update":_1d4.indexOf(caps,"update"),"Delete":_1d4.indexOf(caps,"delete")};if(_2b7&&_2ba===-1){_2b9.push("Editing");}else{if(!_2b7&&_2ba>-1){_2bb=[_2ba];for(cap in _2bc){if(_2bc[cap]>-1){_2bb.push(_2bc[cap]);}}_2bb.sort();for(i=_2bb.length-1;i>=0;i--){_2b9.splice(_2bb[i],1);}}}this.capabilities=_2b9.join(",");},_counter:{value:0},_getUniqueId:function(){return this._counter.value++;},onSuspend:function(){this.inherited(arguments);this._toggleTime(false);var mode=this._mode;if(mode){mode.suspend();}},onResume:function(evt){this.inherited(arguments);this._toggleTime(true);this._updateMaxOffset();var mode=this._mode,map=this._map,_2bd=this.renderer;if(evt.firstOccurrence){this.clearSelection();if(this.timeInfo){if(this._trackIdField||(_2bd&&(_2bd.latestObservationRenderer||_2bd.trackRenderer))){this._trackManager=new _1f4(this);this._trackManager.initialize(map);}}this._zoomConnect=_1d3.connect(map,"onZoomEnd",this,this._updateMaxOffset);}if(mode){evt.firstOccurrence?mode.startup():mode.resume();}},_updateMaxOffset:function(){var map=this._map;if(map&&map.loaded){if(this._autoGeneralize){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}},_toggleTime:function(_2be){var map=this._map;if(_2be&&this.timeInfo&&this.useMapTime&&map){this._mapTimeExtent=map.timeExtent;if(!this._timeConnect){this._timeConnect=_1d3.connect(map,"onTimeExtentChange",this,this._timeChangeHandler);}}else{this._mapTimeExtent=null;_1d3.disconnect(this._timeConnect);this._timeConnect=null;}},_timeChangeHandler:function(_2bf){this._mapTimeExtent=_2bf;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},_getOffsettedTE:function(_2c0){var _2c1=this._timeOffset,_2c2=this._timeOffsetUnits;return (_2c0&&_2c1&&_2c2)?_2c0.offset(-1*_2c1,_2c2):_2c0;},_getTimeOverlap:function(_2c3,_2c4){if(_2c3&&_2c4){return _2c3.intersection(_2c4);}else{return _2c3||_2c4;}},_getTimeFilter:function(_2c5){var _2c6=this.getTimeDefinition(),_2c7=null,_2c8;if(_2c6||_2c7){_2c8=this._getTimeOverlap(_2c6,_2c7);if(!_2c8){return [false];}}if(_2c5){_2c5=_2c8?this._getTimeOverlap(_2c5,_2c8):_2c5;if(!_2c5){return [false];}}else{_2c5=_2c8;}return [true,_2c5];},_getAttributeFilter:function(_2c9){var _2ca=this.getDefinitionExpression();if(_2c9){_2c9=_2ca?"("+_2ca+") AND ("+_2c9+")":_2c9;}else{_2c9=_2ca;}return _2c9;},_applyQueryFilters:function(_2cb){_2cb.where=this._getAttributeFilter(_2cb.where);_2cb.maxAllowableOffset=this._maxOffset;if(this.timeInfo){var _2cc=this._getTimeFilter(_2cb.timeExtent);if(!_2cc[0]){return false;}else{_2cb.timeExtent=_2cc[1];}}return true;},_add:function(_2cd){var _2ce=this._selectionSymbol,attr=_2cd.attributes,_2cf=this.visibilityField;if(_2ce&&this._isSelOnly){_2cd.setSymbol(_2ce);}if(_2cf&&attr&&attr.hasOwnProperty(_2cf)){_2cd[attr[_2cf]?"show":"hide"]();}return this.add.apply(this,arguments);},_remove:function(){return this.remove.apply(this,arguments);},_canDoClientSideQuery:function(_2d0){var _2d1=[],map=this._map;if(this._isTable||!map){return;}if(_2d0.text||(_2d0.where&&_2d0.where!==this.getDefinitionExpression())){return;}var _2d2=this._isSnapshot,_2d3=this._isSelOnly;var _2d4=_2d0.geometry;if(_2d4){if(!_2d3&&_2d0.spatialRelationship===_1e6.SPATIAL_REL_INTERSECTS&&(_2d4.type==="extent"&&(_2d2||map.extent.contains(_2d4)))){_2d1.push(1);}else{return;}}var ids=_2d0.objectIds;if(ids){if(_2d2){_2d1.push(2);}else{var len=ids.length,mode=this._mode,_2d5=0,i;for(i=0;i<len;i++){if(mode._getFeature(ids[i])){_2d5++;}}if(_2d5===len){_2d1.push(2);}else{return;}}}if(this.timeInfo){var _2d6=_2d0.timeExtent,_2d7=this._mapTimeExtent;if(_2d2){if(_2d6){_2d1.push(3);}}else{if(_2d3){if(_2d6){return;}}else{if(_2d7){if(_1d4.indexOf(_2d1,2)!==-1){if(_2d6){_2d1.push(3);}}else{return;}}else{if(_2d1.length>0){if(_2d6){_2d1.push(3);}}else{if(_2d6){return;}}}}}}return _2d1.length>0?_2d1:null;},_doQuery:function(_2d8,_2d9,_2da){var _2db=[],mode=this._mode,_2dc=this.objectIdField,i,len,_2dd;if(_1d4.indexOf(_2d9,2)!==-1){_2db=[];var ids=_2d8.objectIds;len=ids.length;for(i=0;i<len;i++){var obj=mode._getFeature(ids[i]);if(obj){_2db.push(obj);}}if(_2db.length===0){return [];}}if(_1d4.indexOf(_2d9,1)!==-1){_2dd=_2db.length>0?_2db:this.graphics;len=_2dd.length;var _2de=_2d8.geometry._normalize(null,true);_2db=[];for(i=0;i<len;i++){var _2df=_2dd[i],_2e0=_2df.geometry;if(_2e0){if(this.normalization&&_2de.length){if(_2de[0].intersects(_2e0)||_2de[1].intersects(_2e0)){_2db.push(_2df);}}else{if(_2de.intersects(_2e0)){_2db.push(_2df);}}}}if(_2db.length===0){return [];}}if(_1d4.indexOf(_2d9,3)!==-1){if(this.timeInfo){_2dd=_2db.length>0?_2db:this.graphics;var time=_2d8.timeExtent,_2e1=this._filterByTime(_2dd,time.startTime,time.endTime);_2db=_2e1.match;}}if(_2da){return _1d4.map(_2db,function(obj){return obj.attributes[_2dc];},this);}else{return _2db;}},_filterByTime:function(_2e2,_2e3,_2e4){var _2e5=this._startTimeField,_2e6=this._endTimeField,_2e7;if(!this._twoTimeFields){_2e7=_2e5||_2e6;}var _2e8=_1da.isDefined,yea=[],nay=[],i,len=_2e2.length,_2e9,_2ea;_2e3=_2e3?_2e3.getTime():-Infinity;_2e4=_2e4?_2e4.getTime():Infinity;if(_2e7){for(i=0;i<len;i++){_2e9=_2e2[i];_2ea=_2e9.attributes;var time=_2ea[_2e7];if(time>=_2e3&&time<=_2e4){yea.push(_2e9);}else{nay.push(_2e9);}}}else{for(i=0;i<len;i++){_2e9=_2e2[i];_2ea=_2e9.attributes;var _2eb=_2ea[_2e5],end=_2ea[_2e6];_2eb=_2e8(_2eb)?_2eb:-Infinity;end=_2e8(end)?end:Infinity;if((_2eb>=_2e3&&_2eb<=_2e4)||(end>=_2e3&&end<=_2e4)||(_2e3>=_2eb&&_2e4<=end)){yea.push(_2e9);}else{nay.push(_2e9);}}}return {match:yea,noMatch:nay};},_resolve:function(args,_2ec,_2ed,dfd,_2ee){if(_2ec){this[_2ec].apply(this,args);}if(_2ed){_2ed.apply(null,args);}if(dfd){_1dc._resDfd(dfd,args,_2ee);}},_getShallowClone:function(_2ef){var _2f0=new _1e6(),prop;for(prop in _2ef){if(_2ef.hasOwnProperty(prop)){_2f0[prop]=_2ef[prop];}}return _2f0;},_query:function(type,_2f1,_2f2,_2f3,_2f4){var that=this,map=this._map,dfd=new _1d6(_1dc._dfdCanceller),_2f5=_2f2;var _2f6=function(_2f7,_2f8){if(!_2f8&&type==="execute"&&!that._isTable){var _2f9=_2f7.features,mode=that._mode,_2fa=that.objectIdField,il=_2f9.length,i;for(i=il-1;i>=0;i--){var oid=_2f9[i].attributes[_2fa];var _2fb=mode._getFeature(oid);if(_2fb){_2f9.splice(i,1,_2fb);}}}that._resolve([_2f7],_2f1,_2f3,dfd);};if(type!=="executeRelationshipQuery"){_2f5=this._getShallowClone(_2f2);_2f5.outFields=this.getOutFields();_2f5.returnGeometry=_2f2.hasOwnProperty("returnGeometry")?_2f2.returnGeometry:true;var _2fc;if(map){_2f5.outSpatialReference=new _1dd(map.spatialReference.toJson());}if(!this._applyQueryFilters(_2f5)){switch(type){case "execute":_2fc=new _1e7({features:[]});break;case "executeForIds":_2fc=[];break;case "executeForCount":_2fc=0;break;}_2f6(_2fc,true);return dfd;}var _2fd=this._canDoClientSideQuery(_2f5);if(_2fd){var _2fe=this._doQuery(_2f5,_2fd,(type==="executeForIds"||type==="executeForCount"));switch(type){case "execute":_2fc=new _1e7();_2fc.features=_2fe;break;case "executeForIds":_2fc=_2fe;break;case "executeForCount":_2fc=_2fe.length;break;}_2f6(_2fc,true);return dfd;}}if(this._collection){var err=new Error("FeatureLayer::_query - "+this.invalidParams);this._resolve([err],null,_2f4,dfd,true);return dfd;}if(this._ts){_2f5._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task[type](_2f5);temp.addCallbacks(_2f6,function(err){that._resolve([err],null,_2f4,dfd,true);});return dfd;},_convertFeaturesToJson:function(_2ff,_300,_301,_302){var json=[],_303=this._selectionSymbol,_304=this.visibilityField,i,_305,_306=this.objectIdField;if(this.loaded&&(_301||_302)){_305=_1d4.filter(this.fields,function(_307){return (_307.editable===false)&&(!_302||(_307.name!==_306));});}for(i=0;i<_2ff.length;i++){var _308=_2ff[i],_309={},_30a=_308.geometry,attr=_308.attributes,_30b=_308.symbol;if(_30a&&(!_302||!this.loaded||this.allowGeometryUpdates)){_309.geometry=_30a.toJson();}if(_304){_309.attributes=attr=lang.mixin({},attr);attr[_304]=_308.visible?1:0;}else{if(attr){_309.attributes=lang.mixin({},attr);}}if(_309.attributes&&_305&&_305.length){_1d4.forEach(_305,function(_30c){delete _309.attributes[_30c.name];});}if(_30b&&(_30b!==_303)){_309.symbol=_30b.toJson();}json.push(_309);}return _300?json:_1d5.toJson(json);},_selectHandler:function(_30d,_30e,_30f,_310,dfd){var _311,ctor=this.constructor;switch(_30e){case ctor.SELECTION_NEW:this.clearSelection(true);_311=true;break;case ctor.SELECTION_ADD:_311=true;break;case ctor.SELECTION_SUBTRACT:_311=false;break;}var i,_312=_30d.features,mode=this._mode,_313=[],_314=this.objectIdField,_315,oid;if(_311){for(i=0;i<_312.length;i++){_315=_312[i];oid=_315.attributes[_314];var _316=mode._addFeatureIIf(oid,_315);_313.push(_316);this._selectFeatureIIf(oid,_316,mode);}}else{for(i=0;i<_312.length;i++){_315=_312[i];oid=_315.attributes[_314];this._unSelectFeatureIIf(oid,mode);var _317=mode._removeFeatureIIf(oid);_313.push(_317||_315);}}if(this._isSelOnly){mode._applyTimeFilter(true);}this._resolve([_313,_30e,_30d.exceededTransferLimit?{queryLimitExceeded:true}:null],"onSelectionComplete",_30f,dfd);if(_30d.exceededTransferLimit){this.onQueryLimitExceeded();}},_selectFeatureIIf:function(oid,_318,mode){var _319=this._selectedFeatures,_31a=_319[oid];if(!_31a){mode._incRefCount(oid);_319[oid]=_318;if(!this._isTable){this._setSelectSymbol(_318);}}return _31a||_318;},_unSelectFeatureIIf:function(oid,mode){var _31b=this._selectedFeatures[oid];if(_31b){mode._decRefCount(oid);delete this._selectedFeatures[oid];if(!this._isTable){this._setUnSelectSymbol(_31b);}}return _31b;},_isSelected:function(_31c){},_setSelectSymbol:function(_31d){var _31e=this._selectionSymbol;if(_31e&&!this._isSelOnly){_31d.setSymbol(_31e);}},_setUnSelectSymbol:function(_31f){var _320=this._selectionSymbol;if(_320&&!this._isSelOnly){if(_320===_31f.symbol){_31f.setSymbol(null,true);}}},_getOutFields:function(){var _321=_1d4.filter([this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields),function(_322,_323,arr){return !!_322&&(_1d4.indexOf(arr,_322)===_323);});var _324=lang.clone(this._outFields);if(_324){if(_1d4.indexOf(_324,"*")!==-1){return _324;}_1d4.forEach(_321,function(_325){if(_1d4.indexOf(_324,_325)===-1){_324.push(_325);}});return _324;}else{return _321;}},_checkFields:function(_326){var _327=_326||this._getOutFields();_1d4.forEach(_327,function(_328){if(_328==="*"){return;}if(!this._getField(_328)){}},this);if(!_326&&!this._isTable&&!this._fserver&&!this._collection){var _329=_1d4.some(this.fields,function(_32a){return (_32a&&_32a.type==="esriFieldTypeGeometry")?true:false;});if(!_329){}}},_fixRendererFields:function(){var _32b=this.renderer;if(_32b&&this.fields.length>0){var _32c=_1d4.filter([_32b,_32b.observationRenderer,_32b.latestObservationRenderer,_32b.trackRenderer],_1da.isDefined);var _32d=[];_1d4.forEach(_32c,function(rnd){var _32e,_32f;_32f=rnd.attributeField;if(_32f&&!lang.isFunction(_32f)){_32e=!this._getField(_32f)&&this._getField(_32f,true);if(_32e){rnd.attributeField=_32e.name;}}_32f=rnd.attributeField2;if(_32f){_32e=!this._getField(_32f)&&this._getField(_32f,true);if(_32e){rnd.attributeField2=_32e.name;}}_32f=rnd.attributeField3;if(_32f){_32e=!this._getField(_32f)&&this._getField(_32f,true);if(_32e){rnd.attributeField3=_32e.name;}}if(!lang.isFunction(rnd.attributeField)){_32d.push(rnd.attributeField);}_32d.push(rnd.attributeField2);_32d.push(rnd.attributeField3);},this);this._rendererFields=_1d4.filter(_32d,_1da.isDefined);}},_getField:function(_330,_331){var _332=this.fields;if(!_332||_332.length===0){return null;}var _333;if(_331){_330=_330.toLowerCase();}_1d4.some(_332,function(_334){var _335=false;if(_331){_335=(_334&&_334.name.toLowerCase()===_330)?true:false;}else{_335=(_334&&_334.name===_330)?true:false;}if(_335){_333=_334;}return _335;});return _333;},_getDateOpts:function(){if(!this._dtOpts){var _336=_1d4.map(_1d4.filter(this.fields,function(_337){return !!(_337&&_337.type==="esriFieldTypeDate");}),function(_338){return _338.name;});this._dtOpts={properties:_336};}return this._dtOpts;},_applyNormalized:function(_339,_33a){if(_339&&_33a){_1d4.forEach(_339,function(_33b,_33c){if(_33b&&_33a[_33c]){_33b.setGeometry(_33a[_33c]);}});}},_editHandler:function(_33d,adds,_33e,_33f,_340,dfd){var _341=_33d.addResults,_342=_33d.updateResults,_343=_33d.deleteResults,i,_344,oid,_345,attr,_346=this.objectIdField,mode=this._mode,_347=this._isTable;var _348=this.editFieldsInfo,_349=this.getOutFields()||[],_34a=_348&&_348.creatorField,_34b=_348&&_348.creationDateField,_34c=_348&&_348.editorField,_34d=_348&&_348.editDateField,_34e=_348&&_348.realm;if(_1d4.indexOf(_349,"*")===-1){if(_34a&&_1d4.indexOf(_349,_34a)===-1){_34a=null;}if(_34b&&_1d4.indexOf(_349,_34b)===-1){_34b=null;}if(_34c&&_1d4.indexOf(_349,_34c)===-1){_34c=null;}if(_34d&&_1d4.indexOf(_349,_34d)===-1){_34d=null;}}var _34f=(_34b||_34d)?(new Date()).getTime():null,_350=(_34a||_34c)?this.getUserId():undefined;if(_350&&_34e){_350=_350+"@"+_34e;}if(_341){for(i=0;i<_341.length;i++){_341[i]=new _1f0(_341[i]);if(_347){continue;}_344=_341[i];if(_344.success){oid=_344.objectId;_345=adds[i];var gl=_345._graphicsLayer;if(gl&&gl!==this){gl.remove(_345);}attr=_345.attributes||{};attr[_346]=oid;if(_34a){attr[_34a]=_350;}if(_34c){attr[_34c]=_350;}if(_34b){attr[_34b]=_34f;}if(_34d){attr[_34d]=_34f;}_345.setAttributes(attr);if(mode._init){mode.drawFeature(_345);}}}}if(_342){for(i=0;i<_342.length;i++){_342[i]=new _1f0(_342[i]);if(_347){continue;}_344=_342[i];if(_344.success){oid=_344.objectId;_345=_33e[oid];var _351=mode._getFeature(oid);if(_351){if(_351.geometry!==_345.geometry){_351.setGeometry(_1e9.fromJson(_345.geometry.toJson()));}this._repaint(_351,oid);}_345=_351||_345;attr=_345.attributes||{};if(_34c){attr[_34c]=_350;}if(_34d){attr[_34d]=_34f;}_345.setAttributes(attr);}}}if(_343){var _352=[];for(i=0;i<_343.length;i++){_343[i]=new _1f0(_343[i]);if(_347){continue;}_344=_343[i];if(_344.success){oid=_344.objectId;_345=mode._getFeature(oid);if(_345){if(this._unSelectFeatureIIf(oid,mode)){_352.push(_345);}_345._count=0;mode._removeFeatureIIf(oid);}}}if(_352.length>0){this.onSelectionComplete(_352,this.constructor.SELECTION_SUBTRACT);}}this._resolve([_341,_342,_343],"onEditsComplete",_33f,dfd);},_sendAttachment:function(type,_353,_354,_355,_356){var _357=(type==="add")?"addAttachment":"updateAttachment",url=this._url.path+"/"+_353+"/"+_357,self=this;var dfd=_1db({url:url,form:_354,content:lang.mixin(this._url.query,{f:"json",token:this._getToken()||undefined}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(_358){var _359=(type==="add")?"addAttachmentResult":"updateAttachmentResult",_35a=(type==="add")?"onAddAttachmentComplete":"onUpdateAttachmentComplete",_35b=new _1f0(_358[_359]);_35b.attachmentId=_35b.objectId;_35b.objectId=_353;self._resolve([_35b],_35a,_355);return _35b;}).addErrback(function(_35c){self._resolve([_35c],null,_356,null,true);});return dfd;},_repaint:function(_35d,oid,_35e){oid=_1da.isDefined(oid)?oid:_35d.attributes[this.objectIdField];if(!(oid in this._selectedFeatures)||!this._selectionSymbol){_35d.setSymbol(_35d.symbol,_35e);}},_getKind:function(_35f){var _360=this._trackManager;if(_360){return _360.isLatestObservation(_35f)?1:0;}return 0;}});lang.mixin(_1f5,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});_1ea._createWrappers(_1f5);if(has("extend-esri")){lang.setObject("layers.FeatureLayer",_1f5,_1d9);}return _1f5;});},"url:esri/dijit/templates/OverviewMap.html":"<div class=\"esriOverviewMap\">\r\n  <div class=\"ovwContainer\" dojoattachpoint=\"_body\" style=\"width: ${width}px; height: ${height}px;\">\r\n    <div id=\"${id}-map\" style=\"width: 100%; height: 100%;\">\r\n      <div class=\"ovwHighlight\" dojoattachpoint=\"_focusDiv\" title=\"${NLS_drag}\" style=\"border: 1px solid ${color}; background-color: ${color};\"></div>\r\n    </div>\r\n  </div>\r\n  <div class=\"ovwButton ovwController\" title=\"${NLS_show}\" dojoattachpoint=\"_controllerDiv\" dojoattachevent=\"onclick: _visibilityHandler\">\r\n  </div>\r\n  <div class=\"ovwButton ovwMaximizer\" title=\"${NLS_maximize}\" dojoattachpoint=\"_maximizerDiv\" dojoattachevent=\"onclick: _maximizeHandler\">\r\n  </div>\r\n</div>\r\n","dojo/DeferredList":function(){define("dojo/DeferredList",["./_base/kernel","./_base/Deferred","./_base/array"],function(dojo,_361,_362){dojo.DeferredList=function(list,_363,_364,_365,_366){var _367=[];_361.call(this);var self=this;if(list.length===0&&!_363){this.resolve([0,[]]);}var _368=0;_362.forEach(list,function(item,i){item.then(function(_369){if(_363){self.resolve([i,_369]);}else{_36a(true,_369);}},function(_36b){if(_364){self.reject(_36b);}else{_36a(false,_36b);}if(_365){return null;}throw _36b;});function _36a(_36c,_36d){_367[i]=[_36c,_36d];_368++;if(_368===list.length){self.resolve(_367);}};});};dojo.DeferredList.prototype=new _361();dojo.DeferredList.prototype.gatherResults=function(_36e){var d=new dojo.DeferredList(_36e,false,true,false);d.addCallback(function(_36f){var ret=[];_362.forEach(_36f,function(_370){ret.push(_370[1]);});return ret;});return d;};return dojo.DeferredList;});},"esri/layers/KMLFolder":function(){define("esri/layers/KMLFolder",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(_371,lang,has,_372,_373){var _374=_371(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(json){lang.mixin(this,json);if(_373.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLFolder",_374,_372);}return _374;});},"esri/layers/TrackManager":function(){define("esri/layers/TrackManager",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(_375,lang,_376,has,_377,_378,_379,_37a){var _37b=_375(null,{declaredClass:"esri.layers._TrackManager",constructor:function(_37c){this.layer=_37c;this.trackMap={};},initialize:function(map){this.map=map;var _37d=this.layer,_37e=_37d.renderer.trackRenderer;if(_37e&&(_37d.geometryType==="esriGeometryPoint")){var _37f=(this.container=new _37a._GraphicsLayer({id:_37d.id+"_tracks",_child:true}));_37f.loaded=true;_37f.onLoad(_37f);_37f._setMap(map,_37d._div);_37f.setRenderer(_37e);}},addFeatures:function(_380){var tkid,_381=this.trackMap,_382=this.layer,_383=_382._trackIdField;_376.forEach(_380,function(_384){var _385=_384.attributes;tkid=_385[_383];var ary=(_381[tkid]=(_381[tkid]||[]));ary.push(_384);});var _386=_382._startTimeField,_387=_382.objectIdField;var _388=function(a,b){var _389=a.attributes[_386],_38a=b.attributes[_386];if(_389===_38a){return (a.attributes[_387]<b.attributes[_387])?-1:1;}else{return (_389<_38a)?-1:1;}};for(tkid in _381){_381[tkid].sort(_388);}},drawTracks:function(){var _38b=this.container;if(!_38b){return;}var _38c=this.trackMap,sr=this.map.spatialReference,tkid,ary,path,i,_38d,_38e=this.layer._trackIdField,_38f;for(tkid in _38c){ary=_38c[tkid];path=[];for(i=ary.length-1;i>=0;i--){_38d=ary[i].geometry;if(_38d){path.push([_38d.x,_38d.y]);}}_38f={};_38f[_38e]=tkid;if(path.length>0){_38b.add(new _378(new _379({paths:[path],spatialReference:sr}),null,_38f));}}},moveLatestToFront:function(){_376.forEach(this.getLatestObservations(),function(_390){var _391=_390._shape;_391&&_391._moveToFront();this._repaint(_390,null,true);},this.layer);},getLatestObservations:function(){var _392=[];if(!this.layer.renderer.latestObservationRenderer){return _392;}var _393=this.trackMap,tkid;for(tkid in _393){var ary=_393[tkid];_392.push(ary[ary.length-1]);}return _392;},clearTracks:function(){var _394=this.getLatestObservations();this.trackMap={};var _395=this.container;if(_395){_395.clear();}_376.forEach(_394,function(_396){this._repaint(_396,null,true);},this.layer);},isLatestObservation:function(_397){var _398=this.layer._trackIdField;var _399=this.trackMap[_397.attributes[_398]];if(_399){return (_399[_399.length-1]===_397);}return false;},destroy:function(){var _39a=this.container;if(_39a){_39a.clear();_39a._unsetMap(this.map,this.layer._div);this.container=null;}this.map=null;this.layer=null;this.trackMap=null;}});if(has("extend-esri")){lang.setObject("layers._TrackManager",_37b,_377);}return _37b;});},"esri/layers/WMSLayer":function(){define("esri/layers/WMSLayer",["require","dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/request","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/DynamicMapServiceLayer","esri/layers/WMSLayerInfo","dojo/query"],function(_39b,_39c,_39d,lang,_39e,has,_39f,_3a0,_3a1,_3a2,_3a3,_3a4,_3a5){var _3a6=_39d([_3a4],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(url,_3a7){url=this._stripParameters(url,["version","service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);this.url=url;this._url=_3a1.urlToObject(url);this._getCapabilitiesURL=url;this._initLayer=lang.hitch(this,this._initLayer);this._parseCapabilities=lang.hitch(this,this._parseCapabilities);this._getCapabilitiesError=lang.hitch(this,this._getCapabilitiesError);if(_3a7){this.imageFormat=this._getImageFormat(_3a7.format);this.imageTransparency=(_3a7.transparent===false)?false:true;this.visibleLayers=_3a7.visibleLayers?_3a7.visibleLayers:[];if(_3a7.resourceInfo){this._readResourceInfo(_3a7.resourceInfo);}else{this._getCapabilities();}}else{this.imageFormat="image/png";this.imageTransparency=true;this.visibleLayers=[];this._getCapabilities();}this._blankImageURL=_39b.toUrl("esri/layers")+"/../images/pixel.png";},setVisibleLayers:function(_3a8){_3a8=this._checkVisibleLayersList(_3a8);this.visibleLayers=_3a8?_3a8:[];this.refresh(true);},setImageFormat:function(_3a9){this.imageFormat=this._getImageFormat(_3a9);this.refresh(true);},setImageTransparency:function(_3aa){this.imageTransparency=_3aa;this.refresh(true);},getImageUrl:function(_3ab,_3ac,_3ad,_3ae){if(!this.visibleLayers||this.visibleLayers.length===0){_3ae(this._blankImageURL);return;}var wkid=_3ab.spatialReference.wkid;if(_39e.some(this._WEB_MERCATOR,function(el){return el==wkid;})){var _3af=_39e.filter(this.spatialReferences,function(el){return (_39e.some(this._WEB_MERCATOR,function(el2){return el2==el;}));},this);if(_3af.length==0){_3af=_39e.filter(this.spatialReferences,function(el){return (_39e.some(this._WORLD_MERCATOR,function(el2){return el2==el;}));},this);}if(_3af.length>0){wkid=_3af[0];}else{wkid=this._WEB_MERCATOR[0];}}var list=_39e.filter(this.spatialReferences,function(el){return el!==wkid;});this.spatialReferences=list;this.spatialReferences.unshift(wkid);var xmin=_3ab.xmin;var xmax=_3ab.xmax;var ymin=_3ab.ymin;var ymax=_3ab.ymax;var _3b0={};_3b0.SERVICE="WMS";_3b0.REQUEST="GetMap";_3b0.FORMAT=this.imageFormat;_3b0.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";_3b0.STYLES="";_3b0.VERSION=this.version;_3b0.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;_3b0.WIDTH=_3ac;_3b0.HEIGHT=_3ad;if(this.maxWidth<_3ac){_3b0.WIDTH=this.maxWidth;}if(this.maxHeight<_3ad){_3b0.HEIGHT=this.maxHeight;}var _3b1=wkid?wkid:NaN;if(!isNaN(_3b1)){if(this.version=="1.3.0"){_3b0.CRS="EPSG:"+_3b1;}else{_3b0.SRS="EPSG:"+_3b1;}}if(this.version=="1.3.0"&&this._useLatLong(_3b1)){_3b0.BBOX=ymin+","+xmin+","+ymax+","+xmax;}else{_3b0.BBOX=xmin+","+ymin+","+xmax+","+ymax;}var _3b2=this.getMapURL,key;_3b2+=(_3b2.indexOf("?")==-1)?"?":"";for(key in _3b0){_3b2+=(_3b2.substring(_3b2.length-1,_3b2.length)=="?")?"":"&";_3b2+=key+"="+_3b0[key];}_3ae(_3a1.addProxy(_3b2));},_initLayer:function(_3b3,io){this.spatialReference=new _3a2(this.extent.spatialReference);this.initialExtent=new _3a3(this.extent);this.fullExtent=new _3a3(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=true;this.onLoad(this);var _3b4=this._loadCallback;if(_3b4){delete this._loadCallback;_3b4(this);}},_readResourceInfo:function(_3b5){if(!_3b5.extent){return;}if(!_3b5.layerInfos){return;}this.extent=_3b5.extent;this.allExtents[0]=_3b5.extent;this.layerInfos=_3b5.layerInfos;this.description=_3b5.description?_3b5.description:"";this.copyright=_3b5.copyright?_3b5.copyright:"";this.title=_3b5.title?_3b5.title:"";this.getMapURL=_3b5.getMapURL?_3b5.getMapURL:this._getCapabilitiesURL;this.version=_3b5.version?_3b5.version:"1.3.0";this.maxWidth=_3b5.maxWidth?_3b5.maxWidth:5000;this.maxHeight=_3b5.maxHeight?_3b5.maxHeight:5000;this.spatialReferences=_3b5.spatialReferences?_3b5.spatialReferences:[];this.imageFormat=this._getImageFormat(_3b5.format);this.setScaleRange(_3b5.minScale,_3b5.maxScale);this._initLayer();},_getCapabilities:function(){var _3b6=this._url.query?this._url.query:{};_3b6.SERVICE="WMS";_3b6.REQUEST="GetCapabilities";var uri=this._url.path+"?",key;for(key in _3b6){uri+=(uri.substring(uri.length-1,uri.length)=="?")?"":"&";uri+=key+"="+_3b6[key];}var _3b7=_3a0({url:uri,handleAs:"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:false});},_parseCapabilities:function(xml){if(!xml){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)");return;}this.version=this._getAttributeValue("WMS_Capabilities","version",xml,null);if(!this.version){this.version=this._getAttributeValue("WMT_MS_Capabilities","version",xml,"1.3.0");}var _3b8=this._getTag("Service",xml);this.title=this._getTagValue("Title",_3b8,"");if(!this.title||this.title.length==0){this.title=this._getTagValue("Name",_3b8,"");}this.copyright=this._getTagValue("AccessConstraints",_3b8,"");this.description=this._getTagValue("Abstract",_3b8,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",_3b8,5000),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",_3b8,5000),10);var _3b9=this._getTag("Layer",xml);if(!_3b9){this._getCapabilitiesError({"error":{"message":"Response does not contain any layers."}});return;}var _3ba=this._getLayerInfo(_3b9);var _3bb=0;var _3bc=null;var _3bd=this._getTag("Capability",xml);_39e.forEach(_3bd.childNodes,function(_3be){if(_3be.nodeName=="Layer"){if(_3bb===0){_3bc=_3be;}else{if(_3bb===1){if(_3ba.name){_3ba.name="";_3ba.subLayers=[];_3ba.subLayers.push(this._getLayerInfo(_3bc));}_3ba.subLayers.push(this._getLayerInfo(_3be));}else{_3ba.subLayers.push(this._getLayerInfo(_3be));}}_3bb++;}},this);if(_3ba){this.layerInfos=_3ba.subLayers;if(!this.layerInfos||this.layerInfos.length==0){this.layerInfos=[_3ba];}this.extent=_3ba.extent;this.allExtents=_3ba.allExtents;this.spatialReferences=_3ba.spatialReferences;if(this.spatialReferences.length==0&&this.layerInfos.length>0){this.spatialReferences=this.layerInfos[0].spatialReferences;}}this.getMapURL=this._getCapabilitiesURL;var _3bf=_39c.query("DCPType",this._getTag("GetMap",xml));if(_3bf&&_3bf.length>0){var _3c0=_39c.query("HTTP",_3bf[0]);if(_3c0&&_3c0.length>0){var _3c1=_39c.query("Get",_3c0[0]);if(_3c1&&_3c1.length>0){var _3c2=this._getAttributeValue("OnlineResource","xlink:href",_3c1[0],null);if(_3c2){if(_3c2.indexOf("&")==(_3c2.length-1)){_3c2=_3c2.substring(0,_3c2.length-1);}this.getMapURL=_3c2;}}}}this.getMapFormats=[];if(_39c.query("Operation",xml).length==0){_39e.forEach(_39c.query("Format",this._getTag("GetMap",xml)),function(_3c3){this.getMapFormats.push(_3c3.text?_3c3.text:_3c3.textContent);},this);}else{_39e.forEach(_39c.query("Operation",xml),function(_3c4){if(_3c4.getAttribute("name")=="GetMap"){_39e.forEach(_39c.query("Format",_3c4),function(_3c5){this.getMapFormats.push(_3c5.text?_3c5.text:_3c5.textContent);},this);}},this);}if(!_39e.some(this.getMapFormats,function(el){return el.indexOf(this.imageFormat)>-1;},this)){this.imageFormat=this.getMapFormats[0];}this._initLayer();},_getCapabilitiesError:function(_3c6,io){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",_3c6);},_getLayerInfo:function(_3c7){if(!_3c7){return null;}var _3c8=new _3a5();_3c8.name="";_3c8.title="";_3c8.description="";_3c8.allExtents=[];_3c8.spatialReferences=[];_3c8.subLayers=[];var _3c9=this._getTag("LatLonBoundingBox",_3c7);if(_3c9){_3c8.allExtents[0]=this._getExtent(_3c9,4326);}var _3ca=this._getTag("EX_GeographicBoundingBox",_3c7);if(_3ca){var _3cb=new _3a3(0,0,0,0,new _3a2({wkid:4326}));_3cb.xmin=parseFloat(this._getTagValue("westBoundLongitude",_3ca,0));_3cb.ymin=parseFloat(this._getTagValue("southBoundLatitude",_3ca,0));_3cb.xmax=parseFloat(this._getTagValue("eastBoundLongitude",_3ca,0));_3cb.ymax=parseFloat(this._getTagValue("northBoundLatitude",_3ca,0));_3c8.allExtents[0]=_3cb;}_3c8.extent=_3c8.allExtents[0];var _3cc=(_39e.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)>-1)?"SRS":"CRS";_39e.forEach(_3c7.childNodes,function(_3cd){if(_3cd.nodeName=="Name"){_3c8.name=(_3cd.text?_3cd.text:_3cd.textContent)||"";}else{if(_3cd.nodeName=="Title"){_3c8.title=(_3cd.text?_3cd.text:_3cd.textContent)||"";}else{if(_3cd.nodeName=="Abstract"){_3c8.description=(_3cd.text?_3cd.text:_3cd.textContent)||"";}else{if(_3cd.nodeName=="BoundingBox"){var _3ce=_3cd.getAttribute(_3cc),wkid;if(_3ce&&_3ce.indexOf("EPSG:")===0){wkid=parseInt(_3ce.substring(5),10);if(wkid!==0&&!isNaN(wkid)){var _3cf;if(this.version=="1.3.0"){_3cf=this._getExtent(_3cd,wkid,this._useLatLong(wkid));}else{_3cf=this._getExtent(_3cd,wkid);}_3c8.allExtents[wkid]=_3cf;if(!_3c8.extent){_3c8.extent=_3cf;}}}else{if(_3ce&&_3ce.indexOf("CRS:")===0){wkid=parseInt(_3ce.substring(4),10);if(wkid!==0&&!isNaN(wkid)){if(this._CRS_TO_EPSG[wkid]){wkid=this._CRS_TO_EPSG[wkid];}_3c8.allExtents[wkid]=this._getExtent(_3cd,wkid);}}else{wkid=parseInt(_3ce,10);if(wkid!==0&&!isNaN(wkid)){_3c8.allExtents[wkid]=this._getExtent(_3cd,wkid);}}}}else{if(_3cd.nodeName==_3cc){var _3d0=_3cd.text?_3cd.text:_3cd.textContent;var arr=_3d0.split(" ");_39e.forEach(arr,function(val){if(val.indexOf(":")>-1){val=parseInt(val.split(":")[1],10);}else{val=parseInt(val,10);}if(val!==0&&!isNaN(val)){if(this._CRS_TO_EPSG[val]){val=this._CRS_TO_EPSG[val];}if(_39e.indexOf(_3c8.spatialReferences,val)==-1){_3c8.spatialReferences.push(val);}}},this);}else{if(_3cd.nodeName=="Style"){var _3d1=this._getTag("LegendURL",_3cd);if(_3d1){var _3d2=this._getTag("OnlineResource",_3d1);if(_3d2){_3c8.legendURL=_3d2.getAttribute("xlink:href");}}}else{if(_3cd.nodeName==="Layer"){_3c8.subLayers.push(this._getLayerInfo(_3cd));}}}}}}}},this);_3c8.title=_3c8.title||_3c8.name;return _3c8;},_getImageFormat:function(_3d3){var _3d4=_3d3?_3d3.toLowerCase():"";switch(_3d4){case "jpg":return "image/jpeg";case "bmp":return "image/bmp";case "gif":return "image/gif";case "svg":return "image/svg+xml";default:return "image/png";}},getImageFormat:function(){var _3d5=this.imageFormat?this.imageFormat.toLowerCase():"";switch(_3d5){case "image/jpeg":return "jpg";case "image/bmp":return "bmp";case "image/gif":return "gif";case "image/svg+xml":return "svg";default:return "png";}},_getExtent:function(_3d6,wkid,_3d7){var _3d8;if(_3d6){_3d8=new _3a3();var minx=parseFloat(_3d6.getAttribute("minx"));var miny=parseFloat(_3d6.getAttribute("miny"));var maxx=parseFloat(_3d6.getAttribute("maxx"));var maxy=parseFloat(_3d6.getAttribute("maxy"));if(_3d7){_3d8.xmin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_3d8.ymin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_3d8.xmax=isNaN(maxy)?Number.MAX_VALUE:maxy;_3d8.ymax=isNaN(maxx)?Number.MAX_VALUE:maxx;}else{_3d8.xmin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_3d8.ymin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_3d8.xmax=isNaN(maxx)?Number.MAX_VALUE:maxx;_3d8.ymax=isNaN(maxy)?Number.MAX_VALUE:maxy;}_3d8.spatialReference=new _3a2({wkid:wkid});}return _3d8;},_useLatLong:function(wkid){var _3d9,i;for(i=0;i<this._REVERSED_LAT_LONG_RANGES.length;i++){var _3da=this._REVERSED_LAT_LONG_RANGES[i];if(wkid>=_3da[0]&&wkid<=_3da[1]){_3d9=true;break;}}return _3d9;},_getTag:function(_3db,xml){var tags=_39c.query(_3db,xml);if(tags&&tags.length>0){return tags[0];}else{return null;}},_getTagValue:function(_3dc,xml,_3dd){var _3de=_39c.query(_3dc,xml);if(_3de&&_3de.length>0){if(_3de[0].text){return _3de[0].text;}else{return _3de[0].textContent;}}else{return _3dd;}},_getAttributeValue:function(_3df,_3e0,xml,_3e1){var _3e2=_39c.query(_3df,xml);if(_3e2&&_3e2.length>0){return _3e2[0].getAttribute(_3e0);}else{return _3e1;}},_checkVisibleLayersList:function(_3e3){if(_3e3&&_3e3.length>0&&this.layerInfos&&this.layerInfos.length>0){if((typeof _3e3[0])=="number"){var list=[];_39e.forEach(_3e3,function(pos){if(pos<this.layerInfos.length){list.push(this.layerInfos[pos].name);}},this);_3e3=list;}}return _3e3;},_stripParameters:function(url,_3e4){var obj=_3a1.urlToObject(url),prop,qs=[];for(prop in obj.query){if(_39e.indexOf(_3e4,prop.toLowerCase())===-1){qs.push(prop+"="+obj.query[prop]);}}return obj.path+(qs.length?("?"+qs.join("&")):"");}});if(has("extend-esri")){lang.setObject("layers.WMSLayer",_3a6,_39f);}return _3a6;});},"esri/layers/SelectionMode":function(){define("esri/layers/SelectionMode",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(_3e5,lang,has,_3e6,_3e7){var _3e8=_3e5([_3e7],{declaredClass:"esri.layers._SelectionMode",constructor:function(_3e9){this.featureLayer=_3e9;this._featureMap={};},propertyChangeHandler:function(type){if(this._init&&type===0){this._applyTimeFilter();}},resume:function(){this.propertyChangeHandler(0);}});if(has("extend-esri")){lang.setObject("layers._SelectionMode",_3e8,_3e6);}return _3e8;});},"esri/layers/SnapshotMode":function(){define("esri/layers/SnapshotMode",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/SpatialReference","esri/tasks/query","esri/layers/RenderMode"],function(_3ea,lang,has,_3eb,_3ec,_3ed,_3ee){var _3ef=_3ea([_3ee],{declaredClass:"esri.layers._SnapshotMode",constructor:function(_3f0){this.featureLayer=_3f0;this._featureMap={};this._drawFeatures=lang.hitch(this,this._drawFeatures);this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},startup:function(){if(this.featureLayer._collection){this._applyTimeFilter();}else{this._fetchAll();}},propertyChangeHandler:function(type){if(this._init){if(type){if(this.featureLayer._collection){}else{this._fetchAll();}}else{this._applyTimeFilter();}}},drawFeature:function(_3f1){var _3f2=this.featureLayer,_3f3=_3f2.objectIdField,oid=_3f1.attributes[_3f3];this._addFeatureIIf(oid,_3f1);this._incRefCount(oid);},resume:function(){this.propertyChangeHandler(0);},refresh:function(){var _3f4=this.featureLayer;if(_3f4._collection){_3f4._fireUpdateStart();_3f4._refresh(true);_3f4._fireUpdateEnd();}else{this._fetchAll();}},_getRequestId:function(_3f5){var id="_"+_3f5.name+_3f5.layerId+_3f5._ulid;return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_fetchAll:function(){var _3f6=this.featureLayer;if(_3f6._collection){return;}_3f6._fireUpdateStart();this._clearIIf();this._sendRequest();},_sendRequest:function(){var map=this.map,_3f7=this.featureLayer,_3f8=_3f7.getDefinitionExpression();var _3f9=new _3ed();_3f9.outFields=_3f7.getOutFields();_3f9.where=_3f8||"1=1";_3f9.returnGeometry=true;_3f9.outSpatialReference=new _3ec(map.spatialReference.toJson());_3f9.timeExtent=_3f7.getTimeDefinition();_3f9.maxAllowableOffset=_3f7._maxOffset;if(_3f7._ts){_3f9._ts=(new Date()).getTime();}var _3fa;if(_3f7._usePatch){_3fa=this._getRequestId(_3f7);this._cancelPendingRequest(null,_3fa);}_3f7._task.execute(_3f9,this._drawFeatures,this._queryErrorHandler,_3fa);},_drawFeatures:function(_3fb){this._purgeRequests();var _3fc=_3fb.features,_3fd=this.featureLayer,_3fe=_3fd.objectIdField,i,len=_3fc.length,_3ff,oid;for(i=0;i<len;i++){_3ff=_3fc[i];oid=_3ff.attributes[_3fe];this._addFeatureIIf(oid,_3ff);this._incRefCount(oid);}this._applyTimeFilter(true);_3fd._fireUpdateEnd(null,_3fb.exceededTransferLimit?{queryLimitExceeded:true}:null);if(_3fb.exceededTransferLimit){_3fd.onQueryLimitExceeded();}},_queryErrorHandler:function(err){this._purgeRequests();var _400=this.featureLayer;_400._errorHandler(err);_400._fireUpdateEnd(err);}});if(has("extend-esri")){lang.setObject("layers._SnapshotMode",_3ef,_3eb);}return _3ef;});},"esri/dijit/OverviewMap":function(){require({cache:{"url:esri/dijit/templates/OverviewMap.html":"<div class=\"esriOverviewMap\">\r\n  <div class=\"ovwContainer\" dojoattachpoint=\"_body\" style=\"width: ${width}px; height: ${height}px;\">\r\n    <div id=\"${id}-map\" style=\"width: 100%; height: 100%;\">\r\n      <div class=\"ovwHighlight\" dojoattachpoint=\"_focusDiv\" title=\"${NLS_drag}\" style=\"border: 1px solid ${color}; background-color: ${color};\"></div>\r\n    </div>\r\n  </div>\r\n  <div class=\"ovwButton ovwController\" title=\"${NLS_show}\" dojoattachpoint=\"_controllerDiv\" dojoattachevent=\"onclick: _visibilityHandler\">\r\n  </div>\r\n  <div class=\"ovwButton ovwMaximizer\" title=\"${NLS_maximize}\" dojoattachpoint=\"_maximizerDiv\" dojoattachevent=\"onclick: _maximizeHandler\">\r\n  </div>\r\n</div>\r\n"}});define("esri/dijit/OverviewMap",["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/html","dojo/has","dojo/sniff","dojo/dom-class","dojo/dom-style","dojo/dnd/Moveable","dijit/_Widget","dijit/_Templated","esri/map","esri/geometry/Point","esri/geometry/ScreenPoint","esri/layers/TiledMapServiceLayer","esri/layers/DynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/virtualearth/VETiledLayer","esri/kernel","esri/config","esri/domUtils","dojo/text!esri/dijit/templates/OverviewMap.html","dojo/i18n!esri/nls/jsapi"],function(_401,_402,lang,_403,html,has,_404,_405,_406,_407,_408,_409,Map,_40a,_40b,_40c,_40d,_40e,_40f,_410,_411,_412,_413,_414,_415,_416,_417){var OM=_402([_408,_409],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:true,templateString:_416,basePath:_401.toUrl("esri/dijit")+"/",constructor:function(_418,_419){lang.mixin(this,_417.widgets.overviewMap);_418=_418||{};if(!_418.map){return;}var _41a={};if(_419){this._detached=true;_41a=html.coords(_419,true);}this.map=_418.map;this.baseLayer=_418.baseLayer;this.width=_418.width||_41a.w||this.map.width/4;this.height=_418.height||_41a.h||this.map.height/4;this.attachTo=_418.attachTo||"top-right";this.expandFactor=_418.expandFactor||2;this.color=_418.color||"#000000";this.opacity=_418.opacity||0.5;this.maximizeButton=!!_418.maximizeButton;this.visible=!!_418.visible;if(this.map.loaded){this._initialSetup();}else{var _41b=_403.connect(this.map,"onLoad",this,function(){_403.disconnect(_41b);_41b=null;this._initialSetup();});}if(this._detached){this.visible=true;}this._maximized=false;},startup:function(){this.inherited(arguments);if(has("ie")){if(!this.domNode.parentElement){this.map.container.appendChild(this.domNode);}}else{if(!this.domNode.parentNode){this.map.container.appendChild(this.domNode);}}if(this._detached){_406.set(this._body,"display","block");_406.set(this._controllerDiv,"display","none");_406.set(this._maximizerDiv,"display","none");if(this.map.loaded){this._initialize();}else{_403.connect(this.map,"onLoad",this,this._initialize);}}else{if(this.attachTo.split("-")[0]==="bottom"){this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv);}if(!this.maximizeButton){_405.add(this._maximizerDiv,"ovwDisabledButton");}if(this.visible&&this.map.loaded){this.visible=false;this.show();}_405.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]);_405.add(this._controllerDiv,"ovwShow");_405.add(this._maximizerDiv,"ovwMaximize");}_406.set(this._focusDiv,"opacity",this.opacity);},destroy:function(){this._deactivate();if(this.overviewMap){this.overviewMap.destroy();}this.overviewMap=this.baseLayer=null;this.inherited(arguments);},resize:function(size){if(!size||size.w<=0||size.h<=0){return;}this._resize(size.w,size.h);},show:function(){if(!this.visible){var div=this._controllerDiv;div.title=this.NLS_hide;_405.remove(div,"ovwShow");_405.add(div,"ovwHide");_415.show(this._body);_415.show(this._maximizerDiv);this._initialize();this.visible=true;}},hide:function(){if(this.visible){var div=this._controllerDiv;div.title=this.NLS_show;_405.remove(div,"ovwHide");_405.add(div,"ovwShow");if(this._maximized){this._maximizeHandler();}_415.hide(this._body);_415.hide(this._maximizerDiv);this._deactivate();this.visible=false;}},_initialSetup:function(){this._mainMapLayer=this.map.getLayer(this.map.layerIds[0]);if(!this._mainMapLayer){return;}var _41c=this.baseLayer||this._mainMapLayer;var _41d=this.map.spatialReference,_41e=_41c.spatialReference;if((_41e.wkid!==_41d.wkid)&&(_41e.wkt!==_41d.wkt)){return;}var _41f=_41c.declaredClass;if(_41c instanceof _40c){if(_41f.indexOf("VETiledLayer")!==-1){this.baseLayer=new _412({resourceInfo:_41c.getResourceInfo(),culture:_41c.culture,mapStyle:_41c.mapStyle,bingMapsKey:_41c.bingMapsKey});}else{if(_41f.indexOf("OpenStreetMapLayer")!==-1){this.baseLayer=new _411({tileServers:_41c.tileServers});}else{if(_41f.indexOf("WebTiledLayer")!==-1){var _420=_41c.initialExtent,_421=_41c.fullExtent,_422=_41c.tileInfo;this.baseLayer=new _41c.constructor(_41c.urlTemplate,{initialExtent:_420&&new _420.constructor(_420.toJson()),fullExtent:_421&&new _421.constructor(_421.toJson()),tileInfo:_422&&new _422.constructor(_422.toJson()),tileServers:_41c.tileServers&&_41c.tileServers.slice(0)});}else{this.baseLayer=new _40e(_41c.url,{resourceInfo:_41c.getResourceInfo()});}}}}else{if(_41c instanceof _40d){if(_41f.indexOf("ArcGISImageServiceLayer")!==-1){this.baseLayer=new _410(_41c.url);}else{this.baseLayer=new _40f(_41c.url);this.baseLayer.setImageFormat("png24");}}else{return;}}if(!this._detached&&this.visible&&this._controllerDiv){var _423=function(){this.visible=false;this.show();};if(this.baseLayer.loaded){_423.call(this);}else{_403.connect(this.baseLayer,"onLoad",this,_423);}}},_visibilityHandler:function(){if(this.visible){this.hide();}else{this.show();}},_maximizeHandler:function(){var div=this._maximizerDiv;if(this._maximized){div.title=this.NLS_maximize;_405.remove(div,"ovwRestore");_405.add(div,"ovwMaximize");this._resize(this.width,this.height);}else{div.title=this.NLS_restore;_405.remove(div,"ovwMaximize");_405.add(div,"ovwRestore");this._resize(this.map.width,this.map.height);}this._maximized=!this._maximized;},_resize:function(_424,_425){_406.set(this._body,{width:_424+"px",height:_425+"px"});var _426=_414.defaults.map.panDuration,_427=this.overviewMap;_414.defaults.map.panDuration=0;_427.resize(true);_427.centerAt(this._focusExtent.getCenter());_414.defaults.map.panDuration=_426;},_initialize:function(){if(!this.overviewMap){var _428;_428=(this.overviewMap=new Map(this.id+"-map",{slider:false,showAttribution:false,logo:false,lods:this._overviewLods,wrapAround180:this.map.wrapAround180}));_403.connect(_428,"onLoad",this,function(){this._map_resize_override=lang.hitch(_428,this._map_resize_override);_428.disableMapNavigation();this._activate();});_428.addLayer(this.baseLayer);}else{this._activate();}},_activate:function(){var map=this.map,_429=this.overviewMap;this._moveableHandle=new _407(this._focusDiv);this._soeConnect=_403.connect(map,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=_403.connect(map,"onPan",this,this._updateFocus);this._oecConnect=_403.connect(_429,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=_403.connect(_429,"onPan",this,this._ovwPanHandler);this._ozsConnect=_403.connect(_429,"onZoomStart",this,function(){_415.hide(this._focusDiv);});this._ozeConnect=_403.connect(_429,"onZoomEnd",this,function(){_415.show(this._focusDiv);});this._omsConnect=_403.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(map.extent,null,null,null);},_deactivate:function(){_403.disconnect(this._soeConnect);_403.disconnect(this._ufoConnect);_403.disconnect(this._oecConnect);_403.disconnect(this._opaConnect);_403.disconnect(this._ozsConnect);_403.disconnect(this._ozeConnect);_403.disconnect(this._omsConnect);if(this._moveableHandle){this._moveableHandle.destroy();}},_syncOverviewMap:function(ext,_42a,_42b,lod){if(this._suspendPanHandling){this._suspendPanHandling=false;return;}this._focusExtent=ext;this.overviewMap.setExtent(ext.expand(this.expandFactor),true);},_updateFocus:function(ext){if(this._suspendPanHandling){return;}this._focusExtent=ext;this._drawFocusDiv(ext);},_drawFocusDiv:function(ext,_42c){var _42d=this.overviewMap;var tl=_42d.toScreen(new _40a(ext.xmin,ext.ymax,_42d.spatialReference));var br=_42d.toScreen(new _40a(ext.xmax,ext.ymin,_42d.spatialReference));var _42e=br.x-tl.x,_42f=br.y-tl.y,_430=true;if((_42e>this.overviewMap.width)&&(_42f>this.overviewMap.height)){_430=false;}_406.set(this._focusDiv,{left:tl.x+(_42c?_42c.x:0)+"px",top:tl.y+(_42c?_42c.y:0)+"px",width:_42e+"px",height:_42f+"px",display:_430?"block":"none"});},_moveStopHandler:function(evt){var _431=this._moveableHandle.node.style;var ext=this._focusExtent;var _432=this.overviewMap;var _433=_432.toMap(new _40b(parseInt(_431.left,10),parseInt(_431.top,10)));var prev=new _40a(ext.xmin,ext.ymax,_432.spatialReference);this._focusExtent=ext.offset(_433.x-prev.x,_433.y-prev.y);if(this._maximized){this._maximizeHandler();}else{_432.centerAt(this._focusExtent.getCenter());}this._suspendPanHandling=true;this.map.setExtent(this._focusExtent);},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent);},_ovwPanHandler:function(ext,_434){this._drawFocusDiv(this._focusExtent,_434);}});if(has("extend-esri")){lang.setObject("dijit.OverviewMap",OM,_413);}return OM;});},"esri/layers/GridLayout":function(){define("esri/layers/GridLayout",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/Polyline"],function(_435,lang,_436,has,_437,_438,_439,_43a){var _43b=_435(null,{declaredClass:"esri.layers._GridLayout",constructor:function(_43c,_43d,_43e,_43f){this.origin=_43c;this.cellWidth=_43d.width;this.cellHeight=_43d.height;this.mapWidth=_43e.width;this.mapHeight=_43e.height;this.srInfo=_43f;},setResolution:function(_440){this._resolution=(_440.xmax-_440.xmin)/this.mapWidth;if(this.srInfo){var _441=Math.round((2*this.srInfo.valid[1])/this._resolution),_442=Math.round(_441/this.cellWidth);this._frameStats=[_442,0,_442-1];}},getCellCoordinates:function(_443){var res=this._resolution,_444=this.origin;return {row:Math.floor((_444.y-_443.y)/(this.cellHeight*res)),col:Math.floor((_443.x-_444.x)/(this.cellWidth*res))};},normalize:function(col){var _445=this._frameStats;if(_445){var _446=_445[0],m180=_445[1],p180=_445[2];if(col<m180){col=col%_446;col=col<m180?col+_446:col;}else{if(col>p180){col=col%_446;}}}return col;},intersects:function(_447,_448){var _449=this.srInfo;if(_449){return _436.some(_448._getParts(_449),function(_44a){return _447.intersects(_44a.extent);});}else{return _447.intersects(_448);}},getCellExtent:function(row,col){var res=this._resolution,_44b=this.origin,_44c=this.cellWidth,_44d=this.cellHeight;return new _439((col*_44c*res)+_44b.x,_44b.y-((row+1)*_44d*res),((col+1)*_44c*res)+_44b.x,_44b.y-(row*_44d*res),new _438(_44b.spatialReference.toJson()));},getLatticeID:function(_44e){var _44f=this.getCellCoordinates({x:_44e.xmin,y:_44e.ymax}),_450=this.getCellCoordinates({x:_44e.xmax,y:_44e.ymin}),_451=_44f.row,_452=_450.row,_453=this.normalize(_44f.col),_454=this.normalize(_450.col);return _451+"_"+_452+"_"+_453+"_"+_454;},sorter:function(a,b){return (a<b)?-1:1;},getCellsInExtent:function(_455,_456){var _457=this.getCellCoordinates({x:_455.xmin,y:_455.ymax}),_458=this.getCellCoordinates({x:_455.xmax,y:_455.ymin}),_459=_457.row,_45a=_458.row,_45b=_457.col,_45c=_458.col,_45d=[],i,j,nj,_45e=[],_45f=[],len,xmin,xmax,ymin,ymax,_460=[],_461,_462;for(i=_459;i<=_45a;i++){for(j=_45b;j<=_45c;j++){nj=this.normalize(j);_455=this.getCellExtent(i,nj);_45d.push({row:i,col:nj,extent:_455,resolution:this._resolution});if(_456){_45e.push(_455.xmin,_455.xmax);_45f.push(_455.ymin,_455.ymax);}}}_45b=this.normalize(_45b);_45c=this.normalize(_45c);_45e.sort(this.sorter);_45f.sort(this.sorter);len=_45e.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_45e[i]===_45e[i+1]){_45e.splice(i,1);}}}len=_45f.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_45f[i]===_45f[i+1]){_45f.splice(i,1);}}}if(_45e.length&&_45f.length){xmin=_45e[0];xmax=_45e[_45e.length-1];ymin=_45f[0];ymax=_45f[_45f.length-1];len=_45e.length;for(i=0;i<len;i++){_460.push([[_45e[i],ymax],[_45e[i],ymin]]);}len=_45f.length;for(i=0;i<len;i++){_460.push([[xmin,_45f[i]],[xmax,_45f[i]]]);}_461=new _43a({paths:_460,spatialReference:this.origin.spatialReference.toJson()});_462=_459+"_"+_45a+"_"+_45b+"_"+_45c;_45d.push({latticeID:_462,lattice:_461,resolution:this._resolution});}return {minRow:_459,maxRow:_45a,minCol:_45b,maxCol:_45c,cells:_45d};}});if(has("extend-esri")){lang.setObject("layers._GridLayout",_43b,_437);}return _43b;});},"dojox/data/CsvStore":function(){define("dojox/data/CsvStore",["dojo/_base/lang","dojo/_base/declare","dojo/_base/xhr","dojo/_base/kernel","dojo/data/util/filter","dojo/data/util/simpleFetch"],function(lang,_463,xhr,_464,_465,_466){var _467=_463("dojox.data.CsvStore",null,{constructor:function(_468){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=false;if(_468.url){this.url=_468.url;}this._csvData=_468.data;if(_468.label){this.label=_468.label;}else{if(this.label===""){this.label=undefined;}}this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];this.identifier=_468.identifier;if(this.identifier===""){delete this.identifier;}else{this._idMap={};}if("separator" in _468){this.separator=_468.separator;}if("urlPreventCache" in _468){this.urlPreventCache=_468.urlPreventCache?true:false;}},url:"",label:"",identifier:"",separator:",",urlPreventCache:false,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error(this.declaredClass+": a function was passed an item argument that was not an item");}},_getIndex:function(item){var idx=this.getIdentity(item);if(this.identifier){idx=this._idMap[idx];}return idx;},getValue:function(item,_469,_46a){this._assertIsItem(item);var _46b=_46a;if(typeof _469==="string"){var ai=this._attributeIndexes[_469];if(ai!=null){var _46c=this._dataArray[this._getIndex(item)];_46b=_46c[ai]||_46a;}}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}return _46b;},getValues:function(item,_46d){var _46e=this.getValue(item,_46d);return (_46e?[_46e]:[]);},getAttributes:function(item){this._assertIsItem(item);var _46f=[];var _470=this._dataArray[this._getIndex(item)];for(var i=0;i<_470.length;i++){if(_470[i]!==""){_46f.push(this._attributes[i]);}}return _46f;},hasAttribute:function(item,_471){this._assertIsItem(item);if(typeof _471==="string"){var _472=this._attributeIndexes[_471];var _473=this._dataArray[this._getIndex(item)];return (typeof _472!=="undefined"&&_472<_473.length&&_473[_472]!=="");}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}},containsValue:function(item,_474,_475){var _476=undefined;if(typeof _475==="string"){_476=_465.patternToRegExp(_475,false);}return this._containsValue(item,_474,_475,_476);},_containsValue:function(item,_477,_478,_479){var _47a=this.getValues(item,_477);for(var i=0;i<_47a.length;++i){var _47b=_47a[i];if(typeof _47b==="string"&&_479){return (_47b.match(_479)!==null);}else{if(_478===_47b){return true;}}}return false;},isItem:function(_47c){if(_47c&&_47c[this._storeProp]===this){var _47d=_47c[this._idProp];if(this.identifier){var data=this._dataArray[this._idMap[_47d]];if(data){return true;}}else{if(_47d>=0&&_47d<this._dataArray.length){return true;}}}return false;},isItemLoaded:function(_47e){return this.isItem(_47e);},loadItem:function(item){},getFeatures:function(){return this._features;},getLabel:function(item){if(this.label&&this.isItem(item)){return this.getValue(item,this.label);}return undefined;},getLabelAttributes:function(item){if(this.label){return [this.label];}return null;},_fetchItems:function(_47f,_480,_481){var self=this;var _482=function(_483,_484){var _485=null;if(_483.query){var key,_486;_485=[];var _487=_483.queryOptions?_483.queryOptions.ignoreCase:false;var _488={};for(key in _483.query){_486=_483.query[key];if(typeof _486==="string"){_488[key]=_465.patternToRegExp(_486,_487);}}for(var i=0;i<_484.length;++i){var _489=true;var _48a=_484[i];for(key in _483.query){_486=_483.query[key];if(!self._containsValue(_48a,key,_486,_488[key])){_489=false;}}if(_489){_485.push(_48a);}}}else{_485=_484.slice(0,_484.length);}_480(_485,_483);};if(this._loadFinished){_482(_47f,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_47f,filter:_482});}else{this._loadInProgress=true;var _48b={url:self.url,handleAs:"text",preventCache:self.urlPreventCache};var _48c=xhr.get(_48b);_48c.addCallback(function(data){try{self._processData(data);_482(_47f,self._arrayOfAllItems);self._handleQueuedFetches();}catch(e){_481(e,_47f);}});_48c.addErrback(function(_48d){self._loadInProgress=false;if(_481){_481(_48d,_47f);}else{throw _48d;}});var _48e=null;if(_47f.abort){_48e=_47f.abort;}_47f.abort=function(){var df=_48c;if(df&&df.fired===-1){df.cancel();df=null;}if(_48e){_48e.call(_47f);}};}}else{if(this._csvData){try{this._processData(this._csvData);this._csvData=null;_482(_47f,this._arrayOfAllItems);}catch(e){_481(e,_47f);}}else{var _48f=new Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(_481){_481(_48f,_47f);}else{throw _48f;}}}}},close:function(_490){},_getArrayOfArraysFromCsvFileContents:function(_491){if(lang.isString(_491)){var _492=new RegExp("^\\s+","g");var _493=new RegExp("\\s+$","g");var _494=new RegExp("\"\"","g");var _495=[];var i;var _496=this._splitLines(_491);for(i=0;i<_496.length;++i){var _497=_496[i];if(_497.length>0){var _498=_497.split(this.separator);var j=0;while(j<_498.length){var _499=_498[j];var _49a=_499.replace(_492,"");var _49b=_49a.replace(_493,"");var _49c=_49b.charAt(0);var _49d=_49b.charAt(_49b.length-1);var _49e=_49b.charAt(_49b.length-2);var _49f=_49b.charAt(_49b.length-3);if(_49b.length===2&&_49b=="\"\""){_498[j]="";}else{if((_49c=="\"")&&((_49d!="\"")||((_49d=="\"")&&(_49e=="\"")&&(_49f!="\"")))){if(j+1===_498.length){return;}var _4a0=_498[j+1];_498[j]=_49a+this.separator+_4a0;_498.splice(j+1,1);}else{if((_49c=="\"")&&(_49d=="\"")){_49b=_49b.slice(1,(_49b.length-1));_49b=_49b.replace(_494,"\"");}_498[j]=_49b;j+=1;}}}_495.push(_498);}}this._attributes=_495.shift();for(i=0;i<this._attributes.length;i++){this._attributeIndexes[this._attributes[i]]=i;}this._dataArray=_495;}},_splitLines:function(_4a1){var _4a2=[];var i;var line="";var _4a3=false;for(i=0;i<_4a1.length;i++){var c=_4a1.charAt(i);switch(c){case "\"":_4a3=!_4a3;line+=c;break;case "\r":if(_4a3){line+=c;}else{_4a2.push(line);line="";if(i<(_4a1.length-1)&&_4a1.charAt(i+1)=="\n"){i++;}}break;case "\n":if(_4a3){line+=c;}else{_4a2.push(line);line="";}break;default:line+=c;}}if(line!==""){_4a2.push(line);}return _4a2;},_processData:function(data){this._getArrayOfArraysFromCsvFileContents(data);this._arrayOfAllItems=[];if(this.identifier){if(this._attributeIndexes[this.identifier]===undefined){throw new Error(this.declaredClass+": Identity specified is not a column header in the data set.");}}for(var i=0;i<this._dataArray.length;i++){var id=i;if(this.identifier){var _4a4=this._dataArray[i];id=_4a4[this._attributeIndexes[this.identifier]];this._idMap[id]=i;}this._arrayOfAllItems.push(this._createItemFromIdentity(id));}this._loadFinished=true;this._loadInProgress=false;},_createItemFromIdentity:function(_4a5){var item={};item[this._storeProp]=this;item[this._idProp]=_4a5;return item;},getIdentity:function(item){if(this.isItem(item)){return item[this._idProp];}return null;},fetchItemByIdentity:function(_4a6){var item;var _4a7=_4a6.scope?_4a6.scope:_464.global;if(!this._loadFinished){var self=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_4a6});}else{this._loadInProgress=true;var _4a8={url:self.url,handleAs:"text"};var _4a9=xhr.get(_4a8);_4a9.addCallback(function(data){try{self._processData(data);var item=self._createItemFromIdentity(_4a6.identity);if(!self.isItem(item)){item=null;}if(_4a6.onItem){_4a6.onItem.call(_4a7,item);}self._handleQueuedFetches();}catch(error){if(_4a6.onError){_4a6.onError.call(_4a7,error);}}});_4a9.addErrback(function(_4aa){this._loadInProgress=false;if(_4a6.onError){_4a6.onError.call(_4a7,_4aa);}});}}else{if(this._csvData){try{self._processData(self._csvData);self._csvData=null;item=self._createItemFromIdentity(_4a6.identity);if(!self.isItem(item)){item=null;}if(_4a6.onItem){_4a6.onItem.call(_4a7,item);}}catch(e){if(_4a6.onError){_4a6.onError.call(_4a7,e);}}}}}else{item=this._createItemFromIdentity(_4a6.identity);if(!this.isItem(item)){item=null;}if(_4a6.onItem){_4a6.onItem.call(_4a7,item);}}},getIdentityAttributes:function(item){if(this.identifier){return [this.identifier];}else{return null;}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _4ab=this._queuedFetches[i];var _4ac=_4ab.filter;var _4ad=_4ab.args;if(_4ac){_4ac(_4ad,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_4ab.args);}}this._queuedFetches=[];}}});lang.extend(_467,_466);return _467;});},"esri/arcgis/csv":function(){define("esri/arcgis/csv",["dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/sniff","dojo/number","dojox/data/CsvStore","esri/kernel","esri/config","esri/request","esri/SpatialReference","esri/geometry/Point","esri/geometry/jsonUtils","esri/geometry/webMercatorUtils"],function(lang,_4ae,_4af,has,_4b0,_4b1,_4b2,_4b3,_4b4,_4b5,_4b6,_4b7,_4b8){var _4b9=["lat","latitude","y","ycenter","latitude83","latdecdeg","POINT-Y"],_4ba=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","POINT-X"];function _4bb(_4bc){var _4bd=[","," ",";","|","\t"];var _4be=0;var _4bf="";_4ae.forEach(_4bd,function(_4c0){var _4c1=_4bc.split(_4c0).length;if(_4c1>_4be){_4be=_4c1;_4bf=_4c0;}});return _4bf;};function _4c2(d,_4c3){if(!d||Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){return false;}var _4c4=true;if(has("chrome")&&/\d+\W*$/.test(_4c3)){var _4c5=_4c3.match(/[a-zA-Z]{2,}/);if(_4c5){var _4c6=false,i=0,len=_4c5.length,_4c7=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;while(!_4c6&&(i<=len)&&!(_4c6=!_4c7.test(_4c5[i]))){i++;}_4c4=!_4c6;}}return _4c4;};function _4c8(data,_4c9,_4ca){var _4cb=data.indexOf("\n");var _4cc=lang.trim(data.substr(0,_4cb));var _4cd=_4c9.columnDelimiter;if(!_4cd){_4cd=_4bb(_4cc);}var _4ce=new _4b1({data:data,separator:_4cd});var _4cf=(has("ie")<9)?750:1001;_4ce.fetch({start:0,count:_4cf,onComplete:function(_4d0,_4d1){var _4d2=0;var _4d3={"layerDefinition":_4c9.layerDefinition,"featureSet":{"features":[],"geometryType":"esriGeometryPoint"}};var _4d4=_4d3.layerDefinition.objectIdField;if(!_4d4){if(!_4ae.some(_4d3.layerDefinition.fields,function(_4d5){if(_4d5.type=="esriFieldTypeOID"){_4d4=_4d5.name;return true;}return false;})){_4d3.layerDefinition.fields.push({"name":"__OBJECTID","alias":"__OBJECTID","type":"esriFieldTypeOID","editable":false,"domain":null});_4d4="__OBJECTID";}}var _4d6,_4d7;var _4d8=_4ce._attributes;var _4d9=[];var _4da=[];_4ae.forEach(_4d3.layerDefinition.fields,function(_4db,_4dc){if(_4db.type==="esriFieldTypeDate"){_4d9.push(_4db.name);}else{if(_4db.type==="esriFieldTypeDouble"||_4db.type==="esriFieldTypeInteger"){_4da.push(_4db.name);}}});if(_4c9.locationInfo&&_4c9.locationInfo.locationType==="coordinates"){_4d6=_4c9.locationInfo.latitudeFieldName;_4d7=_4c9.locationInfo.longitudeFieldName;}else{_4ae.forEach(_4d8,function(_4dd){var _4de;_4de=_4ae.indexOf(_4b9,_4dd.toLowerCase());if(_4de!==-1){_4d6=_4dd;}_4de=_4ae.indexOf(_4ba,_4dd.toLowerCase());if(_4de!==-1){_4d7=_4dd;}},this);}if(!_4d6||!_4d7){setTimeout(function(){},1);return;}var i=0,il=_4d0.length;for(i;i<il;i++){if(_4d3.featureSet.features.length>=1000){setTimeout(function(){},1);break;}var item=_4d0[i];var _4df=_4ce.getAttributes(item),_4e0={};_4ae.forEach(_4df,function(attr,_4e1){if(attr){var _4e2=attr;if(attr.length===0){_4ae.forEach(_4d3.layerDefinition.fields,function(_4e3,idx){if(_4e3.name==="attribute_"+(idx-1)){attr="attribute_"+(idx-1);}});}if(_4ae.some(_4d9,function(a){return a===attr;})){var val=_4ce.getValue(item,_4e2),date=new Date(val);_4e0[attr]=_4c2(date,val)?date.getTime():null;}else{if(_4ae.some(_4da,function(a){return a===attr;})){var _4e4=_4b0.parse(_4ce.getValue(item,_4e2));if((attr==_4d6||attr==_4d7)&&(isNaN(_4e4)||Math.abs(_4e4)>181)){_4e4=parseFloat(_4ce.getValue(item,_4e2));if(isNaN(_4e4)){_4e0[attr]=null;}else{_4e0[attr]=_4e4;}}else{if(isNaN(_4e4)){_4e0[attr]=null;}else{_4e0[attr]=_4e4;}}}else{_4e0[attr]=_4ce.getValue(item,_4e2);}}}});_4e0[_4d4]=_4d2;_4d2++;var _4e5=_4e0[_4d6];var _4e6=_4e0[_4d7];if(_4e6==null||_4e5==null||isNaN(_4e5)||isNaN(_4e6)){continue;}var _4e7=new _4b6(_4e6,_4e5,new _4b5({wkid:4326}));var _4e8={"geometry":_4e7.toJson(),"attributes":_4e0};_4d3.featureSet.features.push(_4e8);}_4d3.layerDefinition.name="csv";if(_4ca){_4ca(_4d3);}},onError:function(_4e9){}});return true;};function _4ea(_4eb,_4ec,inSR,_4ed,_4ee,_4ef){if(_4eb.length===0){_4ee(null);}var _4f0=_4b7.getGeometryType(_4ec);var _4f1=[];_4ae.forEach(_4eb,function(_4f2){var _4f3=new _4f0(_4f2);_4f3.spatialReference=inSR;_4f1.push(_4f3);},this);var _4f4=[102113,102100,3857];if(inSR.wkid&&inSR.wkid===4326&&_4ed.wkid&&_4ae.indexOf(_4f4,_4ed.wkid)>-1){_4ae.forEach(_4f1,function(_4f5){if(_4f5.xmin){_4f5.xmin=Math.max(_4f5.xmin,-180);_4f5.xmax=Math.min(_4f5.xmax,180);_4f5.ymin=Math.max(_4f5.ymin,-89.99);_4f5.ymax=Math.min(_4f5.ymax,89.99);}else{if(_4f5.rings){_4ae.forEach(_4f5.rings,function(ring){_4ae.forEach(ring,function(_4f6){_4f6[0]=Math.min(Math.max(_4f6[0],-180),180);_4f6[1]=Math.min(Math.max(_4f6[1],-89.99),89.99);},this);},this);}else{if(_4f5.paths){_4ae.forEach(_4f5.paths,function(path){_4ae.forEach(path,function(_4f7){_4f7[0]=Math.min(Math.max(_4f7[0],-180),180);_4f7[1]=Math.min(Math.max(_4f7[1],-89.99),89.99);},this);},this);}else{if(_4f5.x){_4f5.x=Math.min(Math.max(_4f5.x,-180),180);_4f5.y=Math.min(Math.max(_4f5.y,-89.99),89.99);}}}}},this);_4eb=[];_4ae.forEach(_4f1,function(_4f8){var _4f9=_4b8.geographicToWebMercator(_4f8);if(_4ed.wkid!==102100){_4f9.spatialReference=_4ed;}_4eb.push(_4f9.toJson());},this);_4ee(_4eb);}else{if(inSR.wkid!==null&&_4ae.indexOf(_4f4,inSR.wkid)>-1&&_4ed.wkid!==null&&_4ed.wkid===4326){_4eb=[];_4ae.forEach(_4f1,function(_4fa){_4eb.push(_4b8.webMercatorToGeographic(_4fa).toJson());},this);_4ee(_4eb);}else{var _4fb=function(_4fc,args){if(_4fc&&_4fc.length===_4eb.length){_4eb=[];_4ae.forEach(_4fc,function(_4fd){if(_4fd&&((_4fd.rings&&_4fd.rings.length>0&&_4fd.rings[0].length>0&&_4fd.rings[0][0].length>0&&!isNaN(_4fd.rings[0][0][0])&&!isNaN(_4fd.rings[0][0][1]))||(_4fd.paths&&_4fd.paths.length>0&&_4fd.paths[0].length>0&&_4fd.paths[0][0].length>0&&!isNaN(_4fd.paths[0][0][0])&&!isNaN(_4fd.paths[0][0][1]))||(_4fd.xmin&&!isNaN(_4fd.xmin)&&_4fd.ymin&&!isNaN(_4fd.ymin))||(_4fd.x&&!isNaN(_4fd.x)&&_4fd.y&&!isNaN(_4fd.y)))){_4eb.push(_4fd.toJson());}else{_4eb.push(null);}},this);_4ee(_4eb);}else{_4ef(_4fc,args);}};if(_4b3.defaults.geometryService){_4b3.defaults.geometryService.project(_4f1,_4ed,lang.hitch(this,_4fb),_4ef);}else{_4ee(null);}}}};function _4fe(sp1,sp2){var _4ff=[102113,102100,3857];if(sp1&&sp2&&sp1.wkid===sp2.wkid&&sp1.wkt===sp2.wkt){return true;}else{if(sp1&&sp2&&sp1.wkid&&sp2.wkid&&_4ae.indexOf(_4ff,sp1.wkid)>-1&&_4ae.indexOf(_4ff,sp2.wkid)>-1){return true;}}return false;};function _500(_501,_502,_503,_504){if(!_501.featureSet||_501.featureSet.length===0){return;}if(_4fe(_503,_502)){_504(_501);return;}var _505=function(_506){var _507=[];_4ae.forEach(_501.featureSet.features,function(_508,i){if(_506[i]){_508.geometry=_506[i];_507.push(_508);}},this);_504(_501);};var _509=function(_50a,args){_504(_501);};var _50b=function(_50c,args){_4ea(_50d,_501.featureSet.geometryType,_502,_503,lang.hitch(this,_505),lang.hitch(this,_509));};if(_501.featureSet.features&&_501.featureSet.features.length>0){var _50d=[];_4ae.forEach(_501.featureSet.features,function(_50e){_50d.push(_50e.geometry);});_4ea(_50d,_501.featureSet.geometryType,_502,_503,lang.hitch(this,_505),lang.hitch(this,_50b));}else{_504(_501);}};function _50f(_510){var _511=new _4af();var _512=function(_513){_511.callback(_513);};var _514=_4b4({url:_510.url,handleAs:"text",load:function(_515){_4c8(_515,_510,lang.hitch(this,_512));},error:function(_516){}},{usePost:false});return _511;};function _517(_518,_519){var _51a=new _4af();var _51b=function(_51c){_51a.callback(_51c);};_500(_518,new _4b5({wkid:4326}),_519,lang.hitch(this,_51b));return _51a;};function _51d(_51e){var _51f=_51e.layerDefinition.fields;var _520={"esriFieldTypeDouble":1,"esriFieldTypeSingle":1};var _521={"esriFieldTypeInteger":1,"esriFieldTypeSmallInteger":1};var dt={"esriFieldTypeDate":1};var _522=null;var _523=_4ae.map(_51f,lang.hitch(this,function(item){if(item.name.toUpperCase()==="NAME"){_522=item.name;}var _524=(item.type!=="esriFieldTypeOID"&&item.type!=="esriFieldTypeGlobalID"&&item.type!=="esriFieldTypeGeometry");var _525=null;if(_524){var f=item.name.toLowerCase();var _526=",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";if(_526.indexOf(","+f+",")>-1||f.indexOf("area")>-1||f.indexOf("length")>-1||f.indexOf("shape")>-1||f.indexOf("perimeter")>-1||f.indexOf("objectid")>-1||f.indexOf("_")===f.length-1||(f.indexOf("_i")===f.length-2&&f.length>1)){_524=false;}if(item.type in _521){_525={places:0,digitSeparator:true};}else{if(item.type in _520){_525={places:2,digitSeparator:true};}else{if(item.type in dt){_525={dateFormat:"shortDateShortTime"};}}}}return lang.mixin({},{fieldName:item.name,label:item.alias,isEditable:true,tooltip:"",visible:_524,format:_525,stringFieldOption:"textbox"});}));var _527={title:_522?"{"+_522+"}":"",fieldInfos:_523,description:null,showAttachments:false,mediaInfos:[]};return _527;};var csv={latFieldStrings:_4b9,longFieldStrings:_4ba,buildCSVFeatureCollection:_50f,projectFeatureCollection:_517,generateDefaultPopupInfo:_51d,_getSeparator:_4bb,_isValidDate:_4c2,_processCsvData:_4c8,_projectGeometries:_4ea,_sameSpatialReference:_4fe,_projectFeatureSet:_500};if(has("extend-esri")){lang.setObject("arcgis.csv",csv,_4b2);}return csv;});},"dojo/data/util/filter":function(){define("dojo/data/util/filter",["../../_base/lang"],function(lang){var _528={};lang.setObject("dojo.data.util.filter",_528);_528.patternToRegExp=function(_529,_52a){var rxp="^";var c=null;for(var i=0;i<_529.length;i++){c=_529.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_529.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_52a){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _528;});},"esri/layers/WMSLayerInfo":function(){define("esri/layers/WMSLayerInfo",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(_52b,lang,_52c,has,_52d){var _52e=_52b(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(_52f){if(_52f){this.name=_52f.name;this.title=_52f.title;this.description=_52f.description;this.extent=_52f.extent;this.legendURL=_52f.legendURL;this.subLayers=_52f.subLayers?_52f.subLayers:[];this.allExtents=_52f.allExtents?_52f.allExtents:[];this.spatialReferences=_52f.spatialReferences?_52f.spatialReferences:[];}},clone:function(){var info={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},wkid;if(this.extent){info.extent=this.extent.getExtent();}info.subLayers=[];_52c.forEach(this.subLayers,function(_530){info.subLayers.push(_530.clone());});info.allExtents=[];for(wkid in this.allExtents){wkid=parseInt(wkid,10);if(!isNaN(wkid)){info.allExtents[wkid]=this.allExtents[wkid].getExtent();}}info.spatialReferences=[];_52c.forEach(this.spatialReferences,function(wkid){info.spatialReferences.push(wkid);});return info;}});if(has("extend-esri")){lang.setObject("layers.WMSLayerInfo",_52e,_52d);}return _52e;});},"esri/dijit/BasemapLayer":function(){define("esri/dijit/BasemapLayer",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_531,lang,has,_532){var BML=_531(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(_533){_533=_533||{};if(!_533.url&&!_533.type){}this.url=_533.url;this.type=_533.type;this.isReference=(_533.isReference===true)?true:false;this.displayLevels=_533.displayLevels;this.visibleLayers=_533.visibleLayers;this.bandIds=_533.bandIds;this.opacity=_533.opacity;}});if(has("extend-esri")){lang.setObject("dijit.BasemapLayer",BML,_532);}return BML;});},"esri/layers/RenderMode":function(){define("esri/layers/RenderMode",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/io/script","esri/kernel"],function(_534,_535,lang,_536,has,_537,_538){var _539=_535(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(_534._scopeName||"dojo")+"IoScript";},initialize:function(map){this.map=map;this._init=true;},startup:function(){},propertyChangeHandler:function(type){},destroy:function(){this._init=false;},drawFeature:function(_53a){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(oid){var _53b=this._featureMap[oid];if(_53b){_53b._count++;}},_decRefCount:function(oid){var _53c=this._featureMap[oid];if(_53c){_53c._count--;}},_getFeature:function(oid){return this._featureMap[oid];},_addFeatureIIf:function(oid,_53d){var fmap=this._featureMap,_53e=fmap[oid],_53f=this.featureLayer;if(!_53e){fmap[oid]=_53d;_53f._add(_53d);_53d._count=0;}return _53e||_53d;},_removeFeatureIIf:function(oid){var _540=this._featureMap[oid],_541=this.featureLayer;if(_540){if(_540._count){return;}delete this._featureMap[oid];_541._remove(_540);}return _540;},_clearIIf:function(){var i,_542=this.featureLayer,_543=_542.graphics,_544=_542._selectedFeatures,_545=_542.objectIdField;for(i=_543.length-1;i>=0;i--){var _546=_543[i];var oid=_546.attributes[_545];if(oid in _544){_546._count=1;continue;}_546._count=0;this._removeFeatureIIf(oid);}},_isPending:function(id){var dfd=_537[this._prefix+id];return dfd?true:false;},_cancelPendingRequest:function(dfd,id){dfd=dfd||_537[this._prefix+id];if(dfd){try{dfd.cancel();_537._validCheck(dfd);}catch(e){}}},_purgeRequests:function(){_537._validCheck(null);},_toggleVisibility:function(show){var _547=this.featureLayer,_548=_547.graphics,_549=show?"show":"hide",i,len=_548.length;show=show&&_547._ager;for(i=0;i<len;i++){var _54a=_548[i];_54a[_549]();if(show){_547._repaint(_54a);}}},_applyTimeFilter:function(_54b){var _54c=this.featureLayer;if(!_54c.timeInfo||_54c.suspended){return;}if(!_54b){_54c._fireUpdateStart();}var _54d=_54c._trackManager;if(_54d){_54d.clearTracks();}var defn=_54c.getTimeDefinition(),_54e=_54c._getOffsettedTE(_54c._mapTimeExtent);if(_54e){_54e=_54c._getTimeOverlap(defn,_54e);if(_54e){var _54f=_54c._filterByTime(_54c.graphics,_54e.startTime,_54e.endTime);if(_54d){_54d.addFeatures(_54f.match);}_536.forEach(_54f.match,function(_550){var _551=_550._shape;if(!_550.visible){_550.show();_551=_550._shape;_551&&_551._moveToFront();}if(_54c._ager&&_551){_54c._repaint(_550);}});_536.forEach(_54f.noMatch,function(_552){if(_552.visible){_552.hide();}});}else{this._toggleVisibility(false);}}else{if(_54d){_54d.addFeatures(_54c.graphics);}this._toggleVisibility(true);}if(_54d){_54d.moveLatestToFront();_54d.drawTracks();}if(!_54b){_54c._fireUpdateEnd();}}});if(has("extend-esri")){lang.setObject("layers._RenderMode",_539,_538);}return _539;});},"esri/layers/FeatureType":function(){define("esri/layers/FeatureType",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/symbols/jsonUtils","esri/layers/RangeDomain","esri/layers/CodedValueDomain","esri/layers/InheritedDomain","esri/layers/FeatureTemplate"],function(_553,lang,_554,has,_555,_556,_557,_558,_559,_55a,_55b){var _55c=_553(null,{declaredClass:"esri.layers.FeatureType",constructor:function(json){if(json&&lang.isObject(json)){this.id=json.id;this.name=json.name;var _55d=json.symbol;if(_55d){this.symbol=_557.fromJson(_55d);}var _55e=json.domains,_55f,i;var _560=this.domains={};for(_55f in _55e){if(_55e.hasOwnProperty(_55f)){var _561=_55e[_55f];switch(_561.type){case "range":_560[_55f]=new _558(_561);break;case "codedValue":_560[_55f]=new _559(_561);break;case "inherited":_560[_55f]=new _55a(_561);break;}}}var _562=json.templates;if(_562){var _563=this.templates=[];for(i=0;i<_562.length;i++){_563.push(new _55b(_562[i]));}}}},toJson:function(){var json={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()};var _564,_565=this.domains,_566=this.templates,_567=_556.fixJson;if(_565){var _568=json.domains={};for(_564 in _565){if(_565.hasOwnProperty(_564)){_568[_564]=_565[_564]&&_565[_564].toJson();}}_567(_568);}if(_566){json.templates=_554.map(_566,function(_569){return _569.toJson();});}return _567(json);}});if(has("extend-esri")){lang.setObject("layers.FeatureType",_55c,_555);}return _55c;});},"esri/dijit/Basemap":function(){define("esri/dijit/Basemap",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/has","esri/kernel","esri/request","esri/dijit/BasemapLayer"],function(_56a,_56b,lang,has,_56c,_56d,_56e){var BM=_56a(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(_56f,_570){_56f=_56f||{};if(!_56f.layers&&!_56f.itemId){}this.id=_56f.id;this.itemId=_56f.itemId;this.layers=_56f.layers;this.title=_56f.title||"";this.thumbnailUrl=_56f.thumbnailUrl;this.basemapGallery=_570;},getLayers:function(){if(this.layers){return this.layers;}else{if(this.itemId){var url=_56c.dijit._arcgisUrl+"/content/items/"+this.itemId+"/data";var _571={};_571.f="json";var _572=_56d({url:url,content:_571,callbackParamName:"callback",error:lang.hitch(this,function(_573,args){var msg="esri.dijit.Basemap: could not access basemap item.";if(this.basemapGallery){this.basemapGallery.onError(msg);}else{}})});_572.addCallback(lang.hitch(this,function(_574,args){if(_574.baseMap){this.layers=[];_56b.forEach(_574.baseMap.baseMapLayers,function(_575){var _576={};if(_575.url){_576.url=_575.url;}if(_575.type){_576.type=_575.type;}if(_575.isReference){_576.isReference=_575.isReference;}if(_575.displayLevels){_576.displayLevels=_575.displayLevels;}if(_575.visibleLayers){_576.visibleLayers=_575.visibleLayers;}if(_575.bandIds){_576.bandIds=_575.bandIds;}this.layers.push(new _56e(_576));},this);return this.layers;}else{var msg="esri.dijit.Basemap: could not access basemap item.";if(this.basemapGallery){this.basemapGallery.onError(msg);}else{}return [];}}));return _572;}}}});if(has("extend-esri")){lang.setObject("dijit.Basemap",BM,_56c);}return BM;});},"url:esri/dijit/templates/BasemapGallery.html":"<div class=\"esriBasemapGallery\">\r\n  <div dojoAttachPoint=\"flowContainer\">\r\n  </div>\r\n</div>","esri/arcgis/utils":function(){define("esri/arcgis/utils",["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/_base/json","dojo/_base/url","dojo/has","dojo/DeferredList","dojo/dom-construct","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/map","esri/urlUtils","esri/geometry/ScreenPoint","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/symbols/jsonUtils","esri/renderers/jsonUtils","esri/dijit/PopupTemplate","esri/dijit/Popup","esri/tasks/query","esri/tasks/GeometryService","esri/arcgis/csv","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/layers/WebTiledLayer","esri/layers/FeatureLayer","esri/layers/WMSLayer","esri/layers/KMLLayer","esri/layers/GeoRSSLayer","esri/virtualearth/VETiledLayer","esri/layers/TileInfo","esri/layers/DynamicLayerInfo","esri/layers/LayerDrawingOptions","esri/layers/ImageParameters","esri/layers/ImageServiceParameters","esri/layers/RasterFunction","esri/layers/MosaicRule","esri/layers/WMSLayerInfo","dojo/i18n!esri/nls/jsapi"],function(lang,_577,_578,_579,_57a,Url,has,_57b,_57c,_57d,_57e,_57f,_580,_581,Map,_582,_583,_584,_585,_586,_587,_588,_589,_58a,_58b,csv,_58c,_58d,_58e,_58f,_590,_591,_592,_593,_594,_595,_596,_597,_598,_599,_59a,_59b,_59c,_59d,_59e){String.prototype.endsWith=function(str){return (this.match(str+"$")==str);};var _59f;function _5a0(_5a1){var url=_59f.arcgisUrl+"/"+_5a1.itemId+"/data";var _5a2=_580({url:url,content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:true,_preLookup:true});return _5a2;};function _5a3(_5a4){var _5a5={f:"json"};if(_57d.id){var _5a6=_57d.id.findCredential(_582.urlToObject(_59f.arcgisUrl).path);if(_5a6){_5a5.token=_5a6.token;}}var _5a7=_580({url:_5a4,content:_5a5,callbackParamName:"callback"},{"disableIdentityLookup":true});return _5a7;};function _5a8(_5a9){if(_5a9.itemProperties.layerDefinition){if(_5a9.layerDefinition){if(!_5a9.layerDefinition.drawingInfo){_5a9.layerDefinition.drawingInfo=_5a9.itemProperties.layerDefinition.drawingInfo;}if(!_57f.isDefined(_5a9.layerDefinition.definitionExpression)){_5a9.layerDefinition.definitionExpression=_5a9.itemProperties.layerDefinition.definitionExpression;}if(!_57f.isDefined(_5a9.layerDefinition.minScale)){_5a9.layerDefinition.minScale=_5a9.itemProperties.layerDefinition.minScale;}if(!_57f.isDefined(_5a9.layerDefinition.maxScale)){_5a9.layerDefinition.maxScale=_5a9.itemProperties.layerDefinition.maxScale;}}else{_5a9.layerDefinition=_5a9.itemProperties.layerDefinition;}}if(_5a9.itemProperties.popupInfo&&!_5a9.popupInfo&&!_5a9.disablePopup){_5a9.popupInfo=_5a9.itemProperties.popupInfo;}};function _5aa(_5ab,_5ac){var _5ad=new _579();var _5ae=_5ab.itemData;var _5af=[];var _5b0=[];_577.forEach(_5ae.operationalLayers,function(_5b1){if(_5b1.itemId&&!_5b1.type){var _5b2=_5b1.url.toLowerCase();if(_5b2.indexOf("/featureserver")>-1){_5b0.push(_5b1);_5af.push(_5a0(_5b1));}else{if(_5b2.indexOf("/mapserver")>-1&&_5b2.indexOf("/mapserver/")===-1&&(!_5b1.layers||(!_57f.isDefined(_5b1.minScale)&&!_57f.isDefined(_5b1.maxScale)))){_5b0.push(_5b1);_5af.push(_5a0(_5b1));}else{if(_5b2.indexOf("/imageserver")>-1&&!_57f.isDefined(_5b1.minScale)&&!_57f.isDefined(_5b1.maxScale)){_5b0.push(_5b1);_5af.push(_5a0(_5b1));}}}}});if(_5ae.baseMap&&_5ae.baseMap.baseMapLayers){_577.forEach(_5ae.baseMap.baseMapLayers,function(_5b3){if((_5b3.type==="BingMapsAerial"||_5b3.type==="BingMapsRoad"||_5b3.type==="BingMapsHybrid")&&_5b3.portalUrl){_5b0.push(_5b3);_5af.push(_5a3(_5b3.portalUrl));}});}if(_5af.length>0){var _5b4=new _57b(_5af);_5b4.addCallback(function(_5b5){_577.forEach(_5b0,function(_5b6,i){if((_5b6.type==="BingMapsAerial"||_5b6.type==="BingMapsRoad"||_5b6.type==="BingMapsHybrid")&&_5b6.portalUrl){if(_5b5[i][1].bingKey){_5ac.bingMapsKey=_5b5[i][1].bingKey;}else{_5b6.errors=_5b6.errors||[];var _5b7={message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. [type:"+_5b6.type+"]"};_5b6.errors.push(_5b7);}return;}var _5b8=_5b5[i][1];if(_5b8){var _5b9=_5b6.url.toLowerCase();if(_5b9.indexOf("/featureserver")>-1&&_5b8.layers){_577.forEach(_5b8.layers,function(_5ba){if(_5b9.endsWith("/featureserver/"+_5ba.id)){_5b6.itemProperties=_5ba;_5a8(_5b6);}});}else{if(_5b9.indexOf("/mapserver")>-1){if(_5b8.layers&&!_5b6.layers){_5b6.layers=_5b8.layers;}if(_57f.isDefined(_5b8.minScale)&&!_57f.isDefined(_5b6.minScale)){_5b6.minScale=_5b8.minScale;}if(_57f.isDefined(_5b8.maxScale)&&!_57f.isDefined(_5b6.maxScale)){_5b6.maxScale=_5b8.maxScale;}}else{if(_5b9.indexOf("/imageserver")>-1){if(_57f.isDefined(_5b8.minScale)&&!_57f.isDefined(_5b6.minScale)){_5b6.minScale=_5b8.minScale;}if(_57f.isDefined(_5b8.maxScale)&&!_57f.isDefined(_5b6.maxScale)){_5b6.maxScale=_5b8.maxScale;}}}}}});_5ad.callback(_5ab);});}else{_5ad.callback(_5ab);}return _5ad;};function _5bb(_5bc,_5bd){var _5be=_5bc.dynamicLayerInfos||_5bc.layerInfos;var _5bf=_5bd.layers;if(_5bf&&_5be){var _5c0=[],ids=[],urls=[];_577.forEach(_5be,function(_5c1){var id=_5c1.id,i;if(!_5c1.subLayerIds&&_577.indexOf(_5bc.visibleLayers,id)!==-1){for(i=0;i<_5bf.length;i++){var _5c2=_5bf[i];if(_5c2.id===id){ids.push(id);_5c0.push(_5c2.popupInfo);urls.push(_5c2.layerUrl||"");break;}}}});if(_5c0.length){_5bc.__popups=_5c0;_5bc.__popupIds=ids;_5bc.__popupUrls=urls;_5bc.__resourceInfo=_5bd.resourceInfo;}}};function _5c3(url){if(!url){return false;}var _5c4=".arcgis.com/";var _5c5=(new Url(_59f.arcgisUrl)).authority;return (url.indexOf(_5c4)!==-1||url.indexOf(_5c5)!==-1);};function _5c6(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);};function _5c7(url){if(location.protocol==="https:"&&(_5c3(url)||_5c6(url))){url=url.replace("http:","https:");}return url;};function _5c8(_5c9){var _5ca=[];if(!_5c9.displayLevels){_5ca=_577.map(_5c9.resourceInfo.tileInfo.lods,function(lod){return lod.level;});}var _5cb=new _58c(_5c7(_5c9.url),{resourceInfo:_5c9.resourceInfo,opacity:_5c9.opacity,visible:_5c9.visibility,displayLevels:_5c9.displayLevels||_5ca,id:_5c9.id,minScale:_5c9.minScale,maxScale:_5c9.maxScale});_5bb(_5cb,_5c9);return _5cb;};function _5cc(_5cd,_5ce){if(!_5cd||!_5ce||_5ce.length===0){return [];}var _5cf=","+_5ce+",";var _5d0=[];var _5d1="";var k,_5d2=",";for(k=0;k<_5cd.length;k++){if(_5cd[k].subLayerIds!==null){if(_5cf.indexOf(","+_5cd[k].id+",")===-1||_5d2.indexOf(","+_5cd[k].id+",")>-1){_5d2+=_5cd[k].subLayerIds.toString()+",";}}else{if(_5cf.indexOf(","+_5cd[k].id+",")>-1&&_5d2.indexOf(","+_5cd[k].id+",")===-1){_5d0.push(_5cd[k].id);_5d1=",";}}}return _5d0;};function _5d3(_5d4){var _5d5=new _599();_5d5.format="png24";if(_5d4.resourceInfo&&_5d4.resourceInfo.supportedImageFormatTypes&&_5d4.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")>-1){_5d5.format="png32";}var _5d6=new _58d(_5c7(_5d4.url),{resourceInfo:_5d4.resourceInfo,opacity:_5d4.opacity,visible:_5d4.visibility,id:_5d4.id,imageParameters:_5d5,minScale:_5d4.minScale,maxScale:_5d4.maxScale});var _5d7=_5d4.visibleLayers;if(!_5d4.visibleLayers){var _5d8="";var _5d9=_5d6.layerInfos;_577.forEach(_5d9,function(_5da){if(_5da.defaultVisibility){_5d8+=(_5d8.length>0?",":"")+_5da.id;}});_5d7=_5d8;}_5d7=_5cc(_5d6.layerInfos,_5d7);_5d6.setVisibleLayers(_5d7);if(_5d4.layers&&_5d4.layers.length>0){var _5db=[],_5dc=[],_5dd,_5de=[],_5df;_577.forEach(_5d4.layers,function(_5e0){if(_5e0.layerDefinition&&_5e0.layerDefinition.definitionExpression){_5db[_5e0.id]=_5e0.layerDefinition.definitionExpression;}if(_5e0.layerDefinition&&_5e0.layerDefinition.source){_5dd=new _597(lang.mixin(_5e0,_5e0.layerDefinition));delete _5dd.layerDefinition;_5dd.id=_5e0.id;if(_5d4.visibleLayers){if(_577.indexOf(_5d4.visibleLayers,_5e0.id)>-1){_5dd.defaultVisibility=true;}else{_5dd.defaultVisibility=false;}}_5dc.push(_5dd);}if(_5e0.layerDefinition&&_5e0.layerDefinition.source&&_5e0.layerDefinition.drawingInfo){_5df=new _598(_5e0.layerDefinition.drawingInfo);_5de[_5e0.id]=_5df;}},this);if(_5db.length>0){_5d6.setLayerDefinitions(_5db);}if(_5dc.length>0){_5d6.setDynamicLayerInfos(_5dc,true);if(_5de.length>0){_5d6.setLayerDrawingOptions(_5de,true);}}}_5bb(_5d6,_5d4);return _5d6;};function _5e1(_5e2,_5e3){var _5e4=[102113,102100,3857];var sp1=new _581(_5e3[0].layerObject.fullExtent.spatialReference);var sp2=new _581(_5e2.resourceInfo.fullExtent.spatialReference);if(sp1.wkt==sp2.wkt&&(sp1.wkid==sp2.wkid||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.wkid)||(esri.isDefined(sp2.latestWkid)&&sp1.wkid==sp2.latestWkid)||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.latestWkid))){return true;}else{if(sp1.wkid&&sp2.wkid&&_577.some(_5e4,function(wkid){return wkid===sp2.wkid;})&&_577.some(_5e4,function(wkid){return wkid===sp1.wkid;})){return true;}}return false;};function _5e5(_5e6,_5e7){if(!_5e7[0].layerObject.tileInfo){return false;}var _5e8=[];_577.forEach(_5e7,function(_5e9){if(_5e9.baseMapLayer){if(_5e9.layerObject.tileInfo){_5e8=_5e8.concat(_577.map(_5e9.layerObject.tileInfo.lods,function(lod){return lod.scale;}));}}});var _5ea=_577.some(_5e6.resourceInfo.tileInfo.lods,function(lod){return _577.some(_5e8,function(_5eb){return _5eb===lod.scale;});});return _5ea;};function _5ec(_5ed,_5ee,_5ef,_5f0){var _5f1,_5f2=_5ef._clazz;if(_5ed.type==="OpenStreetMap"){_5f1=new _58f({id:_5ed.id,opacity:_5ed.opacity,visible:(_5ed.visibility!==null&&_5ed.visibility!==undefined)?_5ed.visibility:true});}else{if(_5ed.type==="WMS"){var _5f3=[];var _5f4=[];_577.forEach(_5ed.layers,function(_5f5){_5f4.push(new _59d({name:_5f5.name,title:_5f5.title,legendURL:_5f5.legendURL}));_5f3.push(_5f5.name);},this);if(_5ed.visibleLayers){_5f3=_5ed.visibleLayers;}var _5f6=new _584(_5ed.extent[0][0],_5ed.extent[0][1],_5ed.extent[1][0],_5ed.extent[1][1],new _581({wkid:4326}));var _5f7={extent:_5f6,layerInfos:_5f4,version:_5ed.version,maxWidth:_5ed.maxWidth,maxHeight:_5ed.maxHeight,getMapUrl:_5ed.mapUrl,spatialReferences:_5ed.spatialReferences,title:_5ed.title,copyright:_5ed.copyright};_5f1=new _592(_5ed.url,{id:_5ed.id,visibleLayers:_5f3,format:"png",transparent:_5ed.baseMapLayer?false:true,opacity:_5ed.opacity,visible:(_5ed.visibility!==null)?_5ed.visibility:true,resourceInfo:_5f7});_5f1.spatialReference.wkid=_5f7.spatialReferences[0];}else{if(_5ed.type==="KML"){_5f1=new _593(_5ed.url,{id:_5ed.id,visible:(_5ed.visibility!==null)?_5ed.visibility:true,outSR:_5f0});_578.connect(_5f1,"onLoad",function(){var _5f8=function(_5f9){_577.forEach(_5f9,function(_5fa){if(_5fa.declaredClass==="esri.layers.FeatureLayer"||_5fa.declaredClass==="esri.layers.MapImageLayer"){_5fa.setOpacity(_5ed.opacity);}else{if(_5fa.declaredClass==="esri.layers.KMLLayer"){if(_5fa.loaded){_5f8(_5fa.getLayers());}else{_578.connect(_5fa,"onLoad",lang.hitch(this,function(lyr){_5f8(lyr.getLayers());}));}}}});};if(_5ed.opacity||_5ed.opacity===0){_5f8(_5f1.getLayers());}if(_5ed.visibleFolders){_577.forEach(_5f1.folders,function(_5fb){if(_577.indexOf(_5ed.visibleFolders,_5fb.id)>-1){_5f1.setFolderVisibility(_5fb,true);}else{_5f1.setFolderVisibility(_5fb,false);}},this);}});}else{if(_5ed.type==="WebTiledLayer"){_5f1=new _590(_5ed.templateUrl,{id:_5ed.id,visible:(_5ed.visibility!==null)?_5ed.visibility:true,opacity:_5ed.opacity,copyright:_5ed.copyright,fullExtent:_5ed.fullExtent&&new _584(_5ed.fullExtent),initialExtent:_5ed.fullExtent&&new _584(_5ed.fullExtent),subDomains:_5ed.subDomains,tileInfo:_5ed.tileInfo?new _596(_5ed.tileInfo):null});_578.connect(_5f1,"onLoad",function(){if(_57f.isDefined(_5ed.minScale)||_57f.isDefined(_5ed.maxScale)){_5f1.setScaleRange(_5ed.minScale,_5ed.maxScale);}});}else{if(_5ed.type==="GeoRSS"){_5f1=new _594(_5ed.url,{id:_5ed.id,visible:(_5ed.visibility!==null)?_5ed.visibility:true,opacity:_5ed.opacity,outSpatialReference:_5f0});_578.connect(_5f1,"onLoad",function(){var _5fc=_5f1.getFeatureLayers();_577.forEach(_5fc,function(_5fd){if(_5ed.pointSymbol&&_5fd.geometryType==="esriGeometryPoint"){_5fd.renderer.symbol=_586.fromJson(_5ed.pointSymbol);}else{if(_5ed.lineSymbol&&_5fd.geometryType==="esriGeometryPolyline"){_5fd.renderer.symbol=_586.fromJson(_5ed.lineSymbol);}else{if(_5ed.polygonSymbol&&_5fd.geometryType==="esriGeometryPolygon"){_5fd.renderer.symbol=_586.fromJson(_5ed.polygonSymbol);}}}if(_57f.isDefined(_5ed.minScale)||_57f.isDefined(_5ed.maxScale)){_5fd.setScaleRange(_5ed.minScale,_5ed.maxScale);}});});}else{if(_5ed.type=="CSV"&&_5ed.url){_5f1=new _591(_5ed.featureCollection,{infoTemplate:new _588(_5ed.popupInfo?_5ed.popupInfo:csv.generateDefaultPopupInfo(_5ed.featureCollection)),id:_5ed.id?_5ed.id:null,outFields:["*"],visible:(_5ed.visibility!==null)?_5ed.visibility:true,opacity:_5ed.opacity,autoGeneralize:true});}else{if(_5ed.layerDefinition&&!_5ed.url){var _5fe=_57a.fromJson(_57a.toJson(_5ed));delete _5fe.id;delete _5fe.opacity;delete _5fe.visibility;_5f1=new _591(_5fe,{id:_5ed.id,opacity:_5ed.opacity,visible:_5ed.visibility,outFields:["*"],infoTemplate:_5fe.popupInfo&&new _5f2(_5fe.popupInfo),autoGeneralize:true});}else{if(_5ed.type==="BingMapsAerial"||_5ed.type==="BingMapsRoad"||_5ed.type==="BingMapsHybrid"){if(_5ef.bingMapsKey){var _5ff=_595.MAP_STYLE_AERIAL_WITH_LABELS;if(_5ed.type==="BingMapsAerial"){_5ff=_595.MAP_STYLE_AERIAL;}else{if(_5ed.type==="BingMapsRoad"){_5ff=_595.MAP_STYLE_ROAD;}}_5f1=new _595({bingMapsKey:_5ef.bingMapsKey,mapStyle:_5ff,opacity:_5ed.opacity,id:_5ed.id});}}else{if(_5ed.resourceInfo&&_5ed.resourceInfo.mapName){if(_5ed.resourceInfo.singleFusedMapCache===true){if(!_5ed.baseMapLayer){if(_5e1(_5ed,_5ee)){if(_5e5(_5ed,_5ee)){_5f1=_5c8(_5ed);}else{_5f1=_5d3(_5ed);}}else{_5f1=_5d3(_5ed);}}else{_5f1=_5c8(_5ed);}}else{_5f1=_5d3(_5ed);}}else{if(_5ed.resourceInfo&&_5ed.resourceInfo.pixelSizeX){var _600=new _59a();_600.bandIds=_5ed.bandIds;if(_5ed.format!=null){_600.format=_5ed.format;if(_5ed.compressionQuality!=null){_600.compressionQuality=_5ed.compressionQuality;}}if(_5ed.renderingRule&&_5ed.renderingRule.rasterFunction){var _601=new _59b(_5ed.renderingRule);_600.renderingRule=_601;}if(_5ed.mosaicRule){var _602=new _59c(_5ed.mosaicRule);_600.mosaicRule=_602;}if(_57f.isDefined(_5ed.noData)){_600.noData=_5ed.noData;}if(_57f.isDefined(_5ed.noDataInterpretation)){_600.noDataInterpretation=_5ed.noDataInterpretation;}if(_57f.isDefined(_5ed.interpolation)){_600.interpolation=_5ed.interpolation;}_5f1=new _58e(_5c7(_5ed.url),{resourceInfo:_5ed.resourceInfo,opacity:_5ed.opacity,visible:_5ed.visibility,id:_5ed.id,imageServiceParameters:_600,infoTemplate:_5ed.popupInfo&&new _5f2(_5ed.popupInfo),minScale:_5ed.minScale,maxScale:_5ed.maxScale});if(_5ed.layerDefinition&&_5ed.layerDefinition.definitionExpression){_5f1.setDefinitionExpression(_5ed.layerDefinition.definitionExpression,true);}}else{if(_5ed.resourceInfo&&_5ed.resourceInfo.type==="Feature Layer"){_5f1=new _591(_5c7(_5ed.url),{resourceInfo:_5ed.resourceInfo,opacity:_5ed.opacity,visible:_5ed.visibility,id:_5ed.id,mode:_57f.isDefined(_5ed.mode)?_5ed.mode:_591.MODE_ONDEMAND,outFields:["*"],infoTemplate:_5ed.popupInfo&&new _5f2(_5ed.popupInfo),autoGeneralize:true});if(_5ed.layerDefinition){if(_5ed.layerDefinition.drawingInfo&&_5ed.layerDefinition.drawingInfo.renderer){var _603=_587.fromJson(_5ed.layerDefinition.drawingInfo.renderer);_603.isMaxInclusive=true;_5f1.setRenderer(_603);}if(_5ed.layerDefinition.definitionExpression){_5f1.setDefinitionExpression(_5ed.layerDefinition.definitionExpression);}if(_57f.isDefined(_5ed.layerDefinition.minScale)){_5f1.setMinScale(_5ed.layerDefinition.minScale);}if(_57f.isDefined(_5ed.layerDefinition.maxScale)){_5f1.setMaxScale(_5ed.layerDefinition.maxScale);}}}}}}}}}}}}}if(_5f1){_5f1.arcgisProps={title:_5ed.title};if(_5ed.baseMapLayer){if(_5ed.isReference){_5f1._basemapGalleryLayerType="reference";}else{_5f1._basemapGalleryLayerType="basemap";}}}return _5f1;};function _604(_605,_606,_607){_577.forEach(_605,function(_608,_609){if(_608.url&&!_608.type){if(_609===0||_605[0].layerObject){_608.layerObject=_5ec(_608,_605,_606,_607);}}else{if(_608.url&&_608.type=="CSV"){_608.layerObject=_5ec(_608,_605,_606,_607);}else{_608.layerObject=_5ec(_608,_605,_606,_607);}}});var _60a=_577.filter(_605,function(lyr){return !lyr.isReference;});var _60b=_577.filter(_605,function(lyr){return !!lyr.isReference;});_605=_60a.concat(_60b);return _605;};function _60c(_60d){var _60e=null;var _60f=_60d[0];if(_60f.url&&!_60f.type){if(_60f.resourceInfo.spatialReference){_60e=new _581();if(_60f.resourceInfo.spatialReference.wkid){_60e.wkid=_60f.resourceInfo.spatialReference.wkid;}if(_60f.resourceInfo.spatialReference.wkt){_60e.wkt=_60f.resourceInfo.spatialReference.wkt;}}}else{if(_60f.type.indexOf("BingMaps")>-1||_60f.type=="OpenStreetMap"){_60e=new _581({wkid:102100});}else{if(_60f.type=="WMS"){_60e=new _581({wkid:_60f.spatialReferences[0]});}}}return _60e;};function _610(_611,_612,_613,_614,_615){_577.forEach(_612,function(_616,_617){if(_616.url&&!_616.type){_616.resourceInfo=_611[_616.deferredsPos][1];delete _616.deferredsPos;}else{if(_616.url&&_616.type=="CSV"){_616.featureCollection=_614[_616.deferredsPos].results[0];delete _616.deferredsPos;}}});var _618=_60c(_612);var _619=[];var _61a=new _579();_577.forEach(_612,function(_61b){if(_61b.url&&_61b.type=="CSV"){_61b.deferredsPos=_619.length;_619.push(csv.projectFeatureCollection(_61b.featureCollection,_618));}});if(_619.length==0){_612=_604(_612,_613,_618);_615.callback(_612);}else{var _61c=new _57b(_619);_61c.addCallback(function(){_577.forEach(_612,function(_61d){if(_61d.url&&_61d.type=="CSV"){_61d.featureCollection=_619[_61d.deferredsPos].results[0];delete _61d.deferredsPos;}});_612=_604(_612,_613,_618);_615.callback(_612);});}};function _61e(url,_61f){var url2=_5c7(url);return _580({url:url2,content:{f:"json"},callbackParamName:"callback",error:function(_620,io){if(_620.message){_620.message+=" [url:"+url2+"]";}else{_620.message="[url:"+url2+"]";}_61f.push(_620);_57e.defaults.io.errorHandler(_620,io);}});};function _621(_622,_623){var _624=[];var _625=[];var _626=[];var _627=new _579();_577.forEach(_622.operationalLayers,function(_628,_629){if(_628.featureCollection){_577.forEach(_628.featureCollection.layers,function(_62a,idx){var _62b=true;if(_628.visibleLayers){if(_577.indexOf(_628.visibleLayers,idx)==-1){_62b=false;}}_62a.visibility=(_628.visibility&&_62b);_62a.opacity=_628.opacity;_62a.id=(_628.id||("operational"+_629))+"_"+idx;_626.push(_62a);},this);}else{_626.push(_628);}});_577.forEach(_622.baseMap.baseMapLayers,function(_62c,_62d){_62c.baseMapLayer=true;_62c.id=_62c.id||("base"+_62d);_624.push(_62c);});_577.forEach(_626,function(_62e,_62f){_62e.id=_62e.id||("operational"+_62f);_624.push(_62e);});_577.forEach(_624,function(_630){if(_630.url&&!_630.type){_630.deferredsPos=_625.length;_630.errors=[];_625.push(_61e(_630.url,_630.errors));}else{if(_630.url&&_630.type=="CSV"){_630.deferredsPos=_625.length;_625.push(csv.buildCSVFeatureCollection(_630));}}});if(_625.length==0){var _631=_60c(_624);_624=_604(_624,_623,_631);_627.callback(_624);}else{var _632=new _57b(_625);_632.addCallback(function(_633){_610(_633,_624,_623,_625,_627);});}return _627;};function _634(_635,_636){if(_636.version<=10.1&&_635){var i,id=parseInt(_636.url.substring(_636.url.lastIndexOf("/")+1,_636.url.length));for(i=_635.length-1;i>=0;i--){if(_635[i].id==id){if(_636.minScale==0&&_635[i].minScale>0){_636.minScale=_635[i].minScale;}else{if(_636.minScale>0&&_635[i].minScale==0){_636.minScale=_636.minScale;}else{if(_636.minScale>0&&_635[i].minScale>0){_636.minScale=Math.min(_636.minScale,_635[i].minScale);}}}_636.maxScale=Math.max(_636.maxScale||0,_635[i].maxScale||0);if(_635[i].parentLayerId>-1){id=_635[i].parentLayerId;}else{break;}}}}};function _637(_638,_639,_63a,map){var url=_638.url;var _63b=_638.__popups;var ids=_638.__popupIds;var urls=_638.__popupUrls;var _63c=_638.__resourceInfo;var _63d=[];_577.forEach(_63b,function(_63e,_63f){if(!_63e){return;}var _640,_641=[];_577.forEach(_63e.fieldInfos,function(item){if(item.fieldName.toLowerCase()!=="shape"){_641.push(item.fieldName);}});if(_638.dynamicLayerInfos&&_638.dynamicLayerInfos.length>0){var _642=_577.filter(_638.dynamicLayerInfos,function(item){return ids[_63f]==item.id;})[0].source;_640=new _591(url+"/dynamicLayer",{id:_638.id+"_"+ids[_63f],source:_642,outFields:_641,mode:_591.MODE_SELECTION,infoTemplate:_63e&&new _63a(_63e),drawMode:false,visible:_638.visible,autoGeneralize:true});}else{var i,_643=null;if(_639){for(i=0;i<_639.length;i++){if(_639[i].id===ids[_63f]){_643=_639[i];break;}}}var _644=url+"/"+ids[_63f];if(urls[_63f].length){_644=urls[_63f];}_640=new _591(_5c7(_644),{id:_638.id+"_"+ids[_63f],outFields:_641,mode:_591.MODE_SELECTION,infoTemplate:_63e&&new _63a(_63e),drawMode:false,visible:_638.visible,resourceInfo:_643,autoGeneralize:true});}if(_640.loaded){_640.setScaleRange(_638.minScale,_638.maxScale);}else{_578.connect(_640,"onLoad",function(_645){_645.setScaleRange(_638.minScale,_638.maxScale);});}if(_640.loaded){_634(_63c.layers,_640);}else{_578.connect(_640,"onLoad",function(_646){_634(_63c.layers,_646);});}_63d.push(_640);});if(_63d.length>0){var _647=function(_648,_649){_577.forEach(_648,function(_64a){if(_649){_64a.show();}else{_64a.hide();}});};_578.connect(_638,"onVisibilityChange",lang.hitch(this,_647,_63d));var _64b=function(_64c,_64d,_64e){if(_64c.id===_64e.id){_577.forEach(_64d,function(_64f){map.removeLayer(_64f);});}};_578.connect(map,"onLayerRemove",lang.hitch(this,_64b,_638,_63d));}delete _638.__popups;delete _638.__popupIds;delete _638.__popupUrls;delete _638.__resourceInfo;return _63d;};function _650(_651){return _580({url:_5c7(_651.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}});};function _652(_653,map,_654){var _655=[];_577.forEach(_653,function(_656){var _657=_656.__popups;if(_657&&_657.length>1&&_656.version>=10){_656.__deferredsPos=_655.length;_655.push(_650(_656));}});var _658=[];if(_655.length>0){var _659=new _57b(_655);_659.addCallback(function(_65a){_577.forEach(_653,function(_65b){if(_65b.__popups&&_65b.__popups.length>0){if(_65b.__deferredsPos||_65b.__deferredsPos===0){var _65c=_65a[_65b.__deferredsPos][1];_658=_658.concat(_637(_65b,_65c.layers,_654,map));delete _65b.__deferredsPos;}else{_658=_658.concat(_637(_65b,null,_654,map));}}});map.addLayers(_658);});}else{_577.forEach(_653,function(_65d){if(_65d.__popups&&_65d.__popups.length>0){_658=_658.concat(_637(_65d,null,_654,map));}});map.addLayers(_658);}};function _65e(_65f){_577.forEach(_65f,function(_660){var _661=_660.layer;if(_661.toJson){var json=_661.toJson();if(json.featureSet&&_661.name.indexOf("Text")>-1){_577.forEach(json.featureSet.features,function(_662,idx){if(_662.attributes.TEXT){var _663=_661.graphics[idx];_663.symbol.setText(_662.attributes.TEXT);if(_662.symbol.horizontalAlignment){_663.symbol.align=_662.symbol.horizontalAlignment;}_663.setSymbol(_663.symbol);_663.setAttributes(_662.attributes);}},this);}}});};function _664(_665){var _666=6;_577.forEach(_665,function(_667){var _668=_667.renderer;if(_668){if(_668.declaredClass==="esri.renderer.SimpleRenderer"){var _669=_668.symbol;if(_669&&_669.xoffset){_666=Math.max(_666,Math.abs(_669.xoffset));}if(_669&&_669.yoffset){_666=Math.max(_666,Math.abs(_669.yoffset));}}else{if(_668.declaredClass==="esri.renderer.UniqueValueRenderer"||_668.declaredClass==="esri.renderer.ClassBreaksRenderer"){_577.forEach(_668.infos,function(info){var _66a=info.symbol;if(_66a&&_66a.xoffset){_666=Math.max(_666,Math.abs(_66a.xoffset));}if(_66a&&_66a.yoffset){_666=Math.max(_666,Math.abs(_66a.yoffset));}});}}}});return _666;};function _66b(evt){var map=this,_66c=map.infoWindow,_66d=evt.graphic;if(!map.loaded){return;}_66c.hide();_66c.clearFeatures();var _66e=[];_577.forEach(map.graphicsLayerIds,function(_66f){var _670=map.getLayer(_66f);if(_670&&_670.declaredClass.indexOf("FeatureLayer")!==-1&&_670.loaded&&_670.visible){_670.clearSelection();if(_670.infoTemplate&&!_670.suspended){_66e.push(_670);}}});_577.forEach(map.layerIds,function(_671){var _672=map.getLayer(_671);if(_672&&_672.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1&&_672.loaded&&_672.visible&&_672.infoTemplate){_66e.push(_672);}});_66d=(_66d&&_66d.getInfoTemplate())?_66d:null;if(!_66e.length&&!_66d){return;}var _673=_664(_66e);var _674=evt.screenPoint,_675=map.toMap(new _583(_674.x-_673,_674.y+_673)),_676=map.toMap(new _583(_674.x+_673,_674.y-_673)),_677=new _584(_675.x,_675.y,_676.x,_676.y,map.spatialReference);var _678=new _58a();_678.geometry=_677;_678.timeExtent=map.timeExtent;var _679=true;var _67a=_577.map(_66e,function(_67b){var dfd;if(_67b.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1){_679=false;var _67c={};_67c.rasterAttributeTableFieldPrefix="Raster.";_67c.returnDomainValues=true;dfd=_67b.queryVisibleRasters(_678,_67c);dfd.addCallback(function(){var _67d=_67b.getVisibleRasters();return _67d;});}else{dfd=_67b.selectFeatures(_678);dfd.addCallback(function(){var _67e=_67b.getSelectedFeatures();return _67e;});}return dfd;});if(_66d){var dfd=new _579();dfd.callback([_66d]);_67a.splice(0,0,dfd);}var _67f=_577.some(_67a,function(dfd){return dfd.fired===-1;});if(!_67f){var _680=_66d?1:0;_577.forEach(_66e,function(_681){if(_681.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1){_680=_680+_681.getVisibleRasters().length;}else{_680=_680+_681.getSelectedFeatures().length;}});if(!_680){return;}}_66c.setFeatures(_67a);_66c.show(evt.mapPoint,{closestFirst:_679});};function _682(_683,_684,_685,_686,_687,_688){var _689=(_687.mapOptions||{}),_68a,_68b;if(!_689.infoWindow){_68a=new _589(null,_57c.create("div"));_689.infoWindow=_68a;}if(!_57f.isDefined(_689.showInfoWindowOnClick)){_689.showInfoWindowOnClick=false;}var map=new Map(_686,_689);if(_687.ignorePopups){_577.forEach(_683,function(_68c){delete _68c.infoTemplate;});}if(!(_687.ignorePopups||_687.disableClickBehavior)){_68b=_578.connect(map,"onClick",_66b);}_578.connect(map,"onLayersAddResult",_65e);map.addLayers(_683);if(!_687.ignorePopups){_652(_683,map,_687._clazz);}var _68d=[];_577.forEach(_684,function(_68e){_68d=_68d.concat(_68e.errors);},this);_688.callback({map:map,itemInfo:_685,errors:_68d,clickEventHandle:_68b,clickEventListener:_66b});};function _68f(_690,_691,_692,_693,_694){try{var _695=_692.mapOptions||{};_692.mapOptions=_695;var card=_690.item;var _696=[];_577.forEach(_694,function(_697){if(lang.isArray(_697.layerObject)){_577.forEach(_697.layerObject,function(l){_696.push(l);});}else{_696.push(_697.layerObject);}});if(!_696[0]){var msg="";if(_694[0].errors&&_694[0].errors.length){msg=" ("+_694[0].errors[0].message+")";}_693.errback(new Error(_59e.arcgis.utils.baseLayerError+msg));return;}_696=_577.filter(_696,_57f.isDefined);if(card){if(card.extent){if(!_695.extent){var _698=new _584(card.extent[0][0],card.extent[0][1],card.extent[1][0],card.extent[1][1],new _581({wkid:4326}));var _699=_696[0].spatialReference;if(_699.wkid===4326){_695.extent=_698;_682(_696,_694,_690,_691,_692,_693);}else{if(_699.wkid===102100||_699.wkid===102113||_699.wkid===3857){_698.xmin=Math.max(_698.xmin,-180);_698.xmax=Math.min(_698.xmax,180);_698.ymin=Math.max(_698.ymin,-89.99);_698.ymax=Math.min(_698.ymax,89.99);_695.extent=_585.geographicToWebMercator(_698);_682(_696,_694,_690,_691,_692,_693);}else{if(_692.geometryServiceURL||_57e.defaults.geometryService){var gs;if(_692.geometryServiceURL){gs=new _58b(_692.geometryServiceURL);}else{gs=_57e.defaults.geometryService;}gs.project([_698],_699,function(_69a){var _69b=_69a[0];_695.extent=_695.extent||_69b;_682(_696,_694,_690,_691,_692,_693);});}else{_693.errback(new Error(_59e.arcgis.utils.geometryServiceError));}}}}else{_682(_696,_694,_690,_691,_692,_693);}}else{_682(_696,_694,_690,_691,_692,_693);}}else{_682(_696,_694,_690,_691,_692,_693);}}catch(err){_693.errback(err);}};function _69c(_69d){var _69e=[];var _69f=_69d.baseMap.baseMapLayers.concat(_69d.operationalLayers);_577.forEach(_69f,function(_6a0,_6a1){var _6a2={};if(_6a0.featureCollection&&_6a0.type!=="CSV"){if(_6a0.featureCollection.showLegend===true){_577.forEach(_6a0.featureCollection.layers,function(_6a3){if(_6a3.showLegend!==false){_6a2={"layer":_6a3.layerObject,"title":_6a0.title,"defaultSymbol":(_6a3.renderer&&_6a3.renderer.defaultSymbol&&_6a3.renderer.defaultLabel)?true:false};if(_6a0.featureCollection.layers.length>1){_6a2.title+=" - "+_6a3.layerDefinition.name;}_69e.push(_6a2);}});}}else{if((_6a0.baseMapLayer&&_6a0.showLegend===true&&_6a0.layerObject)||(!_6a0.baseMapLayer&&_6a0.showLegend!==false&&_6a0.layerObject)){var rend=_6a0.layerObject.renderer;var _6a4=(!rend||(rend&&rend.defaultSymbol&&rend.defaultLabel))?true:false;if((_6a0.layerObject.version<10.1&&(_6a0.layerObject instanceof _58d||_6a0.layerObject instanceof _58c))||(_6a0.layerObject instanceof esri.layers.ArcGISImageServiceLayer)){_6a4=true;}_6a2={"layer":_6a0.layerObject,"title":_6a0.title,"defaultSymbol":_6a4};if(_6a0.layers){var _6a5=_577.map(_577.filter(_6a0.layers,function(lyr){return (lyr.showLegend===false);}),function(lyr){return lyr.id;});if(_6a5.length){_6a2.hideLayers=_6a5;}}_69e.push(_6a2);}}});return _69e;};function _6a6(_6a7){if(_59f._arcgisUrl&&_59f._arcgisUrl.length>0){_59f.arcgisUrl=_59f._arcgisUrl;}var url=_59f.arcgisUrl+"/"+_6a7;var _6a8={},_6a9=new _579();_580({url:url,content:{f:"json"},callbackParamName:"callback",load:function(_6aa){_6a8.item=_6aa;_580({url:url+"/data",content:{f:"json"},callbackParamName:"callback",load:function(_6ab){_6a8.itemData=_6ab;_6a9.callback(_6a8);},error:function(_6ac){_6a9.errback(_6ac);}});},error:function(_6ad){_6a9.errback(_6ad);}});return _6a9;};function _6ae(arg1,_6af,_6b0){var _6b1=new _579();_6b0=_6b0||{};var _6b2=_6b0.infoTemplateClass;_6b0._clazz=(_6b2&&(lang.isObject(_6b2)?_6b2:lang.getObject(_6b2)))||_588;if(lang.isString(arg1)){_6a6(arg1).addCallback(function(_6b3){_5aa(_6b3,_6b0).addCallback(function(_6b4){_621(_6b4.itemData,_6b0).addCallback(lang.hitch(null,_68f,_6b4,_6af,_6b0,_6b1));});}).addErrback(lang.hitch(_6b1,_6b1.errback));}else{_5aa(arg1,_6b0).addCallback(function(_6b5){_621(_6b5.itemData,_6b0).addCallback(lang.hitch(null,_68f,_6b5,_6af,_6b0,_6b1));});}return _6b1;};function _6b6(_6b7){if(_6b7&&_6b7.itemInfo&&_6b7.itemInfo.itemData){return _69c(_6b7.itemInfo.itemData);}else{return [];}};_59f={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:_6a6,createMap:_6ae,getLegendLayers:_6b6,_arcgisUrl:null,_getItemProps:_5aa,_getItemData:_5a0,_getBingKey:_5a3,_processFSItemProperties:_5a8,_getLayers:_621,_preBuildLayerObjects:_610,_buildLayerObjects:_604,_preCreateMap:_68f,_getMapSR:_60c,_createMap:_682,_addSelectionLayers:_652,_createSelectionFeatureLayers:_637,_getServiceInfo:_61e,_getLayersInfo:_650,_initLayer:_5ec,_loadAsCached:_5c8,_loadAsDynamic:_5d3,_processPopups:_5bb,_onLayersAddResult:_65e,_sameSpatialReferenceAsBasemap:_5e1,_sameTilingSchemeAsBasemap:_5e5,_showPopup:_66b,_calculateClickTolerance:_664,_getVisibleFeatureLayers:_5cc,_updateLayerScaleInfo:_634,_checkUrl:_5c7,_isHostedService:_5c3,_isAgolService:_5c6,_getLegendLayers:_69c};lang.setObject("arcgis.utils",_59f,_57d);return _59f;});},"esri/layers/GeoRSSLayer":function(){define("esri/layers/GeoRSSLayer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/config","esri/request","esri/layers/ServiceGeneratedFeatureCollection"],function(_6b8,lang,_6b9,has,_6ba,_6bb,_6bc,_6bd){var _6be=_6b8([_6bd],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(url,_6bf){if(_6bb.defaults.geoRSSService){this.serviceUrl=_6bb.defaults.geoRSSService;}this._createLayer();},parse:function(){this._io=_6bc({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?true:undefined,outSR:this._outSR?_6b9.toJson(this._outSR.toJson()):undefined},callbackParamName:"callback"});return this._io;},_initLayer:function(json){this.inherited(arguments);if(!this.loaded){this.loaded=true;this.onLoad(this);}}});if(has("extend-esri")){lang.setObject("layers.GeoRSSLayer",_6be,_6ba);}return _6be;});},"esri/layers/FeatureTemplate":function(){define("esri/layers/FeatureTemplate",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/graphic"],function(_6c0,lang,has,_6c1,_6c2,_6c3){var _6c4=_6c0(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(json){if(json&&lang.isObject(json)){this.name=json.name;this.description=json.description;this.drawingTool=json.drawingTool;var _6c5=json.prototype;this.prototype=new _6c3(_6c5.geometry,null,_6c5.attributes);}},toJson:function(){return _6c2.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()});}});lang.mixin(_6c4,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});if(has("extend-esri")){lang.setObject("layers.FeatureTemplate",_6c4,_6c1);}return _6c4;});},"esri/dijit/BasemapGallery":function(){require({cache:{"url:esri/dijit/templates/BasemapGallery.html":"<div class=\"esriBasemapGallery\">\r\n  <div dojoAttachPoint=\"flowContainer\">\r\n  </div>\r\n</div>"}});define("esri/dijit/BasemapGallery",["require","dojo/_base/declare","dojo/_base/array","dojo/_base/connect","dojo/_base/lang","dojo/_base/kernel","dojo/_base/sniff","dojo/has","dojo/query","dojo/DeferredList","dojo/dom","dojo/dom-construct","dojo/dom-class","dijit/_Widget","dijit/_Templated","esri/kernel","esri/urlUtils","esri/request","esri/geometry/Extent","esri/virtualearth/VETiledLayer","esri/layers/OpenStreetMapLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/ImageServiceParameters","esri/dijit/Basemap","esri/dijit/_EventedWidget","dojo/text!esri/dijit/templates/BasemapGallery.html"],function(_6c6,_6c7,_6c8,_6c9,lang,_6ca,_6cb,has,_6cc,_6cd,dom,_6ce,_6cf,_6d0,_6d1,_6d2,_6d3,_6d4,_6d5,_6d6,_6d7,_6d8,_6d9,_6da,_6db,_6dc,_6dd,_6de){var BMG=_6c7([_6dd,_6d0,_6d1],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:true,templateString:_6de,basePath:_6c6.toUrl("esri/dijit")+"/",loaded:false,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:false,_selectedBasemap:null,_selectBasemapInProgress:false,_eventMap:{"load":true,"selection-change":true,"add":["basemap"],"remove":["basemap"],"error":["message"]},constructor:function(_6df,_6e0){_6df=_6df||{};if(!_6df.map){}this.map=_6df.map;this._hasUI=_6e0?true:false;this.bingMapsKey=(_6df.bingMapsKey&&_6df.bingMapsKey.length>0)?_6df.bingMapsKey:null;this.showArcGISBasemaps=(_6df.showArcGISBasemaps===false)?false:true;this.basemaps=_6df.basemaps||[];this.basemapIds=_6df.basemapIds;this.referenceIds=_6df.referenceIds;this.basemapsGroup=_6df.basemapsGroup;if(location.protocol==="https:"){_6d2.dijit._arcgisUrl=_6d2.dijit._arcgisUrl.replace("http:","https:");}this.init();},init:function(){this.inherited(arguments);_6c8.forEach(this.basemaps,function(_6e1,i){if(!_6e1.id||_6e1.id.length===0){_6e1.id=this._getUniqueId();}_6c8.forEach(_6e1.layers,function(_6e2){_6e2.opacity=(_6e2.opacity>=0)?_6e2.opacity:1;_6e2.visibility=true;},this);},this);if(this.basemapIds&&this.basemapIds.length>0){_6c8.forEach(this.basemapIds,function(_6e3){var _6e4=this.map.getLayer(_6e3);_6e4._basemapGalleryLayerType="basemap";},this);}if(this.referenceIds&&this.referenceIds.length>0){_6c8.forEach(this.referenceIds,function(_6e5){var _6e6=this.map.getLayer(_6e5);_6e6._basemapGalleryLayerType="reference";},this);}if(this.basemapsGroup&&((this.basemapsGroup.owner&&this.basemapsGroup.title)||this.basemapsGroup.id)){this._findCustomBasemapsGroup(lang.hitch(this,"_handleArcGISBasemapsResponse"));}else{if(this.showArcGISBasemaps){this._findArcGISBasemapsGroup(lang.hitch(this,"_handleArcGISBasemapsResponse"));}else{this._finishStartup();}}},startup:function(){if(this.loaded){this._refreshUI();}else{_6c9.connect(this,"onLoad",lang.hitch(this,function(){this._refreshUI();}));}},select:function(id){this._select(id);},getSelected:function(){return this._selectedBasemap;},get:function(id){var i;for(i=0;i<this.basemaps.length;i++){if(this.basemaps[i].id==id){return this.basemaps[i];}}return null;},add:function(_6e7){if(_6e7&&!_6e7.id){_6e7.id=this._getUniqueId();this.basemaps.push(_6e7);this._refreshUI();this.onAdd(_6e7);return true;}else{if(_6e7&&this._isUniqueId(_6e7.id)){this.basemaps.push(_6e7);this._refreshUI();this.onAdd(_6e7);return true;}}return false;},remove:function(id){var i;for(i=0;i<this.basemaps.length;i++){var _6e8=this.basemaps[i];if(_6e8.id===id){if(this._selectedBasemap&&this._selectedBasemap.id===_6e8.id){this._selectedBasemap=null;}this.basemaps.splice(i,1);this._refreshUI();this.onRemove(_6e8);return _6e8;}}return null;},onLoad:function(){},onSelectionChange:function(){},onAdd:function(_6e9){},onRemove:function(_6ea){},onError:function(msg){},_defaultBasemapGalleryGroupQuery:"title:\"ArcGIS Online Basemaps\" AND owner:esri",_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=true;this.onLoad();if(this.map.layerIds.length===0&&this.basemaps.length>0&&!this._selectBasemapInProgress){this._select(this.basemaps[0].id);}},_findCustomBasemapsGroup:function(_6eb){if(this.basemapsGroup&&this.basemapsGroup.id){this._findArcGISBasemaps(this.basemapsGroup.id,_6eb);}else{this._basemapGalleryGroupQuery="title:\""+this.basemapsGroup.title+"\" AND owner:"+this.basemapsGroup.owner;this._findArcGISBasemapsGroup(_6eb);}},_findArcGISBasemapsGroup:function(_6ec){if(!this._basemapGalleryGroupQuery){var url=_6d2.dijit._arcgisUrl+"/accounts/self";var _6ed={};_6ed.f="json";_6ed.culture=_6ca.locale;_6d4({url:url,content:_6ed,callbackParamName:"callback",load:lang.hitch(this,function(_6ee,args){if(_6ee&&_6ee.basemapGalleryGroupQuery){this._basemapGalleryGroupQuery=_6ee.basemapGalleryGroupQuery;}else{this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery;}this._findArcGISBasemapsGroupContent(_6ec);}),error:lang.hitch(this,function(_6ef,args){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery;})});}else{this._findArcGISBasemapsGroupContent(_6ec);}},_findArcGISBasemapsGroupContent:function(_6f0){var _6f1=lang.hitch(this,"_findArcGISBasemaps");var url=_6d2.dijit._arcgisUrl+"/community/groups";var _6f2={};_6f2.q=this._basemapGalleryGroupQuery;_6f2.f="json";_6d4({url:url,content:_6f2,callbackParamName:"callback",load:lang.hitch(this,function(_6f3,args){if(_6f3.results.length>0){_6f1(_6f3.results[0].id,_6f0);}else{var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);}}),error:lang.hitch(this,function(_6f4){var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);})});},_findArcGISBasemaps:function(_6f5,_6f6){var url=_6d2.dijit._arcgisUrl+"/search";var _6f7={};_6f7.q="group:"+_6f5+" AND type:\"web map\"";_6f7.sortField="name";_6f7.sortOrder="desc";_6f7.num=50;_6f7.f="json";_6d4({url:url,content:_6f7,callbackParamName:"callback",load:lang.hitch(this,function(_6f8,args){if(_6f8.results.length>0){_6f6(_6f8.results);}else{var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);}}),error:lang.hitch(this,function(_6f9,args){var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);})});},_handleArcGISBasemapsResponse:function(_6fa){if(_6fa.length>0){_6c8.forEach(_6fa,function(item,i){if(this.bingMapsKey||(!this.bingMapsKey&&item.title&&item.title.indexOf("Bing Maps")==-1)){var _6fb={};_6fb.id=this._getUniqueId();_6fb.title=item.title;_6fb.thumbnailUrl="";if(item.thumbnail&&item.thumbnail.length){_6fb.thumbnailUrl=(_6d2.dijit._arcgisUrl+"/content/items/"+item.id+"/info/"+item.thumbnail);if(_6d2.id){var _6fc=_6d2.id.findCredential(_6d3.urlToObject(_6d2.dijit._arcgisUrl).path);if(_6fc){_6fb.thumbnailUrl+="?token="+_6fc.token;}}}_6fb.itemId=item.id;var _6fd=new _6dc(_6fb,this);this.basemaps.splice(0,0,_6fd);}},this);this._finishStartup();}},_refreshUI:function(){if(this._hasUI){_6ce.empty(this.flowContainer);_6c8.forEach(this.basemaps,function(_6fe,i){if(!_6fe.id){_6fe.id="basemap_"+i;}this.flowContainer.appendChild(this._buildNodeLayout(_6fe));},this);_6ce.create("br",{style:{clear:"both"}},this.flowContainer);this._markSelected(this._selectedBasemap);}},_buildNodeLayout:function(_6ff){var nId="galleryNode_"+_6ff.id;var n=_6ce.create("div",{id:nId,"class":"esriBasemapGalleryNode"});var _700=_6ce.create("a",{href:"javascript:void(0);"},n);_6c9.connect(_700,"onclick",lang.hitch(this,"_onNodeClick",_6ff));if(_6ff.thumbnailUrl){_6ce.create("img",{"class":"esriBasemapGalleryThumbnail",src:_6ff.thumbnailUrl},_700);}else{_6ce.create("img",{"class":"esriBasemapGalleryThumbnail",src:this.basePath.toString()+"images/transparent.gif"},_700);}var _701=_6ce.create("div",{"class":"esriBasemapGalleryLabelContainer"},n);var _702=_6ff.title||"";_6ce.create("span",{innerHTML:_702,alt:_702,title:_702},_701);return n;},_onNodeClick:function(_703,e){e.preventDefault();this._markSelected(_703);this.select(_703.id);},_markSelected:function(_704){if(_704){_6c8.forEach(_6ca.query(".esriBasemapGallerySelectedNode",this.domNode),function(node){_6cf.remove(node,"esriBasemapGallerySelectedNode");});var _705=dom.byId("galleryNode_"+_704.id);if(_705){_6cf.add(_705,"esriBasemapGallerySelectedNode");}}},_select:function(id){this._selectBasemapInProgress=true;var _706=this.get(id);if(_706){if(_706.layers){this._getServiceInfos(_706);}else{var _707=_706.getLayers();if(lang.isArray(_707)){this._getServiceInfos(_706);}else{_707.addCallback(lang.hitch(this,function(_708){this._getServiceInfos(_706);}));}}this._markSelected(_706);}else{this._selectBasemapInProgress=false;}},_getServiceInfos:function(_709){if(location.protocol=="https:"){_6c8.forEach(_709.layers,function(_70a){if(this._isAgolService(_70a.url)||this._isHostedService(_70a.url)){_70a.url=_70a.url.replace("http:","https:");}},this);}this._selectedBasemap=_709;var _70b=[];_6c8.forEach(_709.layers,function(_70c){if(_70c.url&&_70c.url.length>0&&!_70c.isReference){_70c.deferredsPos=_70b.length;_70b.push(this._getServiceInfo(_70c.url));}},this);if(_70b.length>0){var _70d=new _6cd(_70b);_70d.addCallback(lang.hitch(this,function(_70e){var _70f=null;_6c8.forEach(_709.layers,function(_710){if(_710.deferredsPos===0||_710.deferredsPos){_710.serviceInfoResponse=_70e[_710.deferredsPos][1];var ext=_710.serviceInfoResponse.fullExtent;if(!ext){ext=_710.serviceInfoResponse.extent;}if(!_70f){_70f=new _6d5(ext);}else{_70f=_70f.union(new _6d5(ext));}}},this);if(this.map.extent){var _711=this._getIntersectionPercent(_70f,this.map.extent);if(_711<5){this.map.setExtent(_70f,true);}}this._switchBasemapLayers(_709);this._updateReferenceLayer(_709);}));}else{this._switchBasemapLayers(_709);this._updateReferenceLayer(_709);}},_switchBasemapLayers:function(_712){var _713=_712.layers;if(this.map.layerIds.length>0&&this.map.getNumLevels()===0&&(_713[0].type==="OpenStreetMap"||(_713[0].type&&_713[0].type.indexOf("BingMaps")>-1))){var msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}_6c8.forEach(_713,function(_714){if(!_714.isReference&&_714.type&&_714.type.indexOf("BingMaps")>-1&&!this.bingMapsKey){var msg="esri.dijit.BasemapGallery: Invalid Bing Maps key.";this.onError(msg);return;}},this);this._removeBasemapLayers();_6c8.forEach(_713,function(_715){if(!_715.isReference){var _716,msg;if(_715.type==="OpenStreetMap"){if(this.map.layerIds.length>0&&this.map.getNumLevels()===0){msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}_716=new _6d7({id:"layer_osm",opacity:_715.opacity});}else{if(_715.type&&_715.type.indexOf("BingMaps")>-1){if(this.map.layerIds.length>0&&this.map.getNumLevels()===0){msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}var _717=_6d6.MAP_STYLE_AERIAL_WITH_LABELS;if(_715.type=="BingMapsAerial"){_717=_6d6.MAP_STYLE_AERIAL;}else{if(_715.type=="BingMapsRoad"){_717=_6d6.MAP_STYLE_ROAD;}}_716=new _6d6({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:_717,opacity:_715.opacity});}else{if(_715.serviceInfoResponse&&_715.serviceInfoResponse.mapName){if((this.map.layerIds.length===0||this.map.getNumLevels()>0)&&_715.serviceInfoResponse.singleFusedMapCache===true){_716=this._loadAsCached(_715);}else{_716=this._loadAsDynamic(_715);}}else{if(_715.serviceInfoResponse&&_715.serviceInfoResponse.pixelSizeX){var _718=new _6db();_718.bandIds=_715.bandIds;if(!_715.bandIds&&_715.serviceInfoResponse.bandCount&&parseInt(_715.serviceInfoResponse.bandCount)>3){_718.bandIds=[0,1,2];}_716=new _6da(_715.url,{resourceInfo:_715.serviceInfoResponse,opacity:_715.opacity,visible:_715.visibility,imageServiceParameters:_718});}}}}if(_716){_716._basemapGalleryLayerType="basemap";this.map.addLayer(_716,0);}}},this);this._selectBasemapInProgress=false;this.onSelectionChange();},_removeBasemapLayers:function(){var _719=this.map.layerIds;var _71a=[];_6c8.forEach(_719,function(id){var _71b=this.map.getLayer(id);if(_71b._basemapGalleryLayerType==="basemap"){_71a.push(_71b);}},this);if(_71a.length===0&&_719.length>0){_71a.push(this.map.getLayer(_719[0]));}if(_71a.length>0){_6c8.forEach(_71a,function(_71c){this.map.removeLayer(_71c);},this);}},_updateReferenceLayer:function(_71d){var i;this._removeReferenceLayer();for(i=0;i<_71d.layers.length;i++){if(_71d.layers[i].isReference===true){this._addReferenceLayer(_71d.layers[i]);}}},_removeReferenceLayer:function(){var i;for(i=this.map.layerIds.length-1;i>=0;i--){var id=this.map.layerIds[i];var _71e=this.map.getLayer(id);if(_71e._basemapGalleryLayerType==="reference"){this.map.removeLayer(_71e);}}},_addReferenceLayer:function(_71f){this._getServiceInfo(_71f.url,lang.hitch(this,"_handleReferenceServiceInfoResponse",_71f));},_handleReferenceServiceInfoResponse:function(_720,_721,args){var _722;_720.serviceInfoResponse=_721;if(_721&&_721.mapName){if(_721.singleFusedMapCache===true){_722=this._loadAsCached(_720);}else{_722=this._loadAsDynamic(_720);}}else{if(_721&&_721.pixelSizeX){var _723=new _6db();_723.bandIds=_720.bandIds;if(!_720.bandIds&&_721.bandCount&&parseInt(_721.bandCount)>3){_723.bandIds=[0,1,2];}_722=new _6da(_720.url,{resourceInfo:_721,opacity:_720.opacity,visible:_720.visibility,imageServiceParameters:_723});}}if(_722){_722._basemapGalleryLayerType="reference";this.map.addLayer(_722);}},_getServiceInfo:function(url,_724){var _725={};_725.f="json";var _726=_6d4({url:url,content:_725,callbackParamName:"callback",load:function(_727,args){if(_724){_724(_727,args);}},error:lang.hitch(this,function(_728,args){var msg="esri.dijit.BasemapGallery: service not accessible.";this.onError(msg);})});return _726;},_loadAsCached:function(_729){var _72a=[];if(!_729.displayLevels){_72a=_6c8.map(_729.serviceInfoResponse.tileInfo.lods,function(lod){return lod.level;});}var _72b=new _6d8(_729.url,{resourceInfo:_729.serviceInfoResponse,opacity:_729.opacity,visible:_729.visibility,displayLevels:_729.displayLevels||_72a});return _72b;},_loadAsDynamic:function(_72c){var _72d=new _6d9(_72c.url,{resourceInfo:_72c.serviceInfoResponse,opacity:_72c.opacity,visible:_72c.visibility});if(_72c.visibleLayers){_72d.setVisibleLayers(_72c.visibleLayers);}return _72d;},_getIntersectionPercent:function(_72e,_72f){var _730=_72f.intersects(_72e);if(_730){var _731=_730.getWidth()*_730.getHeight();var _732=_72f.getWidth()*_72f.getHeight();return (_731/_732)*100;}else{return 0;}},_getIds:function(){var ids=[];_6c8.forEach(this.basemaps,function(_733){ids.push(_733.id);},this);return ids;},_getUniqueId:function(){var _734=","+this._getIds().toString()+",";var _735=0;while(true){if(_734.indexOf(",basemap_"+_735+",")>-1){_735++;}else{return "basemap_"+_735;}}},_isUniqueId:function(id){var _736=","+this._getIds().toString()+",";if(_736.indexOf(","+id+",")===-1){return true;}return false;},_isAgolService:function(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);},_isHostedService:function(url){if(!url){return false;}return (url.indexOf(".arcgis.com/")!==-1);}});if(has("extend-esri")){lang.setObject("dijit.BasemapGallery",BMG,_6d2);}return BMG;});}}});define("esriviewer/mapping",[],1);