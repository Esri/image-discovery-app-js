//>>built
require({cache:{"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_1,_2,_3,_4){var _5=_1(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(_6){if(_6&&_2.isObject(_6)){this.objectId=_6.objectId;this.success=_6.success;if(!_6.success){var _7=_6.error;this.error=new Error();this.error.code=_7.code;this.error.message=_7.description;}}}});if(_3("extend-esri")){_2.setObject("layers.FeatureEditResult",_5,_4);}return _5;});},"esri/layers/MapImageLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/sniff","esri/domUtils","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/layers/layer"],function(_8,_9,_a,_b,_c,_d,_e,_f,has,_10,_11,_12,_13){var _14=_8([_13],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(_15){this.inherited(arguments,[null,_15]);this._mapImages=[];var _16=_a.hitch;this._panStart=_16(this,this._panStart);this._pan=_16(this,this._pan);this._extentChange=_16(this,this._extentChange);this._zoom=_16(this,this._zoom);this._zoomStart=_16(this,this._zoomStart);this._scale=_16(this,this._scale);this._resize=_16(this,this._resize);_9.connect(this,"onSuspend",this,this._onSuspend);_9.connect(this,"onResume",this,this._onResume);this.loaded=true;this.onLoad(this);},opacity:1,_transform:_e._getDOMAccessor("transform"),addImage:function(_17){var _18=this._mapImages.push(_17);_18=_18-1;_17._idx=_18;_17._layer=this;if(this._div){this._createImage(_17,_18);}},removeImage:function(_19){if(_19){var idx=_19._idx,_1a=this._mapImages;if(_1a[idx]===_19){delete _1a[idx];var _1b=_19._node;if(_1b){this._clearEvents(_1b);_1b.e_idx=_1b.e_bl=_1b.e_tr=_1b.e_l=_1b.e_t=_1b.e_w=_1b.e_h=null;if(_1b.parentNode){_1b.parentNode.removeChild(_1b);_c.destroy(_1b);}}_19._node=_19._idx=_19._layer=null;}}},removeAllImages:function(){var _1c=this._mapImages,i,len=_1c.length;for(i=0;i<len;i++){var _1d=_1c[i];if(_1d){this.removeImage(_1d);}}this._mapImages=[];},getImages:function(){var _1e=this._mapImages,_1f=[],i,len=_1e.length;for(i=0;i<len;i++){if(_1e[i]){_1f.push(_1e[i]);}}return _1f;},setOpacity:function(_20){if(this.opacity!=_20){this._opacityChanged(this.opacity=_20);this.onOpacityChange();}},onOpacityChange:function(){},_opacityChanged:function(_21){var div=this._div,i,len,_22;if(div){if(!has("ie")||has("ie")>8){_d.set(div,"opacity",_21);}else{_22=div.childNodes;len=_22.length;for(i=0;i<len;i++){_d.set(_22[i],"opacity",_21);}}}},_createImage:function(_23,idx){var _24=_c.create("img");_d.set(_24,{position:"absolute"});if(has("ie")<=8){_d.set(_24,"opacity",this.opacity);}if(_23.rotation){var _25="rotate("+(360-_23.rotation)+"deg)";if(has("ie")<9){}else{_d.set(_24,this._transform,_25);_d.set(_24,"transform",_25);}}_23._node=_24;_24.e_idx=idx;_24.e_layer=this;_24.e_load=_9.connect(_24,"onload",_14.prototype._imageLoaded);_24.e_error=_9.connect(_24,"onerror",_14.prototype._imageError);_24.e_abort=_9.connect(_24,"onabort",_14.prototype._imageError);_24.src=_23.href;},_imageLoaded:function(evt,img){var _26=img||evt.target||evt.currentTarget,_27=_26.e_layer,_28=_27._mapImages[_26.e_idx],map=_27._map;if(map&&(map.__zooming||map.__panning||!_27._sr)){_27._standby.push(_26);return;}_27._clearEvents(_26);if(!_28||_28._node!==_26){return;}if(map){_27._attach(_28);}},_imageError:function(evt){var _29=evt.target||evt.currentTarget,_2a=_29.e_layer,_2b=_2a._mapImages[_29.e_idx];_2a._clearEvents(_29);if(_2b){_2b._node=null;}},_clearEvents:function(_2c){var _2d=_9.disconnect;_2d(_2c.e_load);_2d(_2c.e_error);_2d(_2c.e_abort);_2c.e_load=_2c.e_error=_2c.e_abort=_2c.e_layer=null;},_attach:function(_2e){var _2f=_2e.extent,_30=_2f.spatialReference,_31=this._sr,div=this._div,_32=_2e._node,_33=new _11({x:_2f.xmin,y:_2f.ymin,spatialReference:_30}),_34=new _11({x:_2f.xmax,y:_2f.ymax,spatialReference:_30});if(!_31.equals(_30)){if(_31.isWebMercator()&&_30.wkid===4326){_33=_12.geographicToWebMercator(_33);_34=_12.geographicToWebMercator(_34);}else{if(_30.isWebMercator()&&_31.wkid===4326){_33=_12.webMercatorToGeographic(_33);_34=_12.webMercatorToGeographic(_34);}}}_32.e_bl=_33;_32.e_tr=_34;if(_2e.visible){this._setPos(_32,div._left,div._top);(this._active||div).appendChild(_32);}},_setPos:function(_35,_36,_37){var _38=_35.e_bl,_39=_35.e_tr,map=this._map;_38=map.toScreen(_38);_39=map.toScreen(_39);var _3a=_38.x-_36,top=_39.y-_37,_3b=Math.abs(_39.x-_38.x),_3c=Math.abs(_38.y-_39.y),css={width:_3b+"px",height:_3c+"px"},_3d=this._mapImages[_35.e_idx];if(map.navigationMode==="css-transforms"){css[_e._css.names.transform]=_e._css.translate(_3a,top)+(_3d.rotation?(" "+_e._css.rotate(360-_3d.rotation)):"");}else{css.left=_3a+"px";css.top=top+"px";}_d.set(_35,css);_35.e_l=_3a;_35.e_t=top;_35.e_w=_3b;_35.e_h=_3c;},managedSuspension:true,_setMap:function(map,_3e){this.inherited(arguments);var div=this._div=_c.create("div",null,_3e),_3f=_e._css.names,css={position:"absolute"},vd=map.__visibleDelta;if(!has("ie")||has("ie")>8){css.opacity=this.opacity;}if(map.navigationMode==="css-transforms"){css[_3f.transform]=_e._css.translate(vd.x,vd.y);_d.set(div,css);div._left=vd.x;div._top=vd.y;css={position:"absolute",width:map.width+"px",height:map.height+"px",overflow:"visible"};this._active=_c.create("div",null,div);_d.set(this._active,css);this._passive=_c.create("div",null,div);_d.set(this._passive,css);}else{div._left=0;div._top=0;_d.set(div,css);}this._standby=[];var _40=this._mapImages,i,len=_40.length;for(i=0;i<len;i++){var _41=_40[i],_42=_41._node;if(!_42){this._createImage(_41,_41._idx);}}_10.hide(div);return div;},_unsetMap:function(map,_43){this._disconnect();var div=this._div;if(div){var _44=this._mapImages,i,len=_44.length;for(i=0;i<len;i++){var _45=_44[i];if(_45){var _46=_45._node;if(_46){this._clearEvents(_46);_46.e_idx=_46.e_bl=_46.e_tr=_46.e_l=_46.e_t=_46.e_w=_46.e_h=null;}_45._node=null;}}_43.removeChild(div);_c.destroy(div);}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments);},_onSuspend:function(){this._disconnect();_10.hide(this._div);},_onResume:function(evt){if(evt.firstOccurrence){this._sr=this._map.spatialReference;this._processStandbyList();}var map=this._map,div=this._div,vd=map.__visibleDelta;if(map.navigationMode==="css-transforms"){div._left=vd.x;div._top=vd.y;_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}this._redraw(map.navigationMode==="css-transforms");this._connect(map);_10.show(div);},_connect:function(map){if(!this._connections){var _47=_9.connect,_48=(map.navigationMode==="css-transforms");this._connections=[_47(map,"onPanStart",this._panStart),_47(map,"onPan",this._pan),_47(map,"onExtentChange",this._extentChange),_48&&_47(map,"onZoomStart",this._zoomStart),_48?_47(map,"onScale",this._scale):_47(map,"onZoom",this._zoom),_48&&_47(map,"onResize",this._resize)];}},_disconnect:function(){if(this._connections){_b.forEach(this._connections,_9.disconnect);this._connections=null;}},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top;},_pan:function(_49,_4a){var div=this._div;div._left=this._panL+_4a.x;div._top=this._panT+_4a.y;if(this._map.navigationMode==="css-transforms"){_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}else{_d.set(div,{left:div._left+"px",top:div._top+"px"});}},_extentChange:function(_4b,_4c,_4d){if(_4d){this._redraw(this._map.navigationMode==="css-transforms");}else{if(_4c){this._pan(_4b,_4c);}}this._processStandbyList();},_processStandbyList:function(){var i,_4e=this._standby;if(_4e&&_4e.length){for(i=_4e.length-1;i>=0;i--){this._imageLoaded(null,_4e[i]);_4e.splice(i,1);}}},_redraw:function(_4f){if(_4f){var _50=this._passive,_51=_e._css.names;_d.set(_50,_51.transition,"none");this._moveImages(_50,this._active);_d.set(_50,_51.transform,"none");}var div=this._active||this._div,_52=this._div._left,_53=this._div._top,i,len=div.childNodes.length,_54;for(i=0;i<len;i++){_54=div.childNodes[i];this._setPos(_54,_52,_53);}},_zoom:function(_55,_56,_57){var div=this._div,_58=div._left,_59=div._top,i,len=div.childNodes.length,_5a;for(i=0;i<len;i++){_5a=div.childNodes[i];var _5b=_5a.e_w*_56,_5c=_5a.e_h*_56,_5d=(_57.x-_58-_5a.e_l)*(_5b-_5a.e_w)/_5a.e_w,_5e=(_57.y-_59-_5a.e_t)*(_5c-_5a.e_h)/_5a.e_h;_5d=isNaN(_5d)?0:_5d;_5e=isNaN(_5e)?0:_5e;_d.set(_5a,{left:(_5a.e_l-_5d)+"px",top:(_5a.e_t-_5e)+"px",width:_5b+"px",height:_5c+"px"});}},_zoomStart:function(){this._moveImages(this._active,this._passive);},_moveImages:function(_5f,_60){var _61=_5f.childNodes,i,len=_61.length;if(len>0){for(i=len-1;i>=0;i--){_60.appendChild(_61[i]);}}},_scale:function(mtx,_62){var css={},_63=_e._css.names,_64=this._passive;_d.set(_64,_63.transition,_62?"none":(_63.transformName+" "+_f.defaults.map.zoomDuration+"ms ease"));css[_63.transform]=_e._css.matrix(mtx);_d.set(_64,_63.transform,_e._css.matrix(mtx));},_resize:function(_65,_66,_67){_d.set(this._active,{width:_66+"px",height:_67+"px"});_d.set(this._passive,{width:_66+"px",height:_67+"px"});}});if(has("extend-esri")){_a.setObject("layers.MapImageLayer",_14,_e);}return _14;});},"esri/layers/WebTiledLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/has","dojo/string","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/TiledMapServiceLayer","esri/layers/TileInfo"],function(_68,_69,_6a,Url,has,_6b,_6c,_6d,_6e,_6f,_70,_71){var _72=_68(_70,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(_73,_74){if(!_74){_74={};}this.urlTemplate=_73;var _75=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));var _76=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));this.initialExtent=_74.initialExtent||_75;this.fullExtent=_74.fullExtent||_76;if(_74.tileInfo){this.tileInfo=_74.tileInfo;}else{var _77=[{"level":0,"resolution":156543.033928,"scale":591657527.591555},{"level":1,"resolution":78271.5169639999,"scale":295828763.795777},{"level":2,"resolution":39135.7584820001,"scale":147914381.897889},{"level":3,"resolution":19567.8792409999,"scale":73957190.948944},{"level":4,"resolution":9783.93962049996,"scale":36978595.474472},{"level":5,"resolution":4891.96981024998,"scale":18489297.737236},{"level":6,"resolution":2445.98490512499,"scale":9244648.868618},{"level":7,"resolution":1222.99245256249,"scale":4622324.434309},{"level":8,"resolution":611.49622628138,"scale":2311162.217155},{"level":9,"resolution":305.748113140558,"scale":1155581.108577},{"level":10,"resolution":152.874056570411,"scale":577790.554289},{"level":11,"resolution":76.4370282850732,"scale":288895.277144},{"level":12,"resolution":38.2185141425366,"scale":144447.638572},{"level":13,"resolution":19.1092570712683,"scale":72223.819286},{"level":14,"resolution":9.55462853563415,"scale":36111.909643},{"level":15,"resolution":4.77731426794937,"scale":18055.954822},{"level":16,"resolution":2.38865713397468,"scale":9027.977411},{"level":17,"resolution":1.19432856685505,"scale":4513.988705},{"level":18,"resolution":0.597164283559817,"scale":2256.994353},{"level":19,"resolution":0.298582141647617,"scale":1128.497176}];var _78=new _71({"rows":256,"cols":256,"origin":{"x":-20037508.342787,"y":20037508.342787},"spatialReference":{"wkid":102100},"lods":_77});this.tileInfo=_78;}this.spatialReference=new _6e(this.tileInfo.spatialReference.toJson());this.copyright=_74.copyright||"";var url=new Url(_73);var _79=url.scheme+"://"+url.authority+"/";this.urlPath=_73.substring(_79.length);this.tileServers=_74.tileServers||[];if(url.authority.indexOf("{subDomain}")===-1){this.tileServers.push(_79);}if(_74.subDomains&&_74.subDomains.length>0&&url.authority.split(".").length>1){this.subDomains=_74.subDomains;var _7a;_6a.forEach(_74.subDomains,function(_7b,idx){if(url.authority.indexOf("${subDomain}")>-1){_7a=url.scheme+"://"+_6b.substitute(url.authority,{subDomain:_7b})+"/";}else{if(url.authority.indexOf("{subDomain}")>-1){_7a=url.scheme+"://"+url.authority.replace(/\{subDomain\}/gi,_7b)+"/";}}this.tileServers.push(_7a);},this);}this.tileServers=_6a.map(this.tileServers,function(_7c){if(_7c.charAt(_7c.length-1)!=="/"){_7c+="/";}return _7c;});this._levelToLevelValue=[];_6a.forEach(this.tileInfo.lods,function(_7d){this._levelToLevelValue[_7d.level]=_7d.levelValue||_7d.level;},this);this.loaded=true;this.onLoad(this);},getTileUrl:function(_7e,row,col){_7e=this._levelToLevelValue[_7e];var _7f=this.tileServers[row%this.tileServers.length]+_6b.substitute(this.urlPath,{level:_7e,col:col,row:row});_7f=_7f.replace(/\{level\}/gi,_7e).replace(/\{row\}/gi,row).replace(/\{col\}/gi,col);_7f=this.addTimestampToURL(_7f);return _6d.addProxy(_7f);}});if(has("extend-esri")){_69.setObject("layers.WebTiledLayer",_72,_6c);}return _72;});},"esri/layers/ServiceGeneratedFeatureCollection":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/renderers/SimpleRenderer","esri/layers/layer","esri/layers/FeatureLayer","esri/dijit/PopupTemplate"],function(_80,_81,_82,_83,_84,_85,has,_86,_87,_88,_89,_8a,_8b,_8c,_8d){var _8e=_80([_8b],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(url,_8f){this.pointSymbol=_8f&&_8f.pointSymbol;this.polylineSymbol=_8f&&_8f.polylineSymbol;this.polygonSymbol=_8f&&_8f.polygonSymbol;this._outSR=(_8f&&(_8f.outSpatialReference||_8f.outSR))||new _87({wkid:4326});this._options=_8f;},parse:function(){},getFeatureLayers:function(){var _90=[];if(this._fLayers){_90=_90.concat(this._fLayers);}return _90;},onRefresh:function(){},refresh:function(){if(!this.loaded||!this._map||this._io||!this.visible){return;}this._createLayer();},_createLayer:function(_91){var _92=this;this._fireUpdateStart();var _93=this.parse(_91);_93.addCallback(function(_94){_92._io=null;_92._initLayer(_94);});_93.addErrback(function(err){_92._io=null;err=_82.mixin(new Error(),err);err.message="Unable to load resource: "+_92.url+" "+(err.message||"");_92._fireUpdateEnd(err);_92.onError(err);});},_initLayer:function(_95){if(this.loaded){this._removeInternalLayers();}this.name=_95.name;this.description=_95.description;this.snippet=_95.snippet;if(_95.visibility!==undefined){this.defaultVisibility=this.visible=!!_95.visibility;}else{this.defaultVisibility=this.visible=true;}this.featureInfos=_95.featureInfos;this.fullExtent=this.initialExtent=new _88(_95.lookAtExtent);this.copyright=_95.author||_95.copyright;var _96;var _97=_82.getObject("featureCollection.layers",false,_95);if(_97&&_97.length>0){this._fLayers=[];_83.forEach(_97,function(_98,i){var _99=_82.getObject("featureSet.features",false,_98),_9a;if(_99&&_99.length>0){_96=_82.mixin({outFields:["*"],infoTemplate:_98.popupInfo?new _8d(_98.popupInfo):null,editable:false},this._options);if(_96.id){_96.id=_96.id+"_"+i;}_98.layerDefinition.capabilities="Query,Data";_9a=new _8c(_98,_96);if(_9a.geometryType){this["_"+_9a.geometryType]=_9a;}this._fLayers.push(_9a);}},this);if(this._fLayers.length===0){delete this._fLayers;}}this.items=[];if(this._esriGeometryPoint){this.items=this.items.concat(this._esriGeometryPoint.graphics);if(this.pointSymbol){var _9b=new _8a(this.pointSymbol);this._esriGeometryPoint.setRenderer(_9b);}}if(this._esriGeometryPolyline){this.items=this.items.concat(this._esriGeometryPolyline.graphics);if(this.polylineSymbol){var _9c=new _8a(this.polylineSymbol);this._esriGeometryPolyline.setRenderer(_9c);}}if(this._esriGeometryPolygon){this.items=this.items.concat(this._esriGeometryPolygon.graphics);if(this.polygonSymbol){var _9d=new _8a(this.polygonSymbol);this._esriGeometryPolygon.setRenderer(_9d);}}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();var _9e=map.spatialReference,_9f=this._outSR,_a0;if(_9e.wkid){_a0=(_9e._isWebMercator()&&_9f._isWebMercator())||(_9e.wkid===_9f.wkid);}else{if(_9e.wkt){_a0=(_9e.wkt===_9f.wkt);}else{return;}}if(!_a0){if(_9e._isWebMercator()&&_9f.wkid===4326){this._converter=_89.geographicToWebMercator;}else{if(_9f._isWebMercator()&&_9e.wkid===4326){this._converter=_89.webMercatorToGeographic;}else{return;}}}var _a1=this._fLayers;if(_a1&&_a1.length>0){_83.forEach(_a1,function(_a2){if(this._converter){var _a3=_a2.graphics,i,_a4,len=_a3?_a3.length:0;for(i=0;i<len;i++){_a4=_a3[i].geometry;if(_a4){_a3[i].setGeometry(this._converter(_a4));}}}map.addLayer(_a2);},this);}this.setVisibility(this.visible);this._fireUpdateEnd();},_removeInternalLayers:function(){var map=this._map;if(map){_83.forEach(this.getFeatureLayers(),map.removeLayer,map);}},onVisibilityChange:function(_a5){this._fireUpdateStart();_83.forEach(this.getFeatureLayers(),function(_a6){_a6.setVisibility(_a5);});this._fireUpdateEnd();},_setMap:function(map,_a7){this.inherited(arguments);this._map=map;var div=this._div=_84.create("div",null,_a7);_85.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_a8){if(this._io){this._io.cancel();}_81.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_a8.removeChild(div);_84.destroy(div);}this._div=null;this.inherited(arguments);}});if(has("extend-esri")){_82.setObject("layers._ServiceGeneratedFeatureCollection",_8e,_86);}return _8e;});},"esri/layers/KMLGroundOverlay":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/layers/MapImage"],function(_a9,_aa,has,_ab,_ac,_ad){var _ae=_a9([_ad],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(_af){if(_ac.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){_aa.setObject("layers.KMLGroundOverlay",_ae,_ab);}return _ae;});},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(_b0,_b1,_b2){var _b3={};_b0.setObject("dojo.data.util.simpleFetch",_b3);_b3.errorHandler=function(_b4,_b5){if(_b5.onError){var _b6=_b5.scope||_b1.global;_b5.onError.call(_b6,_b4,_b5);}};_b3.fetchHandler=function(_b7,_b8){var _b9=_b8.abort||null,_ba=false,_bb=_b8.start?_b8.start:0,_bc=(_b8.count&&(_b8.count!==Infinity))?(_bb+_b8.count):_b7.length;_b8.abort=function(){_ba=true;if(_b9){_b9.call(_b8);}};var _bd=_b8.scope||_b1.global;if(!_b8.store){_b8.store=this;}if(_b8.onBegin){_b8.onBegin.call(_bd,_b7.length,_b8);}if(_b8.sort){_b7.sort(_b2.createSortFunction(_b8.sort,this));}if(_b8.onItem){for(var i=_bb;(i<_b7.length)&&(i<_bc);++i){var _be=_b7[i];if(!_ba){_b8.onItem.call(_bd,_be,_b8);}}}if(_b8.onComplete&&!_ba){var _bf=null;if(!_b8.onItem){_bf=_b7.slice(_bb,_bc);}_b8.onComplete.call(_bd,_bf,_b8);}};_b3.fetch=function(_c0){_c0=_c0||{};if(!_c0.store){_c0.store=this;}this._fetchItems(_c0,_b0.hitch(this,"fetchHandler"),_b0.hitch(this,"errorHandler"));return _c0;};return _b3;});},"esri/layers/KMLLayer":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/sniff","dojo/io-query","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/dijit/PopupTemplate","esri/layers/layer","esri/layers/KMLFolder","esri/layers/KMLGroundOverlay","esri/layers/MapImageLayer","esri/layers/FeatureLayer"],function(_c1,_c2,_c3,_c4,_c5,_c6,has,ioq,_c7,_c8,_c9,_ca,_cb,_cc,_cd,_ce,_cf,_d0,_d1,_d2,_d3,_d4){var _d5=_c2([_d0],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(url,_d6){if(!url){}this._outSR=(_d6&&_d6.outSR)||new _cd({wkid:4326});this._options=_d6;if(_ca.defaults.kmlService){this.serviceUrl=_ca.defaults.kmlService;}var _d7=(this.linkInfo=_d6&&_d6.linkInfo);if(_d7){this.visible=!!_d7.visibility;this._waitingForMap=!!_d7.viewFormat;}if(!_d7||(_d7&&_d7.visibility&&!this._waitingForMap)){this._parseKml();}this.refresh=_c4.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",true);},getFeature:function(_d8){if(!_d8){return;}var _d9=_d8.type,id=_d8.id,_da,i,len;switch(_d9){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var _db=this["_"+_d9];if(_db){_da=_c4.getObject("_mode._featureMap."+id,false,_db);}break;case "GroundOverlay":var _dc=this._groundLyr;if(_dc){var _dd=_dc.getImages();len=_dd.length;for(i=0;i<len;i++){if(_dd[i].id===id){_da=_dd[i];break;}}}break;case "ScreenOverlay":break;case "NetworkLink":_c5.some(this._links,function(_de){if(_de.linkInfo&&_de.linkInfo.id===id){_da=_de;return true;}else{return false;}});break;case "Folder":var _df=this.folders;len=_df?_df.length:0;for(i=0;i<len;i++){if(_df[i].id===id){_da=_df[i];break;}}break;default:undefined;break;}return _da;},getLayers:function(){var _e0=[];if(this._groundLyr){_e0.push(this._groundLyr);}if(this._fLayers){_e0=_e0.concat(this._fLayers);}if(this._links){_c5.forEach(this._links,function(_e1){if(_e1.declaredClass){_e0.push(_e1);}});}return _e0;},setFolderVisibility:function(_e2,_e3){if(!_e2){return;}this._fireUpdateStart();_e2.visible=_e3;if(_e3){_e3=this._areLocalAncestorsVisible(_e2);}this._setState(_e2,_e3);this._fireUpdateEnd();},onRefresh:function(){},_parseKml:function(map){var _e4=this;this._fireUpdateStart();this._io=_cc({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(map),model:"simple",folders:"",refresh:this.loaded?true:undefined,outSR:_c6.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(_e5){_e4._io=null;_e4._initLayer(_e5);},error:function(err){_e4._io=null;err=_c4.mixin(new Error(),err);err.message="Unable to load KML: "+_e4.url+" "+(err.message||"");_e4._fireUpdateEnd(err);_e4.onError(err);}});},_initLayer:function(_e6){if(this.loaded){this._removeInternalLayers();}this.name=_e6.name;this.description=_e6.description;this.snippet=_e6.snippet;this.visibility=_e6.visibility;this.featureInfos=_e6.featureInfos;var i,len;var _e7=(this.folders=_e6.folders),_e8=[],_e9;if(_e7){len=_e7.length;for(i=0;i<len;i++){_e9=(_e7[i]=new _d1(_e7[i]));if(_e9.parentFolderId===-1){_e8.push(_e9);}}}var _ea=(this._links=_e6.networkLinks),_eb;len=_ea?_ea.length:0;for(i=0;i<len;i++){if(_ea[i].viewRefreshMode&&_ea[i].viewRefreshMode.toLowerCase().indexOf("onregion")!==-1){continue;}_eb=_c4.mixin({},this._options);_eb.linkInfo=_ea[i];if(_eb.id){_eb.id=_eb.id+"_"+i;}_ea[i]=new _d5(_ea[i].href,_eb);_ea[i]._parentLayer=this;_ea[i]._parentFolderId=this._getLinkParentId(_ea[i].linkInfo.id);}var _ec=_e6.groundOverlays;if(_ec&&_ec.length>0){_eb=_c4.mixin({},this._options);if(_eb.id){_eb.id=_eb.id+"_"+"mapImage";}var _ed=(this._groundLyr=new _d3(_eb));len=_ec.length;for(i=0;i<len;i++){_ed.addImage(new _d2(_ec[i]));}}var _ee=_c4.getObject("featureCollection.layers",false,_e6);if(_ee&&_ee.length>0){this._fLayers=[];_c5.forEach(_ee,function(_ef,i){var _f0=_c4.getObject("featureSet.features",false,_ef),_f1;if(_f0&&_f0.length>0){_eb=_c4.mixin({outFields:["*"],infoTemplate:_ef.popupInfo?new _cf(_ef.popupInfo):null,editable:false},this._options);if(_eb.id){_eb.id=_eb.id+"_"+i;}_ef.layerDefinition.capabilities="Query,Data";_f1=new _d4(_ef,_eb);if(_f1.geometryType){this["_"+_f1.geometryType]=_f1;}this._fLayers.push(_f1);}},this);if(this._fLayers.length===0){delete this._fLayers;}}len=_e8.length;for(i=0;i<len;i++){_e9=_e8[i];this._setState(_e9,_e9.visible);}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}else{this.loaded=true;this.onLoad(this);}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();if(this._links){_c5.forEach(this._links,function(_f2){if(_f2.declaredClass){map.addLayer(_f2);if(_f2._waitingForMap){_f2._waitingForMap=null;if(_f2.visible){_f2._parseKml(map);}else{_f2._wMap=map;}}}});}var _f3=map.spatialReference,_f4=this._outSR,_f5;if(!_f3.equals(_f4)){if(_f3.isWebMercator()&&_f4.wkid===4326){_f5=_ce.geographicToWebMercator;}else{if(_f4.isWebMercator()&&_f3.wkid===4326){_f5=_ce.webMercatorToGeographic;}else{return;}}}if(this._groundLyr){if(_f5){_c5.forEach(this._groundLyr.getImages(),function(_f6){_f6.extent=_f5(_f6.extent);});}map.addLayer(this._groundLyr);}var _f7=this._fLayers;if(_f7&&_f7.length>0){_c5.forEach(_f7,function(_f8){if(_f5){var _f9=_f8.graphics,i,_fa,len=_f9?_f9.length:0;for(i=0;i<len;i++){_fa=_f9[i].geometry;if(_fa){_f9[i].setGeometry(_f5(_fa));}}}map.addLayer(_f8);});}this.onVisibilityChange(this.visible);},_removeInternalLayers:function(){var map=this._map;if(this._links){_c5.forEach(this._links,function(_fb){if(_fb.declaredClass&&_fb._io){_fb._io.cancel();}});}if(map){_c5.forEach(this.getLayers(),map.removeLayer,map);}},_setState:function(_fc,_fd){var _fe=_fc.featureInfos,_ff,_100,i,len=_fe?_fe.length:0,_101=_fd?"show":"hide";for(i=0;i<len;i++){_ff=_fe[i];_100=this.getFeature(_ff);if(!_100){continue;}if(_ff.type==="Folder"){this._setState(_100,_fd&&_100.visible);}else{if(_ff.type==="NetworkLink"){this._setInternalVisibility(_100,_fd);}else{_100[_101]();}}}},_areLocalAncestorsVisible:function(_102){var _103=_102.parentFolderId,_104=_102.visible;while(_104&&_103!==-1){var _105=this.getFeature({type:"Folder",id:_103});_104=_104&&_105.visible;_103=_105.parentFolderId;}return _104;},_setInternalVisibility:function(_106,_107){var _108=_106._parentLayer,_109=_106._parentFolderId;_107=_107&&_106.visible;while(_107&&_108){_107=_107&&_108.visible;if(_109>-1){_107=_107&&_108._areLocalAncestorsVisible(_108.getFeature({type:"Folder",id:_109}));}_109=_108._parentFolderId;_108=_108._parentLayer;}this._setIntState(_106,_107);},_setIntState:function(link,_10a){if(!link){return;}_c5.forEach(link.getLayers(),function(_10b){if(_10b.linkInfo){link._setIntState(_10b,_10a&&_10b.visible&&link._areLocalAncestorsVisible(link.getFeature({type:"Folder",id:_10b._parentFolderId})));}else{_10b.setVisibility(_10a);}});},_getLinkParentId:function(id){var _10c=-1;if(this.folders){_c5.some(this.folders,function(_10d){if(_10d.networkLinkIds&&_c5.indexOf(_10d.networkLinkIds,id)!==-1){_10c=_10d.id;return true;}return false;});}return _10c;},_checkAutoRefresh:function(){var _10e=this.linkInfo;if(_10e){if(this.visible){if(this.loaded&&this._map){var _10f=_10e.refreshMode,_110=_10e.refreshInterval,_111=_10e.viewRefreshMode,_112=_10e.viewRefreshTime;if(_10f&&_10f.toLowerCase().indexOf("oninterval")!==-1&&_110>0){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,_110*1000);}if(_111&&_111.toLowerCase().indexOf("onstop")!==-1&&_112>0){if(!this._extChgHandle){this._extChgHandle=_c3.connect(this._map,"onExtentChange",this,this._extentChanged);}}}}else{this._stopAutoRefresh();_c3.disconnect(this._extChgHandle);delete this._extChgHandle;}}},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null;},_getQueryParameters:function(map){map=map||this._map;var _113={},_114=this.linkInfo,_115=map&&map.extent,_116;if(this._url.query){_c4.mixin(_113,this._url.query);_116=!!this._url.query.token;}if(_c9.id&&!_116){var _117=_c9.id.findCredential(this._url.path);if(_117){_113.token=_117.token;}}if(_114){var _118=_114.viewFormat,_119=_114.httpQuery,_11a=_114.viewBoundScale;if(_115&&_118){var _11b=_115,_11c=_115,sr=_115.spatialReference;if(sr){if(sr.isWebMercator()){_11b=_ce.webMercatorToGeographic(_115);}else{if(sr.wkid===4326){_11c=_ce.geographicToWebMercator(_115);}}}var _11d=_11b.getCenter(),_11e=Math.max(_11c.getWidth(),_11c.getHeight());if(_11a){_11b=_11b.expand(_11a);}_118=_118.replace(/\[bboxWest\]/ig,_11b.xmin).replace(/\[bboxEast\]/ig,_11b.xmax).replace(/\[bboxSouth\]/ig,_11b.ymin).replace(/\[bboxNorth\]/ig,_11b.ymax).replace(/\[lookatLon\]/ig,_11d.x).replace(/\[lookatLat\]/ig,_11d.y).replace(/\[lookatRange\]/ig,_11e).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,_11d.x).replace(/\[lookatTerrainLat\]/ig,_11d.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,_11d.x).replace(/\[cameraLat\]/ig,_11d.y).replace(/\[cameraAlt\]/ig,_11e).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,map.width).replace(/\[vertPixels\]/ig,map.height).replace(/\[terrainEnabled\]/ig,0);_c4.mixin(_113,ioq.queryToObject(_118));}if(_119){_119=_119.replace(/\[clientVersion\]/ig,_c9.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,_c1.locale);_c4.mixin(_113,ioq.queryToObject(_119));}}var _11f=[],_120;for(_120 in _113){if(_cb.isDefined(_113[_120])){_11f.push(_120+"="+_113[_120]);}}_11f=_11f.join("&");return _11f?("?"+_11f):"";},_setMap:function(map,_121){this.inherited(arguments);this._map=map;var div=this._div=_c7.create("div",null,_121);_c8.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_122){if(this._io){this._io.cancel();}this._stopAutoRefresh();_c3.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_122.removeChild(div);_c7.destroy(div);}this._wMap=this._div=null;this.inherited(arguments);},onVisibilityChange:function(_123){if(!this.loaded){if(this.linkInfo&&_123){if(!this._waitingForMap){this._parseKml(this._wMap);}}return;}this._fireUpdateStart();this._setInternalVisibility(this,_123);this._checkAutoRefresh();this._fireUpdateEnd();},refresh:function(){if(!this.loaded||!this._map||this._io||!this.visible){return;}this._parseKml();},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,this.linkInfo.viewRefreshTime*1000);}});if(has("extend-esri")){_c4.setObject("layers.KMLLayer",_d5,_c9);}return _d5;});},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(lang){var _124={};lang.setObject("dojo.data.util.sorter",_124);_124.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_124.createSortFunction=function(_125,_126){var _127=[];function _128(attr,dir,comp,s){return function(_129,_12a){var a=s.getValue(_129,attr);var b=s.getValue(_12a,attr);return dir*comp(a,b);};};var _12b;var map=_126.comparatorMap;var bc=_124.basicComparator;for(var i=0;i<_125.length;i++){_12b=_125[i];var attr=_12b.attribute;if(attr){var dir=(_12b.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_127.push(_128(attr,dir,comp,_126));}}return function(rowA,rowB){var i=0;while(i<_127.length){var ret=_127[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _124;});},"esri/layers/OnDemandMode":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/geometry/Point","esri/tasks/query","esri/layers/RenderMode","esri/layers/GridLayout"],function(_12c,_12d,lang,_12e,has,_12f,_130,_131,_132,_133){var _134=_12c([_132],{declaredClass:"esri.layers._OnDemandMode",constructor:function(_135){this.featureLayer=_135;this._featureMap={};this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},initialize:function(map){this.inherited(arguments);var _136=this.featureLayer,_137=_136._srInfo;this._gridLayer=new _133(new _130(_137?_137.valid[0]:map.extent.xmin,map.extent.ymax,map.spatialReference),{width:_136._tileWidth,height:_136._tileHeight},{width:map.width,height:map.height},_137);this._cellMap={};this._gridLayer.setResolution(map.extent);},startup:function(){this._ioQueue=[];if(!this.featureLayer.suspended){this._zoomHandler();this._enableConnectors();}},propertyChangeHandler:function(type){if(this._init){if(type<2){this._zoomHandler();}else{}}},destroy:function(){this._disableConnectors();this.inherited(arguments);},drawFeature:function(_138){var _139=this._gridLayer,geom=_138.geometry,_13a=[];if(!geom){return;}_13a=_139.getCellsInExtent((geom.type==="point")?{xmin:geom.x,ymin:geom.y,xmax:geom.x,ymax:geom.y}:geom.getExtent(),false).cells;var _13b=this._cellMap,i,cell,oid=_138.attributes[this.featureLayer.objectIdField],_13c,row,col;for(i=0;i<_13a.length;i++){cell=_13a[i];_13c=cell.latticeID;row=cell.row;col=cell.col;if(_13c){cell=(_13b[_13c]=(_13b[_13c]||cell));}else{_13b[row]=_13b[row]||{};cell=(_13b[row][col]=(_13b[row][col]||cell));}cell.features=cell.features||[];cell.features.push(_138);this._addFeatureIIf(oid,_138);this._incRefCount(oid);}},suspend:function(){if(!this._init){return;}this._disableConnectors();},resume:function(){if(!this._init){return;}this._enableConnectors();this._zoomHandler();},refresh:function(){this._zoomHandler();},_enableConnectors:function(){var map=this.map;this._zoomConnect=_12d.connect(map,"onZoomEnd",this,this._zoomHandler);this._panConnect=_12d.connect(map,"onPanEnd",this,this._panHandler);this._resizeConnect=_12d.connect(map,"onResize",this,this._panHandler);},_disableConnectors:function(){_12d.disconnect(this._zoomConnect);_12d.disconnect(this._panConnect);_12d.disconnect(this._resizeConnect);},_zoomHandler:function(){this._processIOQueue(true);var _13d=this.featureLayer,map=this.map;if(_13d.suspended){return;}_13d._fireUpdateStart();this._clearIIf();var _13e=_13d._trackManager;if(_13e){_13e.clearTracks();}this._cellMap={};this._gridLayer.setResolution(map.extent);this._sendRequest();},_panHandler:function(){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&arguments[0]);},_getRequestId:function(_13f,cell){var id="_"+_13f.name+_13f.layerId+_13f._ulid+"_"+cell.resolution+"_"+(cell.latticeID||(cell.row+"_"+cell.col));return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_sendRequest:function(_140){this._exceeds=false;var _141=this.featureLayer,map=this.map,_142=_140||map.extent,_143=this._gridLayer.getCellsInExtent(_142,_141.latticeTiling),_144=_143.cells;if(!_141.isEditable()){var _145=this._cellMap;_144=_12e.filter(_144,function(cell){if(cell.lattice){if(_145[cell.latticeID]){return false;}}else{if(_145[cell.row]&&_145[cell.row][cell.col]){return false;}}return true;});}var _146=_141.getOutFields(),_147=_141.getDefinitionExpression(),time=_141._getOffsettedTE(_141._mapTimeExtent),_148=_141.supportsAdvancedQueries?_141.orderByFields:null,_149=_141._usePatch,_14a=this._ioQueue,i,self=this,func=this._drawFeatures,cell,_14b,_14c;this._pending=this._pending||0;for(i=0;i<_144.length;i++){cell=_144[i];_14b=new _131();_14b.geometry=cell.extent||cell.lattice;_14b.outFields=_146;_14b.where=_147;if(_141.latticeTiling&&cell.extent){_14b.spatialRelationship=_131.SPATIAL_REL_CONTAINS;}_14b.returnGeometry=true;_14b.timeExtent=time;_14b.maxAllowableOffset=_141._maxOffset;if(_141._ts){_14b._ts=(new Date()).getTime();}_14b.orderByFields=_148;_14c=null;if(_149){_14c=this._getRequestId(_141,cell);if(this._isPending(_14c)){continue;}}this._pending++;_14a.push(_141._task.execute(_14b,function(){var _14d=cell;return function(_14e){func.apply(self,[_14e,_14d]);};}.call(this),this._queryErrorHandler,_14c));}this._removeOldCells(_142);this._endCheck();},_drawFeatures:function(_14f,cell){this._exceeds=this._exceeds||_14f.exceededTransferLimit;this._finalizeIO();var _150=this.featureLayer,map=this.map,_151=map.extent,_152=cell.extent,row=cell.row,col=cell.col,_153=_150.objectIdField,_154=_14f.features,_155=this._gridLayer,_156=this._cellMap,i,len,_157=cell.latticeID,_158=_157?_156[_157]:(_156[row]&&_156[row][col]);if((cell.resolution!=_155._resolution)||(_157?(_157!==_155.getLatticeID(_151)):(!_155.intersects(_152,_151)))){if(_158){this._removeCell(row,col,_157);}}else{if(_158){this._updateCell(_158,_154);}else{cell.features=_154;if(_157){_156[_157]=cell;}else{_156[row]=_156[row]||{};_156[row][col]=cell;}len=_154.length;for(i=0;i<len;i++){var _159=_154[i];var oid=_159.attributes[_153];this._addFeatureIIf(oid,_159);this._incRefCount(oid);}}}this._endCheck();},_queryErrorHandler:function(err){this._finalizeIO();this.featureLayer._errorHandler(err);this._endCheck(true);},_finalizeIO:function(){this._purgeRequests();this._pending--;},_endCheck:function(_15a){if(this._pending===0){this._processIOQueue();var _15b=this.featureLayer,_15c=_15b._trackManager;if(_15c){_15c.clearTracks();_15c.addFeatures(_15b.graphics);if(_15b._ager){_12e.forEach(_15b.graphics,function(_15d){if(_15d._shape){_15b._repaint(_15d);}});}_15c.moveLatestToFront();_15c.drawTracks();}this.featureLayer._fireUpdateEnd(_15a&&new Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:true}:null);if(this._exceeds){_15b.onQueryLimitExceeded();}}},_processIOQueue:function(_15e){this._ioQueue=_12e.filter(this._ioQueue,function(dfd){var keep=dfd.fired>-1?false:true;return keep;});if(_15e){_12e.forEach(this._ioQueue,this._cancelPendingRequest);}},_removeOldCells:function(_15f){var _160=this._cellMap,_161=this._gridLayer,_162,_163;for(_162 in _160){if(_160[_162]){var row=_160[_162],_164=row.latticeID,_165=0,_166=0;if(_164){_165++;if(_164!==_161.getLatticeID(_15f)){this._removeCell(null,null,_164);_166++;}}else{for(_163 in row){if(row[_163]){_165++;var _167=row[_163].extent;if(!_161.intersects(_167,_15f)){this._removeCell(_162,_163);_166++;}}}}if(_166===_165){delete _160[_162];}}}},_updateCell:function(cell,_168){var _169=this.featureLayer,_16a=_169.objectIdField,_16b=_169._selectedFeatures,i,len=_168.length;cell.features=cell.features||[];for(i=0;i<len;i++){var _16c=_168[i];var oid=_16c.attributes[_16a];var _16d=this._addFeatureIIf(oid,_16c);if(_16d===_16c){this._incRefCount(oid);cell.features.push(_16d);}else{if(!(oid in _16b)){_16d.setGeometry(_16c.geometry);_16d.setAttributes(_16c.attributes);}}}},_removeCell:function(row,col,_16e){var _16f=this._cellMap,_170=this.featureLayer,_171=_170.objectIdField;var cell=_16e?_16f[_16e]:(_16f[row]&&_16f[row][col]);if(cell){if(_16e){delete _16f[_16e];}else{delete _16f[row][col];}var _172=cell.features,i;for(i=0;i<_172.length;i++){var _173=_172[i];var oid=_173.attributes[_171];this._decRefCount(oid);if(oid in _170._selectedFeatures){continue;}this._removeFeatureIIf(oid);}}}});if(has("extend-esri")){lang.setObject("layers._OnDemandMode",_134,_12f);}return _134;});},"esri/arcgis/Portal":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/kernel","dojo/_base/Deferred","dojo/_base/array","dojo/_base/sniff","dojo/Evented","dojo/DeferredList","esri/kernel","esri/lang","esri/request","esri/IdentityManager"],function(_174,lang,_175,_176,_177,has,_178,_179,_17a,_17b,_17c){var _17d={"options":{"disableIdentityLookup":true},"requestParams":{"f":"json"}},_17e=function(_17f){if(!_17f){return _17f;}if(_17f.then){_17f=lang.delegate(_17f);}if(!_17f.total){_17f.total=_176.when(_17f,function(_180){return _17b.isDefined(_180.total)?_180.total:(_180.length||0);});}function _181(_182){if(!_17f[_182]){_17f[_182]=function(){var args=arguments;return _176.when(_17f,function(_183){Array.prototype.unshift.call(args,(_183.results||_183));return _17e(_177[_182].apply(_177,args));});};}};_181("forEach");_181("filter");_181("map");_181("some");_181("every");return _17f;},_184={useSSL:function(_185,url){return (_185.indexOf("https:")!==-1||(_17d.self&&_17d.self.allSSL))?url.replace("http:","https:"):url;},formatUrl:function(url){var _186=_17d.loggedInUser&&_17d.loggedInUser.credential&&_17d.loggedInUser.credential.token;return url.indexOf("null")!==-1?null:_184.useSSL(window.location.protocol,(_186?url+(url.indexOf("?")!==-1?"&":"?")+("token="+_186):url));},resultsToTypedArray:function(type,_187,_188){_188=_188?(_188.listings||_188.notifications||_188.userInvitations||_188.tags||_188.items||_188.groups||_188.comments||_188.results||_188):[];return _177.map(_188,function(_189){_189=lang.mixin(_189,_187||{});return type?new type(_189):_189;});},clearFieldsFromObject:function(flds,obj){var fld,i,l=flds.length;if(!lang.isArray(flds)){for(fld in flds){delete obj[fld];}}else{for(i=0;i<l;i++){delete obj[flds[i]];}}return obj;},requestToTypedArray:function(url,_18a,_18b,type,_18c){return _17e(_184.request(url,_18a,_18b).then(lang.partial(_184.resultsToTypedArray,type,_18c)));},request:function(url,_18d,_18e){if(_18d&&_18d.portal){delete _18d.portal;}var _18f=lang.mixin(lang.mixin({},_18d||{}),_17d.requestParams);var _190=lang.mixin(_18e||{},_17d.options);return _17c({url:_184.useSSL(window.location.protocol,(url.url||url)),content:_18f,callbackParamName:"callback",timeout:(_190&&_190.timeout)||0},_190);},formatQueryParams:function(_191,_192,_193){var qp=lang.mixin(lang.mixin({},_191),(lang.isString(_192)?{"q":_192}:(_192||{})));qp.q=!_193&&_17d.extraQuery?"("+qp.q+")"+_17d.extraQuery:qp.q;return qp;}},_194=_174([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(_195){lang.mixin(this,_195);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null;}}),_196=_174([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(_197){lang.mixin(this,_197);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null;}}),_198=_174([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(_199){lang.mixin(this,_199);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.itemUrl.replace("content",("content/users/"+this.owner)+(this.folderId?"/"+this.folderId:""));this.itemDataUrl=_184.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=_184.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null;},addComment:function(_19a){var _19b=lang.isString(_19a)?{"comment":_19a}:_19a;return _184.request(this.itemUrl+"/addComment",_19b,{"usePost":true}).then(lang.hitch(this,function(_19c){return _194(lang.mixin(_19b,{"id":_19c.commentId,"item":this}));}));},updateComment:function(_19d){if(_19d&&_19d.url&&_19d.comment){var _19e={"comment":_19d.comment};return _184.request(_19d.url+"/update",_19e,{"usePost":true}).then(function(_19f){_19d.id=_19f.commentId;return _19d;});}else{throw new Error();}},getComments:function(){return _184.requestToTypedArray(this.itemUrl+"/comments",null,null,_194,{"item":this});},deleteComment:function(_1a0){if(_1a0&&_1a0.url){return _184.request(_1a0.url+"/delete",null,{"usePost":true});}else{throw new Error();}},addRating:function(_1a1){var _1a2=lang.isObject(_1a1)?_1a1:{"rating":parseFloat(_1a1)};return _184.request(this.itemUrl+"/addRating",_1a2,{"usePost":true}).then(lang.hitch(this,function(_1a3){return new _196(lang.mixin(_1a2,{"id":_1a3.ratingId,"item":this}));}));},getRating:function(){return _184.request(this.itemUrl+"/rating").then(lang.hitch(this,function(_1a4){return new _196(lang.mixin(_1a4,{"item":this}));}));},deleteRating:function(){return _184.request(this.itemUrl+"/deleteRating",null,{"usePost":true});}}),_1a5=_174([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(_1a6){lang.mixin(this,_1a6);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?_184.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?_184.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?_184.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:false,trialDuration:0,listingAccess:"private"};for(var prop in this.listingProperties){if(this[prop]){this.listingProperties[prop]=this[prop];}}this.properties=this.properties||{"systemRequirements":"","termsAndConditions":"","version":"1.0"};this.screenshots=_177.map(this.screenshots,lang.hitch(this,function(_1a7){return _184.formatUrl(this.url+"/info/"+_1a7);}));this.vendorName=this.vendor.name;this.vendor.orgPhone=this.vendor.orgPhone;this.vendor.orgEmail=this.vendor.orgEmail;this.vendor.orgUrl=this.vendor.orgUrl;this.vendor.description=this.vendor.description;this.vendor.thumbnail=this.vendor.thumbnail?(this.userItemUrl?_184.formatUrl(this.portal.portalUrl+"/accounts/self/resources/"+this.vendor.thumbnail):_184.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail)):"";},getComments:function(){return _184.requestToTypedArray(this.commentsUrl,null,null,_194,{"item":this});},getVendor:function(){return this.vendor;}}),_1a8=_174([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(_1a9){lang.mixin(this,_1a9);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&this.endDate!==-1?new Date(this.endDate):null;this.listing=_1a9.listing?new _1a5(lang.mixin(_1a9.listing,{"portal":this.portal})):null;}}),_1aa=_174([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(_1ab){lang.mixin(this,_1ab);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=_184.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null;},getMembers:function(){return _184.request(this.url+"/users");},queryItems:function(_1ac){_1ac=_184.formatQueryParams({},_1ac);_1ac.q="group:"+this.id+(_1ac.q?(" "+_1ac.q):"");return this.portal.queryItems(_1ac);}}),_1ad=_174([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(_1ae){lang.mixin(this,_1ae);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null;},getItems:function(){return _184.requestToTypedArray(this.url,null,null,_198,{"portal":this.portal,"folderId":this.id});}}),_1af=_174([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(_1b0){lang.mixin(this,_1b0);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=_184.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null;},getGroups:function(){return _17e(_184.request(this.url).then(lang.hitch(this,function(_1b1){return _184.resultsToTypedArray(_1aa,{"portal":this.portal},_1b1.groups);})));},getNotifications:function(){return _184.requestToTypedArray(this.url+"/notifications",null,null,null,{"portal":this.portal});},getGroupInvitations:function(){return _184.requestToTypedArray(this.url+"/invitations",null,null,null,{"portal":this.portal});},getTags:function(){return _184.requestToTypedArray(this.url+"/tags",null,null,null,{"portal":this.portal});},getFolders:function(){return _17e(this.getContent().then(function(_1b2){return _1b2.folders;}));},getItems:function(_1b3){return _17e(this.getContent(_1b3).then(function(_1b4){return _1b4.items;}));},getItem:function(_1b5){var url=this.portal.portalUrl+"content/items/"+_1b5;return _184.request(url).then(lang.hitch(this,function(item){return new _198(lang.mixin(item,{"portal":this.portal}));}));},getContent:function(_1b6){var url=(this.url.replace("community","content"))+(_1b6?("/"+_1b6):"");return _184.request(url).then(lang.hitch(this,function(_1b7){_1b7.folders=_184.resultsToTypedArray(_1ad,{"portal":this.portal},_1b7.folders);_1b7.items=_184.resultsToTypedArray(_198,{"portal":this.portal,"folderId":_1b6},_1b7.items);return _1b7;}));}}),_1b8=_174([_178],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},constructor:function(url){lang.mixin(this,{"url":url});this.init(url).then(lang.hitch(this,function(){this.emit("ready",this);this.onLoad(this);}));},init:function(url,_1b9){url=(url||this.portalUrl).replace(/\/+$/,"");var idx=url.indexOf("/sharing");this.portalUrl=(idx!==-1?(url+"/"):(url+"/sharing/rest/"));return this._getSelf(this.portalUrl).then(lang.hitch(this,function(_1ba){_17d.self=lang.mixin({},_1ba);var _1bb=_1ba.user;if(_1bb){_1bb.portal=this;_1bb=new _1af(_1bb);_17d.loggedInUser=lang.mixin({},lang.mixin(_1bb,{"credential":_1b9}));}if(_17d.self.id&&_17d.self.canSearchPublic===false){_17d.extraQuery=" AND orgid:"+_17d.self.id;}lang.mixin(this,_17d.self);this.thumbnailUrl=_184.formatUrl(this.portalUrl+"accounts/self/resources/"+this.thumbnail);this.isOrganization=(this.access&&this.access.length)||false;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this;}));},signIn:function(){if(_17d&&_17d.loggedInUser){var dfd=new _176();dfd.resolve(_17d.loggedInUser);return dfd;}else{_17d.options.disableIdentityLookup=false;return _17a.id.getCredential(this.portalUrl).then(lang.hitch(this,"init",this.url)).then(function(){return _17d.loggedInUser;},function(_1bc){_17d.options.disableIdentityLookup=true;throw _1bc;});}},signOut:function(){if(_17d.loggedInUser.credential){_17d.loggedInUser.credential.destroy();}_17d.loggedInUser=null;_17d.options.disableIdentityLookup=true;_184.clearFieldsFromObject(_17d.self,this);_17d.self=null;return this.init(this.url);},getPortalUser:function(){return _17d.loggedInUser;},addResource:function(_1bd,_1be){var _1bf={"key":_1bd,"text":_1be};return _184.request((this.portalUrl+"portals/self/addResource"),_1bf,{"usePost":true});},update:function(_1c0){return _184.request((this.portalUrl+"portals/self/update"),_1c0,{"usePost":true});},queryGroups:function(_1c1){return this._queryPortal(this.portalUrl+"community/groups",_184.formatQueryParams({},_1c1),_1aa);},queryItems:function(_1c2){return this._queryPortal(this.portalUrl+"search",_184.formatQueryParams({},_1c2),_198);},queryListings:function(_1c3){var qp=_184.formatQueryParams({},_1c3,true),qs="";if(qp.q&&qp.q.toLowerCase().indexOf("mylistings:true")>-1){qp.q=qp.q.toLowerCase().replace("mylistings:true","");qs="?mylistings=true";}else{if(!qp.q){qp.q="\"\"";}}return this._queryPortal(this.portalUrl+"content/listings"+qs,qp,_1a5);},getProvisions:function(){return this.getCustomers().then(lang.hitch(this,function(_1c4){return _1c4.purchases;}));},getInterests:function(){return this.getCustomers().then(lang.hitch(this,function(_1c5){return _1c5.interests;}));},getTrials:function(){return this.getCustomers().then(lang.hitch(this,function(_1c6){return _1c6.trials;}));},getCustomers:function(){var url=((this.portalUrl)+"portals/self/customers");return _184.request(url);},getMyPurchases:function(){return this.getPurchases().then(function(_1c7){return _1c7.purchases;});},getMyInterests:function(){return this.getPurchases().then(function(_1c8){return _1c8.interests;});},getPurchases:function(){var url=((this.portalUrl)+"portals/self/purchases");return _184.request(url).then(lang.hitch(this,function(_1c9){_1c9.interests=_177.map(_1c9.interests,function(item){return lang.mixin(item.provision,{"listing":item.listing});});_1c9.purchases=_177.map(_1c9.purchases,function(item){return lang.mixin(item.provision,{"listing":item.listing});});_1c9.trials=_177.map(_1c9.trials,function(item){return lang.mixin(item.provision,{"listing":item.listing});});_1c9.interests=_184.resultsToTypedArray(_1a8,{"portal":this},_1c9.interests);_1c9.trials=_184.resultsToTypedArray(_1a8,{"portal":this},_1c9.trials);_1c9.purchases=_184.resultsToTypedArray(_1a8,{"portal":this},_1c9.purchases);return _1c9;}));},queryUsers:function(_1ca){return this._queryPortal(this.portalUrl+"community/users",_184.formatQueryParams({"sortField":"username"},_1ca),_1af);},_getSelf:function(url){var _1cb=url+"accounts/self?"+"culture="+_175.locale;return _184.request(_1cb);},_queryPortal:function(url,_1cc,type){var _1cd=lang.mixin({"num":10,"start":0,"sortField":"title","sortOrder":"asc"},_1cc),_1ce=["start","query","num","nextStart"],dfd=_184.request(url,_1cd).then(lang.hitch(this,function(_1cf){_1cf.results=_184.resultsToTypedArray(type,{"portal":this},_1cf);_1cf.queryParams=lang.mixin({},_1cd);_1cf.nextQueryParams=lang.mixin(_1cd,{"start":_1cf.nextStart});return _184.clearFieldsFromObject(_1ce,_1cf);}));dfd=lang.delegate(dfd);dfd.queryParams=lang.mixin({},_1cd);dfd.nextQueryParams=_176.when(dfd,function(_1d0){return _1d0.nextQueryParams;});return _17e(dfd);}}),_1d1={Portal:_1b8,PortalFolder:_1ad,PortalGroup:_1aa,PortalItem:_198,PortalComment:_194,PortalRating:_196,PortalUtil:_184,PortalResult:_17e,PortalListing:_1a5};if(has("extend-esri")){lang.mixin(lang.getObject("arcgis",true,_17a),_1d1);}return _1d1;});},"esriviewer/loader/esrirequires/EsriRequires":function(){define(["esri/arcgis/utils","esri/layers/FeatureLayer","esri/layers/KMLLayer","esri/layers/MapImageLayer","esri/layers/WMSLayer","esri/dijit/BasemapGallery","esri/dijit/OverviewMap","esri/arcgis/Portal"],function(_1d2){return _1d2([],{});});},"esri/layers/FeatureLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/date/locale","dojo/sniff","dojo/io-query","dojo/dom-construct","dojo/i18n","esri/kernel","esri/lang","esri/request","esri/deferredUtils","esri/SpatialReference","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/jsonUtils","esri/renderers/SimpleRenderer","esri/renderers/UniqueValueRenderer","esri/renderers/jsonUtils","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/FeatureSet","esri/geometry/Extent","esri/geometry/jsonUtils","esri/geometry/normalizeUtils","esri/layers/GraphicsLayer","esri/layers/Field","esri/layers/TimeInfo","esri/layers/FeatureType","esri/layers/FeatureTemplate","esri/layers/FeatureEditResult","esri/layers/LabelClass","esri/layers/SnapshotMode","esri/layers/OnDemandMode","esri/layers/SelectionMode","esri/layers/TrackManager","dojo/i18n!esri/nls/jsapi","dojo/has!extend-esri?esri/layers/agscommon"],function(_1d3,_1d4,lang,_1d5,_1d6,_1d7,_1d8,has,ioq,_1d9,i18n,_1da,_1db,_1dc,_1dd,_1de,_1df,_1e0,_1e1,_1e2,_1e3,_1e4,_1e5,_1e6,_1e7,_1e8,_1e9,_1ea,_1eb,_1ec,_1ed,_1ee,_1ef,_1f0,_1f1,_1f2,_1f3,_1f4,_1f5,_1f6){var _1f7=_1d3(_1ec,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(url,_1f8){this.i18n=i18n.getLocalization("esri","jsapi");this._outFields=_1f8&&_1f8.outFields;this._loadCallback=_1f8&&_1f8.loadCallback;var _1f9=_1f8&&_1f8._usePatch;this._usePatch=(_1f9===null||_1f9===undefined)?true:_1f9;this._trackIdField=_1f8&&_1f8.trackIdField;this.objectIdField=_1f8&&_1f8.objectIdField;this._maxOffset=_1f8&&_1f8.maxAllowableOffset;this._optEditable=_1f8&&_1f8.editable;this._optAutoGen=_1f8&&_1f8.autoGeneralize;this.editSummaryCallback=_1f8&&_1f8.editSummaryCallback;this.userId=_1f8&&_1f8.userId;this.userIsAdmin=_1f8&&_1f8.userIsAdmin;this.useMapTime=(_1f8&&_1f8.hasOwnProperty("useMapTime"))?(!!_1f8.useMapTime):true;this.source=_1f8&&_1f8.source;this.gdbVersion=_1f8&&_1f8.gdbVersion;this.orderByFields=_1f8&&_1f8.orderByFields;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var ctor=this.constructor,mode=this.mode=(_1db.isDefined(_1f8&&_1f8.mode)?_1f8.mode:ctor.MODE_ONDEMAND);switch(mode){case ctor.MODE_SNAPSHOT:this._mode=new _1f3(this);this._isSnapshot=true;break;case ctor.MODE_ONDEMAND:this._tileWidth=(_1f8&&_1f8.tileWidth)||512;this._tileHeight=(_1f8&&_1f8.tileHeight)||512;this._mode=new _1f4(this);var _1fa=_1f8&&_1f8.latticeTiling;this.latticeTiling=_1fa;break;case ctor.MODE_SELECTION:this._mode=new _1f5(this);this._isSelOnly=true;break;}this._initLayer=lang.hitch(this,this._initLayer);this._selectHandler=lang.hitch(this,this._selectHandler);this._editable=false;if(lang.isObject(url)&&url.layerDefinition){var json=url;this._collection=true;this.mode=ctor.MODE_SNAPSHOT;this._initLayer(json);return this;}this._task=new _1e6(this.url,{source:this.source,gdbVersion:this.gdbVersion});var _1fb=this._url.path;this._fserver=false;if(_1fb.search(/\/FeatureServer\//i)!==-1){this._fserver=true;}var _1fc=_1f8&&_1f8.resourceInfo;if(_1fc){this._initLayer(_1fc);}else{if(this.source){var _1fd={source:this.source.toJson()};this._url.query=lang.mixin(this._url.query,{layer:_1d6.toJson(_1fd)});}if(this.gdbVersion){this._url.query=lang.mixin(this._url.query,{gdbVersion:this.gdbVersion});}_1dc({url:_1fb,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}this.registerConnectEvents();},_initLayer:function(_1fe,io){if(_1fe||io){this._json=_1fe;this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_1fe&&_1fe._ssl);if(ssl){this._useSSL();this._task._useSSL();}if(this._collection){this._mode=new _1f3(this);this._isSnapshot=true;this._featureSet=_1fe.featureSet;this._nextId=_1fe.nextObjectId;_1fe=_1fe.layerDefinition;}if(_1fe.hasOwnProperty("capabilities")){var _1ff=(this.capabilities=_1fe.capabilities);if(_1ff&&_1ff.toLowerCase().indexOf("editing")!==-1){this._editable=true;}else{this._editable=false;}}else{if(!this._collection){this._editable=this._fserver;}}if(_1db.isDefined(this._optEditable)){this._editable=this._optEditable;delete this._optEditable;}this._json=_1d6.toJson(this._json);if(this.isEditable()){delete this._maxOffset;}else{if(this.mode!==this.constructor.MODE_SNAPSHOT&&((_1fe.geometryType==="esriGeometryPolyline")||(_1fe.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_1db.isDefined(this._optAutoGen)?this._optAutoGen:(this.mode===this.constructor.MODE_ONDEMAND);delete this._optAutoGen;}}var _200=_1fe.effectiveMinScale||_1fe.minScale,_201=_1fe.effectiveMaxScale||_1fe.maxScale;if(!this._hasMin&&_200){this.setMinScale(_200);}if(!this._hasMax&&_201){this.setMaxScale(_201);}this.layerId=_1fe.id;this.name=_1fe.name;this.description=_1fe.description;this.copyright=_1fe.copyrightText;this.type=_1fe.type;this.geometryType=_1fe.geometryType;this.displayField=_1fe.displayField;this.defaultDefinitionExpression=_1fe.definitionExpression;this.fullExtent=new _1e9(_1fe.extent);this.initialExtent=new _1e9(this.fullExtent.toJson());if(this.fullExtent.spatialReference){this.spatialReference=new _1de(this.fullExtent.spatialReference.toJson());}this.defaultVisibility=_1fe.defaultVisibility;if((this.geometryType==="esriGeometryPoint")||(this.geometryType==="esriGeometryMultipoint")){this.latticeTiling=false;}this.indexedFields=_1fe.indexedFields;this.maxRecordCount=_1fe.maxRecordCount;this.canModifyLayer=_1fe.canModifyLayer;this.supportsStatistics=_1fe.supportsStatistics;this.supportsAdvancedQueries=_1fe.supportsAdvancedQueries;this.hasLabels=_1fe.hasLabels;this.canScaleSymbols=_1fe.canScaleSymbols;this.supportsRollbackOnFailure=_1fe.supportsRollbackOnFailure;this.syncCanReturnChanges=_1fe.syncCanReturnChanges;this.isDataVersioned=_1fe.isDataVersioned;this.editFieldsInfo=_1fe.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=_1fe.ownershipBasedAccessControlForFeatures;if(this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures){this.creatorField=this.editFieldsInfo.creatorField;}this.relationships=_1fe.relationships;this.allowGeometryUpdates=_1db.isDefined(_1fe.allowGeometryUpdates)?_1fe.allowGeometryUpdates:true;this._isTable=(this.type==="Table");var _202=(this.fields=[]),_203=_1fe.fields,i;for(i=0;i<_203.length;i++){_202.push(new _1ed(_203[i]));}if(!this.objectIdField){this.objectIdField=_1fe.objectIdField;if(!this.objectIdField){_203=_1fe.fields;for(i=0;i<_203.length;i++){var _204=_203[i];if(_204.type==="esriFieldTypeOID"){this.objectIdField=_204.name;break;}}}if(!this.objectIdField){}}if(!_1db.isDefined(this._nextId)){var _205=this.objectIdField,_206=-1;if(this._collection&&_205){var fset=this._featureSet,_207=fset&&fset.features,il=_207?_207.length:0,oid,attr;for(i=0;i<il;i++){attr=_207[i].attributes;oid=attr&&attr[_205];if(oid>_206){_206=oid;}}}this._nextId=(_206+1);}this.globalIdField=_1fe.globalIdField;var _208=(this.typeIdField=_1fe.typeIdField),_209;if(_208){_209=!this._getField(_208)&&this._getField(_208,true);if(_209){this.typeIdField=_209.name;}}this.visibilityField=_1fe.visibilityField;var _20a=_1fe.defaultSymbol;if(_20a){this.defaultSymbol=_1e2.fromJson(_20a);}var _20b=this.types=[],_20c=_1fe.types,_20d,_20e,_20f,_210=this.editFieldsInfo,_211=_210&&_210.creatorField,_212=_210&&_210.editorField,fix=(_211||_212),_213=[];if(_20c){for(i=0;i<_20c.length;i++){_20d=new _1ef(_20c[i]);_20e=_20d.templates;if(fix&&_20e&&_20e.length){_213=_213.concat(_20e);}_20b.push(_20d);}}var _214=_1fe.templates,_215,_216=this.templates=[];if(_214){for(i=0;i<_214.length;i++){_215=new _1f0(_214[i]);if(fix){_213.push(_215);}_216.push(_215);}}for(i=0;i<_213.length;i++){_20f=lang.getObject("prototype.attributes",false,_213[i]);if(_20f){if(_211){delete _20f[_211];}if(_212){delete _20f[_212];}}}var _217=_1fe.timeInfo;if(_217){this.timeInfo=new _1ee(_217);this._startTimeField=_217.startTimeField;this._endTimeField=_217.endTimeField;if(this._startTimeField&&this._endTimeField){this._twoTimeFields=true;}if(this._trackIdField){_217.trackIdField=this._trackIdField;}else{this._trackIdField=_217.trackIdField;}}this.hasAttachments=(!this._collection&&_1fe.hasAttachments)?true:false;this.htmlPopupType=_1fe.htmlPopupType;var _218=_1fe.drawingInfo,_219,_21a=_218&&_218.labelingInfo;if(_21a){this.labelingInfo=_1d5.map(_21a,function(_21b){return new _1f2(_21b);});}if(!this.renderer){if(_218&&_218.renderer){_219=_218.renderer;this.setRenderer(_1e5.fromJson(_219));if(_219.type==="classBreaks"){this.renderer.setMaxInclusive(true);}if(!this._collection){var _21c=_219.type,_21d=[];_219=this.renderer;switch(_21c){case "simple":_21d.push(_219.symbol);break;case "uniqueValue":case "classBreaks":_21d.push(_219.defaultSymbol);_21d=_21d.concat(_1d5.map(_219.infos,function(info){return info.symbol;}));break;}_21d=_1d5.filter(_21d,_1db.isDefined);var _21e=this._url.path+"/images/",_21f=this._getToken();_1d5.forEach(_21d,function(sym){var url=sym.url;if(url){if((url.search(/https?\:/)===-1)&&(url.indexOf("data:")===-1)){sym.url=_21e+url;}if(_21f&&sym.url.search(/https?\:/)!==-1){sym.url+=("?token="+_21f);}}});}}else{if(_20a){_20c=this.types;if(_20c.length>0){_219=new _1e4(this.defaultSymbol,this.typeIdField);_1d5.forEach(_20c,function(type){_219.addValue(type.id,type.symbol);});}else{_219=new _1e3(this.defaultSymbol);}this.setRenderer(_219);}else{if(!this._isTable){var _220;switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":_220=new _1df();break;case "esriGeometryPolyline":_220=new _1e0();break;case "esriGeometryPolygon":_220=new _1e1();break;}this.setRenderer(_220?new _1e3(_220):null);}}}}var _221=(_218&&_218.transparency)||0;if(!_1db.isDefined(this.opacity)&&_221>0){this.opacity=1-(_221/100);}this.version=_1fe.currentVersion;if(!this.version){var ver;if("capabilities" in _1fe||"drawingInfo" in _1fe||"hasAttachments" in _1fe||"htmlPopupType" in _1fe||"relationships" in _1fe||"timeInfo" in _1fe||"typeIdField" in _1fe||"types" in _1fe){ver=10;}else{ver=9.3;}this.version=ver;}if((has("ie")||has("safari"))&&this.isEditable()&&this.version<10.02){this._ts=true;}this.loaded=true;this._fixRendererFields();this._checkFields();this._updateCaps();var _222=function(){this.onLoad(this);var _223=this._loadCallback;if(_223){delete this._loadCallback;_223(this);}};if(this._collection){this._fireUpdateStart();var _224=this._featureSet;delete this._featureSet;this._mode._drawFeatures(new _1e8(_224));this._fcAdded=true;_222.call(this);}else{this._forceIdentity(_222);}}},setRenderer:function(ren){this.inherited("setRenderer",arguments);var _225=this.renderer;if(_225){this._ager=(_225.declaredClass.indexOf("TemporalRenderer")!==-1&&_225.observationAger&&_225.observationRenderer);var _226=[],_227=_1d5.filter([_225,_225.observationRenderer,_225.latestObservationRenderer,_225.trackRenderer],_1db.isDefined);_1d5.forEach(_227,function(rnd){if(!lang.isFunction(rnd.attributeField)){_226.push(rnd.attributeField);}_226.push(rnd.attributeField2);_226.push(rnd.attributeField3);},this);this._rendererFields=_1d5.filter(_226,_1db.isDefined);}else{this._ager=false;this._rendererFields=[];}if(this.loaded){if(this._rendererFields.length>0){this._fixRendererFields();this._checkFields(this._rendererFields);}if(this._collection){this._typesDirty=true;}}},_setMap:function(map){var div=this.inherited(arguments),mode=this._mode,self=this;if(mode){mode.initialize(map);}if(this.geometryType){this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());}this._addHandle=this.on("graphic-node-add",function(evt){var _228=evt.graphic.attributes,oid=_228&&_228[self.objectIdField],_229=self._selectedFeatures[oid];if(_229){_229.attr("data-selected","");}});return div;},_unsetMap:function(map){var mode=this._mode;if(mode){mode.suspend();}if(this._trackManager){this._trackManager.destroy();this._trackManager=null;}_1d4.disconnect(this._zoomConnect);_1d4.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(false);this.inherited("_unsetMap",arguments);},refresh:function(){var mode=this._mode;if(mode){mode.refresh();}},getOutFields:function(){return _1d5.filter(this._getOutFields(),function(_22a){return (_22a==="*"||!!this._getField(_22a));},this);},setEditable:function(_22b){if(!this._collection){return this;}if(!this.loaded){this._optEditable=_22b;return this;}var _22c=this._editable;this._editable=_22b;this._updateCaps();if(_22c!==_22b){this.onCapabilitiesChange();}return this;},getEditCapabilities:function(_22d){var _22e={"canCreate":false,"canUpdate":false,"canDelete":false};if(!this.loaded||!this.isEditable()){return _22e;}var _22f=_22d&&_22d.feature,_230=_22d&&_22d.userId,caps=_1d5.map((this.capabilities?this.capabilities.toLowerCase().split(","):[]),lang.trim),_231=_1d5.indexOf(caps,"editing")>-1,_232=_231&&(_1d5.indexOf(caps,"create")>-1),_233=_231&&(_1d5.indexOf(caps,"update")>-1),_234=_231&&(_1d5.indexOf(caps,"delete")>-1),_235=this.ownershipBasedAccessControlForFeatures,_236=this.editFieldsInfo,_237=_236&&_236.creatorField,_238=_236&&_236.realm,_239=_22f&&_22f.attributes,_23a=(_239&&_237)?_239[_237]:undefined,_23b,_23c=!!this.userIsAdmin,_23d=!_235||_23c||!!(_235.allowOthersToUpdate||_235.allowUpdateToOthers),_23e=!_235||_23c||!!(_235.allowOthersToDelete||_235.allowDeleteToOthers);if(_23c||(_231&&!(_232||_233||_234))){_232=_233=_234=true;}_23b={"canCreate":_232,"canUpdate":_233,"canDelete":_234};if(_23a===null){_23b.canUpdate=_233&&_23d;_23b.canDelete=_234&&_23e;}else{if(_23a===""){return _23b;}else{if(_23a){_230=_230||this.getUserId();if(_230&&_238){_230=_230+"@"+_238;}if(_230.toLowerCase()===_23a.toLowerCase()){return _23b;}else{_23b.canUpdate=_233&&_23d;_23b.canDelete=_234&&_23e;}}}}return _23b;},getUserId:function(){var _23f;if(this.loaded){_23f=(this.credential&&this.credential.userId)||this.userId||"";}return _23f;},setUserIsAdmin:function(_240){this.userIsAdmin=_240;},setEditSummaryCallback:function(_241){this.editSummaryCallback=_241;},getEditSummary:function(_242,_243,_244){_244=_1db.isDefined(_244)?_244:(new Date()).getTime();var _245="",info=this.getEditInfo(_242,_243,_244),_246=(_243&&_243.callback)||this.editSummaryCallback;if(_246){info=_246(_242,info)||"";}if(lang.isString(info)){_245=info;}else{if(info){var _247=info.action,_248=info.userId,_249=info.timeValue,_24a=0;if(_247){_24a++;}if(_248){_24a++;}if(_1db.isDefined(_249)){_24a++;}if(_24a>1){_245=(_247==="edit"?"edit":"create")+(_248?"User":"")+(_1db.isDefined(_249)?info.displayPattern:"");}}_245=_245&&_1db.substitute(info,this.i18n.layers.FeatureLayer[_245]);}return _245;},getEditInfo:function(_24b,_24c,_24d){if(!this.loaded){return;}_24d=_1db.isDefined(_24d)?_24d:(new Date()).getTime();var _24e=(_24c&&_24c.action)||"last",_24f=this.editFieldsInfo,_250=_24f&&_24f.creatorField,_251=_24f&&_24f.creationDateField,_252=_24f&&_24f.editorField,_253=_24f&&_24f.editDateField,_254=_24f&&_24f.realm,_255=_24b&&_24b.attributes,_256=(_255&&_250)?_255[_250]:undefined,_257=(_255&&_251)?_255[_251]:null,_258=(_255&&_252)?_255[_252]:undefined,_259=(_255&&_253)?_255[_253]:null,_25a=this._getEditData(_256,_257,_24d),_25b=this._getEditData(_258,_259,_24d),_25c;switch(_24e){case "creation":_25c=_25a;break;case "edit":_25c=_25b;break;case "last":_25c=_25b||_25a;break;}if(_25c){_25c.action=(_25c===_25b)?"edit":"creation";}return _25c;},_getEditData:function(_25d,_25e,_25f){var data,_260,_261,_262=60000,_263=3600000,_264=2*_263,_265=24*_263,_266=7*_265;if(_1db.isDefined(_25e)){_260=_25f-_25e;if(_260<0){_261="Full";}else{if(_260<_262){_261="Seconds";}else{if(_260<(2*_262)){_261="Minute";}else{if(_260<_263){_261="Minutes";}else{if(_260<_264){_261="Hour";}else{if(_260<_265){_261="Hours";}else{if(_260<_266){_261="WeekDay";}else{_261="Full";}}}}}}}}if((_25d!==undefined)||_261){data=data||{};data.userId=_25d;if(_261){var _267=_1d8.format,_268=new Date(_25e);data.minutes=Math.floor(_260/_262);data.hours=Math.floor(_260/_263);data.weekDay=_267(_268,{datePattern:"EEEE",selector:"date"});data.formattedDate=_267(_268,{selector:"date"});data.formattedTime=_267(_268,{selector:"time"});data.displayPattern=_261;data.timeValue=_25e;}}return data;},isEditable:function(){return !!(this._editable||this.userIsAdmin);},setMaxAllowableOffset:function(_269){if(!this.isEditable()){this._maxOffset=_269;}return this;},getMaxAllowableOffset:function(){return this._maxOffset;},setAutoGeneralize:function(_26a){if(!this.loaded){this._optAutoGen=_26a;}else{if(!this.isEditable()&&(this.mode!==this.constructor.MODE_SNAPSHOT)&&((this.geometryType==="esriGeometryPolyline")||(this.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_26a;if(_26a){var map=this._map;if(map&&map.loaded){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}else{delete this._maxOffset;}}}return this;},setGDBVersion:function(_26b){if(!this._collection&&(_26b!==this.gdbVersion)&&(_26b||this.gdbVersion)){this.gdbVersion=_26b;this._task.gdbVersion=_26b;this._url.query=lang.mixin(this._url.query,{gdbVersion:_26b});if(this.loaded){this.clearSelection();if(this._map){this.refresh();}}this.onGDBVersionChange();}return this;},setDefinitionExpression:function(expr){this._defnExpr=expr;var mode=this._mode;if(mode){mode.propertyChangeHandler(1);}return this;},getDefinitionExpression:function(){return this._defnExpr;},setTimeDefinition:function(_26c){if(this._isSnapshot){this._timeDefn=_26c;var mode=this._mode;if(mode){mode.propertyChangeHandler(2);}}else{}return this;},getTimeDefinition:function(){return this._timeDefn;},setTimeOffset:function(_26d,_26e){this._timeOffset=_26d;this._timeOffsetUnits=_26e;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}return this;},setUseMapTime:function(use){this.useMapTime=use;this._toggleTime(!this.suspended);var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},selectFeatures:function(_26f,_270,_271,_272){_270=_270||this.constructor.SELECTION_NEW;var _273=this._getShallowClone(_26f),map=this._map,_274,dfd=_1dd._fixDfd(new _1d7(_1dd._dfdCanceller));_273.outFields=this.getOutFields();_273.returnGeometry=true;if(map){_273.outSpatialReference=new _1de(map.spatialReference.toJson());}if(!this._applyQueryFilters(_273,true)){_274={features:[]};this._selectHandler(_274,_270,_271,_272,dfd);return dfd;}var _275=this._canDoClientSideQuery(_273);if(_275){_274={features:this._doQuery(_273,_275)};this._selectHandler(_274,_270,_271,_272,dfd);return dfd;}else{if(this._collection){var err=new Error("FeatureLayer::selectFeatures - "+this.invalidParams);this._resolve([err],null,_272,dfd,true);return dfd;}var self=this;if(this._ts){_273._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task.execute(_273);temp.addCallbacks(function(_276){self._selectHandler(_276,_270,_271,_272,dfd);},function(err){self._resolve([err],null,_272,dfd,true);});return dfd;}},getSelectedFeatures:function(){var _277=this._selectedFeatures,_278=[],item;for(item in _277){if(_277.hasOwnProperty(item)){_278.push(_277[item]);}}return _278;},clearSelection:function(_279){var _27a=this._selectedFeatures,mode=this._mode,item;for(item in _27a){if(_27a.hasOwnProperty(item)){this._unSelectFeatureIIf(item,mode);mode._removeFeatureIIf(item);}}this._selectedFeatures={};if(this._isSelOnly){mode._applyTimeFilter(true);}if(!_279){this.onSelectionClear();}return this;},setSelectionSymbol:function(_27b){this._selectionSymbol=_27b;if(_27b){var _27c=this._selectedFeatures,item;for(item in _27c){if(_27c.hasOwnProperty(item)){_27c[item].setSymbol(_27b);}}}return this;},getSelectionSymbol:function(){return this._selectionSymbol;},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(adds,_27d,_27e,_27f,_280,_281){var _282=_281.assembly,dfd=_281.dfd;this._applyNormalized(adds,_282&&_282[0]);this._applyNormalized(_27d,_282&&_282[1]);this.onBeforeApplyEdits(adds,_27d,_27e);var i,_283={},_284=this.objectIdField,_285={f:"json"},_286=false;if(this._collection){var _287={};_287.addResults=adds?_1d5.map(adds,function(){_286=true;return {objectId:this._nextId++,success:true};},this):null;_287.updateResults=_27d?_1d5.map(_27d,function(_288){_286=true;var oid=_288.attributes[_284];_283[oid]=_288;return {objectId:oid,success:true};},this):null;_287.deleteResults=_27e?_1d5.map(_27e,function(_289){_286=true;return {objectId:_289.attributes[_284],success:true};},this):null;if(_286){this._editHandler(_287,adds,_283,_27f,_280,dfd);}return;}if(adds&&adds.length>0){_285.adds=this._convertFeaturesToJson(adds,0,1);_286=true;}if(_27d&&_27d.length>0){for(i=0;i<_27d.length;i++){var _28a=_27d[i];_283[_28a.attributes[_284]]=_28a;}_285.updates=this._convertFeaturesToJson(_27d,0,0,1);_286=true;}if(_27e&&_27e.length>0){var ids=[];for(i=0;i<_27e.length;i++){ids.push(_27e[i].attributes[_284]);}_285.deletes=ids.join(",");_286=true;}if(_286){var self=this;return _1dc({url:this._url.path+"/applyEdits",content:lang.mixin(_285,this._url.query),callbackParamName:"callback",load:function(_28b){self._editHandler(_28b,adds,_283,_27f,_280,dfd);},error:function(err){self._resolve([err],null,_280,dfd,true);}},{usePost:true});}},queryFeatures:function(_28c,_28d,_28e){return this._query("execute","onQueryFeaturesComplete",_28c,_28d,_28e);},queryRelatedFeatures:function(_28f,_290,_291){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",_28f,_290,_291);},queryIds:function(_292,_293,_294){return this._query("executeForIds","onQueryIdsComplete",_292,_293,_294);},queryCount:function(_295,_296,_297){return this._query("executeForCount","onQueryCountComplete",_295,_296,_297);},queryAttachmentInfos:function(_298,_299,_29a){var url=this._url.path+"/"+_298+"/attachments",dfd=new _1d7(_1dd._dfdCanceller),self=this;dfd._pendingDfd=_1dc({url:url,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(_29b){var _29c=_29b.attachmentInfos,_29d;_1d5.forEach(_29c,function(info){_29d=ioq.objectToQuery({gdbVersion:self._url.query&&self._url.query.gdbVersion,layer:self._url.query&&self._url.query.layer,token:self._getToken()});info.url=url+"/"+info.id+(_29d?("?"+_29d):"");info.objectId=_298;});self._resolve([_29c],"onQueryAttachmentInfosComplete",_299,dfd);},error:function(err){self._resolve([err],null,_29a,dfd,true);}});return dfd;},addAttachment:function(_29e,_29f,_2a0,_2a1){return this._sendAttachment("add",_29e,_29f,_2a0,_2a1);},updateAttachment:function(_2a2,_2a3,_2a4,_2a5,_2a6){_2a4.appendChild(_1d9.create("input",{type:"hidden",name:"attachmentId",value:_2a3}));return this._sendAttachment("update",_2a2,_2a4,_2a5,_2a6);},deleteAttachments:function(_2a7,_2a8,_2a9,_2aa){var url=this._url.path+"/"+_2a7+"/deleteAttachments",dfd=new _1d7(_1dd._dfdCanceller),self=this,_2ab={f:"json",attachmentIds:_2a8.join(",")};dfd._pendingDfd=_1dc({url:url,content:lang.mixin(_2ab,this._url.query),callbackParamName:"callback",load:lang.hitch(this,function(_2ac){var _2ad=_2ac.deleteAttachmentResults;_2ad=_1d5.map(_2ad,function(_2ae){var res=new _1f1(_2ae);res.attachmentId=res.objectId;res.objectId=_2a7;return res;});self._resolve([_2ad],"onDeleteAttachmentsComplete",_2a9,dfd);}),error:function(err){self._resolve([err],null,_2aa,dfd,true);}},{usePost:true});return dfd;},addType:function(_2af){var _2b0=this.types;if(_2b0){var _2b1=_1d5.some(_2b0,function(type){if(type.id==_2af.id){return true;}return false;});if(_2b1){return false;}else{_2b0.push(_2af);}}else{this.types=[_2af];}this._typesDirty=true;return true;},deleteType:function(_2b2){if(!this._collection){return;}var _2b3=this.types;if(_2b3){var _2b4=-1;_1d5.some(_2b3,function(type,_2b5){if(type.id==_2b2){_2b4=_2b5;return true;}return false;});if(_2b4>-1){this._typesDirty=true;return _2b3.splice(_2b4,1)[0];}}},toJson:function(){var _2b6=this._json,json=lang.isString(_2b6)?_1d6.fromJson(_2b6):lang.clone(_2b6);if(!json){return;}json=json.layerDefinition?json:{layerDefinition:json};var _2b7=json.layerDefinition,_2b8=this._collection;if(_2b8&&this._typesDirty){_2b7.types=_1d5.map(this.types||[],function(type){return type.toJson();});var _2b9=this.renderer,_2ba=_2b7.drawingInfo;if(_2b9&&!_2ba){_2ba=(_2b7.drawingInfo={});}if(_2ba&&_2b9&&_2b9.declaredClass.indexOf("TemporalRenderer")===-1){_2ba.renderer=_2b9.toJson();}}var _2bb=null;if(!(_2b8&&!this._fcAdded)){_2bb={geometryType:_2b7.geometryType,features:this._convertFeaturesToJson(this.graphics,true)};}json.featureSet=lang.mixin({},json.featureSet||{},_2bb);if(_2b8){json.nextObjectId=this._nextId;_2b7.capabilities=this.capabilities;}return json;},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(_2bc){var self=this,path=this._url&&this._url.path;if((this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&path&&_1da.id&&_1da.id._hasPortalSession()&&_1da.id._doPortalSignIn(path)){_1da.id.getCredential(path).then(function(){self._findCredential();_2bc.call(self);},function(){_2bc.call(self);});}else{_2bc.call(this);}},_updateCaps:function(){var _2bd=this._editable,_2be=lang.trim(this.capabilities||""),_2bf=_1d5.map((_2be?_2be.split(","):[]),lang.trim),caps=_1d5.map((_2be?_2be.toLowerCase().split(","):[]),lang.trim),_2c0=_1d5.indexOf(caps,"editing"),cap,i,_2c1,_2c2={"Create":_1d5.indexOf(caps,"create"),"Update":_1d5.indexOf(caps,"update"),"Delete":_1d5.indexOf(caps,"delete")};if(_2bd&&_2c0===-1){_2bf.push("Editing");}else{if(!_2bd&&_2c0>-1){_2c1=[_2c0];for(cap in _2c2){if(_2c2[cap]>-1){_2c1.push(_2c2[cap]);}}_2c1.sort();for(i=_2c1.length-1;i>=0;i--){_2bf.splice(_2c1[i],1);}}}this.capabilities=_2bf.join(",");},_counter:{value:0},_getUniqueId:function(){return this._counter.value++;},onSuspend:function(){this.inherited(arguments);this._toggleTime(false);var mode=this._mode;if(mode){mode.suspend();}},onResume:function(evt){this.inherited(arguments);this._toggleTime(true);this._updateMaxOffset();var mode=this._mode,map=this._map,_2c3=this.renderer;if(evt.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo){if(this._trackIdField||(_2c3&&(_2c3.latestObservationRenderer||_2c3.trackRenderer))){this._trackManager=new _1f6(this);this._trackManager.initialize(map);}}this._zoomConnect=_1d4.connect(map,"onZoomEnd",this,this._updateMaxOffset);}if(mode){evt.firstOccurrence?mode.startup():mode.resume();}},_updateMaxOffset:function(){var map=this._map;if(map&&map.loaded){if(this._autoGeneralize){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}},_toggleTime:function(_2c4){var map=this._map;if(_2c4&&this.timeInfo&&this.useMapTime&&map){this._mapTimeExtent=map.timeExtent;if(!this._timeConnect){this._timeConnect=_1d4.connect(map,"onTimeExtentChange",this,this._timeChangeHandler);}}else{this._mapTimeExtent=null;_1d4.disconnect(this._timeConnect);this._timeConnect=null;}},_timeChangeHandler:function(_2c5){this._mapTimeExtent=_2c5;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},_getOffsettedTE:function(_2c6){var _2c7=this._timeOffset,_2c8=this._timeOffsetUnits;return (_2c6&&_2c7&&_2c8)?_2c6.offset(-1*_2c7,_2c8):_2c6;},_getTimeOverlap:function(_2c9,_2ca){if(_2c9&&_2ca){return _2c9.intersection(_2ca);}else{return _2c9||_2ca;}},_getTimeFilter:function(_2cb){var _2cc=this.getTimeDefinition(),_2cd=null,_2ce;if(_2cc||_2cd){_2ce=this._getTimeOverlap(_2cc,_2cd);if(!_2ce){return [false];}}if(_2cb){_2cb=_2ce?this._getTimeOverlap(_2cb,_2ce):_2cb;if(!_2cb){return [false];}}else{_2cb=_2ce;}return [true,_2cb];},_getAttributeFilter:function(_2cf){var _2d0=this.getDefinitionExpression();if(_2cf){_2cf=_2d0?"("+_2d0+") AND ("+_2cf+")":_2cf;}else{_2cf=_2d0;}return _2cf;},_applyQueryFilters:function(_2d1,_2d2){_2d1.where=this._getAttributeFilter(_2d1.where);_2d1.maxAllowableOffset=this._maxOffset;if(_2d2&&this.supportsAdvancedQueries){_2d1.orderByFields=_2d1.orderByFields||this.orderByFields;}if(this.timeInfo){var _2d3=this._getTimeFilter(_2d1.timeExtent);if(!_2d3[0]){return false;}else{_2d1.timeExtent=_2d3[1];}}return true;},_add:function(_2d4){var _2d5=this._selectionSymbol,attr=_2d4.attributes,_2d6=this.visibilityField;if(_2d5&&this._isSelOnly){_2d4.setSymbol(_2d5);}if(_2d6&&attr&&attr.hasOwnProperty(_2d6)){_2d4[attr[_2d6]?"show":"hide"]();}return this.add.apply(this,arguments);},_remove:function(){return this.remove.apply(this,arguments);},_canDoClientSideQuery:function(_2d7){var _2d8=[],map=this._map;if(this._isTable||!map){return;}if(_2d7.text||(_2d7.where&&_2d7.where!==this.getDefinitionExpression())||(_2d7.orderByFields&&_2d7.orderByFields.length)){return;}var _2d9=this._isSnapshot,_2da=this._isSelOnly;var _2db=_2d7.geometry;if(_2db){if(!_2da&&_2d7.spatialRelationship===_1e7.SPATIAL_REL_INTERSECTS&&(_2db.type==="extent"&&(_2d9||map.extent.contains(_2db)))){_2d8.push(1);}else{return;}}var ids=_2d7.objectIds;if(ids){if(_2d9){_2d8.push(2);}else{var len=ids.length,mode=this._mode,_2dc=0,i;for(i=0;i<len;i++){if(mode._getFeature(ids[i])){_2dc++;}}if(_2dc===len){_2d8.push(2);}else{return;}}}if(this.timeInfo){var _2dd=_2d7.timeExtent,_2de=this._mapTimeExtent;if(_2d9){if(_2dd){_2d8.push(3);}}else{if(_2da){if(_2dd){return;}}else{if(_2de){if(_1d5.indexOf(_2d8,2)!==-1){if(_2dd){_2d8.push(3);}}else{return;}}else{if(_2d8.length>0){if(_2dd){_2d8.push(3);}}else{if(_2dd){return;}}}}}}return _2d8.length>0?_2d8:null;},_doQuery:function(_2df,_2e0,_2e1){var _2e2=[],mode=this._mode,_2e3=this.objectIdField,i,len,_2e4;if(_1d5.indexOf(_2e0,2)!==-1){_2e2=[];var ids=_2df.objectIds;len=ids.length;for(i=0;i<len;i++){var obj=mode._getFeature(ids[i]);if(obj){_2e2.push(obj);}}if(_2e2.length===0){return [];}}if(_1d5.indexOf(_2e0,1)!==-1){_2e4=_2e2.length>0?_2e2:this.graphics;len=_2e4.length;var _2e5=_2df.geometry._normalize(null,true);_2e2=[];for(i=0;i<len;i++){var _2e6=_2e4[i],_2e7=_2e6.geometry;if(_2e7){if(this.normalization&&_2e5.length){if(_2e5[0].intersects(_2e7)||_2e5[1].intersects(_2e7)){_2e2.push(_2e6);}}else{if(_2e5.intersects(_2e7)){_2e2.push(_2e6);}}}}if(_2e2.length===0){return [];}}if(_1d5.indexOf(_2e0,3)!==-1){if(this.timeInfo){_2e4=_2e2.length>0?_2e2:this.graphics;var time=_2df.timeExtent,_2e8=this._filterByTime(_2e4,time.startTime,time.endTime);_2e2=_2e8.match;}}if(_2e1){return _1d5.map(_2e2,function(obj){return obj.attributes[_2e3];},this);}else{return _2e2;}},_filterByTime:function(_2e9,_2ea,_2eb){var _2ec=this._startTimeField,_2ed=this._endTimeField,_2ee;if(!this._twoTimeFields){_2ee=_2ec||_2ed;}var _2ef=_1db.isDefined,yea=[],nay=[],i,len=_2e9.length,_2f0,_2f1;_2ea=_2ea?_2ea.getTime():-Infinity;_2eb=_2eb?_2eb.getTime():Infinity;if(_2ee){for(i=0;i<len;i++){_2f0=_2e9[i];_2f1=_2f0.attributes;var time=_2f1[_2ee];if(time>=_2ea&&time<=_2eb){yea.push(_2f0);}else{nay.push(_2f0);}}}else{for(i=0;i<len;i++){_2f0=_2e9[i];_2f1=_2f0.attributes;var _2f2=_2f1[_2ec],end=_2f1[_2ed];_2f2=_2ef(_2f2)?_2f2:-Infinity;end=_2ef(end)?end:Infinity;if((_2f2>=_2ea&&_2f2<=_2eb)||(end>=_2ea&&end<=_2eb)||(_2ea>=_2f2&&_2eb<=end)){yea.push(_2f0);}else{nay.push(_2f0);}}}return {match:yea,noMatch:nay};},_resolve:function(args,_2f3,_2f4,dfd,_2f5){if(_2f3){this[_2f3].apply(this,args);}if(_2f4){_2f4.apply(null,args);}if(dfd){_1dd._resDfd(dfd,args,_2f5);}},_getShallowClone:function(_2f6){var _2f7=new _1e7(),prop;for(prop in _2f6){if(_2f6.hasOwnProperty(prop)){_2f7[prop]=_2f6[prop];}}return _2f7;},_query:function(type,_2f8,_2f9,_2fa,_2fb){var that=this,map=this._map,dfd=new _1d7(_1dd._dfdCanceller),_2fc=_2f9;var _2fd=function(_2fe,_2ff){if(!_2ff&&type==="execute"&&!that._isTable){var _300=_2fe.features,mode=that._mode,_301=that.objectIdField,il=_300.length,i;for(i=il-1;i>=0;i--){var oid=_300[i].attributes[_301];var _302=mode._getFeature(oid);if(_302){_300.splice(i,1,_302);}}}that._resolve([_2fe],_2f8,_2fa,dfd);};if(type!=="executeRelationshipQuery"){_2fc=this._getShallowClone(_2f9);_2fc.outFields=this.getOutFields();_2fc.returnGeometry=_2f9.hasOwnProperty("returnGeometry")?_2f9.returnGeometry:true;var _303;if(map){_2fc.outSpatialReference=new _1de(map.spatialReference.toJson());}if(!this._applyQueryFilters(_2fc,type==="execute")){switch(type){case "execute":_303=new _1e8({features:[]});break;case "executeForIds":_303=[];break;case "executeForCount":_303=0;break;}_2fd(_303,true);return dfd;}var _304=this._canDoClientSideQuery(_2fc);if(_304){var _305=this._doQuery(_2fc,_304,(type==="executeForIds"||type==="executeForCount"));switch(type){case "execute":_303=new _1e8();_303.features=_305;break;case "executeForIds":_303=_305;break;case "executeForCount":_303=_305.length;break;}_2fd(_303,true);return dfd;}}if(this._collection){var err=new Error("FeatureLayer::_query - "+this.invalidParams);this._resolve([err],null,_2fb,dfd,true);return dfd;}if(this._ts){_2fc._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task[type](_2fc);temp.addCallbacks(_2fd,function(err){that._resolve([err],null,_2fb,dfd,true);});return dfd;},_convertFeaturesToJson:function(_306,_307,_308,_309){var json=[],_30a=this._selectionSymbol,_30b=this.visibilityField,i,_30c,_30d=this.objectIdField;if(this.loaded&&(_308||_309)){_30c=_1d5.filter(this.fields,function(_30e){return (_30e.editable===false)&&(!_309||(_30e.name!==_30d));});}for(i=0;i<_306.length;i++){var _30f=_306[i],_310={},_311=_30f.geometry,attr=_30f.attributes,_312=_30f.symbol;if(_311&&(!_309||!this.loaded||this.allowGeometryUpdates)){_310.geometry=_311.toJson();}if(_30b){_310.attributes=attr=lang.mixin({},attr);attr[_30b]=_30f.visible?1:0;}else{if(attr){_310.attributes=lang.mixin({},attr);}}if(_310.attributes&&_30c&&_30c.length){_1d5.forEach(_30c,function(_313){delete _310.attributes[_313.name];});}if(_312&&(_312!==_30a)){_310.symbol=_312.toJson();}json.push(_310);}return _307?json:_1d6.toJson(json);},_selectHandler:function(_314,_315,_316,_317,dfd){var _318,ctor=this.constructor;switch(_315){case ctor.SELECTION_NEW:this.clearSelection(true);_318=true;break;case ctor.SELECTION_ADD:_318=true;break;case ctor.SELECTION_SUBTRACT:_318=false;break;}var i,_319=_314.features,mode=this._mode,_31a=[],_31b=this.objectIdField,_31c,oid;if(_318){for(i=0;i<_319.length;i++){_31c=_319[i];oid=_31c.attributes[_31b];var _31d=mode._addFeatureIIf(oid,_31c);_31a.push(_31d);this._selectFeatureIIf(oid,_31d,mode);}}else{for(i=0;i<_319.length;i++){_31c=_319[i];oid=_31c.attributes[_31b];this._unSelectFeatureIIf(oid,mode);var _31e=mode._removeFeatureIIf(oid);_31a.push(_31e||_31c);}}if(this._isSelOnly){mode._applyTimeFilter(true);}this._resolve([_31a,_315,_314.exceededTransferLimit?{queryLimitExceeded:true}:null],"onSelectionComplete",_316,dfd);if(_314.exceededTransferLimit){this.onQueryLimitExceeded();}},_selectFeatureIIf:function(oid,_31f,mode){var _320=this._selectedFeatures,_321=_320[oid];if(!_321){mode._incRefCount(oid);_320[oid]=_31f;if(!this._isTable){this._setSelectSymbol(_31f);_31f.attr("data-selected","");}}return _321||_31f;},_unSelectFeatureIIf:function(oid,mode){var _322=this._selectedFeatures[oid];if(_322){mode._decRefCount(oid);delete this._selectedFeatures[oid];if(!this._isTable){this._setUnSelectSymbol(_322);_322.attr("data-selected");}}return _322;},_isSelected:function(_323){},_setSelectSymbol:function(_324){var _325=this._selectionSymbol;if(_325&&!this._isSelOnly){_324.setSymbol(_325);}},_setUnSelectSymbol:function(_326){var _327=this._selectionSymbol;if(_327&&!this._isSelOnly){if(_327===_326.symbol){_326.setSymbol(null,true);}}},_getOutFields:function(){var _328=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes);_328=_1d5.filter(_328,function(_329,_32a,arr){return !!_329&&(_1d5.indexOf(arr,_329)===_32a);});var _32b=lang.clone(this._outFields);if(_32b){if(_1d5.indexOf(_32b,"*")!==-1){return _32b;}_1d5.forEach(_328,function(_32c){if(_1d5.indexOf(_32b,_32c)===-1){_32b.push(_32c);}});return _32b;}else{return _328;}},_checkFields:function(_32d){var _32e=_32d||this._getOutFields();_1d5.forEach(_32e,function(_32f){if(_32f==="*"){return;}if(!this._getField(_32f)){}},this);if(!_32d&&!this._isTable&&!this._fserver&&!this._collection){var _330=_1d5.some(this.fields,function(_331){return (_331&&_331.type==="esriFieldTypeGeometry")?true:false;});if(!_330){}}},_fixRendererFields:function(){var _332=this.renderer;if(_332&&this.fields.length>0){var _333=[],_334,_335,_336=_1d5.filter([_332,_332.observationRenderer,_332.latestObservationRenderer,_332.trackRenderer],_1db.isDefined),_337=[].concat(_336);_1d5.forEach(_336,function(L1){_1d5.forEach(L1.rendererInfos,function(info){if(info.renderer){_337.push(info.renderer);}});});_1d5.forEach(_337,function(rnd){_335=rnd.attributeField;if(_335&&!lang.isFunction(_335)){_334=!this._getField(_335)&&this._getField(_335,true);if(_334){rnd.attributeField=_334.name;}}_335=rnd.attributeField2;if(_335){_334=!this._getField(_335)&&this._getField(_335,true);if(_334){rnd.attributeField2=_334.name;}}_335=rnd.attributeField3;if(_335){_334=!this._getField(_335)&&this._getField(_335,true);if(_334){rnd.attributeField3=_334.name;}}if(!lang.isFunction(rnd.attributeField)){_333.push(rnd.attributeField);}_333.push(rnd.attributeField2);_333.push(rnd.attributeField3);_335=rnd.rotationInfo&&rnd.rotationInfo.field;if(_335&&!lang.isFunction(_335)){_334=!this._getField(_335)&&this._getField(_335,true);if(_334){_335=rnd.rotationInfo.field=_334.name;}_333.push(_335);}if(rnd.proportionalSymbolInfo){_335=rnd.proportionalSymbolInfo.field;if(_335&&!lang.isFunction(_335)){_334=!this._getField(_335)&&this._getField(_335,true);if(_334){_335=rnd.proportionalSymbolInfo.field=_334.name;}_333.push(_335);}_335=rnd.proportionalSymbolInfo.normalizationField;if(_335&&!lang.isFunction(_335)){_334=!this._getField(_335)&&this._getField(_335,true);if(_334){_335=rnd.proportionalSymbolInfo.normalizationField=_334.name;}_333.push(_335);}}},this);this._rendererFields=_1d5.filter(_333,_1db.isDefined);}},_getField:function(_338,_339){var _33a=this.fields;if(!_33a||_33a.length===0){return null;}var _33b;if(_339){_338=_338.toLowerCase();}_1d5.some(_33a,function(_33c){var _33d=false;if(_339){_33d=(_33c&&_33c.name.toLowerCase()===_338)?true:false;}else{_33d=(_33c&&_33c.name===_338)?true:false;}if(_33d){_33b=_33c;}return _33d;});return _33b;},_getDateOpts:function(){if(!this._dtOpts){var _33e=_1d5.map(_1d5.filter(this.fields,function(_33f){return !!(_33f&&_33f.type==="esriFieldTypeDate");}),function(_340){return _340.name;});this._dtOpts={properties:_33e};}return this._dtOpts;},_applyNormalized:function(_341,_342){if(_341&&_342){_1d5.forEach(_341,function(_343,_344){if(_343&&_342[_344]){_343.setGeometry(_342[_344]);}});}},_editHandler:function(_345,adds,_346,_347,_348,dfd){var _349=_345.addResults,_34a=_345.updateResults,_34b=_345.deleteResults,i,_34c,oid,_34d,attr,_34e=this.objectIdField,mode=this._mode,_34f=this._isTable;var _350=this.editFieldsInfo,_351=this.getOutFields()||[],_352=_350&&_350.creatorField,_353=_350&&_350.creationDateField,_354=_350&&_350.editorField,_355=_350&&_350.editDateField,_356=_350&&_350.realm;if(_1d5.indexOf(_351,"*")===-1){if(_352&&_1d5.indexOf(_351,_352)===-1){_352=null;}if(_353&&_1d5.indexOf(_351,_353)===-1){_353=null;}if(_354&&_1d5.indexOf(_351,_354)===-1){_354=null;}if(_355&&_1d5.indexOf(_351,_355)===-1){_355=null;}}var _357=(_353||_355)?(new Date()).getTime():null,_358=(_352||_354)?this.getUserId():undefined;if(_358&&_356){_358=_358+"@"+_356;}if(_349){for(i=0;i<_349.length;i++){_349[i]=new _1f1(_349[i]);if(_34f){continue;}_34c=_349[i];if(_34c.success){oid=_34c.objectId;_34d=adds[i];var gl=_34d._graphicsLayer;if(gl&&gl!==this){gl.remove(_34d);}attr=_34d.attributes||{};attr[_34e]=oid;if(_352){attr[_352]=_358;}if(_354){attr[_354]=_358;}if(_353){attr[_353]=_357;}if(_355){attr[_355]=_357;}_34d.setAttributes(attr);if(mode._init){mode.drawFeature(_34d);}}}}if(_34a){for(i=0;i<_34a.length;i++){_34a[i]=new _1f1(_34a[i]);if(_34f){continue;}_34c=_34a[i];if(_34c.success){oid=_34c.objectId;_34d=_346[oid];var _359=mode._getFeature(oid);if(_359){if(_359.geometry!==_34d.geometry){_359.setGeometry(_1ea.fromJson(_34d.geometry.toJson()));}this._repaint(_359,oid);}_34d=_359||_34d;attr=_34d.attributes||{};if(_354){attr[_354]=_358;}if(_355){attr[_355]=_357;}_34d.setAttributes(attr);}}}if(_34b){var _35a=[];for(i=0;i<_34b.length;i++){_34b[i]=new _1f1(_34b[i]);if(_34f){continue;}_34c=_34b[i];if(_34c.success){oid=_34c.objectId;_34d=mode._getFeature(oid);if(_34d){if(this._unSelectFeatureIIf(oid,mode)){_35a.push(_34d);}_34d._count=0;mode._removeFeatureIIf(oid);}}}if(_35a.length>0){this.onSelectionComplete(_35a,this.constructor.SELECTION_SUBTRACT);}}this._resolve([_349,_34a,_34b],"onEditsComplete",_347,dfd);},_sendAttachment:function(type,_35b,_35c,_35d,_35e){var _35f=(type==="add")?"addAttachment":"updateAttachment",url=this._url.path+"/"+_35b+"/"+_35f,self=this;var dfd=_1dc({url:url,form:_35c,content:lang.mixin(this._url.query,{f:"json",token:this._getToken()||undefined}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(_360){var _361=(type==="add")?"addAttachmentResult":"updateAttachmentResult",_362=(type==="add")?"onAddAttachmentComplete":"onUpdateAttachmentComplete",_363=new _1f1(_360[_361]);_363.attachmentId=_363.objectId;_363.objectId=_35b;self._resolve([_363],_362,_35d);return _363;}).addErrback(function(_364){self._resolve([_364],null,_35e,null,true);});return dfd;},_repaint:function(_365,oid,_366){oid=_1db.isDefined(oid)?oid:_365.attributes[this.objectIdField];if(!(oid in this._selectedFeatures)||!this._selectionSymbol){_365.setSymbol(_365.symbol,_366);}},_getKind:function(_367){var _368=this._trackManager;if(_368){return _368.isLatestObservation(_367)?1:0;}return 0;}});lang.mixin(_1f7,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});_1eb._createWrappers(_1f7);if(has("extend-esri")){lang.setObject("layers.FeatureLayer",_1f7,_1da);}return _1f7;});},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(dojo,_369,_36a){dojo.DeferredList=function(list,_36b,_36c,_36d,_36e){var _36f=[];_369.call(this);var self=this;if(list.length===0&&!_36b){this.resolve([0,[]]);}var _370=0;_36a.forEach(list,function(item,i){item.then(function(_371){if(_36b){self.resolve([i,_371]);}else{_372(true,_371);}},function(_373){if(_36c){self.reject(_373);}else{_372(false,_373);}if(_36d){return null;}throw _373;});function _372(_374,_375){_36f[i]=[_374,_375];_370++;if(_370===list.length){self.resolve(_36f);}};});};dojo.DeferredList.prototype=new _369();dojo.DeferredList.prototype.gatherResults=function(_376){var d=new dojo.DeferredList(_376,false,true,false);d.addCallback(function(_377){var ret=[];_36a.forEach(_377,function(_378){ret.push(_378[1]);});return ret;});return d;};return dojo.DeferredList;});},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(_379,lang,has,_37a,_37b){var _37c=_379(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(json){lang.mixin(this,json);if(_37b.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLFolder",_37c,_37a);}return _37c;});},"esri/layers/WMSLayer":function(){define(["require","dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/request","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/DynamicMapServiceLayer","esri/layers/WMSLayerInfo","dojo/query"],function(_37d,_37e,_37f,lang,_380,has,_381,_382,_383,_384,_385,_386,_387){var _388=_37f([_386],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(url,_389){url=this._stripParameters(url,["version","service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);this.url=url;this._url=_383.urlToObject(url);this._getCapabilitiesURL=url;this._initLayer=lang.hitch(this,this._initLayer);this._parseCapabilities=lang.hitch(this,this._parseCapabilities);this._getCapabilitiesError=lang.hitch(this,this._getCapabilitiesError);if(_389){this.imageFormat=this._getImageFormat(_389.format);this.imageTransparency=(_389.transparent===false)?false:true;this.visibleLayers=_389.visibleLayers?_389.visibleLayers:[];if(_389.resourceInfo){this._readResourceInfo(_389.resourceInfo);}else{this._getCapabilities();}}else{this.imageFormat="image/png";this.imageTransparency=true;this.visibleLayers=[];this._getCapabilities();}this._blankImageURL=_37d.toUrl("esri/layers")+"/../images/pixel.png";},setVisibleLayers:function(_38a){_38a=this._checkVisibleLayersList(_38a);this.visibleLayers=_38a?_38a:[];this.refresh(true);},setImageFormat:function(_38b){this.imageFormat=this._getImageFormat(_38b);this.refresh(true);},setImageTransparency:function(_38c){this.imageTransparency=_38c;this.refresh(true);},getImageUrl:function(_38d,_38e,_38f,_390){if(!this.visibleLayers||this.visibleLayers.length===0){_390(this._blankImageURL);return;}var wkid=_38d.spatialReference.wkid;if(_380.some(this._WEB_MERCATOR,function(el){return el==wkid;})){var _391=_380.filter(this.spatialReferences,function(el){return (_380.some(this._WEB_MERCATOR,function(el2){return el2==el;}));},this);if(_391.length==0){_391=_380.filter(this.spatialReferences,function(el){return (_380.some(this._WORLD_MERCATOR,function(el2){return el2==el;}));},this);}if(_391.length>0){wkid=_391[0];}else{wkid=this._WEB_MERCATOR[0];}}var list=_380.filter(this.spatialReferences,function(el){return el!==wkid;});this.spatialReferences=list;this.spatialReferences.unshift(wkid);var xmin=_38d.xmin;var xmax=_38d.xmax;var ymin=_38d.ymin;var ymax=_38d.ymax;var _392={};_392.SERVICE="WMS";_392.REQUEST="GetMap";_392.FORMAT=this.imageFormat;_392.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";_392.STYLES="";_392.VERSION=this.version;_392.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;_392.WIDTH=_38e;_392.HEIGHT=_38f;if(this.maxWidth<_38e){_392.WIDTH=this.maxWidth;}if(this.maxHeight<_38f){_392.HEIGHT=this.maxHeight;}var _393=wkid?wkid:NaN;if(!isNaN(_393)){if(this.version=="1.3.0"){_392.CRS="EPSG:"+_393;}else{_392.SRS="EPSG:"+_393;}}if(this.version=="1.3.0"&&this._useLatLong(_393)){_392.BBOX=ymin+","+xmin+","+ymax+","+xmax;}else{_392.BBOX=xmin+","+ymin+","+xmax+","+ymax;}var _394=this.getMapURL,key;_394+=(_394.indexOf("?")==-1)?"?":"";for(key in _392){_394+=(_394.substring(_394.length-1,_394.length)=="?")?"":"&";_394+=key+"="+_392[key];}_390(_383.addProxy(_394));},_initLayer:function(_395,io){this.spatialReference=new _384(this.extent.spatialReference);this.initialExtent=new _385(this.extent);this.fullExtent=new _385(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=true;this.onLoad(this);var _396=this._loadCallback;if(_396){delete this._loadCallback;_396(this);}},_readResourceInfo:function(_397){if(!_397.extent){return;}if(!_397.layerInfos){return;}this.extent=_397.extent;this.allExtents[0]=_397.extent;this.layerInfos=_397.layerInfos;this.description=_397.description?_397.description:"";this.copyright=_397.copyright?_397.copyright:"";this.title=_397.title?_397.title:"";this.getMapURL=_397.getMapURL?_397.getMapURL:this._getCapabilitiesURL;this.version=_397.version?_397.version:"1.3.0";this.maxWidth=_397.maxWidth?_397.maxWidth:5000;this.maxHeight=_397.maxHeight?_397.maxHeight:5000;this.spatialReferences=_397.spatialReferences?_397.spatialReferences:[];this.imageFormat=this._getImageFormat(_397.format);this.setScaleRange(_397.minScale,_397.maxScale);this._initLayer();},_getCapabilities:function(){var _398=this._url.query?this._url.query:{};_398.SERVICE="WMS";_398.REQUEST="GetCapabilities";var uri=this._url.path+"?",key;for(key in _398){uri+=(uri.substring(uri.length-1,uri.length)=="?")?"":"&";uri+=key+"="+_398[key];}var _399=_382({url:uri,handleAs:"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:false});},_parseCapabilities:function(xml){if(!xml){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)");return;}this.version=this._getAttributeValue("WMS_Capabilities","version",xml,null);if(!this.version){this.version=this._getAttributeValue("WMT_MS_Capabilities","version",xml,"1.3.0");}var _39a=this._getTag("Service",xml);this.title=this._getTagValue("Title",_39a,"");if(!this.title||this.title.length==0){this.title=this._getTagValue("Name",_39a,"");}this.copyright=this._getTagValue("AccessConstraints",_39a,"");this.description=this._getTagValue("Abstract",_39a,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",_39a,5000),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",_39a,5000),10);var _39b=this._getTag("Layer",xml);if(!_39b){this._getCapabilitiesError({"error":{"message":"Response does not contain any layers."}});return;}var _39c=this._getLayerInfo(_39b);var _39d=0;var _39e=null;var _39f=this._getTag("Capability",xml);_380.forEach(_39f.childNodes,function(_3a0){if(_3a0.nodeName=="Layer"){if(_39d===0){_39e=_3a0;}else{if(_39d===1){if(_39c.name){_39c.name="";_39c.subLayers=[];_39c.subLayers.push(this._getLayerInfo(_39e));}_39c.subLayers.push(this._getLayerInfo(_3a0));}else{_39c.subLayers.push(this._getLayerInfo(_3a0));}}_39d++;}},this);if(_39c){this.layerInfos=_39c.subLayers;if(!this.layerInfos||this.layerInfos.length==0){this.layerInfos=[_39c];}this.extent=_39c.extent;this.allExtents=_39c.allExtents;this.spatialReferences=_39c.spatialReferences;if(this.spatialReferences.length==0&&this.layerInfos.length>0){this.spatialReferences=this.layerInfos[0].spatialReferences;}}this.getMapURL=this._getCapabilitiesURL;var _3a1=_37e.query("DCPType",this._getTag("GetMap",xml));if(_3a1&&_3a1.length>0){var _3a2=_37e.query("HTTP",_3a1[0]);if(_3a2&&_3a2.length>0){var _3a3=_37e.query("Get",_3a2[0]);if(_3a3&&_3a3.length>0){var _3a4=this._getAttributeValue("OnlineResource","xlink:href",_3a3[0],null);if(_3a4){if(_3a4.indexOf("&")==(_3a4.length-1)){_3a4=_3a4.substring(0,_3a4.length-1);}this.getMapURL=_3a4;}}}}this.getMapFormats=[];if(_37e.query("Operation",xml).length==0){_380.forEach(_37e.query("Format",this._getTag("GetMap",xml)),function(_3a5){this.getMapFormats.push(_3a5.text?_3a5.text:_3a5.textContent);},this);}else{_380.forEach(_37e.query("Operation",xml),function(_3a6){if(_3a6.getAttribute("name")=="GetMap"){_380.forEach(_37e.query("Format",_3a6),function(_3a7){this.getMapFormats.push(_3a7.text?_3a7.text:_3a7.textContent);},this);}},this);}if(!_380.some(this.getMapFormats,function(el){return el.indexOf(this.imageFormat)>-1;},this)){this.imageFormat=this.getMapFormats[0];}this._initLayer();},_getCapabilitiesError:function(_3a8,io){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",_3a8);},_getLayerInfo:function(_3a9){if(!_3a9){return null;}var _3aa=new _387();_3aa.name="";_3aa.title="";_3aa.description="";_3aa.allExtents=[];_3aa.spatialReferences=[];_3aa.subLayers=[];var _3ab=this._getTag("LatLonBoundingBox",_3a9);if(_3ab){_3aa.allExtents[0]=this._getExtent(_3ab,4326);}var _3ac=this._getTag("EX_GeographicBoundingBox",_3a9);if(_3ac){var _3ad=new _385(0,0,0,0,new _384({wkid:4326}));_3ad.xmin=parseFloat(this._getTagValue("westBoundLongitude",_3ac,0));_3ad.ymin=parseFloat(this._getTagValue("southBoundLatitude",_3ac,0));_3ad.xmax=parseFloat(this._getTagValue("eastBoundLongitude",_3ac,0));_3ad.ymax=parseFloat(this._getTagValue("northBoundLatitude",_3ac,0));_3aa.allExtents[0]=_3ad;}_3aa.extent=_3aa.allExtents[0];var _3ae=(_380.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)>-1)?"SRS":"CRS";_380.forEach(_3a9.childNodes,function(_3af){if(_3af.nodeName=="Name"){_3aa.name=(_3af.text?_3af.text:_3af.textContent)||"";}else{if(_3af.nodeName=="Title"){_3aa.title=(_3af.text?_3af.text:_3af.textContent)||"";}else{if(_3af.nodeName=="Abstract"){_3aa.description=(_3af.text?_3af.text:_3af.textContent)||"";}else{if(_3af.nodeName=="BoundingBox"){var _3b0=_3af.getAttribute(_3ae),wkid;if(_3b0&&_3b0.indexOf("EPSG:")===0){wkid=parseInt(_3b0.substring(5),10);if(wkid!==0&&!isNaN(wkid)){var _3b1;if(this.version=="1.3.0"){_3b1=this._getExtent(_3af,wkid,this._useLatLong(wkid));}else{_3b1=this._getExtent(_3af,wkid);}_3aa.allExtents[wkid]=_3b1;if(!_3aa.extent){_3aa.extent=_3b1;}}}else{if(_3b0&&_3b0.indexOf("CRS:")===0){wkid=parseInt(_3b0.substring(4),10);if(wkid!==0&&!isNaN(wkid)){if(this._CRS_TO_EPSG[wkid]){wkid=this._CRS_TO_EPSG[wkid];}_3aa.allExtents[wkid]=this._getExtent(_3af,wkid);}}else{wkid=parseInt(_3b0,10);if(wkid!==0&&!isNaN(wkid)){_3aa.allExtents[wkid]=this._getExtent(_3af,wkid);}}}}else{if(_3af.nodeName==_3ae){var _3b2=_3af.text?_3af.text:_3af.textContent;var arr=_3b2.split(" ");_380.forEach(arr,function(val){if(val.indexOf(":")>-1){val=parseInt(val.split(":")[1],10);}else{val=parseInt(val,10);}if(val!==0&&!isNaN(val)){if(this._CRS_TO_EPSG[val]){val=this._CRS_TO_EPSG[val];}if(_380.indexOf(_3aa.spatialReferences,val)==-1){_3aa.spatialReferences.push(val);}}},this);}else{if(_3af.nodeName=="Style"){var _3b3=this._getTag("LegendURL",_3af);if(_3b3){var _3b4=this._getTag("OnlineResource",_3b3);if(_3b4){_3aa.legendURL=_3b4.getAttribute("xlink:href");}}}else{if(_3af.nodeName==="Layer"){_3aa.subLayers.push(this._getLayerInfo(_3af));}}}}}}}},this);_3aa.title=_3aa.title||_3aa.name;return _3aa;},_getImageFormat:function(_3b5){var _3b6=_3b5?_3b5.toLowerCase():"";switch(_3b6){case "jpg":return "image/jpeg";case "bmp":return "image/bmp";case "gif":return "image/gif";case "svg":return "image/svg+xml";default:return "image/png";}},getImageFormat:function(){var _3b7=this.imageFormat?this.imageFormat.toLowerCase():"";switch(_3b7){case "image/jpeg":return "jpg";case "image/bmp":return "bmp";case "image/gif":return "gif";case "image/svg+xml":return "svg";default:return "png";}},_getExtent:function(_3b8,wkid,_3b9){var _3ba;if(_3b8){_3ba=new _385();var minx=parseFloat(_3b8.getAttribute("minx"));var miny=parseFloat(_3b8.getAttribute("miny"));var maxx=parseFloat(_3b8.getAttribute("maxx"));var maxy=parseFloat(_3b8.getAttribute("maxy"));if(_3b9){_3ba.xmin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_3ba.ymin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_3ba.xmax=isNaN(maxy)?Number.MAX_VALUE:maxy;_3ba.ymax=isNaN(maxx)?Number.MAX_VALUE:maxx;}else{_3ba.xmin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_3ba.ymin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_3ba.xmax=isNaN(maxx)?Number.MAX_VALUE:maxx;_3ba.ymax=isNaN(maxy)?Number.MAX_VALUE:maxy;}_3ba.spatialReference=new _384({wkid:wkid});}return _3ba;},_useLatLong:function(wkid){var _3bb,i;for(i=0;i<this._REVERSED_LAT_LONG_RANGES.length;i++){var _3bc=this._REVERSED_LAT_LONG_RANGES[i];if(wkid>=_3bc[0]&&wkid<=_3bc[1]){_3bb=true;break;}}return _3bb;},_getTag:function(_3bd,xml){var tags=_37e.query(_3bd,xml);if(tags&&tags.length>0){return tags[0];}else{return null;}},_getTagValue:function(_3be,xml,_3bf){var _3c0=_37e.query(_3be,xml);if(_3c0&&_3c0.length>0){if(_3c0[0].text){return _3c0[0].text;}else{return _3c0[0].textContent;}}else{return _3bf;}},_getAttributeValue:function(_3c1,_3c2,xml,_3c3){var _3c4=_37e.query(_3c1,xml);if(_3c4&&_3c4.length>0){return _3c4[0].getAttribute(_3c2);}else{return _3c3;}},_checkVisibleLayersList:function(_3c5){if(_3c5&&_3c5.length>0&&this.layerInfos&&this.layerInfos.length>0){if((typeof _3c5[0])=="number"){var list=[];_380.forEach(_3c5,function(pos){if(pos<this.layerInfos.length){list.push(this.layerInfos[pos].name);}},this);_3c5=list;}}return _3c5;},_stripParameters:function(url,_3c6){var obj=_383.urlToObject(url),prop,qs=[];for(prop in obj.query){if(_380.indexOf(_3c6,prop.toLowerCase())===-1){qs.push(prop+"="+obj.query[prop]);}}return obj.path+(qs.length?("?"+qs.join("&")):"");}});if(has("extend-esri")){lang.setObject("layers.WMSLayer",_388,_381);}return _388;});},"esri/layers/TrackManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(_3c7,lang,_3c8,has,_3c9,_3ca,_3cb,_3cc){var _3cd=_3c7(null,{declaredClass:"esri.layers._TrackManager",constructor:function(_3ce){this.layer=_3ce;this.trackMap={};},initialize:function(map){this.map=map;var _3cf=this.layer,_3d0=_3cf.renderer.trackRenderer;if(_3d0&&(_3cf.geometryType==="esriGeometryPoint")){var _3d1=(this.container=new _3cc._GraphicsLayer({id:_3cf.id+"_tracks",_child:true}));_3d1.loaded=true;_3d1.onLoad(_3d1);_3d1._setMap(map,_3cf._div);_3d1.setRenderer(_3d0);}},addFeatures:function(_3d2){var tkid,_3d3=this.trackMap,_3d4=this.layer,_3d5=_3d4._trackIdField;_3c8.forEach(_3d2,function(_3d6){var _3d7=_3d6.attributes;tkid=_3d7[_3d5];var ary=(_3d3[tkid]=(_3d3[tkid]||[]));ary.push(_3d6);});var _3d8=_3d4._startTimeField,_3d9=_3d4.objectIdField;var _3da=function(a,b){var _3db=a.attributes[_3d8],_3dc=b.attributes[_3d8];if(_3db===_3dc){return (a.attributes[_3d9]<b.attributes[_3d9])?-1:1;}else{return (_3db<_3dc)?-1:1;}};for(tkid in _3d3){_3d3[tkid].sort(_3da);}},drawTracks:function(){var _3dd=this.container;if(!_3dd){return;}var _3de=this.trackMap,sr=this.map.spatialReference,tkid,ary,path,i,_3df,_3e0=this.layer._trackIdField,_3e1;for(tkid in _3de){ary=_3de[tkid];path=[];for(i=ary.length-1;i>=0;i--){_3df=ary[i].geometry;if(_3df){path.push([_3df.x,_3df.y]);}}_3e1={};_3e1[_3e0]=tkid;if(path.length>0){_3dd.add(new _3ca(new _3cb({paths:[path],spatialReference:sr}),null,_3e1));}}},moveLatestToFront:function(){_3c8.forEach(this.getLatestObservations(),function(_3e2){var _3e3=_3e2._shape;_3e3&&_3e3._moveToFront();this._repaint(_3e2,null,true);},this.layer);},getLatestObservations:function(){var _3e4=[];if(!this.layer.renderer.latestObservationRenderer){return _3e4;}var _3e5=this.trackMap,tkid;for(tkid in _3e5){var ary=_3e5[tkid];_3e4.push(ary[ary.length-1]);}return _3e4;},clearTracks:function(){var _3e6=this.getLatestObservations();this.trackMap={};var _3e7=this.container;if(_3e7){_3e7.clear();}_3c8.forEach(_3e6,function(_3e8){this._repaint(_3e8,null,true);},this.layer);},isLatestObservation:function(_3e9){var _3ea=this.layer._trackIdField;var _3eb=this.trackMap[_3e9.attributes[_3ea]];if(_3eb){return (_3eb[_3eb.length-1]===_3e9);}return false;},destroy:function(){var _3ec=this.container;if(_3ec){_3ec.clear();_3ec._unsetMap(this.map,this.layer._div);this.container=null;}this.map=null;this.layer=null;this.trackMap=null;}});if(has("extend-esri")){lang.setObject("layers._TrackManager",_3cd,_3c9);}return _3cd;});},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(_3ed,lang,has,_3ee,_3ef){var _3f0=_3ed([_3ef],{declaredClass:"esri.layers._SelectionMode",constructor:function(_3f1){this.featureLayer=_3f1;this._featureMap={};},propertyChangeHandler:function(type){if(this._init&&type===0){this._applyTimeFilter();}},resume:function(){this.propertyChangeHandler(0);}});if(has("extend-esri")){lang.setObject("layers._SelectionMode",_3f0,_3ee);}return _3f0;});},"esri/layers/SnapshotMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/SpatialReference","esri/tasks/query","esri/layers/RenderMode"],function(_3f2,lang,has,_3f3,_3f4,_3f5,_3f6){var _3f7=_3f2([_3f6],{declaredClass:"esri.layers._SnapshotMode",constructor:function(_3f8){this.featureLayer=_3f8;this._featureMap={};this._drawFeatures=lang.hitch(this,this._drawFeatures);this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},startup:function(){if(this.featureLayer._collection){this._applyTimeFilter();}else{this._fetchAll();}},propertyChangeHandler:function(type){if(this._init){if(type){if(this.featureLayer._collection){}else{this._fetchAll();}}else{this._applyTimeFilter();}}},drawFeature:function(_3f9){var _3fa=this.featureLayer,_3fb=_3fa.objectIdField,oid=_3f9.attributes[_3fb];this._addFeatureIIf(oid,_3f9);this._incRefCount(oid);},resume:function(){this.propertyChangeHandler(0);},refresh:function(){var _3fc=this.featureLayer;if(_3fc._collection){_3fc._fireUpdateStart();_3fc._refresh(true);_3fc._fireUpdateEnd();}else{this._fetchAll();}},_getRequestId:function(_3fd){var id="_"+_3fd.name+_3fd.layerId+_3fd._ulid;return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_fetchAll:function(){var _3fe=this.featureLayer;if(_3fe._collection||_3fe.suspended){return;}_3fe._fireUpdateStart();this._clearIIf();this._sendRequest();},_sendRequest:function(){var map=this.map,_3ff=this.featureLayer,_400=_3ff.getDefinitionExpression();var _401=new _3f5();_401.outFields=_3ff.getOutFields();_401.where=_400||"1=1";_401.returnGeometry=true;_401.outSpatialReference=new _3f4(map.spatialReference.toJson());_401.timeExtent=_3ff.getTimeDefinition();_401.maxAllowableOffset=_3ff._maxOffset;if(_3ff._ts){_401._ts=(new Date()).getTime();}_401.orderByFields=_3ff.supportsAdvancedQueries?_3ff.orderByFields:null;var _402;if(_3ff._usePatch){_402=this._getRequestId(_3ff);this._cancelPendingRequest(null,_402);}_3ff._task.execute(_401,this._drawFeatures,this._queryErrorHandler,_402);},_drawFeatures:function(_403){this._purgeRequests();var _404=_403.features,_405=this.featureLayer,_406=_405.objectIdField,i,len=_404.length,_407,oid;for(i=0;i<len;i++){_407=_404[i];oid=_407.attributes[_406];this._addFeatureIIf(oid,_407);this._incRefCount(oid);}this._applyTimeFilter(true);_405._fireUpdateEnd(null,_403.exceededTransferLimit?{queryLimitExceeded:true}:null);if(_403.exceededTransferLimit){_405.onQueryLimitExceeded();}},_queryErrorHandler:function(err){this._purgeRequests();var _408=this.featureLayer;_408._errorHandler(err);_408._fireUpdateEnd(err);}});if(has("extend-esri")){lang.setObject("layers._SnapshotMode",_3f7,_3f3);}return _3f7;});},"esri/dijit/OverviewMap":function(){define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/html","dojo/has","dojo/sniff","dojo/dom-class","dojo/dom-style","dojo/dnd/Moveable","dijit/_Widget","dijit/_Templated","esri/map","esri/geometry/Point","esri/geometry/ScreenPoint","esri/layers/TiledMapServiceLayer","esri/layers/DynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/virtualearth/VETiledLayer","esri/kernel","esri/config","esri/domUtils","dojo/text!esri/dijit/templates/OverviewMap.html","dojo/i18n!esri/nls/jsapi"],function(_409,_40a,lang,_40b,html,has,_40c,_40d,_40e,_40f,_410,_411,Map,_412,_413,_414,_415,_416,_417,_418,_419,_41a,_41b,_41c,_41d,_41e,_41f){var OM=_40a([_410,_411],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:true,templateString:_41e,basePath:_409.toUrl("esri/dijit")+"/",constructor:function(_420,_421){lang.mixin(this,_41f.widgets.overviewMap);_420=_420||{};if(!_420.map){return;}var _422={};if(_421){this._detached=true;_422=html.coords(_421,true);}this.map=_420.map;this.baseLayer=_420.baseLayer;this.width=_420.width||_422.w||this.map.width/4;this.height=_420.height||_422.h||this.map.height/4;this.attachTo=_420.attachTo||"top-right";this.expandFactor=_420.expandFactor||2;this.color=_420.color||"#000000";this.opacity=_420.opacity||0.5;this.maximizeButton=!!_420.maximizeButton;this.visible=!!_420.visible;if(this.map.loaded){this._initialSetup();}else{var _423=_40b.connect(this.map,"onLoad",this,function(){_40b.disconnect(_423);_423=null;this._initialSetup();});}if(this._detached){this.visible=true;}this._maximized=false;},startup:function(){this.inherited(arguments);if(has("ie")){if(!this.domNode.parentElement){this.map.container.appendChild(this.domNode);}}else{if(!this.domNode.parentNode){this.map.container.appendChild(this.domNode);}}if(this._detached){_40e.set(this._body,"display","block");_40e.set(this._controllerDiv,"display","none");_40e.set(this._maximizerDiv,"display","none");if(this.map.loaded){this._initialize();}else{_40b.connect(this.map,"onLoad",this,this._initialize);}}else{if(this.attachTo.split("-")[0]==="bottom"){this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv);}if(!this.maximizeButton){_40d.add(this._maximizerDiv,"ovwDisabledButton");}if(this.visible&&this.map.loaded){this.visible=false;this.show();}_40d.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]);_40d.add(this._controllerDiv,"ovwShow");_40d.add(this._maximizerDiv,"ovwMaximize");}_40e.set(this._focusDiv,"opacity",this.opacity);},destroy:function(){this._deactivate();if(this.overviewMap){this.overviewMap.destroy();}this.overviewMap=this.baseLayer=null;this.inherited(arguments);},resize:function(size){if(!size||size.w<=0||size.h<=0){return;}this._resize(size.w,size.h);},show:function(){if(!this.visible){var div=this._controllerDiv;div.title=this.NLS_hide;_40d.remove(div,"ovwShow");_40d.add(div,"ovwHide");_41d.show(this._body);_41d.show(this._maximizerDiv);this._initialize();this.visible=true;}},hide:function(){if(this.visible){var div=this._controllerDiv;div.title=this.NLS_show;_40d.remove(div,"ovwHide");_40d.add(div,"ovwShow");if(this._maximized){this._maximizeHandler();}_41d.hide(this._body);_41d.hide(this._maximizerDiv);this._deactivate();this.visible=false;}},_initialSetup:function(){this._mainMapLayer=this.map.getLayer(this.map.layerIds[0]);if(!this._mainMapLayer){return;}var _424=this.baseLayer||this._mainMapLayer;var _425=this.map.spatialReference,_426=_424.spatialReference;if((_426.wkid!==_425.wkid)&&(_426.wkt!==_425.wkt)){return;}var _427=_424.declaredClass;if(_424 instanceof _414){if(_427.indexOf("VETiledLayer")!==-1){this.baseLayer=new _41a({resourceInfo:_424.getResourceInfo(),culture:_424.culture,mapStyle:_424.mapStyle,bingMapsKey:_424.bingMapsKey});}else{if(_427.indexOf("OpenStreetMapLayer")!==-1){this.baseLayer=new _419({tileServers:_424.tileServers});}else{if(_427.indexOf("WebTiledLayer")!==-1){var _428=_424.initialExtent,_429=_424.fullExtent,_42a=_424.tileInfo;this.baseLayer=new _424.constructor(_424.urlTemplate,{initialExtent:_428&&new _428.constructor(_428.toJson()),fullExtent:_429&&new _429.constructor(_429.toJson()),tileInfo:_42a&&new _42a.constructor(_42a.toJson()),tileServers:_424.tileServers&&_424.tileServers.slice(0)});}else{this.baseLayer=new _416(_424.url,{resourceInfo:_424.getResourceInfo()});}}}}else{if(_424 instanceof _415){if(_427.indexOf("ArcGISImageServiceLayer")!==-1){this.baseLayer=new _418(_424.url);}else{this.baseLayer=new _417(_424.url);this.baseLayer.setImageFormat("png24");}}else{return;}}if(!this._detached&&this.visible&&this._controllerDiv){var _42b=function(){this.visible=false;this.show();};if(this.baseLayer.loaded){_42b.call(this);}else{_40b.connect(this.baseLayer,"onLoad",this,_42b);}}},_visibilityHandler:function(){if(this.visible){this.hide();}else{this.show();}},_maximizeHandler:function(){var div=this._maximizerDiv;if(this._maximized){div.title=this.NLS_maximize;_40d.remove(div,"ovwRestore");_40d.add(div,"ovwMaximize");this._resize(this.width,this.height);}else{div.title=this.NLS_restore;_40d.remove(div,"ovwMaximize");_40d.add(div,"ovwRestore");this._resize(this.map.width,this.map.height);}this._maximized=!this._maximized;},_resize:function(_42c,_42d){_40e.set(this._body,{width:_42c+"px",height:_42d+"px"});var _42e=_41c.defaults.map.panDuration,_42f=this.overviewMap;_41c.defaults.map.panDuration=0;_42f.resize(true);_42f.centerAt(this._focusExtent.getCenter());_41c.defaults.map.panDuration=_42e;},_initialize:function(){if(!this.overviewMap){var _430;_430=(this.overviewMap=new Map(this.id+"-map",{slider:false,showAttribution:false,logo:false,lods:this._overviewLods,wrapAround180:this.map.wrapAround180}));_40b.connect(_430,"onLoad",this,function(){this._map_resize_override=lang.hitch(_430,this._map_resize_override);_430.disableMapNavigation();this._activate();});_430.addLayer(this.baseLayer);}else{this._activate();}},_activate:function(){var map=this.map,_431=this.overviewMap;this._moveableHandle=new _40f(this._focusDiv);this._soeConnect=_40b.connect(map,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=_40b.connect(map,"onPan",this,this._updateFocus);this._oecConnect=_40b.connect(_431,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=_40b.connect(_431,"onPan",this,this._ovwPanHandler);this._ozsConnect=_40b.connect(_431,"onZoomStart",this,function(){_41d.hide(this._focusDiv);});this._ozeConnect=_40b.connect(_431,"onZoomEnd",this,function(){_41d.show(this._focusDiv);});this._omsConnect=_40b.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(map.extent,null,null,null);},_deactivate:function(){_40b.disconnect(this._soeConnect);_40b.disconnect(this._ufoConnect);_40b.disconnect(this._oecConnect);_40b.disconnect(this._opaConnect);_40b.disconnect(this._ozsConnect);_40b.disconnect(this._ozeConnect);_40b.disconnect(this._omsConnect);if(this._moveableHandle){this._moveableHandle.destroy();}},_syncOverviewMap:function(ext,_432,_433,lod){if(this._suspendPanHandling){this._suspendPanHandling=false;return;}this._focusExtent=ext;this.overviewMap.setExtent(ext.expand(this.expandFactor),true);},_updateFocus:function(ext){if(this._suspendPanHandling){return;}this._focusExtent=ext;this._drawFocusDiv(ext);},_drawFocusDiv:function(ext,_434){var _435=this.overviewMap;var tl=_435.toScreen(new _412(ext.xmin,ext.ymax,_435.spatialReference));var br=_435.toScreen(new _412(ext.xmax,ext.ymin,_435.spatialReference));var _436=br.x-tl.x,_437=br.y-tl.y,_438=true;if((_436>this.overviewMap.width)&&(_437>this.overviewMap.height)){_438=false;}_40e.set(this._focusDiv,{left:tl.x+(_434?_434.x:0)+"px",top:tl.y+(_434?_434.y:0)+"px",width:_436+"px",height:_437+"px",display:_438?"block":"none"});},_moveStopHandler:function(evt){var _439=this._moveableHandle.node.style;var ext=this._focusExtent;var _43a=this.overviewMap;var _43b=_43a.toMap(new _413(parseInt(_439.left,10),parseInt(_439.top,10)));var prev=new _412(ext.xmin,ext.ymax,_43a.spatialReference);this._focusExtent=ext.offset(_43b.x-prev.x,_43b.y-prev.y);if(this._maximized){this._maximizeHandler();}else{_43a.centerAt(this._focusExtent.getCenter());}this._suspendPanHandling=true;this.map.setExtent(this._focusExtent);},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent);},_ovwPanHandler:function(ext,_43c){this._drawFocusDiv(this._focusExtent,_43c);}});if(has("extend-esri")){lang.setObject("dijit.OverviewMap",OM,_41b);}return OM;});},"dojox/data/CsvStore":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/xhr","dojo/_base/kernel","dojo/data/util/filter","dojo/data/util/simpleFetch"],function(lang,_43d,xhr,_43e,_43f,_440){var _441=_43d("dojox.data.CsvStore",null,{constructor:function(_442){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=false;if(_442.url){this.url=_442.url;}this._csvData=_442.data;if(_442.label){this.label=_442.label;}else{if(this.label===""){this.label=undefined;}}this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];this.identifier=_442.identifier;if(this.identifier===""){delete this.identifier;}else{this._idMap={};}if("separator" in _442){this.separator=_442.separator;}if("urlPreventCache" in _442){this.urlPreventCache=_442.urlPreventCache?true:false;}},url:"",label:"",identifier:"",separator:",",urlPreventCache:false,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error(this.declaredClass+": a function was passed an item argument that was not an item");}},_getIndex:function(item){var idx=this.getIdentity(item);if(this.identifier){idx=this._idMap[idx];}return idx;},getValue:function(item,_443,_444){this._assertIsItem(item);var _445=_444;if(typeof _443==="string"){var ai=this._attributeIndexes[_443];if(ai!=null){var _446=this._dataArray[this._getIndex(item)];_445=_446[ai]||_444;}}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}return _445;},getValues:function(item,_447){var _448=this.getValue(item,_447);return (_448?[_448]:[]);},getAttributes:function(item){this._assertIsItem(item);var _449=[];var _44a=this._dataArray[this._getIndex(item)];for(var i=0;i<_44a.length;i++){if(_44a[i]!==""){_449.push(this._attributes[i]);}}return _449;},hasAttribute:function(item,_44b){this._assertIsItem(item);if(typeof _44b==="string"){var _44c=this._attributeIndexes[_44b];var _44d=this._dataArray[this._getIndex(item)];return (typeof _44c!=="undefined"&&_44c<_44d.length&&_44d[_44c]!=="");}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}},containsValue:function(item,_44e,_44f){var _450=undefined;if(typeof _44f==="string"){_450=_43f.patternToRegExp(_44f,false);}return this._containsValue(item,_44e,_44f,_450);},_containsValue:function(item,_451,_452,_453){var _454=this.getValues(item,_451);for(var i=0;i<_454.length;++i){var _455=_454[i];if(typeof _455==="string"&&_453){return (_455.match(_453)!==null);}else{if(_452===_455){return true;}}}return false;},isItem:function(_456){if(_456&&_456[this._storeProp]===this){var _457=_456[this._idProp];if(this.identifier){var data=this._dataArray[this._idMap[_457]];if(data){return true;}}else{if(_457>=0&&_457<this._dataArray.length){return true;}}}return false;},isItemLoaded:function(_458){return this.isItem(_458);},loadItem:function(item){},getFeatures:function(){return this._features;},getLabel:function(item){if(this.label&&this.isItem(item)){return this.getValue(item,this.label);}return undefined;},getLabelAttributes:function(item){if(this.label){return [this.label];}return null;},_fetchItems:function(_459,_45a,_45b){var self=this;var _45c=function(_45d,_45e){var _45f=null;if(_45d.query){var key,_460;_45f=[];var _461=_45d.queryOptions?_45d.queryOptions.ignoreCase:false;var _462={};for(key in _45d.query){_460=_45d.query[key];if(typeof _460==="string"){_462[key]=_43f.patternToRegExp(_460,_461);}}for(var i=0;i<_45e.length;++i){var _463=true;var _464=_45e[i];for(key in _45d.query){_460=_45d.query[key];if(!self._containsValue(_464,key,_460,_462[key])){_463=false;}}if(_463){_45f.push(_464);}}}else{_45f=_45e.slice(0,_45e.length);}_45a(_45f,_45d);};if(this._loadFinished){_45c(_459,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_459,filter:_45c});}else{this._loadInProgress=true;var _465={url:self.url,handleAs:"text",preventCache:self.urlPreventCache};var _466=xhr.get(_465);_466.addCallback(function(data){try{self._processData(data);_45c(_459,self._arrayOfAllItems);self._handleQueuedFetches();}catch(e){_45b(e,_459);}});_466.addErrback(function(_467){self._loadInProgress=false;if(_45b){_45b(_467,_459);}else{throw _467;}});var _468=null;if(_459.abort){_468=_459.abort;}_459.abort=function(){var df=_466;if(df&&df.fired===-1){df.cancel();df=null;}if(_468){_468.call(_459);}};}}else{if(this._csvData){try{this._processData(this._csvData);this._csvData=null;_45c(_459,this._arrayOfAllItems);}catch(e){_45b(e,_459);}}else{var _469=new Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(_45b){_45b(_469,_459);}else{throw _469;}}}}},close:function(_46a){},_getArrayOfArraysFromCsvFileContents:function(_46b){if(lang.isString(_46b)){var _46c=new RegExp("^\\s+","g");var _46d=new RegExp("\\s+$","g");var _46e=new RegExp("\"\"","g");var _46f=[];var i;var _470=this._splitLines(_46b);for(i=0;i<_470.length;++i){var _471=_470[i];if(_471.length>0){var _472=_471.split(this.separator);var j=0;while(j<_472.length){var _473=_472[j];var _474=_473.replace(_46c,"");var _475=_474.replace(_46d,"");var _476=_475.charAt(0);var _477=_475.charAt(_475.length-1);var _478=_475.charAt(_475.length-2);var _479=_475.charAt(_475.length-3);if(_475.length===2&&_475=="\"\""){_472[j]="";}else{if((_476=="\"")&&((_477!="\"")||((_477=="\"")&&(_478=="\"")&&(_479!="\"")))){if(j+1===_472.length){return;}var _47a=_472[j+1];_472[j]=_474+this.separator+_47a;_472.splice(j+1,1);}else{if((_476=="\"")&&(_477=="\"")){_475=_475.slice(1,(_475.length-1));_475=_475.replace(_46e,"\"");}_472[j]=_475;j+=1;}}}_46f.push(_472);}}this._attributes=_46f.shift();for(i=0;i<this._attributes.length;i++){this._attributeIndexes[this._attributes[i]]=i;}this._dataArray=_46f;}},_splitLines:function(_47b){var _47c=[];var i;var line="";var _47d=false;for(i=0;i<_47b.length;i++){var c=_47b.charAt(i);switch(c){case "\"":_47d=!_47d;line+=c;break;case "\r":if(_47d){line+=c;}else{_47c.push(line);line="";if(i<(_47b.length-1)&&_47b.charAt(i+1)=="\n"){i++;}}break;case "\n":if(_47d){line+=c;}else{_47c.push(line);line="";}break;default:line+=c;}}if(line!==""){_47c.push(line);}return _47c;},_processData:function(data){this._getArrayOfArraysFromCsvFileContents(data);this._arrayOfAllItems=[];if(this.identifier){if(this._attributeIndexes[this.identifier]===undefined){throw new Error(this.declaredClass+": Identity specified is not a column header in the data set.");}}for(var i=0;i<this._dataArray.length;i++){var id=i;if(this.identifier){var _47e=this._dataArray[i];id=_47e[this._attributeIndexes[this.identifier]];this._idMap[id]=i;}this._arrayOfAllItems.push(this._createItemFromIdentity(id));}this._loadFinished=true;this._loadInProgress=false;},_createItemFromIdentity:function(_47f){var item={};item[this._storeProp]=this;item[this._idProp]=_47f;return item;},getIdentity:function(item){if(this.isItem(item)){return item[this._idProp];}return null;},fetchItemByIdentity:function(_480){var item;var _481=_480.scope?_480.scope:_43e.global;if(!this._loadFinished){var self=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_480});}else{this._loadInProgress=true;var _482={url:self.url,handleAs:"text"};var _483=xhr.get(_482);_483.addCallback(function(data){try{self._processData(data);var item=self._createItemFromIdentity(_480.identity);if(!self.isItem(item)){item=null;}if(_480.onItem){_480.onItem.call(_481,item);}self._handleQueuedFetches();}catch(error){if(_480.onError){_480.onError.call(_481,error);}}});_483.addErrback(function(_484){this._loadInProgress=false;if(_480.onError){_480.onError.call(_481,_484);}});}}else{if(this._csvData){try{self._processData(self._csvData);self._csvData=null;item=self._createItemFromIdentity(_480.identity);if(!self.isItem(item)){item=null;}if(_480.onItem){_480.onItem.call(_481,item);}}catch(e){if(_480.onError){_480.onError.call(_481,e);}}}}}else{item=this._createItemFromIdentity(_480.identity);if(!this.isItem(item)){item=null;}if(_480.onItem){_480.onItem.call(_481,item);}}},getIdentityAttributes:function(item){if(this.identifier){return [this.identifier];}else{return null;}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _485=this._queuedFetches[i];var _486=_485.filter;var _487=_485.args;if(_486){_486(_487,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_485.args);}}this._queuedFetches=[];}}});lang.extend(_441,_440);return _441;});},"esri/layers/GridLayout":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/Polyline"],function(_488,lang,_489,has,_48a,_48b,_48c,_48d){var _48e=_488(null,{declaredClass:"esri.layers._GridLayout",constructor:function(_48f,_490,_491,_492){this.origin=_48f;this.cellWidth=_490.width;this.cellHeight=_490.height;this.mapWidth=_491.width;this.mapHeight=_491.height;this.srInfo=_492;},setResolution:function(_493){this._resolution=(_493.xmax-_493.xmin)/this.mapWidth;if(this.srInfo){var _494=Math.round((2*this.srInfo.valid[1])/this._resolution),_495=Math.round(_494/this.cellWidth);this._frameStats=[_495,0,_495-1];}},getCellCoordinates:function(_496){var res=this._resolution,_497=this.origin;return {row:Math.floor((_497.y-_496.y)/(this.cellHeight*res)),col:Math.floor((_496.x-_497.x)/(this.cellWidth*res))};},normalize:function(col){var _498=this._frameStats;if(_498){var _499=_498[0],m180=_498[1],p180=_498[2];if(col<m180){col=col%_499;col=col<m180?col+_499:col;}else{if(col>p180){col=col%_499;}}}return col;},intersects:function(_49a,_49b){var _49c=this.srInfo;if(_49c){return _489.some(_49b._getParts(_49c),function(_49d){return _49a.intersects(_49d.extent);});}else{return _49a.intersects(_49b);}},getCellExtent:function(row,col){var res=this._resolution,_49e=this.origin,_49f=this.cellWidth,_4a0=this.cellHeight;return new _48c((col*_49f*res)+_49e.x,_49e.y-((row+1)*_4a0*res),((col+1)*_49f*res)+_49e.x,_49e.y-(row*_4a0*res),new _48b(_49e.spatialReference.toJson()));},getLatticeID:function(_4a1){var _4a2=this.getCellCoordinates({x:_4a1.xmin,y:_4a1.ymax}),_4a3=this.getCellCoordinates({x:_4a1.xmax,y:_4a1.ymin}),_4a4=_4a2.row,_4a5=_4a3.row,_4a6=this.normalize(_4a2.col),_4a7=this.normalize(_4a3.col);return _4a4+"_"+_4a5+"_"+_4a6+"_"+_4a7;},sorter:function(a,b){return (a<b)?-1:1;},getCellsInExtent:function(_4a8,_4a9){var _4aa=this.getCellCoordinates({x:_4a8.xmin,y:_4a8.ymax}),_4ab=this.getCellCoordinates({x:_4a8.xmax,y:_4a8.ymin}),_4ac=_4aa.row,_4ad=_4ab.row,_4ae=_4aa.col,_4af=_4ab.col,_4b0=[],i,j,nj,_4b1=[],_4b2=[],len,xmin,xmax,ymin,ymax,_4b3=[],_4b4,_4b5;for(i=_4ac;i<=_4ad;i++){for(j=_4ae;j<=_4af;j++){nj=this.normalize(j);_4a8=this.getCellExtent(i,nj);_4b0.push({row:i,col:nj,extent:_4a8,resolution:this._resolution});if(_4a9){_4b1.push(_4a8.xmin,_4a8.xmax);_4b2.push(_4a8.ymin,_4a8.ymax);}}}_4ae=this.normalize(_4ae);_4af=this.normalize(_4af);_4b1.sort(this.sorter);_4b2.sort(this.sorter);len=_4b1.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_4b1[i]===_4b1[i+1]){_4b1.splice(i,1);}}}len=_4b2.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_4b2[i]===_4b2[i+1]){_4b2.splice(i,1);}}}if(_4b1.length&&_4b2.length){xmin=_4b1[0];xmax=_4b1[_4b1.length-1];ymin=_4b2[0];ymax=_4b2[_4b2.length-1];len=_4b1.length;for(i=0;i<len;i++){_4b3.push([[_4b1[i],ymax],[_4b1[i],ymin]]);}len=_4b2.length;for(i=0;i<len;i++){_4b3.push([[xmin,_4b2[i]],[xmax,_4b2[i]]]);}_4b4=new _48d({paths:_4b3,spatialReference:this.origin.spatialReference.toJson()});_4b5=_4ac+"_"+_4ad+"_"+_4ae+"_"+_4af;_4b0.push({latticeID:_4b5,lattice:_4b4,resolution:this._resolution});}return {minRow:_4ac,maxRow:_4ad,minCol:_4ae,maxCol:_4af,cells:_4b0};}});if(has("extend-esri")){lang.setObject("layers._GridLayout",_48e,_48a);}return _48e;});},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(lang){var _4b6={};lang.setObject("dojo.data.util.filter",_4b6);_4b6.patternToRegExp=function(_4b7,_4b8){var rxp="^";var c=null;for(var i=0;i<_4b7.length;i++){c=_4b7.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_4b7.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_4b8){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _4b6;});},"esri/arcgis/csv":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/sniff","dojo/number","dojox/data/CsvStore","esri/kernel","esri/config","esri/request","esri/SpatialReference","esri/geometry/Point","esri/geometry/jsonUtils","esri/geometry/webMercatorUtils"],function(lang,_4b9,_4ba,has,_4bb,_4bc,_4bd,_4be,_4bf,_4c0,_4c1,_4c2,_4c3){var _4c4=["lat","latitude","y","ycenter","latitude83","latdecdeg","POINT-Y"],_4c5=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","POINT-X"];function _4c6(_4c7){var _4c8=[","," ",";","|","\t"];var _4c9=0;var _4ca="";_4b9.forEach(_4c8,function(_4cb){var _4cc=_4c7.split(_4cb).length;if(_4cc>_4c9){_4c9=_4cc;_4ca=_4cb;}});return _4ca;};function _4cd(d,_4ce){if(!d||Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){return false;}var _4cf=true;if(has("chrome")&&/\d+\W*$/.test(_4ce)){var _4d0=_4ce.match(/[a-zA-Z]{2,}/);if(_4d0){var _4d1=false,i=0,len=_4d0.length,_4d2=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;while(!_4d1&&(i<=len)&&!(_4d1=!_4d2.test(_4d0[i]))){i++;}_4cf=!_4d1;}}return _4cf;};function _4d3(data,_4d4,_4d5){var _4d6=data.indexOf("\n");var _4d7=lang.trim(data.substr(0,_4d6));var _4d8=_4d4.columnDelimiter;if(!_4d8){_4d8=_4c6(_4d7);}var _4d9=new _4bc({data:data,separator:_4d8});var _4da=(has("ie")<9)?750:1001;_4d9.fetch({start:0,count:_4da,onComplete:function(_4db,_4dc){var _4dd=0;var _4de={"layerDefinition":_4d4.layerDefinition,"featureSet":{"features":[],"geometryType":"esriGeometryPoint"}};var _4df=_4de.layerDefinition.objectIdField;if(!_4df){if(!_4b9.some(_4de.layerDefinition.fields,function(_4e0){if(_4e0.type=="esriFieldTypeOID"){_4df=_4e0.name;return true;}return false;})){_4de.layerDefinition.fields.push({"name":"__OBJECTID","alias":"__OBJECTID","type":"esriFieldTypeOID","editable":false,"domain":null});_4df="__OBJECTID";}}var _4e1,_4e2;var _4e3=_4d9._attributes;var _4e4=[];var _4e5=[];_4b9.forEach(_4de.layerDefinition.fields,function(_4e6,_4e7){if(_4e6.type==="esriFieldTypeDate"){_4e4.push(_4e6.name);}else{if(_4e6.type==="esriFieldTypeDouble"||_4e6.type==="esriFieldTypeInteger"){_4e5.push(_4e6.name);}}});if(_4d4.locationInfo&&_4d4.locationInfo.locationType==="coordinates"){_4e1=_4d4.locationInfo.latitudeFieldName;_4e2=_4d4.locationInfo.longitudeFieldName;}else{_4b9.forEach(_4e3,function(_4e8){var _4e9;_4e9=_4b9.indexOf(_4c4,_4e8.toLowerCase());if(_4e9!==-1){_4e1=_4e8;}_4e9=_4b9.indexOf(_4c5,_4e8.toLowerCase());if(_4e9!==-1){_4e2=_4e8;}},this);}if(!_4e1||!_4e2){setTimeout(function(){},1);return;}var i=0,il=_4db.length;for(i;i<il;i++){if(_4de.featureSet.features.length>=1000){setTimeout(function(){},1);break;}var item=_4db[i];var _4ea=_4d9.getAttributes(item),_4eb={};_4b9.forEach(_4ea,function(attr,_4ec){if(attr){var _4ed=attr;if(attr.length===0){_4b9.forEach(_4de.layerDefinition.fields,function(_4ee,idx){if(_4ee.name==="attribute_"+(idx-1)){attr="attribute_"+(idx-1);}});}if(_4b9.some(_4e4,function(a){return a===attr;})){var val=_4d9.getValue(item,_4ed),date=new Date(val);_4eb[attr]=_4cd(date,val)?date.getTime():null;}else{if(_4b9.some(_4e5,function(a){return a===attr;})){var _4ef=_4bb.parse(_4d9.getValue(item,_4ed));if((attr==_4e1||attr==_4e2)&&(isNaN(_4ef)||Math.abs(_4ef)>181)){_4ef=parseFloat(_4d9.getValue(item,_4ed));if(isNaN(_4ef)){_4eb[attr]=null;}else{_4eb[attr]=_4ef;}}else{if(isNaN(_4ef)){_4eb[attr]=null;}else{_4eb[attr]=_4ef;}}}else{_4eb[attr]=_4d9.getValue(item,_4ed);}}}});_4eb[_4df]=_4dd;_4dd++;var _4f0=_4eb[_4e1];var _4f1=_4eb[_4e2];if(_4f1==null||_4f0==null||isNaN(_4f0)||isNaN(_4f1)){continue;}var _4f2=new _4c1(_4f1,_4f0,new _4c0({wkid:4326}));var _4f3={"geometry":_4f2.toJson(),"attributes":_4eb};_4de.featureSet.features.push(_4f3);}_4de.layerDefinition.name="csv";if(_4d5){_4d5(_4de);}},onError:function(_4f4){}});return true;};function _4f5(_4f6,_4f7,inSR,_4f8,_4f9,_4fa){if(_4f6.length===0){_4f9(null);}var _4fb=_4c2.getGeometryType(_4f7);var _4fc=[];_4b9.forEach(_4f6,function(_4fd){var _4fe=new _4fb(_4fd);_4fe.spatialReference=inSR;_4fc.push(_4fe);},this);var _4ff=[102113,102100,3857];if(inSR.wkid&&inSR.wkid===4326&&_4f8.wkid&&_4b9.indexOf(_4ff,_4f8.wkid)>-1){_4b9.forEach(_4fc,function(_500){if(_500.xmin){_500.xmin=Math.max(_500.xmin,-180);_500.xmax=Math.min(_500.xmax,180);_500.ymin=Math.max(_500.ymin,-89.99);_500.ymax=Math.min(_500.ymax,89.99);}else{if(_500.rings){_4b9.forEach(_500.rings,function(ring){_4b9.forEach(ring,function(_501){_501[0]=Math.min(Math.max(_501[0],-180),180);_501[1]=Math.min(Math.max(_501[1],-89.99),89.99);},this);},this);}else{if(_500.paths){_4b9.forEach(_500.paths,function(path){_4b9.forEach(path,function(_502){_502[0]=Math.min(Math.max(_502[0],-180),180);_502[1]=Math.min(Math.max(_502[1],-89.99),89.99);},this);},this);}else{if(_500.x){_500.x=Math.min(Math.max(_500.x,-180),180);_500.y=Math.min(Math.max(_500.y,-89.99),89.99);}}}}},this);_4f6=[];_4b9.forEach(_4fc,function(_503){var _504=_4c3.geographicToWebMercator(_503);if(_4f8.wkid!==102100){_504.spatialReference=_4f8;}_4f6.push(_504.toJson());},this);_4f9(_4f6);}else{if(inSR.wkid!==null&&_4b9.indexOf(_4ff,inSR.wkid)>-1&&_4f8.wkid!==null&&_4f8.wkid===4326){_4f6=[];_4b9.forEach(_4fc,function(_505){_4f6.push(_4c3.webMercatorToGeographic(_505).toJson());},this);_4f9(_4f6);}else{var _506=function(_507,args){if(_507&&_507.length===_4f6.length){_4f6=[];_4b9.forEach(_507,function(_508){if(_508&&((_508.rings&&_508.rings.length>0&&_508.rings[0].length>0&&_508.rings[0][0].length>0&&!isNaN(_508.rings[0][0][0])&&!isNaN(_508.rings[0][0][1]))||(_508.paths&&_508.paths.length>0&&_508.paths[0].length>0&&_508.paths[0][0].length>0&&!isNaN(_508.paths[0][0][0])&&!isNaN(_508.paths[0][0][1]))||(_508.xmin&&!isNaN(_508.xmin)&&_508.ymin&&!isNaN(_508.ymin))||(_508.x&&!isNaN(_508.x)&&_508.y&&!isNaN(_508.y)))){_4f6.push(_508.toJson());}else{_4f6.push(null);}},this);_4f9(_4f6);}else{_4fa(_507,args);}};if(_4be.defaults.geometryService){_4be.defaults.geometryService.project(_4fc,_4f8,lang.hitch(this,_506),_4fa);}else{_4f9(null);}}}};function _509(sp1,sp2){var _50a=[102113,102100,3857];if(sp1&&sp2&&sp1.wkid===sp2.wkid&&sp1.wkt===sp2.wkt){return true;}else{if(sp1&&sp2&&sp1.wkid&&sp2.wkid&&_4b9.indexOf(_50a,sp1.wkid)>-1&&_4b9.indexOf(_50a,sp2.wkid)>-1){return true;}}return false;};function _50b(_50c,_50d,_50e,_50f){if(!_50c.featureSet||_50c.featureSet.length===0){return;}if(_509(_50e,_50d)){_50f(_50c);return;}var _510=function(_511){var _512=[];_4b9.forEach(_50c.featureSet.features,function(_513,i){if(_511[i]){_513.geometry=_511[i];_512.push(_513);}},this);_50f(_50c);};var _514=function(_515,args){_50f(_50c);};var _516=function(_517,args){_4f5(_518,_50c.featureSet.geometryType,_50d,_50e,lang.hitch(this,_510),lang.hitch(this,_514));};if(_50c.featureSet.features&&_50c.featureSet.features.length>0){var _518=[];_4b9.forEach(_50c.featureSet.features,function(_519){_518.push(_519.geometry);});_4f5(_518,_50c.featureSet.geometryType,_50d,_50e,lang.hitch(this,_510),lang.hitch(this,_516));}else{_50f(_50c);}};function _51a(_51b){var _51c=new _4ba();var _51d=function(_51e){_51c.callback(_51e);};var _51f=_4bf({url:_51b.url,handleAs:"text",load:function(_520){_4d3(_520,_51b,lang.hitch(this,_51d));},error:function(_521){}},{usePost:false});return _51c;};function _522(_523,_524){var _525=new _4ba();var _526=function(_527){_525.callback(_527);};_50b(_523,new _4c0({wkid:4326}),_524,lang.hitch(this,_526));return _525;};function _528(_529){var _52a=_529.layerDefinition.fields;var _52b={"esriFieldTypeDouble":1,"esriFieldTypeSingle":1};var _52c={"esriFieldTypeInteger":1,"esriFieldTypeSmallInteger":1};var dt={"esriFieldTypeDate":1};var _52d=null;var _52e=_4b9.map(_52a,lang.hitch(this,function(item){if(item.name.toUpperCase()==="NAME"){_52d=item.name;}var _52f=(item.type!=="esriFieldTypeOID"&&item.type!=="esriFieldTypeGlobalID"&&item.type!=="esriFieldTypeGeometry");var _530=null;if(_52f){var f=item.name.toLowerCase();var _531=",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";if(_531.indexOf(","+f+",")>-1||f.indexOf("area")>-1||f.indexOf("length")>-1||f.indexOf("shape")>-1||f.indexOf("perimeter")>-1||f.indexOf("objectid")>-1||f.indexOf("_")===f.length-1||(f.indexOf("_i")===f.length-2&&f.length>1)){_52f=false;}if(item.type in _52c){_530={places:0,digitSeparator:true};}else{if(item.type in _52b){_530={places:2,digitSeparator:true};}else{if(item.type in dt){_530={dateFormat:"shortDateShortTime"};}}}}return lang.mixin({},{fieldName:item.name,label:item.alias,isEditable:true,tooltip:"",visible:_52f,format:_530,stringFieldOption:"textbox"});}));var _532={title:_52d?"{"+_52d+"}":"",fieldInfos:_52e,description:null,showAttachments:false,mediaInfos:[]};return _532;};var csv={latFieldStrings:_4c4,longFieldStrings:_4c5,buildCSVFeatureCollection:_51a,projectFeatureCollection:_522,generateDefaultPopupInfo:_528,_getSeparator:_4c6,_isValidDate:_4cd,_processCsvData:_4d3,_projectGeometries:_4f5,_sameSpatialReference:_509,_projectFeatureSet:_50b};if(has("extend-esri")){lang.setObject("arcgis.csv",csv,_4bd);}return csv;});},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_533,lang,has,_534){var BML=_533(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(_535){_535=_535||{};if(!_535.url&&!_535.type){}this.url=_535.url;this.type=_535.type;this.isReference=(_535.isReference===true)?true:false;this.opacity=_535.opacity;this.visibleLayers=_535.visibleLayers;this.displayLevels=_535.displayLevels;this.bandIds=_535.bandIds;this.copyright=_535.copyright;this.subDomains=_535.subDomains;this.fullExtent=_535.fullExtent;this.initialExtent=_535.initialExtent;this.tileInfo=_535.tileInfo;this.tileServers=_535.tileServers;}});if(has("extend-esri")){lang.setObject("dijit.BasemapLayer",BML,_534);}return BML;});},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(_536,lang,_537,has,_538){var _539=_536(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(_53a){if(_53a){this.name=_53a.name;this.title=_53a.title;this.description=_53a.description;this.extent=_53a.extent;this.legendURL=_53a.legendURL;this.subLayers=_53a.subLayers?_53a.subLayers:[];this.allExtents=_53a.allExtents?_53a.allExtents:[];this.spatialReferences=_53a.spatialReferences?_53a.spatialReferences:[];}},clone:function(){var info={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},wkid;if(this.extent){info.extent=this.extent.getExtent();}info.subLayers=[];_537.forEach(this.subLayers,function(_53b){info.subLayers.push(_53b.clone());});info.allExtents=[];for(wkid in this.allExtents){wkid=parseInt(wkid,10);if(!isNaN(wkid)){info.allExtents[wkid]=this.allExtents[wkid].getExtent();}}info.spatialReferences=[];_537.forEach(this.spatialReferences,function(wkid){info.spatialReferences.push(wkid);});return info;}});if(has("extend-esri")){lang.setObject("layers.WMSLayerInfo",_539,_538);}return _539;});},"esri/layers/FeatureType":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/symbols/jsonUtils","esri/layers/RangeDomain","esri/layers/CodedValueDomain","esri/layers/InheritedDomain","esri/layers/FeatureTemplate"],function(_53c,lang,_53d,has,_53e,_53f,_540,_541,_542,_543,_544){var _545=_53c(null,{declaredClass:"esri.layers.FeatureType",constructor:function(json){if(json&&lang.isObject(json)){this.id=json.id;this.name=json.name;var _546=json.symbol;if(_546){this.symbol=_540.fromJson(_546);}var _547=json.domains,_548,i;var _549=this.domains={};for(_548 in _547){if(_547.hasOwnProperty(_548)){var _54a=_547[_548];switch(_54a.type){case "range":_549[_548]=new _541(_54a);break;case "codedValue":_549[_548]=new _542(_54a);break;case "inherited":_549[_548]=new _543(_54a);break;}}}var _54b=json.templates;if(_54b){var _54c=this.templates=[];for(i=0;i<_54b.length;i++){_54c.push(new _544(_54b[i]));}}}},toJson:function(){var json={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()};var _54d,_54e=this.domains,_54f=this.templates,_550=_53f.fixJson;if(_54e){var _551=json.domains={};for(_54d in _54e){if(_54e.hasOwnProperty(_54d)){_551[_54d]=_54e[_54d]&&_54e[_54d].toJson();}}_550(_551);}if(_54f){json.templates=_53d.map(_54f,function(_552){return _552.toJson();});}return _550(json);}});if(has("extend-esri")){lang.setObject("layers.FeatureType",_545,_53e);}return _545;});},"esri/layers/RenderMode":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/io/script","esri/kernel"],function(_553,_554,lang,_555,has,_556,_557){var _558=_554(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(_553._scopeName||"dojo")+"IoScript";},initialize:function(map){this.map=map;this._init=true;},startup:function(){},propertyChangeHandler:function(type){},destroy:function(){this._init=false;},drawFeature:function(_559){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(oid){var _55a=this._featureMap[oid];if(_55a){_55a._count++;}},_decRefCount:function(oid){var _55b=this._featureMap[oid];if(_55b){_55b._count--;}},_getFeature:function(oid){return this._featureMap[oid];},_addFeatureIIf:function(oid,_55c){var fmap=this._featureMap,_55d=fmap[oid],_55e=this.featureLayer;if(!_55d){fmap[oid]=_55c;_55e._add(_55c);_55c._count=0;}return _55d||_55c;},_removeFeatureIIf:function(oid){var _55f=this._featureMap[oid],_560=this.featureLayer;if(_55f){if(_55f._count){return;}delete this._featureMap[oid];_560._remove(_55f);}return _55f;},_clearIIf:function(){var i,_561=this.featureLayer,_562=_561.graphics,_563=_561._selectedFeatures,_564=_561.objectIdField;for(i=_562.length-1;i>=0;i--){var _565=_562[i];var oid=_565.attributes[_564];if(oid in _563){_565._count=1;continue;}_565._count=0;this._removeFeatureIIf(oid);}},_isPending:function(id){var dfd=_556[this._prefix+id];return dfd?true:false;},_cancelPendingRequest:function(dfd,id){dfd=dfd||_556[this._prefix+id];if(dfd){try{dfd.cancel();_556._validCheck(dfd);}catch(e){}}},_purgeRequests:function(){_556._validCheck(null);},_toggleVisibility:function(show){var _566=this.featureLayer,_567=_566.graphics,_568=show?"show":"hide",i,len=_567.length;show=show&&_566._ager;for(i=0;i<len;i++){var _569=_567[i];_569[_568]();if(show){_566._repaint(_569);}}},_applyTimeFilter:function(_56a){var _56b=this.featureLayer;if(!_56b.timeInfo||_56b.suspended){return;}if(!_56a){_56b._fireUpdateStart();}var _56c=_56b._trackManager;if(_56c){_56c.clearTracks();}var defn=_56b.getTimeDefinition(),_56d=_56b._getOffsettedTE(_56b._mapTimeExtent);if(_56d){_56d=_56b._getTimeOverlap(defn,_56d);if(_56d){var _56e=_56b._filterByTime(_56b.graphics,_56d.startTime,_56d.endTime);if(_56c){_56c.addFeatures(_56e.match);}_555.forEach(_56e.match,function(_56f){var _570=_56f._shape;if(!_56f.visible){_56f.show();_570=_56f._shape;_570&&_570._moveToFront();}if(_56b._ager&&_570){_56b._repaint(_56f);}});_555.forEach(_56e.noMatch,function(_571){if(_571.visible){_571.hide();}});}else{this._toggleVisibility(false);}}else{if(_56c){_56c.addFeatures(_56b.graphics);}this._toggleVisibility(true);}if(_56c){_56c.moveLatestToFront();_56c.drawTracks();}if(!_56a){_56b._fireUpdateEnd();}}});if(has("extend-esri")){lang.setObject("layers._RenderMode",_558,_557);}return _558;});},"esri/dijit/Basemap":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/has","esri/kernel","esri/request","esri/dijit/BasemapLayer"],function(_572,_573,lang,has,_574,_575,_576){var BM=_572(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(_577,_578){_577=_577||{};if(!_577.layers&&!_577.itemId){}this.id=_577.id;this.itemId=_577.itemId;this.layers=_577.layers;this.title=_577.title||"";this.thumbnailUrl=_577.thumbnailUrl;this.basemapGallery=_578;},getLayers:function(){if(this.layers){return this.layers;}else{if(this.itemId){var url=_574.dijit._arcgisUrl+"/content/items/"+this.itemId+"/data";var _579={};_579.f="json";var _57a=_575({url:url,content:_579,callbackParamName:"callback",error:lang.hitch(this,function(_57b,args){var msg="esri.dijit.Basemap: could not access basemap item.";if(this.basemapGallery){this.basemapGallery.onError(msg);}else{}})});_57a.addCallback(lang.hitch(this,function(_57c,args){if(_57c.baseMap){this.layers=[];_573.forEach(_57c.baseMap.baseMapLayers,function(_57d){var _57e={};if(_57d.url){_57e.url=_57d.url;}if(_57d.type){_57e.type=_57d.type;}if(_57d.isReference){_57e.isReference=_57d.isReference;}if(_57d.displayLevels){_57e.displayLevels=_57d.displayLevels;}if(_57d.visibleLayers){_57e.visibleLayers=_57d.visibleLayers;}if(_57d.bandIds){_57e.bandIds=_57d.bandIds;}this.layers.push(new _576(_57e));},this);return this.layers;}else{var msg="esri.dijit.Basemap: could not access basemap item.";if(this.basemapGallery){this.basemapGallery.onError(msg);}else{}return [];}}));return _57a;}}}});if(has("extend-esri")){lang.setObject("dijit.Basemap",BM,_574);}return BM;});},"esri/layers/GeoRSSLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/config","esri/request","esri/layers/ServiceGeneratedFeatureCollection"],function(_57f,lang,_580,has,_581,_582,_583,_584){var _585=_57f([_584],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(url,_586){if(_582.defaults.geoRSSService){this.serviceUrl=_582.defaults.geoRSSService;}this._createLayer();},parse:function(){this._io=_583({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?true:undefined,outSR:this._outSR?_580.toJson(this._outSR.toJson()):undefined},callbackParamName:"callback"});return this._io;},_initLayer:function(json){this.inherited(arguments);if(!this.loaded){this.loaded=true;this.onLoad(this);}}});if(has("extend-esri")){lang.setObject("layers.GeoRSSLayer",_585,_581);}return _585;});},"esri/arcgis/utils":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/_base/json","dojo/_base/url","dojo/has","dojo/DeferredList","dojo/dom-construct","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/map","esri/urlUtils","esri/geometry/ScreenPoint","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/symbols/jsonUtils","esri/renderers/jsonUtils","esri/dijit/PopupTemplate","esri/dijit/Popup","esri/tasks/query","esri/tasks/GeometryService","esri/arcgis/csv","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/layers/WebTiledLayer","esri/layers/FeatureLayer","esri/layers/WMSLayer","esri/layers/KMLLayer","esri/layers/GeoRSSLayer","esri/virtualearth/VETiledLayer","esri/layers/TileInfo","esri/layers/DynamicLayerInfo","esri/layers/LayerDrawingOptions","esri/layers/ImageParameters","esri/layers/ImageServiceParameters","esri/layers/RasterFunction","esri/layers/MosaicRule","esri/layers/WMSLayerInfo","dojo/i18n!esri/nls/jsapi"],function(lang,_587,_588,_589,_58a,Url,has,_58b,_58c,_58d,_58e,_58f,_590,_591,Map,_592,_593,_594,_595,_596,_597,_598,_599,_59a,_59b,csv,_59c,_59d,_59e,_59f,_5a0,_5a1,_5a2,_5a3,_5a4,_5a5,_5a6,_5a7,_5a8,_5a9,_5aa,_5ab,_5ac,_5ad,_5ae){String.prototype.endsWith=function(str){return (this.match(str+"$")==str);};var _5af;function _5b0(_5b1){var url=_5af.arcgisUrl+"/"+_5b1.itemId+"/data";var _5b2=_590({url:url,content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:true,_preLookup:true});return _5b2;};function _5b3(_5b4){var _5b5={f:"json"};if(_58d.id){var _5b6=_58d.id.findCredential(_592.urlToObject(_5af.arcgisUrl).path);if(_5b6){_5b5.token=_5b6.token;}}var _5b7=_590({url:_5b4,content:_5b5,callbackParamName:"callback"},{"disableIdentityLookup":true});return _5b7;};function _5b8(_5b9){if(_5b9.itemProperties.layerDefinition){if(_5b9.layerDefinition){if(!_5b9.layerDefinition.drawingInfo){_5b9.layerDefinition.drawingInfo=_5b9.itemProperties.layerDefinition.drawingInfo;}if(!_58f.isDefined(_5b9.layerDefinition.definitionExpression)){_5b9.layerDefinition.definitionExpression=_5b9.itemProperties.layerDefinition.definitionExpression;}if(!_58f.isDefined(_5b9.layerDefinition.minScale)){_5b9.layerDefinition.minScale=_5b9.itemProperties.layerDefinition.minScale;}if(!_58f.isDefined(_5b9.layerDefinition.maxScale)){_5b9.layerDefinition.maxScale=_5b9.itemProperties.layerDefinition.maxScale;}}else{_5b9.layerDefinition=_5b9.itemProperties.layerDefinition;}}if(_5b9.itemProperties.popupInfo&&!_5b9.popupInfo&&!_5b9.disablePopup){_5b9.popupInfo=_5b9.itemProperties.popupInfo;}};function _5ba(_5bb,_5bc){var _5bd=new _589();var _5be=_5bb.itemData;var _5bf=[];var _5c0=[];_587.forEach(_5be.operationalLayers,function(_5c1){if(_5c1.itemId&&!_5c1.type){var _5c2=_5c1.url.toLowerCase();if(_5c2.indexOf("/featureserver")>-1){_5c0.push(_5c1);_5bf.push(_5b0(_5c1));}else{if(_5c2.indexOf("/mapserver")>-1&&_5c2.indexOf("/mapserver/")===-1&&(!_5c1.layers||(!_58f.isDefined(_5c1.minScale)&&!_58f.isDefined(_5c1.maxScale)))){_5c0.push(_5c1);_5bf.push(_5b0(_5c1));}else{if(_5c2.indexOf("/imageserver")>-1&&!_58f.isDefined(_5c1.minScale)&&!_58f.isDefined(_5c1.maxScale)){_5c0.push(_5c1);_5bf.push(_5b0(_5c1));}}}}});if(_5be.baseMap&&_5be.baseMap.baseMapLayers){_587.forEach(_5be.baseMap.baseMapLayers,function(_5c3){if((_5c3.type==="BingMapsAerial"||_5c3.type==="BingMapsRoad"||_5c3.type==="BingMapsHybrid")&&_5c3.portalUrl){_5c0.push(_5c3);_5bf.push(_5b3(_5c3.portalUrl));}else{if(_5c3.itemId){_5c0.push(_5c3);_5bf.push(_5b0(_5c3));}}});}if(_5bf.length>0){var _5c4=new _58b(_5bf);_5c4.addCallback(function(_5c5){_587.forEach(_5c0,function(_5c6,i){if((_5c6.type==="BingMapsAerial"||_5c6.type==="BingMapsRoad"||_5c6.type==="BingMapsHybrid")&&_5c6.portalUrl){if(_5c5[i][1].bingKey){_5bc.bingMapsKey=_5c5[i][1].bingKey;}else{_5c6.errors=_5c6.errors||[];var _5c7={message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. [type:"+_5c6.type+"]"};_5c6.errors.push(_5c7);}return;}var _5c8=_5c5[i][1];if(_5c8){var _5c9=_5c6.url.toLowerCase();if(_5c9.indexOf("/featureserver")>-1&&_5c8.layers){_587.forEach(_5c8.layers,function(_5ca){if(_5c9.endsWith("/featureserver/"+_5ca.id)){_5c6.itemProperties=_5ca;_5b8(_5c6);}});}else{if(_5c9.indexOf("/mapserver")>-1){if(_5c8.layers&&!_5c6.layers){_5c6.layers=_5c8.layers;}if(_58f.isDefined(_5c8.minScale)&&!_58f.isDefined(_5c6.minScale)){_5c6.minScale=_5c8.minScale;}if(_58f.isDefined(_5c8.maxScale)&&!_58f.isDefined(_5c6.maxScale)){_5c6.maxScale=_5c8.maxScale;}if(_58f.isDefined(_5c8.refreshInterval)&&!_58f.isDefined(_5c6.refreshInterval)){_5c6.refreshInterval=_5c8.refreshInterval;}}else{if(_5c9.indexOf("/imageserver")>-1){if(_58f.isDefined(_5c8.minScale)&&!_58f.isDefined(_5c6.minScale)){_5c6.minScale=_5c8.minScale;}if(_58f.isDefined(_5c8.maxScale)&&!_58f.isDefined(_5c6.maxScale)){_5c6.maxScale=_5c8.maxScale;}if(_58f.isDefined(_5c8.refreshInterval)&&!_58f.isDefined(_5c6.refreshInterval)){_5c6.refreshInterval=_5c8.refreshInterval;}if(_5c8.popupInfo&&!_5c6.popupInfo&&!_5c6.disablePopup){_5c6.popupInfo=_5c8.popupInfo;}if(_5c8.renderingRule&&!_5c6.renderingRule){_5c6.renderingRule=_5c8.renderingRule;if(_5c8.renderingRule.functionName){_5c6.renderingRule.rasterFunction=_5c8.renderingRule.functionName;}}if(_5c8.bandIds&&!_5c6.bandIds){_5c6.bandIds=_5c8.bandIds;}if(_5c8.mosaicRule&&!_5c6.mosaicRule){_5c6.mosaicRule=_5c8.mosaicRule;}if(_5c8.format&&!_5c6.format){_5c6.format=_5c8.format;}if(_58f.isDefined(_5c8.compressionQuality)&&!_58f.isDefined(_5c6.compressionQuality)){_5c6.compressionQuality=_5c8.compressionQuality;}}}}}});_5bd.callback(_5bb);});}else{_5bd.callback(_5bb);}return _5bd;};function _5cb(_5cc,_5cd){var _5ce=_5cc.dynamicLayerInfos||_5cc.layerInfos;var _5cf=_5cd.layers;if(_5cf&&_5ce){var _5d0=[],ids=[],urls=[],_5d1=[],_5d2=[],_5d3=[];_587.forEach(_5ce,function(_5d4){var id=_5d4.id,i;if(!_5d4.subLayerIds&&_587.indexOf(_5cc.visibleLayers,id)!==-1){for(i=0;i<_5cf.length;i++){var _5d5=_5cf[i];if(_5d5.id===id){ids.push(id);_5d0.push(_5d5.popupInfo);urls.push(_5d5.layerUrl||"");if(_5d5.layerDefinition&&_5d5.layerDefinition.definitionExpression){_5d1.push(_5d5.layerDefinition.definitionExpression);}else{_5d1.push("");}_5d2.push(esri.isDefined(_5d5.minScale)?_5d5.minScale:0);_5d3.push(esri.isDefined(_5d5.maxScale)?_5d5.maxScale:0);break;}}}});if(_5d0.length){_5cc.__popups=_5d0;_5cc.__popupIds=ids;_5cc.__popupUrls=urls;_5cc.__popupWhereClauses=_5d1;_5cc.__popupMinScales=_5d2;_5cc.__popupMaxScales=_5d3;_5cc.__resourceInfo=_5cd.resourceInfo;}}};function _5d6(url){if(!url){return false;}var _5d7=".arcgis.com/";var _5d8=(new Url(_5af.arcgisUrl)).authority;return (url.indexOf(_5d7)!==-1||url.indexOf(_5d8)!==-1);};function _5d9(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);};function _5da(url){if(location.protocol==="https:"&&(_5d6(url)||_5d9(url))){url=url.replace("http:","https:");}return url;};function _5db(_5dc){var _5dd=[];if(!_5dc.displayLevels){_5dd=_587.map(_5dc.resourceInfo.tileInfo.lods,function(lod){return lod.level;});}var _5de=new _59c(_5da(_5dc.url),{resourceInfo:_5dc.resourceInfo,opacity:_5dc.opacity,visible:_5dc.visibility,displayLevels:_5dc.displayLevels||_5dd,id:_5dc.id,minScale:_5dc.minScale,maxScale:_5dc.maxScale,refreshInterval:_5dc.refreshInterval});_5cb(_5de,_5dc);return _5de;};function _5df(_5e0,_5e1){if(!_5e0||!_5e1||_5e1.length===0){return [];}var _5e2=","+_5e1+",";var _5e3=[];var _5e4="";var k,_5e5=",";for(k=0;k<_5e0.length;k++){if(_5e0[k].subLayerIds!==null){if(_5e2.indexOf(","+_5e0[k].id+",")===-1||_5e5.indexOf(","+_5e0[k].id+",")>-1){_5e5+=_5e0[k].subLayerIds.toString()+",";}}else{if(_5e2.indexOf(","+_5e0[k].id+",")>-1&&_5e5.indexOf(","+_5e0[k].id+",")===-1){_5e3.push(_5e0[k].id);_5e4=",";}}}return _5e3;};function _5e6(_5e7){var _5e8=new _5a9();_5e8.format="png24";if(_5e7.resourceInfo&&_5e7.resourceInfo.supportedImageFormatTypes&&_5e7.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")>-1){_5e8.format="png32";}var _5e9=new _59d(_5da(_5e7.url),{resourceInfo:_5e7.resourceInfo,opacity:_5e7.opacity,visible:_5e7.visibility,id:_5e7.id,imageParameters:_5e8,minScale:_5e7.minScale,maxScale:_5e7.maxScale,refreshInterval:_5e7.refreshInterval});var _5ea=_5e7.visibleLayers;if(!_5e7.visibleLayers){var _5eb="";var _5ec=_5e9.layerInfos;_587.forEach(_5ec,function(_5ed){if(_5ed.defaultVisibility){_5eb+=(_5eb.length>0?",":"")+_5ed.id;}});_5ea=_5eb;}if(_5e7.layers&&_5e7.layers.length>0){var _5ee=[],_5ef=[],_5f0,_5f1=[],_5f2;_587.forEach(_5e7.layers,function(_5f3){if(_5f3.layerDefinition&&_5f3.layerDefinition.definitionExpression){_5ee[_5f3.id]=_5f3.layerDefinition.definitionExpression;}if(_5f3.layerDefinition&&_5f3.layerDefinition.source){_5f0=new _5a7(lang.mixin(_5f3,_5f3.layerDefinition));delete _5f0.layerDefinition;_5f0.id=_5f3.id;if(_5e7.visibleLayers){var vis=((typeof _5e7.visibleLayers)=="string")?_5e7.visibleLayers.split(","):_5e7.visibleLayers;if(_587.indexOf(vis,_5f3.id)>-1){_5f0.defaultVisibility=true;}else{_5f0.defaultVisibility=false;}}_5ef.push(_5f0);}if(_5f3.layerDefinition&&_5f3.layerDefinition.source&&_5f3.layerDefinition.drawingInfo){_5f2=new _5a8(_5f3.layerDefinition.drawingInfo);_5f1[_5f3.id]=_5f2;}},this);if(_5ee.length>0){_5e9.setLayerDefinitions(_5ee);}if(_5ef.length>0){_5e9.setDynamicLayerInfos(_5ef,true);if(_5f1.length>0){_5e9.setLayerDrawingOptions(_5f1,true);}}else{_5ea=_5df(_5e9.layerInfos,_5ea);_5e9.setVisibleLayers(_5ea);}}else{_5ea=_5df(_5e9.layerInfos,_5ea);_5e9.setVisibleLayers(_5ea);}_5cb(_5e9,_5e7);return _5e9;};function _5f4(_5f5,_5f6){var _5f7=new _5aa();_5f7.bandIds=_5f5.bandIds;if(_5f5.format!=null){_5f7.format=_5f5.format;if(_5f5.compressionQuality!=null){_5f7.compressionQuality=_5f5.compressionQuality;}}if(_5f5.renderingRule&&_5f5.renderingRule.rasterFunction){var _5f8=new _5ab(_5f5.renderingRule);_5f7.renderingRule=_5f8;}if(_5f5.mosaicRule){var _5f9=new _5ac(_5f5.mosaicRule);_5f7.mosaicRule=_5f9;}if(_58f.isDefined(_5f5.noData)){_5f7.noData=_5f5.noData;}if(_58f.isDefined(_5f5.noDataInterpretation)){_5f7.noDataInterpretation=_5f5.noDataInterpretation;}if(_58f.isDefined(_5f5.interpolation)){_5f7.interpolation=_5f5.interpolation;}var _5fa=new _59e(_5da(_5f5.url),{resourceInfo:_5f5.resourceInfo,opacity:_5f5.opacity,visible:_5f5.visibility,id:_5f5.id,imageServiceParameters:_5f7,infoTemplate:_5f5.popupInfo&&new _5f6(_5f5.popupInfo),minScale:_5f5.minScale,maxScale:_5f5.maxScale,refreshInterval:_5f5.refreshInterval});if(_5f5.layerDefinition&&_5f5.layerDefinition.definitionExpression){_5fa.setDefinitionExpression(_5f5.layerDefinition.definitionExpression,true);}return _5fa;};function _5fb(_5fc,_5fd,_5fe){var _5ff=[102113,102100,3857];var sp1=_5fe||new _591(_5fd[0].layerObject.fullExtent.spatialReference);var sp2=new _591(_5fc.resourceInfo.fullExtent.spatialReference);if(sp1.wkt==sp2.wkt&&(sp1.wkid==sp2.wkid||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.wkid)||(esri.isDefined(sp2.latestWkid)&&sp1.wkid==sp2.latestWkid)||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.latestWkid))){return true;}else{if(sp1.wkid&&sp2.wkid&&_587.some(_5ff,function(wkid){return wkid===sp2.wkid;})&&_587.some(_5ff,function(wkid){return wkid===sp1.wkid;})){return true;}}return false;};function _600(_601,_602){if(!_602[0].layerObject.tileInfo){return false;}var _603=[];_587.forEach(_602,function(_604){if(_604.baseMapLayer){if(_604.layerObject.tileInfo){_603=_603.concat(_587.map(_604.layerObject.tileInfo.lods,function(lod){return lod.scale;}));}}});var _605=_587.some(_601.resourceInfo.tileInfo.lods,function(lod){return _587.some(_603,function(_606){return _606===lod.scale;});});return _605;};function _607(_608,_609,_60a,_60b,_60c){var _60d,_60e=_60a._clazz;if(_608.type==="OpenStreetMap"){_60d=new _59f({id:_608.id,opacity:_608.opacity,visible:(_608.visibility!==null&&_608.visibility!==undefined)?_608.visibility:true});}else{if(_608.type==="WMS"){var _60f=[];var _610=[];_587.forEach(_608.layers,function(_611){_610.push(new _5ad({name:_611.name,title:_611.title,legendURL:_611.legendURL}));_60f.push(_611.name);},this);if(_608.visibleLayers){_60f=_608.visibleLayers;}var _612=new _594(_608.extent[0][0],_608.extent[0][1],_608.extent[1][0],_608.extent[1][1],new _591({wkid:4326}));var _613={extent:_612,layerInfos:_610,version:_608.version,maxWidth:_608.maxWidth,maxHeight:_608.maxHeight,getMapURL:_608.mapUrl,spatialReferences:_608.spatialReferences,title:_608.title,copyright:_608.copyright};_60d=new _5a2(_608.url,{id:_608.id,visibleLayers:_60f,format:"png",transparent:_608.baseMapLayer?false:true,opacity:_608.opacity,visible:(_608.visibility!==null)?_608.visibility:true,resourceInfo:_613,refreshInterval:_608.refreshInterval});_60d.spatialReference.wkid=_613.spatialReferences[0];}else{if(_608.type==="KML"){var url=_608.url;if(_58d.id){var _614=_58d.id.findCredential(_592.urlToObject(_5af.arcgisUrl).path);if(_614){var _615=_5af.arcgisUrl.substring(_5af.arcgisUrl.indexOf("//")+2,_5af.arcgisUrl.indexOf("/",_5af.arcgisUrl.indexOf("//")+3));var list=_615.split(".");var _616=list[list.length-2]+"."+list[list.length-1];var pos=url.indexOf(_616);if(pos>-1){url="https://"+_615+url.substring(pos+_616.length);}url+="?token="+_614.token;}}_60d=new _5a3(url,{id:_608.id,visible:(_608.visibility!==null)?_608.visibility:true,outSR:_60b,refreshInterval:_608.refreshInterval});_588.connect(_60d,"onLoad",function(){var _617=function(_618){_587.forEach(_618,function(_619){if(_619.declaredClass==="esri.layers.FeatureLayer"||_619.declaredClass==="esri.layers.MapImageLayer"){_619.setOpacity(_608.opacity);}else{if(_619.declaredClass==="esri.layers.KMLLayer"){if(_619.loaded){_617(_619.getLayers());}else{_588.connect(_619,"onLoad",lang.hitch(this,function(lyr){_617(lyr.getLayers());}));}}}});};if(_608.opacity||_608.opacity===0){_617(_60d.getLayers());}if(_608.visibleFolders){_587.forEach(_60d.folders,function(_61a){if(_587.indexOf(_608.visibleFolders,_61a.id)>-1){_60d.setFolderVisibility(_61a,true);}else{_60d.setFolderVisibility(_61a,false);}},this);}});}else{if(_608.type==="WebTiledLayer"){_60d=new _5a0(_608.templateUrl,{id:_608.id,visible:(_608.visibility!==null)?_608.visibility:true,opacity:_608.opacity,copyright:_608.copyright,fullExtent:_608.fullExtent&&new _594(_608.fullExtent),initialExtent:_608.fullExtent&&new _594(_608.fullExtent),subDomains:_608.subDomains,tileInfo:_608.tileInfo?new _5a6(_608.tileInfo):null,refreshInterval:_608.refreshInterval});_588.connect(_60d,"onLoad",function(){if(_58f.isDefined(_608.minScale)||_58f.isDefined(_608.maxScale)){_60d.setScaleRange(_608.minScale,_608.maxScale);}});}else{if(_608.type==="GeoRSS"){_60d=new _5a4(_608.url,{id:_608.id,opacity:_608.opacity,outSpatialReference:_60b,refreshInterval:_608.refreshInterval});_588.connect(_60d,"onLoad",function(){if(_608.visibility===false){_60d.hide();}var _61b=_60d.getFeatureLayers();_587.forEach(_61b,function(_61c){if(_608.pointSymbol&&_61c.geometryType==="esriGeometryPoint"){_61c.renderer.symbol=_596.fromJson(_608.pointSymbol);}else{if(_608.lineSymbol&&_61c.geometryType==="esriGeometryPolyline"){_61c.renderer.symbol=_596.fromJson(_608.lineSymbol);}else{if(_608.polygonSymbol&&_61c.geometryType==="esriGeometryPolygon"){_61c.renderer.symbol=_596.fromJson(_608.polygonSymbol);}}}if(_58f.isDefined(_608.minScale)||_58f.isDefined(_608.maxScale)){_61c.setScaleRange(_608.minScale,_608.maxScale);}});});}else{if(_608.type=="CSV"&&_608.url){_60d=new _5a1(_608.featureCollection,{infoTemplate:new _598(_608.popupInfo?_608.popupInfo:csv.generateDefaultPopupInfo(_608.featureCollection)),id:_608.id?_608.id:null,outFields:["*"],visible:(_608.visibility!==null)?_608.visibility:true,opacity:_608.opacity,autoGeneralize:true});}else{if(_608.layerDefinition&&!_608.url){var _61d=_58a.fromJson(_58a.toJson(_608));delete _61d.id;delete _61d.opacity;delete _61d.visibility;_60d=new _5a1(_61d,{id:_608.id,opacity:_608.opacity,visible:_608.visibility,outFields:["*"],infoTemplate:_61d.popupInfo&&new _60e(_61d.popupInfo),autoGeneralize:true});}else{if(_608.type==="BingMapsAerial"||_608.type==="BingMapsRoad"||_608.type==="BingMapsHybrid"){if(_60a.bingMapsKey){var _61e=_5a5.MAP_STYLE_AERIAL_WITH_LABELS;if(_608.type==="BingMapsAerial"){_61e=_5a5.MAP_STYLE_AERIAL;}else{if(_608.type==="BingMapsRoad"){_61e=_5a5.MAP_STYLE_ROAD;}}_60d=new _5a5({bingMapsKey:_60a.bingMapsKey,mapStyle:_61e,opacity:_608.opacity,id:_608.id});}else{_608.errors=_608.errors||[];var _61f={message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+_608.type+"]"};_608.errors.push(_61f);}}else{if(_608.resourceInfo&&_608.resourceInfo.mapName){if(_608.resourceInfo.singleFusedMapCache===true&&(_608.baseMapLayer||(_5fb(_608,_609,_60b)&&_600(_608,_60c)))){_60d=_5db(_608);}else{_60d=_5e6(_608);}}else{if(_608.resourceInfo&&_608.resourceInfo.pixelSizeX){if(_608.resourceInfo.singleFusedMapCache===true&&(_608.baseMapLayer||(_5fb(_608,_609,_60b)&&_600(_608,_60c)))){_60d=_5db(_608);}else{_60d=_5f4(_608,_60e);}}else{if(_608.resourceInfo&&_608.resourceInfo.type==="Feature Layer"){_60d=new _5a1(_5da(_608.url),{resourceInfo:_608.resourceInfo,opacity:_608.opacity,visible:_608.visibility,id:_608.id,mode:_58f.isDefined(_608.mode)?_608.mode:_5a1.MODE_ONDEMAND,outFields:["*"],infoTemplate:_608.popupInfo&&new _60e(_608.popupInfo),autoGeneralize:true,refreshInterval:_608.refreshInterval});if(_608.layerDefinition){if(_608.layerDefinition.drawingInfo&&_608.layerDefinition.drawingInfo.renderer){var _620=_597.fromJson(_608.layerDefinition.drawingInfo.renderer);_620.isMaxInclusive=true;_60d.setRenderer(_620);}if(_608.layerDefinition.definitionExpression){_60d.setDefinitionExpression(_608.layerDefinition.definitionExpression);}if(_58f.isDefined(_608.layerDefinition.minScale)){_60d.setMinScale(_608.layerDefinition.minScale);}if(_58f.isDefined(_608.layerDefinition.maxScale)){_60d.setMaxScale(_608.layerDefinition.maxScale);}}}}}}}}}}}}}if(_60d){_60d.arcgisProps={title:_608.title};if(_608.baseMapLayer){if(_608.isReference){_60d._basemapGalleryLayerType="reference";}else{_60d._basemapGalleryLayerType="basemap";}}}return _60d;};function _621(_622,_623,_624,_625){_587.forEach(_622,function(_626,_627){if(_626.url&&!_626.type){if(_627===0||_622[0].layerObject){_626.layerObject=_607(_626,_622,_623,_624,_625);}}else{if(_626.url&&_626.type=="CSV"){_626.layerObject=_607(_626,_622,_623,_624,_625);}else{_626.layerObject=_607(_626,_622,_623,_624,_625);}}});var _628=_587.filter(_622,function(lyr){return !lyr.isReference;});var _629=_587.filter(_622,function(lyr){return !!lyr.isReference;});_622=_628.concat(_629);return _622;};function _62a(_62b){var _62c=null;var _62d=_62b[0];if(_62d.url&&!_62d.type){if(_62d.resourceInfo.spatialReference){_62c=new _591();if(_62d.resourceInfo.spatialReference.wkid){_62c.wkid=_62d.resourceInfo.spatialReference.wkid;}if(_62d.resourceInfo.spatialReference.wkt){_62c.wkt=_62d.resourceInfo.spatialReference.wkt;}}}else{if(_62d.type.indexOf("BingMaps")>-1||_62d.type=="OpenStreetMap"){_62c=new _591({wkid:102100});}else{if(_62d.type=="WMS"){_62c=new _591({wkid:_62d.spatialReferences[0]});}}}return _62c;};function _62e(_62f,_630,_631,_632,_633,_634,_635){_587.forEach(_630,function(_636,_637){if(_636.url&&!_636.type){_636.resourceInfo=_62f[_636.deferredsPos][1];delete _636.deferredsPos;}else{if(_636.url&&_636.type=="CSV"){_636.featureCollection=_632[_636.deferredsPos].results[0];delete _636.deferredsPos;}}});_634=_634||_62a(_630);var _638=[];_587.forEach(_630,function(_639){if(_639.url&&_639.type=="CSV"){_639.deferredsPos=_638.length;_638.push(csv.projectFeatureCollection(_639.featureCollection,_634));}});if(_638.length==0){_630=_621(_630,_631,_634,_635);_633.callback(_630);}else{var _63a=new _58b(_638);_63a.addCallback(function(){_587.forEach(_630,function(_63b){if(_63b.url&&_63b.type=="CSV"){_63b.featureCollection=_638[_63b.deferredsPos].results[0];delete _63b.deferredsPos;}});_630=_621(_630,_631,_634,_635);_633.callback(_630);});}};function _63c(url,_63d){var url2=_5da(url);return _590({url:url2,content:{f:"json"},callbackParamName:"callback",error:function(_63e,io){if(_63e.message){_63e.message+=" [url:"+url2+"]";}else{_63e.message="[url:"+url2+"]";}_63d.push(_63e);_58e.defaults.io.errorHandler(_63e,io);}});};function _63f(_640,_641,_642,_643){var _644=[];var _645=[];var _646=[];var _647=new _589();_587.forEach(_640.operationalLayers,function(_648,_649){if(_648.featureCollection){_587.forEach(_648.featureCollection.layers,function(_64a,idx){var _64b=true;if(_648.visibleLayers){if(_587.indexOf(_648.visibleLayers,idx)==-1){_64b=false;}}_64a.visibility=(_648.visibility&&_64b);_64a.opacity=_648.opacity;_64a.id=(_648.id||("operational"+_649))+"_"+idx;_646.push(_64a);},this);}else{_646.push(_648);}});_587.forEach(_640.baseMap.baseMapLayers,function(_64c,_64d){_64c.baseMapLayer=true;_64c.id=_64c.id||("base"+_64d);_644.push(_64c);});_587.forEach(_646,function(_64e,_64f){_64e.id=_64e.id||("operational"+_64f);_644.push(_64e);});_587.forEach(_644,function(_650){if(_650.url&&!_650.type){_650.deferredsPos=_645.length;_650.errors=[];_645.push(_63c(_650.url,_650.errors));}else{if(_650.url&&_650.type=="CSV"){_650.deferredsPos=_645.length;_645.push(csv.buildCSVFeatureCollection(_650));}}});if(_645.length==0){_642=_642||_62a(_644);_644=_621(_644,_641,_642,_643);_647.callback(_644);}else{var _651=new _58b(_645);_651.addCallback(function(_652){_62e(_652,_644,_641,_645,_647,_642,_643);});}return _647;};function _653(_654,_655){if(_655.version<=10.1&&_654){var i,id=parseInt(_655.url.substring(_655.url.lastIndexOf("/")+1,_655.url.length));for(i=_654.length-1;i>=0;i--){if(_654[i].id==id){if(_655.minScale==0&&_654[i].minScale>0){_655.minScale=_654[i].minScale;}else{if(_655.minScale>0&&_654[i].minScale==0){_655.minScale=_655.minScale;}else{if(_655.minScale>0&&_654[i].minScale>0){_655.minScale=Math.min(_655.minScale,_654[i].minScale);}}}_655.maxScale=Math.max(_655.maxScale||0,_654[i].maxScale||0);if(_654[i].parentLayerId>-1){id=_654[i].parentLayerId;}else{break;}}}}};function _656(_657,_658,_659,map){var url=_657.url;var _65a=_657.__popups;var ids=_657.__popupIds;var urls=_657.__popupUrls;var _65b=_657.__popupWhereClauses;var _65c=_657.__popupMinScales;var _65d=_657.__popupMaxScales;var _65e=_657.__resourceInfo;var _65f=[];_587.forEach(_65a,function(_660,_661){if(!_660){return;}var _662,_663=[];_587.forEach(_660.fieldInfos,function(item){if(item.fieldName.toLowerCase()!=="shape"){_663.push(item.fieldName);}});if(_657.dynamicLayerInfos&&_657.dynamicLayerInfos.length>0){var _664=_587.filter(_657.dynamicLayerInfos,function(item){return ids[_661]==item.id;})[0].source;_662=new _5a1(url+"/dynamicLayer",{id:_657.id+"_"+ids[_661],source:_664,outFields:_663,mode:_5a1.MODE_SELECTION,infoTemplate:_660&&new _659(_660),drawMode:false,visible:_657.visible,autoGeneralize:true});if(_662.loaded){if(_65b[_661].length>0){_662.setDefinitionExpression(_65b[_661]);}if(esri.isDefined(_65c[_661])&&esri.isDefined(_65d[_661])){_662.setScaleRange(_65c[_661],_65d[_661]);}}else{_588.connect(_662,"onLoad",function(_665){if(_65b[_661].length>0){_662.setDefinitionExpression(_65b[_661]);}if(esri.isDefined(_65c[_661])&&esri.isDefined(_65d[_661])){_662.setScaleRange(_65c[_661],_65d[_661]);}});}}else{var i,_666=null;if(_658){for(i=0;i<_658.length;i++){if(_658[i].id===ids[_661]){_666=_658[i];break;}}}var _667=url+"/"+ids[_661];if(urls[_661].length){_667=urls[_661];}_662=new _5a1(_5da(_667),{id:_657.id+"_"+ids[_661],outFields:_663,mode:_5a1.MODE_SELECTION,infoTemplate:_660&&new _659(_660),drawMode:false,visible:_657.visible,resourceInfo:_666,autoGeneralize:true});if(_662.loaded){_662.setScaleRange(_657.minScale,_657.maxScale);if(_65b[_661].length>0){_662.setDefinitionExpression(_65b[_661]);}}else{_588.connect(_662,"onLoad",function(_668){_668.setScaleRange(_657.minScale,_657.maxScale);if(_65b[_661].length>0){_662.setDefinitionExpression(_65b[_661]);}});}if(_662.loaded){_653(_65e.layers,_662);}else{_588.connect(_662,"onLoad",function(_669){_653(_65e.layers,_669);});}}_65f.push(_662);});if(_65f.length>0){var _66a=function(_66b,_66c){_587.forEach(_66b,function(_66d){if(_66c){_66d.show();}else{_66d.hide();}});};_588.connect(_657,"onVisibilityChange",lang.hitch(this,_66a,_65f));var _66e=function(_66f,_670,_671){if(_66f.id===_671.id){_587.forEach(_670,function(_672){map.removeLayer(_672);});}};_588.connect(map,"onLayerRemove",lang.hitch(this,_66e,_657,_65f));}delete _657.__popups;delete _657.__popupIds;delete _657.__popupUrls;delete _657.__popupWhereClauses;delete _657.__popupMinScales;delete _657.__popupMaxScales;delete _657.__resourceInfo;return _65f;};function _673(_674){return _590({url:_5da(_674.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}});};function _675(_676,map,_677){var _678=[];_587.forEach(_676,function(_679){var _67a=_679.__popups;if(_67a&&_67a.length>1&&_679.version>=10){_679.__deferredsPos=_678.length;_678.push(_673(_679));}});var _67b=[];if(_678.length>0){var _67c=new _58b(_678);_67c.addCallback(function(_67d){_587.forEach(_676,function(_67e){if(_67e.__popups&&_67e.__popups.length>0){if(_67e.__deferredsPos||_67e.__deferredsPos===0){var _67f=_67d[_67e.__deferredsPos][1];_67b=_67b.concat(_656(_67e,_67f.layers,_677,map));delete _67e.__deferredsPos;}else{_67b=_67b.concat(_656(_67e,null,_677,map));}}});map.addLayers(_67b);});}else{_587.forEach(_676,function(_680){if(_680.__popups&&_680.__popups.length>0){_67b=_67b.concat(_656(_680,null,_677,map));}});map.addLayers(_67b);}};function _681(_682){_587.forEach(_682,function(_683){var _684=_683.layer;if(_684.toJson){var json=_684.toJson();if(json.featureSet&&_684.name.indexOf("Text")>-1){_587.forEach(json.featureSet.features,function(_685,idx){if(_685.attributes.TEXT){var _686=_684.graphics[idx];_686.symbol.setText(_685.attributes.TEXT);if(_685.symbol.horizontalAlignment){_686.symbol.align=_685.symbol.horizontalAlignment;}_686.setSymbol(_686.symbol);_686.setAttributes(_685.attributes);}},this);}}});};function _687(_688){var _689=6;_587.forEach(_688,function(_68a){var _68b=_68a.renderer;if(_68b){if(_68b.declaredClass==="esri.renderer.SimpleRenderer"){var _68c=_68b.symbol;if(_68c&&_68c.xoffset){_689=Math.max(_689,Math.abs(_68c.xoffset));}if(_68c&&_68c.yoffset){_689=Math.max(_689,Math.abs(_68c.yoffset));}}else{if(_68b.declaredClass==="esri.renderer.UniqueValueRenderer"||_68b.declaredClass==="esri.renderer.ClassBreaksRenderer"){_587.forEach(_68b.infos,function(info){var _68d=info.symbol;if(_68d&&_68d.xoffset){_689=Math.max(_689,Math.abs(_68d.xoffset));}if(_68d&&_68d.yoffset){_689=Math.max(_689,Math.abs(_68d.yoffset));}});}}}});return _689;};function _68e(evt){var map=this,_68f=map.infoWindow,_690=evt.graphic;if(!map.loaded){return;}_68f.hide();_68f.clearFeatures();var _691=[];_587.forEach(map.graphicsLayerIds,function(_692){var _693=map.getLayer(_692);if(_693&&_693.declaredClass.indexOf("FeatureLayer")!==-1&&_693.loaded&&_693.visible){_693.clearSelection();if(_693.infoTemplate&&!_693.suspended){_691.push(_693);}}});_587.forEach(map.layerIds,function(_694){var _695=map.getLayer(_694);if(_695&&_695.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1&&_695.loaded&&_695.visible&&_695.infoTemplate){_691.push(_695);}});_690=(_690&&_690.getInfoTemplate())?_690:null;if(!_691.length&&!_690){return;}var _696=_687(_691);var _697=evt.screenPoint,_698=map.toMap(new _593(_697.x-_696,_697.y+_696)),_699=map.toMap(new _593(_697.x+_696,_697.y-_696)),_69a=new _594(_698.x,_698.y,_699.x,_699.y,map.spatialReference);var _69b=new _59a();_69b.geometry=_69a;_69b.timeExtent=map.timeExtent;var _69c=true;var _69d=_587.map(_691,function(_69e){var dfd;if(_69e.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1){_69c=false;var _69f={};_69f.rasterAttributeTableFieldPrefix="Raster.";_69f.returnDomainValues=true;dfd=_69e.queryVisibleRasters(_69b,_69f);dfd.addCallback(function(){var _6a0=_69e.getVisibleRasters();return _6a0;});}else{dfd=_69e.selectFeatures(_69b);dfd.addCallback(function(){var _6a1=_69e.getSelectedFeatures();return _6a1;});}return dfd;});if(_690){var dfd=new _589();dfd.callback([_690]);_69d.splice(0,0,dfd);}var _6a2=_587.some(_69d,function(dfd){return dfd.fired===-1;});if(!_6a2){var _6a3=_690?1:0;_587.forEach(_691,function(_6a4){if(_6a4.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1){_6a3=_6a3+_6a4.getVisibleRasters().length;}else{_6a3=_6a3+_6a4.getSelectedFeatures().length;}});if(!_6a3){return;}}_68f.setFeatures(_69d);_68f.show(evt.mapPoint,{closestFirst:_69c});};function _6a5(_6a6,_6a7){var _6a8=(_6a7.mapOptions||{}),_6a9;if(!_6a8.infoWindow){_6a9=new _599(null,_58c.create("div"));_6a8.infoWindow=_6a9;}if(!_58f.isDefined(_6a8.showInfoWindowOnClick)){_6a8.showInfoWindowOnClick=false;}var map=new Map(_6a6,_6a8);_588.connect(map,"onLayersAddResult",_681);return map;};function _6aa(_6ab,_6ac,_6ad,_6ae,_6af,_6b0){var map,_6b1,errs;if(_6ae.map){map=_6ae.map;_6b1=_6ae.clickEventHandle;errs=_6ae.errors;}else{map=_6a5(_6ae,_6af);if(!(_6af.ignorePopups||_6af.disableClickBehavior)){_6b1=_588.connect(map,"onClick",_68e);}}if(_6af.ignorePopups){_587.forEach(_6ab,function(_6b2){delete _6b2.infoTemplate;});}map.addLayers(_6ab);if(!_6af.ignorePopups){_675(_6ab,map,_6af._clazz);}var _6b3=errs||[];_587.forEach(_6ac,function(_6b4){_6b3=_6b3.concat(_6b4.errors);},this);if(!map.loaded){_588.connect(map,"onLoad",function(){_6b0.callback({map:map,itemInfo:_6ad,errors:_6b3,clickEventHandle:_6b1,clickEventListener:_68e});});}else{_6b0.callback({map:map,itemInfo:_6ad,errors:_6b3,clickEventHandle:_6b1,clickEventListener:_68e});}};function _6b5(_6b6,_6b7,_6b8,_6b9,_6ba){try{var _6bb=_6b8.mapOptions||{};_6b8.mapOptions=_6bb;var card=_6b6.item;var _6bc=[];_587.forEach(_6ba,function(_6bd){if(lang.isArray(_6bd.layerObject)){_587.forEach(_6bd.layerObject,function(l){_6bc.push(l);});}else{_6bc.push(_6bd.layerObject);}});if(!_6bc[0]){var msg="";if(_6ba[0].errors&&_6ba[0].errors.length){msg=" ("+_6ba[0].errors[0].message+")";}_6b9.errback(new Error(_5ae.arcgis.utils.baseLayerError+msg));return;}_6bc=_587.filter(_6bc,_58f.isDefined);if(card){if(card.extent&&card.extent.length){if(!_6bb.extent){var _6be=new _594(card.extent[0][0],card.extent[0][1],card.extent[1][0],card.extent[1][1],new _591({wkid:4326}));var _6bf=_6bc[0].spatialReference;if(_6bf.wkid===4326){_6bb.extent=_6be;_6aa(_6bc,_6ba,_6b6,_6b7,_6b8,_6b9);}else{if(_6bf.wkid===102100||_6bf.wkid===102113||_6bf.wkid===3857){_6be.xmin=Math.max(_6be.xmin,-180);_6be.xmax=Math.min(_6be.xmax,180);_6be.ymin=Math.max(_6be.ymin,-89.99);_6be.ymax=Math.min(_6be.ymax,89.99);_6bb.extent=_595.geographicToWebMercator(_6be);_6aa(_6bc,_6ba,_6b6,_6b7,_6b8,_6b9);}else{if(_6b8.geometryServiceURL||_58e.defaults.geometryService){var gs;if(_6b8.geometryServiceURL){gs=new _59b(_6b8.geometryServiceURL);}else{gs=_58e.defaults.geometryService;}gs.project([_6be],_6bf,function(_6c0){var _6c1=_6c0[0];_6bb.extent=_6bb.extent||_6c1;_6aa(_6bc,_6ba,_6b6,_6b7,_6b8,_6b9);});}else{_6b9.errback(new Error(_5ae.arcgis.utils.geometryServiceError));}}}}else{_6aa(_6bc,_6ba,_6b6,_6b7,_6b8,_6b9);}}else{_6aa(_6bc,_6ba,_6b6,_6b7,_6b8,_6b9);}}else{_6aa(_6bc,_6ba,_6b6,_6b7,_6b8,_6b9);}}catch(err){_6b9.errback(err);}};function _6c2(_6c3){var _6c4=[];var _6c5=_6c3.baseMap.baseMapLayers.concat(_6c3.operationalLayers);_587.forEach(_6c5,function(_6c6,_6c7){var _6c8={};if(_6c6.featureCollection&&_6c6.type!=="CSV"){if(_6c6.featureCollection.showLegend===true){_587.forEach(_6c6.featureCollection.layers,function(_6c9){if(_6c9.showLegend!==false){_6c8={"layer":_6c9.layerObject,"title":_6c6.title,"defaultSymbol":(_6c9.renderer&&_6c9.renderer.defaultSymbol&&_6c9.renderer.defaultLabel)?true:false};if(_6c6.featureCollection.layers.length>1){_6c8.title+=" - "+_6c9.layerDefinition.name;}_6c4.push(_6c8);}});}}else{if((_6c6.baseMapLayer&&_6c6.showLegend===true&&_6c6.layerObject)||(!_6c6.baseMapLayer&&_6c6.showLegend!==false&&_6c6.layerObject)){var rend=_6c6.layerObject.renderer;var _6ca=(!rend||(rend&&rend.defaultSymbol&&rend.defaultLabel))?true:false;if((_6c6.layerObject.version<10.1&&(_6c6.layerObject instanceof _59d||_6c6.layerObject instanceof _59c))||(_6c6.layerObject instanceof esri.layers.ArcGISImageServiceLayer)){_6ca=true;}_6c8={"layer":_6c6.layerObject,"title":_6c6.title,"defaultSymbol":_6ca};if(_6c6.layers){var _6cb=_587.map(_587.filter(_6c6.layers,function(lyr){return (lyr.showLegend===false);}),function(lyr){return lyr.id;});if(_6cb.length){_6c8.hideLayers=_6cb;}}_6c4.push(_6c8);}}});return _6c4;};function _6cc(_6cd,_6ce,_6cf,_6d0){if(!_6d0.itemData.operationalLayers||_6d0.itemData.operationalLayers.length===0){_5ba(_6d0,_6ce).addCallback(function(_6d1){_63f(_6d1.itemData,_6ce).addCallback(lang.hitch(null,_6b5,_6d1,_6cd,_6ce,_6cf));});}else{var _6d2=new _589(),_6d3=_6d0.itemData.baseMap.baseMapLayers.slice(0),_6d4=_587.filter(_6d0.itemData.baseMap.baseMapLayers,function(item){return !item.isReference;}),_6d5={item:_6d0.item,itemData:{baseMap:{baseMapLayers:_6d4}}};_6d0.itemData.baseMap.baseMapLayers=_587.filter(_6d0.itemData.baseMap.baseMapLayers,function(item){return item.isReference;});_5ba(_6d5,_6ce).addCallback(function(_6d6){_63f(_6d6.itemData,_6ce).addCallback(lang.hitch(null,_6b5,_6d6,_6cd,_6ce,_6d2));});_6d2.then(function(_6d7){_5ba(_6d0,_6ce).addCallback(function(_6d8){_63f(_6d8.itemData,_6ce,_6d7.map.spatialReference,_6d4).addCallback(function(_6d9){_6d8.itemData.baseMap.baseMapLayers=_6d3;_6b5(_6d8,_6d7,_6ce,_6cf,_6d9);});});},lang.hitch(_6cf,_6cf.errback));}};function _6da(_6db){if(_5af._arcgisUrl&&_5af._arcgisUrl.length>0){_5af.arcgisUrl=_5af._arcgisUrl;}var url=_5af.arcgisUrl+"/"+_6db;var _6dc={},_6dd=new _589();_590({url:url,content:{f:"json"},callbackParamName:"callback",load:function(_6de){_6dc.item=_6de;_590({url:url+"/data",content:{f:"json"},callbackParamName:"callback",load:function(_6df){_6dc.itemData=_6df;_6dd.callback(_6dc);},error:function(_6e0){_6dd.errback(_6e0);}});},error:function(_6e1){_6dd.errback(_6e1);}});return _6dd;};function _6e2(arg1,_6e3,_6e4){var _6e5=new _589();_6e4=_6e4||{};var _6e6=_6e4.infoTemplateClass;_6e4._clazz=(_6e6&&(lang.isObject(_6e6)?_6e6:lang.getObject(_6e6)))||_598;if(lang.isString(arg1)){_6da(arg1).addCallback(lang.hitch(null,_6cc,_6e3,_6e4,_6e5)).addErrback(lang.hitch(_6e5,_6e5.errback));}else{_6cc(_6e3,_6e4,_6e5,arg1);}return _6e5;};function _6e7(_6e8){if(_6e8&&_6e8.itemInfo&&_6e8.itemInfo.itemData){return _6c2(_6e8.itemInfo.itemData);}else{return [];}};_5af={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:_6da,createMap:_6e2,getLegendLayers:_6e7,_arcgisUrl:null,_getItemProps:_5ba,_getItemData:_5b0,_getBingKey:_5b3,_processFSItemProperties:_5b8,_getLayers:_63f,_preBuildLayerObjects:_62e,_buildLayerObjects:_621,_preCreateMap:_6b5,_getMapSR:_62a,_createMap:_6aa,_addSelectionLayers:_675,_createSelectionFeatureLayers:_656,_getServiceInfo:_63c,_getLayersInfo:_673,_initLayer:_607,_loadAsCached:_5db,_loadAsDynamic:_5e6,_processPopups:_5cb,_onLayersAddResult:_681,_sameSpatialReferenceAsBasemap:_5fb,_sameTilingSchemeAsBasemap:_600,_showPopup:_68e,_calculateClickTolerance:_687,_getVisibleFeatureLayers:_5df,_updateLayerScaleInfo:_653,_checkUrl:_5da,_isHostedService:_5d6,_isAgolService:_5d9,_getLegendLayers:_6c2};lang.setObject("arcgis.utils",_5af,_58d);return _5af;});},"esri/layers/FeatureTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/graphic"],function(_6e9,lang,has,_6ea,_6eb,_6ec){var _6ed=_6e9(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(json){if(json&&lang.isObject(json)){this.name=json.name;this.description=json.description;this.drawingTool=json.drawingTool;var _6ee=json.prototype;this.prototype=new _6ec(_6ee.geometry,null,_6ee.attributes);}},toJson:function(){return _6eb.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()});}});lang.mixin(_6ed,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});if(has("extend-esri")){lang.setObject("layers.FeatureTemplate",_6ed,_6ea);}return _6ed;});},"esri/dijit/BasemapGallery":function(){define(["require","dojo/_base/declare","dojo/_base/array","dojo/_base/connect","dojo/_base/lang","dojo/_base/kernel","dojo/_base/sniff","dojo/has","dojo/query","dojo/DeferredList","dojo/dom","dojo/dom-construct","dojo/dom-class","dijit/_Widget","dijit/_Templated","esri/kernel","esri/urlUtils","esri/request","esri/geometry/Extent","esri/virtualearth/VETiledLayer","esri/layers/OpenStreetMapLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/WebTiledLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/ImageServiceParameters","esri/dijit/Basemap","esri/dijit/_EventedWidget","dojo/text!esri/dijit/templates/BasemapGallery.html"],function(_6ef,_6f0,_6f1,_6f2,lang,_6f3,_6f4,has,_6f5,_6f6,dom,_6f7,_6f8,_6f9,_6fa,_6fb,_6fc,_6fd,_6fe,_6ff,_700,_701,_702,_703,_704,_705,_706,_707,_708){var BMG=_6f0([_707,_6f9,_6fa],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:true,templateString:_708,basePath:_6ef.toUrl("esri/dijit")+"/",loaded:false,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:false,_selectedBasemap:null,_selectBasemapInProgress:false,_eventMap:{"load":true,"selection-change":true,"add":["basemap"],"remove":["basemap"],"error":["message"]},constructor:function(_709,_70a){_709=_709||{};if(!_709.map){}this.map=_709.map;this._hasUI=_70a?true:false;this.bingMapsKey=(_709.bingMapsKey&&_709.bingMapsKey.length>0)?_709.bingMapsKey:null;this.showArcGISBasemaps=(_709.showArcGISBasemaps===false)?false:true;this.basemaps=_709.basemaps||[];this.basemapIds=_709.basemapIds;this.referenceIds=_709.referenceIds;this.basemapsGroup=_709.basemapsGroup;this.arcgisUrl=_6fb.dijit._arcgisUrl;if(_709.portalUrl){this.arcgisUrl=_709.portalUrl+"/sharing/rest";}if(this.arcgisUrl.indexOf("://")<0){this.arcgisUrl=window.location.protocol+"//"+this.arcgisUrl;}else{if(window.location.protocol==="https:"){this.arcgisUrl=this.arcgisUrl.replace("http:","https:");}}this.init();},init:function(){this.inherited(arguments);_6f1.forEach(this.basemaps,function(_70b,i){if(!_70b.id||_70b.id.length===0){_70b.id=this._getUniqueId();}_6f1.forEach(_70b.layers,function(_70c){_70c.opacity=(_70c.opacity>=0)?_70c.opacity:1;_70c.visibility=true;},this);},this);if(this.basemapIds&&this.basemapIds.length>0){_6f1.forEach(this.basemapIds,function(_70d){var _70e=this.map.getLayer(_70d);_70e._basemapGalleryLayerType="basemap";},this);}if(this.referenceIds&&this.referenceIds.length>0){_6f1.forEach(this.referenceIds,function(_70f){var _710=this.map.getLayer(_70f);_710._basemapGalleryLayerType="reference";},this);}if(this.basemapsGroup&&((this.basemapsGroup.owner&&this.basemapsGroup.title)||this.basemapsGroup.id)){this._findCustomBasemapsGroup(lang.hitch(this,"_handleArcGISBasemapsResponse"));}else{if(this.showArcGISBasemaps){this._findArcGISBasemapsGroup(lang.hitch(this,"_handleArcGISBasemapsResponse"));}else{this._finishStartup();}}},startup:function(){if(this.loaded){this._refreshUI();}else{_6f2.connect(this,"onLoad",lang.hitch(this,function(){this._refreshUI();}));}},select:function(id){this._select(id);},getSelected:function(){return this._selectedBasemap;},get:function(id){var i;for(i=0;i<this.basemaps.length;i++){if(this.basemaps[i].id==id){return this.basemaps[i];}}return null;},add:function(_711){if(_711&&!_711.id){_711.id=this._getUniqueId();this.basemaps.push(_711);this._refreshUI();this.onAdd(_711);return true;}else{if(_711&&this._isUniqueId(_711.id)){this.basemaps.push(_711);this._refreshUI();this.onAdd(_711);return true;}}return false;},remove:function(id){var i;for(i=0;i<this.basemaps.length;i++){var _712=this.basemaps[i];if(_712.id===id){if(this._selectedBasemap&&this._selectedBasemap.id===_712.id){this._selectedBasemap=null;}this.basemaps.splice(i,1);this._refreshUI();this.onRemove(_712);return _712;}}return null;},onLoad:function(){},onSelectionChange:function(){},onAdd:function(_713){},onRemove:function(_714){},onError:function(msg){},_defaultBasemapGalleryGroupQuery:"title:\"ArcGIS Online Basemaps\" AND owner:esri",_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=true;this.onLoad();if(this.map.layerIds.length===0&&this.basemaps.length>0&&!this._selectBasemapInProgress){this._select(this.basemaps[0].id);}},_findCustomBasemapsGroup:function(_715){if(this.basemapsGroup&&this.basemapsGroup.id){this._findArcGISBasemaps(this.basemapsGroup.id,_715);}else{this._basemapGalleryGroupQuery="title:\""+this.basemapsGroup.title+"\" AND owner:"+this.basemapsGroup.owner;this._findArcGISBasemapsGroup(_715);}},_findArcGISBasemapsGroup:function(_716){if(!this._basemapGalleryGroupQuery){var url=this.arcgisUrl+"/accounts/self";var _717={};_717.f="json";_717.culture=_6f3.locale;_6fd({url:url,content:_717,callbackParamName:"callback",load:lang.hitch(this,function(_718,args){if(_718&&_718.basemapGalleryGroupQuery){this._basemapGalleryGroupQuery=_718.basemapGalleryGroupQuery;}else{this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery;}this._findArcGISBasemapsGroupContent(_716);}),error:lang.hitch(this,function(_719,args){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery;})});}else{this._findArcGISBasemapsGroupContent(_716);}},_findArcGISBasemapsGroupContent:function(_71a){var _71b=lang.hitch(this,"_findArcGISBasemaps");var url=this.arcgisUrl+"/community/groups";var _71c={};_71c.q=this._basemapGalleryGroupQuery;_71c.f="json";_6fd({url:url,content:_71c,callbackParamName:"callback",load:lang.hitch(this,function(_71d,args){if(_71d.results.length>0){_71b(_71d.results[0].id,_71a);}else{var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);}}),error:lang.hitch(this,function(_71e){var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);})});},_findArcGISBasemaps:function(_71f,_720){var url=this.arcgisUrl+"/search";var _721={};_721.q="group:"+_71f+" AND type:\"web map\"";_721.sortField="name";_721.sortOrder="desc";_721.num=50;_721.f="json";_6fd({url:url,content:_721,callbackParamName:"callback",load:lang.hitch(this,function(_722,args){if(_722.results.length>0){_720(_722.results);}else{var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);}}),error:lang.hitch(this,function(_723,args){var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);})});},_handleArcGISBasemapsResponse:function(_724){if(_724.length>0){_6f1.forEach(_724,function(item,i){if(this.bingMapsKey||(!this.bingMapsKey&&item.title&&item.title.indexOf("Bing Maps")==-1)){var _725={};_725.id=this._getUniqueId();_725.title=item.title;_725.thumbnailUrl="";if(item.thumbnail&&item.thumbnail.length){_725.thumbnailUrl=(this.arcgisUrl+"/content/items/"+item.id+"/info/"+item.thumbnail);if(_6fb.id){var _726=_6fb.id.findCredential(_6fc.urlToObject(this.arcgisUrl).path);if(_726){_725.thumbnailUrl+="?token="+_726.token;}}}_725.itemId=item.id;var _727=new _706(_725,this);this.basemaps.splice(0,0,_727);}},this);this._finishStartup();}},_refreshUI:function(){if(this._hasUI){_6f7.empty(this.flowContainer);_6f1.forEach(this.basemaps,function(_728,i){if(!_728.id){_728.id="basemap_"+i;}this.flowContainer.appendChild(this._buildNodeLayout(_728));},this);_6f7.create("br",{style:{clear:"both"}},this.flowContainer);this._markSelected(this._selectedBasemap);}},_buildNodeLayout:function(_729){var nId="galleryNode_"+_729.id;var n=_6f7.create("div",{id:nId,"class":"esriBasemapGalleryNode"});var _72a=_6f7.create("a",{href:"javascript:void(0);"},n);_6f2.connect(_72a,"onclick",lang.hitch(this,"_onNodeClick",_729));if(_729.thumbnailUrl){_6f7.create("img",{"class":"esriBasemapGalleryThumbnail",src:_729.thumbnailUrl},_72a);}else{_6f7.create("img",{"class":"esriBasemapGalleryThumbnail",src:this.basePath.toString()+"images/transparent.gif"},_72a);}var _72b=_6f7.create("div",{"class":"esriBasemapGalleryLabelContainer"},n);var _72c=_729.title||"";_6f7.create("span",{innerHTML:_72c,alt:_72c,title:_72c},_72b);return n;},_onNodeClick:function(_72d,e){e.preventDefault();this._markSelected(_72d);this.select(_72d.id);},_markSelected:function(_72e){if(_72e){_6f1.forEach(_6f3.query(".esriBasemapGallerySelectedNode",this.domNode),function(node){_6f8.remove(node,"esriBasemapGallerySelectedNode");});var _72f=dom.byId("galleryNode_"+_72e.id);if(_72f){_6f8.add(_72f,"esriBasemapGallerySelectedNode");}}},_select:function(id){this._selectBasemapInProgress=true;var _730=this.get(id);if(_730){if(_730.layers){this._getServiceInfos(_730);}else{var _731=_730.getLayers();if(lang.isArray(_731)){this._getServiceInfos(_730);}else{_731.addCallback(lang.hitch(this,function(_732){this._getServiceInfos(_730);}));}}this._markSelected(_730);}else{this._selectBasemapInProgress=false;}},_getServiceInfos:function(_733){if(location.protocol=="https:"){_6f1.forEach(_733.layers,function(_734){if(this._isAgolService(_734.url)||this._isHostedService(_734.url)){_734.url=_734.url.replace("http:","https:");}},this);}this._selectedBasemap=_733;var _735=[];_6f1.forEach(_733.layers,function(_736){if(_736.url&&_736.url.length>0&&!_736.isReference&&!_736.type){_736.deferredsPos=_735.length;_735.push(this._getServiceInfo(_736.url));}},this);if(_735.length>0){var _737=new _6f6(_735);_737.addCallback(lang.hitch(this,function(_738){var _739=null;_6f1.forEach(_733.layers,function(_73a){if(_73a.deferredsPos===0||_73a.deferredsPos){_73a.serviceInfoResponse=_738[_73a.deferredsPos][1];var ext=_73a.serviceInfoResponse.fullExtent;if(!ext){ext=_73a.serviceInfoResponse.extent;}if(!_739){_739=new _6fe(ext);}else{_739=_739.union(new _6fe(ext));}}},this);if(this.map.extent){var _73b=this._getIntersectionPercent(_739,this.map.extent);if(_73b<5){this.map.setExtent(_739,true);}}this._switchBasemapLayers(_733);this._updateReferenceLayer(_733);}));}else{this._switchBasemapLayers(_733);this._updateReferenceLayer(_733);}},_switchBasemapLayers:function(_73c){var _73d=_73c.layers;if(this.map.layerIds.length>0&&this.map.getNumLevels()===0&&(_73d[0].type==="OpenStreetMap"||(_73d[0].type&&_73d[0].type.indexOf("BingMaps")>-1)||_73d[0].type==="WebTiledLayer")){var msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}_6f1.forEach(_73d,function(_73e){if(!_73e.isReference&&_73e.type&&_73e.type.indexOf("BingMaps")>-1&&!this.bingMapsKey){var msg="esri.dijit.BasemapGallery: Invalid Bing Maps key.";this.onError(msg);return;}},this);this._removeBasemapLayers();var _73f=0;_6f1.forEach(_73d,function(_740){if(!_740.isReference){var _741,msg;if(_740.type==="OpenStreetMap"){if(this.map.layerIds.length>0&&this.map.getNumLevels()===0){msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}_741=new _700({id:"layer_osm",opacity:_740.opacity});}else{if(_740.type&&_740.type.indexOf("BingMaps")>-1){if(this.map.layerIds.length>0&&this.map.getNumLevels()===0){msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}var _742=_6ff.MAP_STYLE_AERIAL_WITH_LABELS;if(_740.type=="BingMapsAerial"){_742=_6ff.MAP_STYLE_AERIAL;}else{if(_740.type=="BingMapsRoad"){_742=_6ff.MAP_STYLE_ROAD;}}_741=new _6ff({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:_742,opacity:_740.opacity});}else{if(_740.type=="WebTiledLayer"){if(this.map.layerIds.length>0&&this.map.getNumLevels()===0){msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}_741=new _703(_740.url,{visible:_740.visibility,opacity:_740.opacity,copyright:_740.copyright,fullExtent:_740.fullExtent,initialExtent:_740.initialExtent||_740.fullExtent,subDomains:_740.subDomains,tileInfo:_740.tileInfo,tileServers:_740.tileServers});}else{if(_740.serviceInfoResponse&&_740.serviceInfoResponse.mapName){if((this.map.layerIds.length===0||this.map.getNumLevels()>0)&&_740.serviceInfoResponse.singleFusedMapCache===true){_741=this._loadAsCached(_740);}else{_741=this._loadAsDynamic(_740);}}else{if(_740.serviceInfoResponse&&_740.serviceInfoResponse.pixelSizeX){var _743=new _705();_743.bandIds=_740.bandIds;if(!_740.bandIds&&_740.serviceInfoResponse.bandCount&&parseInt(_740.serviceInfoResponse.bandCount)>3){_743.bandIds=[0,1,2];}_741=new _704(_740.url,{resourceInfo:_740.serviceInfoResponse,opacity:_740.opacity,visible:_740.visibility,imageServiceParameters:_743});}}}}}if(_741){_741._basemapGalleryLayerType="basemap";this.map.addLayer(_741,_73f);_73f++;}}},this);this._selectBasemapInProgress=false;this.onSelectionChange();},_removeBasemapLayers:function(){var _744=this.map.layerIds;var _745=[];_6f1.forEach(_744,function(id){var _746=this.map.getLayer(id);if(_746._basemapGalleryLayerType==="basemap"){_745.push(_746);}},this);if(_745.length===0&&_744.length>0){_745.push(this.map.getLayer(_744[0]));}if(_745.length>0){_6f1.forEach(_745,function(_747){this.map.removeLayer(_747);},this);}},_updateReferenceLayer:function(_748){var i;this._removeReferenceLayer();for(i=0;i<_748.layers.length;i++){if(_748.layers[i].isReference===true){this._addReferenceLayer(_748.layers[i]);}}},_removeReferenceLayer:function(){var i;for(i=this.map.layerIds.length-1;i>=0;i--){var id=this.map.layerIds[i];var _749=this.map.getLayer(id);if(_749._basemapGalleryLayerType==="reference"){this.map.removeLayer(_749);}}},_addReferenceLayer:function(_74a){this._getServiceInfo(_74a.url,lang.hitch(this,"_handleReferenceServiceInfoResponse",_74a));},_handleReferenceServiceInfoResponse:function(_74b,_74c,args){var _74d;_74b.serviceInfoResponse=_74c;if(_74c&&_74c.mapName){if(_74c.singleFusedMapCache===true){_74d=this._loadAsCached(_74b);}else{_74d=this._loadAsDynamic(_74b);}}else{if(_74c&&_74c.pixelSizeX){var _74e=new _705();_74e.bandIds=_74b.bandIds;if(!_74b.bandIds&&_74c.bandCount&&parseInt(_74c.bandCount)>3){_74e.bandIds=[0,1,2];}_74d=new _704(_74b.url,{resourceInfo:_74c,opacity:_74b.opacity,visible:_74b.visibility,imageServiceParameters:_74e});}}if(_74d){_74d._basemapGalleryLayerType="reference";this.map.addLayer(_74d);}},_getServiceInfo:function(url,_74f){var _750={};_750.f="json";var _751=_6fd({url:url,content:_750,callbackParamName:"callback",load:function(_752,args){if(_74f){_74f(_752,args);}},error:lang.hitch(this,function(_753,args){var msg="esri.dijit.BasemapGallery: service not accessible.";this.onError(msg);})});return _751;},_loadAsCached:function(_754){var _755=[];if(!_754.displayLevels){_755=_6f1.map(_754.serviceInfoResponse.tileInfo.lods,function(lod){return lod.level;});}var _756=new _701(_754.url,{resourceInfo:_754.serviceInfoResponse,opacity:_754.opacity,visible:_754.visibility,displayLevels:_754.displayLevels||_755});return _756;},_loadAsDynamic:function(_757){var _758=new _702(_757.url,{resourceInfo:_757.serviceInfoResponse,opacity:_757.opacity,visible:_757.visibility});if(_757.visibleLayers){_758.setVisibleLayers(_757.visibleLayers);}return _758;},_getIntersectionPercent:function(_759,_75a){var _75b=_75a.intersects(_759);if(_75b){var _75c=_75b.getWidth()*_75b.getHeight();var _75d=_75a.getWidth()*_75a.getHeight();return (_75c/_75d)*100;}else{return 0;}},_getIds:function(){var ids=[];_6f1.forEach(this.basemaps,function(_75e){ids.push(_75e.id);},this);return ids;},_getUniqueId:function(){var _75f=","+this._getIds().toString()+",";var _760=0;while(true){if(_75f.indexOf(",basemap_"+_760+",")>-1){_760++;}else{return "basemap_"+_760;}}},_isUniqueId:function(id){var _761=","+this._getIds().toString()+",";if(_761.indexOf(","+id+",")===-1){return true;}return false;},_isAgolService:function(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);},_isHostedService:function(url){if(!url){return false;}return (url.indexOf(".arcgis.com/")!==-1);}});if(has("extend-esri")){lang.setObject("dijit.BasemapGallery",BMG,_6fb);}return BMG;});},"url:esri/dijit/templates/BasemapGallery.html":"<div class=\"esriBasemapGallery\">\r\n  <div dojoAttachPoint=\"flowContainer\">\r\n  </div>\r\n</div>","url:esri/dijit/templates/OverviewMap.html":"<div class=\"esriOverviewMap\">\r\n  <div class=\"ovwContainer\" dojoattachpoint=\"_body\" style=\"width: ${width}px; height: ${height}px;\">\r\n    <div id=\"${id}-map\" style=\"width: 100%; height: 100%;\">\r\n      <div class=\"ovwHighlight\" dojoattachpoint=\"_focusDiv\" title=\"${NLS_drag}\" style=\"border: 1px solid ${color}; background-color: ${color};\"></div>\r\n    </div>\r\n  </div>\r\n  <div class=\"ovwButton ovwController\" title=\"${NLS_show}\" dojoattachpoint=\"_controllerDiv\" dojoattachevent=\"onclick: _visibilityHandler\">\r\n  </div>\r\n  <div class=\"ovwButton ovwMaximizer\" title=\"${NLS_maximize}\" dojoattachpoint=\"_maximizerDiv\" dojoattachevent=\"onclick: _maximizeHandler\">\r\n  </div>\r\n</div>\r\n"}});define("esriviewer/mapping",[],1);