//>>built
require({cache:{"esri/layers/FeatureEditResult":function(){define("esri/layers/FeatureEditResult",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_1,_2,_3,_4){var _5=_1(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(_6){if(_6&&_2.isObject(_6)){this.objectId=_6.objectId;this.success=_6.success;if(!_6.success){var _7=_6.error;this.error=new Error();this.error.code=_7.code;this.error.message=_7.description;}}}});if(_3("extend-esri")){_2.setObject("layers.FeatureEditResult",_5,_4);}return _5;});},"esri/layers/MapImageLayer":function(){define("esri/layers/MapImageLayer",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/sniff","esri/domUtils","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/layers/layer"],function(_8,_9,_a,_b,_c,_d,_e,_f,has,_10,_11,_12,_13){var _14=_8([_13],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(_15){this.inherited(arguments,[null,_15]);this._mapImages=[];var _16=_a.hitch;this._panStart=_16(this,this._panStart);this._pan=_16(this,this._pan);this._extentChange=_16(this,this._extentChange);this._zoom=_16(this,this._zoom);this._zoomStart=_16(this,this._zoomStart);this._scale=_16(this,this._scale);this._resize=_16(this,this._resize);_9.connect(this,"onSuspend",this,this._onSuspend);_9.connect(this,"onResume",this,this._onResume);this.loaded=true;this.onLoad(this);},opacity:1,_transform:_e._getDOMAccessor("transform"),addImage:function(_17){var _18=this._mapImages.push(_17);_18=_18-1;_17._idx=_18;_17._layer=this;if(this._div){this._createImage(_17,_18);}},removeImage:function(_19){if(_19){var idx=_19._idx,_1a=this._mapImages;if(_1a[idx]===_19){delete _1a[idx];var _1b=_19._node;if(_1b){this._clearEvents(_1b);_1b.e_idx=_1b.e_bl=_1b.e_tr=_1b.e_l=_1b.e_t=_1b.e_w=_1b.e_h=null;if(_1b.parentNode){_1b.parentNode.removeChild(_1b);_c.destroy(_1b);}}_19._node=_19._idx=_19._layer=null;}}},removeAllImages:function(){var _1c=this._mapImages,i,len=_1c.length;for(i=0;i<len;i++){var _1d=_1c[i];if(_1d){this.removeImage(_1d);}}this._mapImages=[];},getImages:function(){var _1e=this._mapImages,_1f=[],i,len=_1e.length;for(i=0;i<len;i++){if(_1e[i]){_1f.push(_1e[i]);}}return _1f;},setOpacity:function(_20){if(this.opacity!=_20){this._opacityChanged(this.opacity=_20);this.onOpacityChange();}},onOpacityChange:function(){},_opacityChanged:function(_21){var div=this._div,i,len,_22;if(div){if(!has("ie")||has("ie")>8){_d.set(div,"opacity",_21);}else{_22=div.childNodes;len=_22.length;for(i=0;i<len;i++){_d.set(_22[i],"opacity",_21);}}}},_createImage:function(_23,idx){var _24=_c.create("img");_d.set(_24,{position:"absolute"});if(has("ie")<=8){_d.set(_24,"opacity",this.opacity);}if(_23.rotation){var _25="rotate("+(360-_23.rotation)+"deg)";if(has("ie")<9){}else{_d.set(_24,this._transform,_25);_d.set(_24,"transform",_25);}}_23._node=_24;_24.e_idx=idx;_24.e_layer=this;_24.e_load=_9.connect(_24,"onload",_14.prototype._imageLoaded);_24.e_error=_9.connect(_24,"onerror",_14.prototype._imageError);_24.e_abort=_9.connect(_24,"onabort",_14.prototype._imageError);_24.src=_23.href;},_imageLoaded:function(evt,img){var _26=img||evt.target||evt.currentTarget,_27=_26.e_layer,_28=_27._mapImages[_26.e_idx],map=_27._map;if(map&&(map.__zooming||map.__panning||!_27._sr)){_27._standby.push(_26);return;}_27._clearEvents(_26);if(!_28||_28._node!==_26){return;}if(map){_27._attach(_28);}},_imageError:function(evt){var _29=evt.target||evt.currentTarget,_2a=_29.e_layer,_2b=_2a._mapImages[_29.e_idx];_2a._clearEvents(_29);if(_2b){_2b._node=null;}},_clearEvents:function(_2c){var _2d=_9.disconnect;_2d(_2c.e_load);_2d(_2c.e_error);_2d(_2c.e_abort);_2c.e_load=_2c.e_error=_2c.e_abort=_2c.e_layer=null;},_attach:function(_2e){var _2f=_2e.extent,_30=_2f.spatialReference,_31=this._sr,div=this._div,_32=_2e._node,_33=new _11({x:_2f.xmin,y:_2f.ymin,spatialReference:_30}),_34=new _11({x:_2f.xmax,y:_2f.ymax,spatialReference:_30});if(!_31.equals(_30)){if(_31.isWebMercator()&&_30.wkid===4326){_33=_12.geographicToWebMercator(_33);_34=_12.geographicToWebMercator(_34);}else{if(_30.isWebMercator()&&_31.wkid===4326){_33=_12.webMercatorToGeographic(_33);_34=_12.webMercatorToGeographic(_34);}}}_32.e_bl=_33;_32.e_tr=_34;if(_2e.visible){this._setPos(_32,div._left,div._top);(this._active||div).appendChild(_32);}},_setPos:function(_35,_36,_37){var _38=_35.e_bl,_39=_35.e_tr,map=this._map;_38=map.toScreen(_38);_39=map.toScreen(_39);var _3a=_38.x-_36,top=_39.y-_37,_3b=Math.abs(_39.x-_38.x),_3c=Math.abs(_38.y-_39.y),css={width:_3b+"px",height:_3c+"px"},_3d=this._mapImages[_35.e_idx];if(map.navigationMode==="css-transforms"){css[_e._css.names.transform]=_e._css.translate(_3a,top)+(_3d.rotation?(" "+_e._css.rotate(360-_3d.rotation)):"");}else{css.left=_3a+"px";css.top=top+"px";}_d.set(_35,css);_35.e_l=_3a;_35.e_t=top;_35.e_w=_3b;_35.e_h=_3c;},managedSuspension:true,_setMap:function(map,_3e){this.inherited(arguments);var div=this._div=_c.create("div",null,_3e),_3f=_e._css.names,css={position:"absolute"},vd=map.__visibleDelta;if(!has("ie")||has("ie")>8){css.opacity=this.opacity;}if(map.navigationMode==="css-transforms"){css[_3f.transform]=_e._css.translate(vd.x,vd.y);_d.set(div,css);div._left=vd.x;div._top=vd.y;css={position:"absolute",width:map.width+"px",height:map.height+"px",overflow:"visible"};this._active=_c.create("div",null,div);_d.set(this._active,css);this._passive=_c.create("div",null,div);_d.set(this._passive,css);}else{div._left=0;div._top=0;_d.set(div,css);}this._standby=[];var _40=this._mapImages,i,len=_40.length;for(i=0;i<len;i++){var _41=_40[i],_42=_41._node;if(!_42){this._createImage(_41,_41._idx);}}_10.hide(div);return div;},_unsetMap:function(map,_43){this._disconnect();var div=this._div;if(div){var _44=this._mapImages,i,len=_44.length;for(i=0;i<len;i++){var _45=_44[i];if(_45){var _46=_45._node;if(_46){this._clearEvents(_46);_46.e_idx=_46.e_bl=_46.e_tr=_46.e_l=_46.e_t=_46.e_w=_46.e_h=null;}_45._node=null;}}_43.removeChild(div);_c.destroy(div);}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments);},_onSuspend:function(){this._disconnect();_10.hide(this._div);},_onResume:function(evt){if(evt.firstOccurrence){this._sr=this._map.spatialReference;this._processStandbyList();}var map=this._map,div=this._div,vd=map.__visibleDelta;if(map.navigationMode==="css-transforms"){div._left=vd.x;div._top=vd.y;_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}this._redraw(map.navigationMode==="css-transforms");this._connect(map);_10.show(div);},_connect:function(map){if(!this._connections){var _47=_9.connect,_48=(map.navigationMode==="css-transforms");this._connections=[_47(map,"onPanStart",this._panStart),_47(map,"onPan",this._pan),_47(map,"onExtentChange",this._extentChange),_48&&_47(map,"onZoomStart",this._zoomStart),_48?_47(map,"onScale",this._scale):_47(map,"onZoom",this._zoom),_48&&_47(map,"onResize",this._resize)];}},_disconnect:function(){if(this._connections){_b.forEach(this._connections,_9.disconnect);this._connections=null;}},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top;},_pan:function(_49,_4a){var div=this._div;div._left=this._panL+_4a.x;div._top=this._panT+_4a.y;if(this._map.navigationMode==="css-transforms"){_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}else{_d.set(div,{left:div._left+"px",top:div._top+"px"});}},_extentChange:function(_4b,_4c,_4d){if(_4d){this._redraw(this._map.navigationMode==="css-transforms");}else{if(_4c){this._pan(_4b,_4c);}}this._processStandbyList();},_processStandbyList:function(){var i,_4e=this._standby;if(_4e&&_4e.length){for(i=_4e.length-1;i>=0;i--){this._imageLoaded(null,_4e[i]);_4e.splice(i,1);}}},_redraw:function(_4f){if(_4f){var _50=this._passive,_51=_e._css.names;_d.set(_50,_51.transition,"none");this._moveImages(_50,this._active);_d.set(_50,_51.transform,"none");}var div=this._active||this._div,_52=this._div._left,_53=this._div._top,i,len=div.childNodes.length,_54;for(i=0;i<len;i++){_54=div.childNodes[i];this._setPos(_54,_52,_53);}},_zoom:function(_55,_56,_57){var div=this._div,_58=div._left,_59=div._top,i,len=div.childNodes.length,_5a;for(i=0;i<len;i++){_5a=div.childNodes[i];var _5b=_5a.e_w*_56,_5c=_5a.e_h*_56,_5d=(_57.x-_58-_5a.e_l)*(_5b-_5a.e_w)/_5a.e_w,_5e=(_57.y-_59-_5a.e_t)*(_5c-_5a.e_h)/_5a.e_h;_5d=isNaN(_5d)?0:_5d;_5e=isNaN(_5e)?0:_5e;_d.set(_5a,{left:(_5a.e_l-_5d)+"px",top:(_5a.e_t-_5e)+"px",width:_5b+"px",height:_5c+"px"});}},_zoomStart:function(){this._moveImages(this._active,this._passive);},_moveImages:function(_5f,_60){var _61=_5f.childNodes,i,len=_61.length;if(len>0){for(i=len-1;i>=0;i--){_60.appendChild(_61[i]);}}},_scale:function(mtx,_62){var css={},_63=_e._css.names,_64=this._passive;_d.set(_64,_63.transition,_62?"none":(_63.transformName+" "+_f.defaults.map.zoomDuration+"ms ease"));css[_63.transform]=_e._css.matrix(mtx);_d.set(_64,_63.transform,_e._css.matrix(mtx));},_resize:function(_65,_66,_67){_d.set(this._active,{width:_66+"px",height:_67+"px"});_d.set(this._passive,{width:_66+"px",height:_67+"px"});}});if(has("extend-esri")){_a.setObject("layers.MapImageLayer",_14,_e);}return _14;});},"esri/layers/WebTiledLayer":function(){define("esri/layers/WebTiledLayer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/has","dojo/string","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/TiledMapServiceLayer","esri/layers/TileInfo"],function(_68,_69,_6a,Url,has,_6b,_6c,_6d,_6e,_6f,_70,_71){var _72=_68(_70,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(_73,_74){if(!_74){_74={};}this.urlTemplate=_73;var _75=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));var _76=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));this.initialExtent=_74.initialExtent||_75;this.fullExtent=_74.fullExtent||_76;if(_74.tileInfo){this.tileInfo=_74.tileInfo;}else{var _77=[{"level":0,"resolution":156543.033928,"scale":591657527.591555},{"level":1,"resolution":78271.5169639999,"scale":295828763.795777},{"level":2,"resolution":39135.7584820001,"scale":147914381.897889},{"level":3,"resolution":19567.8792409999,"scale":73957190.948944},{"level":4,"resolution":9783.93962049996,"scale":36978595.474472},{"level":5,"resolution":4891.96981024998,"scale":18489297.737236},{"level":6,"resolution":2445.98490512499,"scale":9244648.868618},{"level":7,"resolution":1222.99245256249,"scale":4622324.434309},{"level":8,"resolution":611.49622628138,"scale":2311162.217155},{"level":9,"resolution":305.748113140558,"scale":1155581.108577},{"level":10,"resolution":152.874056570411,"scale":577790.554289},{"level":11,"resolution":76.4370282850732,"scale":288895.277144},{"level":12,"resolution":38.2185141425366,"scale":144447.638572},{"level":13,"resolution":19.1092570712683,"scale":72223.819286},{"level":14,"resolution":9.55462853563415,"scale":36111.909643},{"level":15,"resolution":4.77731426794937,"scale":18055.954822},{"level":16,"resolution":2.38865713397468,"scale":9027.977411},{"level":17,"resolution":1.19432856685505,"scale":4513.988705},{"level":18,"resolution":0.597164283559817,"scale":2256.994353},{"level":19,"resolution":0.298582141647617,"scale":1128.497176}];var _78=new _71({"rows":256,"cols":256,"origin":{"x":-20037508.342787,"y":20037508.342787},"spatialReference":{"wkid":102100},"lods":_77});this.tileInfo=_78;}this.spatialReference=new _6e(this.tileInfo.spatialReference.toJson());this.copyright=_74.copyright||"";var url=new Url(_73);var _79=url.scheme+"://"+url.authority+"/";this.urlPath=_73.substring(_79.length);this.tileServers=_74.tileServers||[];if(url.authority.indexOf("{subDomain}")===-1){this.tileServers.push(_79);}if(_74.subDomains&&_74.subDomains.length>0&&url.authority.split(".").length>1){this.subDomains=_74.subDomains;var _7a;_6a.forEach(_74.subDomains,function(_7b,idx){if(url.authority.indexOf("${subDomain}")>-1){_7a=url.scheme+"://"+_6b.substitute(url.authority,{subDomain:_7b})+"/";}else{if(url.authority.indexOf("{subDomain}")>-1){_7a=url.scheme+"://"+url.authority.replace(/\{subDomain\}/gi,_7b)+"/";}}this.tileServers.push(_7a);},this);}this.tileServers=_6a.map(this.tileServers,function(_7c){if(_7c.charAt(_7c.length-1)!=="/"){_7c+="/";}return _7c;});this._levelToLevelValue=[];_6a.forEach(this.tileInfo.lods,function(_7d){this._levelToLevelValue[_7d.level]=_7d.levelValue?_7d.levelValue:_7d.level;},this);this.loaded=true;this.onLoad(this);},getTileUrl:function(_7e,row,col){_7e=this._levelToLevelValue[_7e];var _7f=this.tileServers[row%this.tileServers.length];var _80=_7f+_6b.substitute(this.urlPath,{level:_7e,col:col,row:row});_80=_80.replace(/\{level\}/gi,_7e);_80=_80.replace(/\{row\}/gi,row);_80=_80.replace(/\{col\}/gi,col);return _6d.addProxy(_80);}});if(has("extend-esri")){_69.setObject("layers.WebTiledLayer",_72,_6c);}return _72;});},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("esri/layers/ServiceGeneratedFeatureCollection",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/renderers/SimpleRenderer","esri/layers/layer","esri/layers/FeatureLayer","esri/dijit/PopupTemplate"],function(_81,_82,_83,_84,_85,_86,has,_87,_88,_89,_8a,_8b,_8c,_8d,_8e){var _8f=_81([_8c],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(url,_90){this.pointSymbol=_90&&_90.pointSymbol;this.polylineSymbol=_90&&_90.polylineSymbol;this.polygonSymbol=_90&&_90.polygonSymbol;this._outSR=(_90&&(_90.outSpatialReference||_90.outSR))||new _88({wkid:4326});this._options=_90;},parse:function(){},getFeatureLayers:function(){var _91=[];if(this._fLayers){_91=_91.concat(this._fLayers);}return _91;},onRefresh:function(){},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._createLayer();},_createLayer:function(_92){var _93=this;this._fireUpdateStart();var _94=this.parse(_92);_94.addCallback(function(_95){_93._io=null;_93._initLayer(_95);});_94.addErrback(function(err){_93._io=null;err=_83.mixin(new Error(),err);err.message="Unable to load resource: "+_93.url+" "+(err.message||"");_93._fireUpdateEnd(err);_93.onError(err);});},_initLayer:function(_96){if(this.loaded){this._removeInternalLayers();}this.name=_96.name;this.description=_96.description;this.snippet=_96.snippet;if(_96.visibility!==undefined){this.defaultVisibility=this.visible=!!_96.visibility;}else{this.defaultVisibility=this.visible=true;}this.featureInfos=_96.featureInfos;this.fullExtent=this.initialExtent=new _89(_96.lookAtExtent);this.copyright=_96.author||_96.copyright;var _97;var _98=_83.getObject("featureCollection.layers",false,_96);if(_98&&_98.length>0){this._fLayers=[];_84.forEach(_98,function(_99,i){var _9a=_83.getObject("featureSet.features",false,_99),_9b;if(_9a&&_9a.length>0){_97=_83.mixin({outFields:["*"],infoTemplate:_99.popupInfo?new _8e(_99.popupInfo):null,editable:false},this._options);if(_97.id){_97.id=_97.id+"_"+i;}_99.layerDefinition.capabilities="Query,Data";_9b=new _8d(_99,_97);if(_9b.geometryType){this["_"+_9b.geometryType]=_9b;}this._fLayers.push(_9b);}},this);if(this._fLayers.length===0){delete this._fLayers;}}this.items=[];if(this._esriGeometryPoint){this.items=this.items.concat(this._esriGeometryPoint.graphics);if(this.pointSymbol){var _9c=new _8b(this.pointSymbol);this._esriGeometryPoint.setRenderer(_9c);}}if(this._esriGeometryPolyline){this.items=this.items.concat(this._esriGeometryPolyline.graphics);if(this.polylineSymbol){var _9d=new _8b(this.polylineSymbol);this._esriGeometryPolyline.setRenderer(_9d);}}if(this._esriGeometryPolygon){this.items=this.items.concat(this._esriGeometryPolygon.graphics);if(this.polygonSymbol){var _9e=new _8b(this.polygonSymbol);this._esriGeometryPolygon.setRenderer(_9e);}}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();var _9f=map.spatialReference,_a0=this._outSR,_a1;if(_9f.wkid){_a1=(_9f._isWebMercator()&&_a0._isWebMercator())||(_9f.wkid===_a0.wkid);}else{if(_9f.wkt){_a1=(_9f.wkt===_a0.wkt);}else{return;}}if(!_a1){if(_9f._isWebMercator()&&_a0.wkid===4326){this._converter=_8a.geographicToWebMercator;}else{if(_a0._isWebMercator()&&_9f.wkid===4326){this._converter=_8a.webMercatorToGeographic;}else{return;}}}var _a2=this._fLayers;if(_a2&&_a2.length>0){_84.forEach(_a2,function(_a3){if(this._converter){var _a4=_a3.graphics,i,_a5,len=_a4?_a4.length:0;for(i=0;i<len;i++){_a5=_a4[i].geometry;if(_a5){_a4[i].setGeometry(this._converter(_a5));}}}map.addLayer(_a3);},this);}this.setVisibility(this.visible);},_removeInternalLayers:function(){var map=this._map;if(map){_84.forEach(this.getFeatureLayers(),map.removeLayer,map);}},onVisibilityChange:function(_a6){this._fireUpdateStart();_84.forEach(this.getFeatureLayers(),function(_a7){_a7.setVisibility(_a6);});this._fireUpdateEnd();},_setMap:function(map,_a8){this.inherited(arguments);this._map=map;var div=this._div=_85.create("div",null,_a8);_86.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_a9){if(this._io){this._io.cancel();}_82.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_a9.removeChild(div);_85.destroy(div);}this._div=null;this.inherited(arguments);}});if(has("extend-esri")){_83.setObject("layers._ServiceGeneratedFeatureCollection",_8f,_87);}return _8f;});},"esri/layers/KMLGroundOverlay":function(){define("esri/layers/KMLGroundOverlay",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/layers/MapImage"],function(_aa,_ab,has,_ac,_ad,_ae){var _af=_aa([_ae],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(_b0){if(_ad.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){_ab.setObject("layers.KMLGroundOverlay",_af,_ac);}return _af;});},"dojo/data/util/simpleFetch":function(){define("dojo/data/util/simpleFetch",["../../_base/lang","../../_base/kernel","./sorter"],function(_b1,_b2,_b3){var _b4={};_b1.setObject("dojo.data.util.simpleFetch",_b4);_b4.errorHandler=function(_b5,_b6){if(_b6.onError){var _b7=_b6.scope||_b2.global;_b6.onError.call(_b7,_b5,_b6);}};_b4.fetchHandler=function(_b8,_b9){var _ba=_b9.abort||null,_bb=false,_bc=_b9.start?_b9.start:0,_bd=(_b9.count&&(_b9.count!==Infinity))?(_bc+_b9.count):_b8.length;_b9.abort=function(){_bb=true;if(_ba){_ba.call(_b9);}};var _be=_b9.scope||_b2.global;if(!_b9.store){_b9.store=this;}if(_b9.onBegin){_b9.onBegin.call(_be,_b8.length,_b9);}if(_b9.sort){_b8.sort(_b3.createSortFunction(_b9.sort,this));}if(_b9.onItem){for(var i=_bc;(i<_b8.length)&&(i<_bd);++i){var _bf=_b8[i];if(!_bb){_b9.onItem.call(_be,_bf,_b9);}}}if(_b9.onComplete&&!_bb){var _c0=null;if(!_b9.onItem){_c0=_b8.slice(_bc,_bd);}_b9.onComplete.call(_be,_c0,_b9);}};_b4.fetch=function(_c1){_c1=_c1||{};if(!_c1.store){_c1.store=this;}this._fetchItems(_c1,_b1.hitch(this,"fetchHandler"),_b1.hitch(this,"errorHandler"));return _c1;};return _b4;});},"esri/layers/KMLLayer":function(){define("esri/layers/KMLLayer",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/sniff","dojo/io-query","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/dijit/PopupTemplate","esri/layers/layer","esri/layers/KMLFolder","esri/layers/KMLGroundOverlay","esri/layers/MapImageLayer","esri/layers/FeatureLayer"],function(_c2,_c3,_c4,_c5,_c6,_c7,has,ioq,_c8,_c9,_ca,_cb,_cc,_cd,_ce,_cf,_d0,_d1,_d2,_d3,_d4,_d5){var _d6=_c3([_d1],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(url,_d7){if(!url){}this._outSR=(_d7&&_d7.outSR)||new _ce({wkid:4326});this._options=_d7;if(_cb.defaults.kmlService){this.serviceUrl=_cb.defaults.kmlService;}var _d8=(this.linkInfo=_d7&&_d7.linkInfo);if(_d8){this.visible=!!_d8.visibility;this._waitingForMap=!!_d8.viewFormat;}if(!_d8||(_d8&&_d8.visibility&&!this._waitingForMap)){this._parseKml();}this.refresh=_c5.hitch(this,this.refresh);},getFeature:function(_d9){if(!_d9){return;}var _da=_d9.type,id=_d9.id,_db,i,len;switch(_da){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var _dc=this["_"+_da];if(_dc){_db=_c5.getObject("_mode._featureMap."+id,false,_dc);}break;case "GroundOverlay":var _dd=this._groundLyr;if(_dd){var _de=_dd.getImages();len=_de.length;for(i=0;i<len;i++){if(_de[i].id===id){_db=_de[i];break;}}}break;case "ScreenOverlay":break;case "NetworkLink":_c6.some(this._links,function(_df){if(_df.linkInfo&&_df.linkInfo.id===id){_db=_df;return true;}else{return false;}});break;case "Folder":var _e0=this.folders;len=_e0?_e0.length:0;for(i=0;i<len;i++){if(_e0[i].id===id){_db=_e0[i];break;}}break;default:undefined;break;}return _db;},getLayers:function(){var _e1=[];if(this._groundLyr){_e1.push(this._groundLyr);}if(this._fLayers){_e1=_e1.concat(this._fLayers);}if(this._links){_c6.forEach(this._links,function(_e2){if(_e2.declaredClass){_e1.push(_e2);}});}return _e1;},setFolderVisibility:function(_e3,_e4){if(!_e3){return;}this._fireUpdateStart();_e3.visible=_e4;if(_e4){_e4=this._areLocalAncestorsVisible(_e3);}this._setState(_e3,_e4);this._fireUpdateEnd();},onRefresh:function(){},_parseKml:function(map){var _e5=this;this._fireUpdateStart();this._io=_cd({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(map),model:"simple",folders:"",refresh:this.loaded?true:undefined,outSR:_c7.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(_e6){_e5._io=null;_e5._initLayer(_e6);},error:function(err){_e5._io=null;err=_c5.mixin(new Error(),err);err.message="Unable to load KML: "+_e5.url+" "+(err.message||"");_e5._fireUpdateEnd(err);_e5.onError(err);}});},_initLayer:function(_e7){if(this.loaded){this._removeInternalLayers();}this.name=_e7.name;this.description=_e7.description;this.snippet=_e7.snippet;this.visibility=_e7.visibility;this.featureInfos=_e7.featureInfos;var i,len;var _e8=(this.folders=_e7.folders),_e9=[],_ea;if(_e8){len=_e8.length;for(i=0;i<len;i++){_ea=(_e8[i]=new _d2(_e8[i]));if(_ea.parentFolderId===-1){_e9.push(_ea);}}}var _eb=(this._links=_e7.networkLinks),_ec;len=_eb?_eb.length:0;for(i=0;i<len;i++){if(_eb[i].viewRefreshMode&&_eb[i].viewRefreshMode.toLowerCase().indexOf("onregion")!==-1){continue;}_ec=_c5.mixin({},this._options);_ec.linkInfo=_eb[i];if(_ec.id){_ec.id=_ec.id+"_"+i;}_eb[i]=new _d6(_eb[i].href,_ec);_eb[i]._parentLayer=this;_eb[i]._parentFolderId=this._getLinkParentId(_eb[i].linkInfo.id);}var _ed=_e7.groundOverlays;if(_ed&&_ed.length>0){_ec=_c5.mixin({},this._options);if(_ec.id){_ec.id=_ec.id+"_"+"mapImage";}var _ee=(this._groundLyr=new _d4(_ec));len=_ed.length;for(i=0;i<len;i++){_ee.addImage(new _d3(_ed[i]));}}var _ef=_c5.getObject("featureCollection.layers",false,_e7);if(_ef&&_ef.length>0){this._fLayers=[];_c6.forEach(_ef,function(_f0,i){var _f1=_c5.getObject("featureSet.features",false,_f0),_f2;if(_f1&&_f1.length>0){_ec=_c5.mixin({outFields:["*"],infoTemplate:_f0.popupInfo?new _d0(_f0.popupInfo):null,editable:false},this._options);if(_ec.id){_ec.id=_ec.id+"_"+i;}_f0.layerDefinition.capabilities="Query,Data";_f2=new _d5(_f0,_ec);if(_f2.geometryType){this["_"+_f2.geometryType]=_f2;}this._fLayers.push(_f2);}},this);if(this._fLayers.length===0){delete this._fLayers;}}len=_e9.length;for(i=0;i<len;i++){_ea=_e9[i];this._setState(_ea,_ea.visible);}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}else{this.loaded=true;this.onLoad(this);}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();if(this._links){_c6.forEach(this._links,function(_f3){if(_f3.declaredClass){map.addLayer(_f3);if(_f3._waitingForMap){_f3._waitingForMap=null;if(_f3.visible){_f3._parseKml(map);}else{_f3._wMap=map;}}}});}var _f4=map.spatialReference,_f5=this._outSR,_f6;if(!_f4.equals(_f5)){if(_f4.isWebMercator()&&_f5.wkid===4326){_f6=_cf.geographicToWebMercator;}else{if(_f5.isWebMercator()&&_f4.wkid===4326){_f6=_cf.webMercatorToGeographic;}else{return;}}}if(this._groundLyr){if(_f6){_c6.forEach(this._groundLyr.getImages(),function(_f7){_f7.extent=_f6(_f7.extent);});}map.addLayer(this._groundLyr);}var _f8=this._fLayers;if(_f8&&_f8.length>0){_c6.forEach(_f8,function(_f9){if(_f6){var _fa=_f9.graphics,i,_fb,len=_fa?_fa.length:0;for(i=0;i<len;i++){_fb=_fa[i].geometry;if(_fb){_fa[i].setGeometry(_f6(_fb));}}}map.addLayer(_f9);});}this.onVisibilityChange(this.visible);},_removeInternalLayers:function(){var map=this._map;if(this._links){_c6.forEach(this._links,function(_fc){if(_fc.declaredClass&&_fc._io){_fc._io.cancel();}});}if(map){_c6.forEach(this.getLayers(),map.removeLayer,map);}},_setState:function(_fd,_fe){var _ff=_fd.featureInfos,info,_100,i,len=_ff?_ff.length:0,_101=_fe?"show":"hide";for(i=0;i<len;i++){info=_ff[i];_100=this.getFeature(info);if(!_100){continue;}if(info.type==="Folder"){this._setState(_100,_fe&&_100.visible);}else{if(info.type==="NetworkLink"){this._setInternalVisibility(_100,_fe);}else{_100[_101]();}}}},_areLocalAncestorsVisible:function(_102){var _103=_102.parentFolderId,_104=_102.visible;while(_104&&_103!==-1){var _105=this.getFeature({type:"Folder",id:_103});_104=_104&&_105.visible;_103=_105.parentFolderId;}return _104;},_setInternalVisibility:function(_106,_107){var _108=_106._parentLayer,_109=_106._parentFolderId;_107=_107&&_106.visible;while(_107&&_108){_107=_107&&_108.visible;if(_109>-1){_107=_107&&_108._areLocalAncestorsVisible(_108.getFeature({type:"Folder",id:_109}));}_109=_108._parentFolderId;_108=_108._parentLayer;}this._setIntState(_106,_107);},_setIntState:function(link,_10a){if(!link){return;}_c6.forEach(link.getLayers(),function(_10b){if(_10b.linkInfo){link._setIntState(_10b,_10a&&_10b.visible&&link._areLocalAncestorsVisible(link.getFeature({type:"Folder",id:_10b._parentFolderId})));}else{_10b.setVisibility(_10a);}});},_getLinkParentId:function(id){var _10c=-1;if(this.folders){_c6.some(this.folders,function(_10d){if(_10d.networkLinkIds&&_c6.indexOf(_10d.networkLinkIds,id)!==-1){_10c=_10d.id;return true;}return false;});}return _10c;},_checkAutoRefresh:function(){var _10e=this.linkInfo;if(_10e){if(this.visible){if(this.loaded&&this._map){var _10f=_10e.refreshMode,_110=_10e.refreshInterval,_111=_10e.viewRefreshMode,_112=_10e.viewRefreshTime;if(_10f&&_10f.toLowerCase().indexOf("oninterval")!==-1&&_110>0){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,_110*1000);}if(_111&&_111.toLowerCase().indexOf("onstop")!==-1&&_112>0){if(!this._extChgHandle){this._extChgHandle=_c4.connect(this._map,"onExtentChange",this,this._extentChanged);}}}}else{this._stopAutoRefresh();_c4.disconnect(this._extChgHandle);delete this._extChgHandle;}}},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null;},_getQueryParameters:function(map){map=map||this._map;var _113={},_114=this.linkInfo,_115=map&&map.extent,_116;if(this._url.query){_c5.mixin(_113,this._url.query);_116=!!this._url.query.token;}if(_ca.id&&!_116){var _117=_ca.id.findCredential(this._url.path);if(_117){_113.token=_117.token;}}if(_114){var _118=_114.viewFormat,_119=_114.httpQuery,_11a=_114.viewBoundScale;if(_115&&_118){var _11b=_115,_11c=_115,sr=_115.spatialReference;if(sr){if(sr.isWebMercator()){_11b=_cf.webMercatorToGeographic(_115);}else{if(sr.wkid===4326){_11c=_cf.geographicToWebMercator(_115);}}}var _11d=_11b.getCenter(),_11e=Math.max(_11c.getWidth(),_11c.getHeight());if(_11a){_11b=_11b.expand(_11a);}_118=_118.replace(/\[bboxWest\]/ig,_11b.xmin).replace(/\[bboxEast\]/ig,_11b.xmax).replace(/\[bboxSouth\]/ig,_11b.ymin).replace(/\[bboxNorth\]/ig,_11b.ymax).replace(/\[lookatLon\]/ig,_11d.x).replace(/\[lookatLat\]/ig,_11d.y).replace(/\[lookatRange\]/ig,_11e).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,_11d.x).replace(/\[lookatTerrainLat\]/ig,_11d.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,_11d.x).replace(/\[cameraLat\]/ig,_11d.y).replace(/\[cameraAlt\]/ig,_11e).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,map.width).replace(/\[vertPixels\]/ig,map.height).replace(/\[terrainEnabled\]/ig,0);_c5.mixin(_113,ioq.queryToObject(_118));}if(_119){_119=_119.replace(/\[clientVersion\]/ig,_ca.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,_c2.locale);_c5.mixin(_113,ioq.queryToObject(_119));}}var _11f=[],_120;for(_120 in _113){if(_cc.isDefined(_113[_120])){_11f.push(_120+"="+_113[_120]);}}_11f=_11f.join("&");return _11f?("?"+_11f):"";},_setMap:function(map,_121){this._map=map;var div=this._div=_c8.create("div",null,_121);_c9.set(div,"position","absolute");this._addInternalLayers();return div;},_unsetMap:function(map,_122){if(this._io){this._io.cancel();}this._stopAutoRefresh();_c4.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_122.removeChild(div);_c8.destroy(div);}this._map=this._wMap=this._div=null;},onVisibilityChange:function(_123){if(!this.loaded){if(this.linkInfo&&_123){if(!this._waitingForMap){this._parseKml(this._wMap);}}return;}this._fireUpdateStart();this._setInternalVisibility(this,_123);this._checkAutoRefresh();this._fireUpdateEnd();},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._parseKml();},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,this.linkInfo.viewRefreshTime*1000);}});if(has("extend-esri")){_c5.setObject("layers.KMLLayer",_d6,_ca);}return _d6;});},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(lang){var _124={};lang.setObject("dojo.data.util.sorter",_124);_124.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_124.createSortFunction=function(_125,_126){var _127=[];function _128(attr,dir,comp,s){return function(_129,_12a){var a=s.getValue(_129,attr);var b=s.getValue(_12a,attr);return dir*comp(a,b);};};var _12b;var map=_126.comparatorMap;var bc=_124.basicComparator;for(var i=0;i<_125.length;i++){_12b=_125[i];var attr=_12b.attribute;if(attr){var dir=(_12b.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_127.push(_128(attr,dir,comp,_126));}}return function(rowA,rowB){var i=0;while(i<_127.length){var ret=_127[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _124;});},"esri/layers/OnDemandMode":function(){define("esri/layers/OnDemandMode",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/geometry/Point","esri/tasks/query","esri/layers/RenderMode","esri/layers/GridLayout"],function(_12c,_12d,lang,_12e,has,_12f,_130,_131,_132,_133){var _134=_12c([_132],{declaredClass:"esri.layers._OnDemandMode",constructor:function(_135){this.featureLayer=_135;this._featureMap={};this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},initialize:function(map){this.inherited(arguments);var _136=this.featureLayer,_137=_136._srInfo;this._gridLayer=new _133(new _130(_137?_137.valid[0]:map.extent.xmin,map.extent.ymax,map.spatialReference),{width:_136._tileWidth,height:_136._tileHeight},{width:map.width,height:map.height},_137);this._cellMap={};this._gridLayer.setResolution(map.extent);},startup:function(){this._ioQueue=[];if(!this.featureLayer.suspended){this._zoomHandler();this._enableConnectors();}},propertyChangeHandler:function(type){if(this._init){if(type<2){this._zoomHandler();}else{}}},destroy:function(){this._disableConnectors();this.inherited(arguments);},drawFeature:function(_138){var _139=this._gridLayer,geom=_138.geometry,_13a=[];if(!geom){return;}_13a=_139.getCellsInExtent((geom.type==="point")?{xmin:geom.x,ymin:geom.y,xmax:geom.x,ymax:geom.y}:geom.getExtent(),false).cells;var _13b=this._cellMap,i,cell,oid=_138.attributes[this.featureLayer.objectIdField],_13c,row,col;for(i=0;i<_13a.length;i++){cell=_13a[i];_13c=cell.latticeID;row=cell.row;col=cell.col;if(_13c){cell=(_13b[_13c]=(_13b[_13c]||cell));}else{_13b[row]=_13b[row]||{};cell=(_13b[row][col]=(_13b[row][col]||cell));}cell.features=cell.features||[];cell.features.push(_138);this._addFeatureIIf(oid,_138);this._incRefCount(oid);}},suspend:function(){if(!this._init){return;}this._disableConnectors();},resume:function(){if(!this._init){return;}this._enableConnectors();this._zoomHandler();},refresh:function(){this._zoomHandler();},_enableConnectors:function(){var map=this.map;this._zoomConnect=_12d.connect(map,"onZoomEnd",this,this._zoomHandler);this._panConnect=_12d.connect(map,"onPanEnd",this,this._panHandler);this._resizeConnect=_12d.connect(map,"onResize",this,this._panHandler);},_disableConnectors:function(){_12d.disconnect(this._zoomConnect);_12d.disconnect(this._panConnect);_12d.disconnect(this._resizeConnect);},_zoomHandler:function(){this._processIOQueue(true);var _13d=this.featureLayer,map=this.map;if(_13d.suspended){return;}_13d._fireUpdateStart();this._clearIIf();var _13e=_13d._trackManager;if(_13e){_13e.clearTracks();}this._cellMap={};this._gridLayer.setResolution(map.extent);this._sendRequest();},_panHandler:function(){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&arguments[0]);},_getRequestId:function(_13f,cell){var id="_"+_13f.name+_13f.layerId+_13f._ulid+"_"+cell.resolution+"_"+(cell.latticeID||(cell.row+"_"+cell.col));return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_sendRequest:function(_140){this._exceeds=false;var _141=this.featureLayer,map=this.map,_142=_140||map.extent,_143=this._gridLayer.getCellsInExtent(_142,_141.latticeTiling),_144=_143.cells;if(!_141.isEditable()){var _145=this._cellMap;_144=_12e.filter(_144,function(cell){if(cell.lattice){if(_145[cell.latticeID]){return false;}}else{if(_145[cell.row]&&_145[cell.row][cell.col]){return false;}}return true;});}var _146=_141._getOutFields(),_147=_141.getDefinitionExpression(),time=_141._getOffsettedTE(_141._mapTimeExtent),_148=_141._usePatch,_149=this._ioQueue,i,self=this,func=this._drawFeatures,cell,_14a,_14b;this._pending=this._pending||0;for(i=0;i<_144.length;i++){cell=_144[i];_14a=new _131();_14a.geometry=cell.extent||cell.lattice;_14a.outFields=_146;_14a.where=_147;if(_141.latticeTiling&&cell.extent){_14a.spatialRelationship=_131.SPATIAL_REL_CONTAINS;}_14a.returnGeometry=true;_14a.timeExtent=time;_14a.maxAllowableOffset=_141._maxOffset;if(_141._ts){_14a._ts=(new Date()).getTime();}_14b=null;if(_148){_14b=this._getRequestId(_141,cell);if(this._isPending(_14b)){continue;}}this._pending++;_149.push(_141._task.execute(_14a,function(){var _14c=cell;return function(_14d){func.apply(self,[_14d,_14c]);};}.call(this),this._queryErrorHandler,_14b));}this._removeOldCells(_142);this._endCheck();},_drawFeatures:function(_14e,cell){this._exceeds=this._exceeds||_14e.exceededTransferLimit;this._finalizeIO();var _14f=this.featureLayer,map=this.map,_150=map.extent,_151=cell.extent,row=cell.row,col=cell.col,_152=_14f.objectIdField,_153=_14e.features,_154=this._gridLayer,_155=this._cellMap,i,len,_156=cell.latticeID,_157=_156?_155[_156]:(_155[row]&&_155[row][col]);if((cell.resolution!=_154._resolution)||(_156?(_156!==_154.getLatticeID(_150)):(!_154.intersects(_151,_150)))){if(_157){this._removeCell(row,col,_156);}}else{if(_157){this._updateCell(_157,_153);}else{cell.features=_153;if(_156){_155[_156]=cell;}else{_155[row]=_155[row]||{};_155[row][col]=cell;}len=_153.length;for(i=0;i<len;i++){var _158=_153[i];var oid=_158.attributes[_152];this._addFeatureIIf(oid,_158);this._incRefCount(oid);}}}this._endCheck();},_queryErrorHandler:function(err){this._finalizeIO();this.featureLayer._errorHandler(err);this._endCheck(true);},_finalizeIO:function(){this._purgeRequests();this._pending--;},_endCheck:function(_159){if(this._pending===0){this._processIOQueue();var _15a=this.featureLayer,_15b=_15a._trackManager;if(_15b){_15b.clearTracks();_15b.addFeatures(_15a.graphics);if(_15a._ager){_12e.forEach(_15a.graphics,function(_15c){if(_15c._shape){_15a._repaint(_15c);}});}_15b.moveLatestToFront();_15b.drawTracks();}this.featureLayer._fireUpdateEnd(_159&&new Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:true}:null);if(this._exceeds){_15a.onQueryLimitExceeded();}}},_processIOQueue:function(_15d){this._ioQueue=_12e.filter(this._ioQueue,function(dfd){var keep=dfd.fired>-1?false:true;return keep;});if(_15d){_12e.forEach(this._ioQueue,this._cancelPendingRequest);}},_removeOldCells:function(_15e){var _15f=this._cellMap,_160=this._gridLayer,_161,_162;for(_161 in _15f){if(_15f[_161]){var row=_15f[_161],_163=row.latticeID,_164=0,_165=0;if(_163){_164++;if(_163!==_160.getLatticeID(_15e)){this._removeCell(null,null,_163);_165++;}}else{for(_162 in row){if(row[_162]){_164++;var _166=row[_162].extent;if(!_160.intersects(_166,_15e)){this._removeCell(_161,_162);_165++;}}}}if(_165===_164){delete _15f[_161];}}}},_updateCell:function(cell,_167){var _168=this.featureLayer,_169=_168.objectIdField,_16a=_168._selectedFeatures,i,len=_167.length;cell.features=cell.features||[];for(i=0;i<len;i++){var _16b=_167[i];var oid=_16b.attributes[_169];var _16c=this._addFeatureIIf(oid,_16b);if(_16c===_16b){this._incRefCount(oid);cell.features.push(_16c);}else{if(!(oid in _16a)){_16c.setGeometry(_16b.geometry);_16c.setAttributes(_16b.attributes);}}}},_removeCell:function(row,col,_16d){var _16e=this._cellMap,_16f=this.featureLayer,_170=_16f.objectIdField;var cell=_16d?_16e[_16d]:(_16e[row]&&_16e[row][col]);if(cell){if(_16d){delete _16e[_16d];}else{delete _16e[row][col];}var _171=cell.features,i;for(i=0;i<_171.length;i++){var _172=_171[i];var oid=_172.attributes[_170];this._decRefCount(oid);if(oid in _16f._selectedFeatures){continue;}this._removeFeatureIIf(oid);}}}});if(has("extend-esri")){lang.setObject("layers._OnDemandMode",_134,_12f);}return _134;});},"esri/arcgis/Portal":function(){define("esri/arcgis/Portal",["dojo/_base/declare","dojo/_base/lang","dojo/_base/kernel","dojo/_base/Deferred","dojo/_base/array","dojo/_base/sniff","dojo/Evented","dojo/DeferredList","esri/kernel","esri/lang","esri/request","esri/IdentityManager"],function(_173,lang,_174,_175,_176,has,_177,_178,_179,_17a,_17b){var _17c={"options":{"disableIdentityLookup":true},"requestParams":{"f":"json"}},_17d=function(_17e){if(!_17e){return _17e;}if(_17e.then){_17e=lang.delegate(_17e);}if(!_17e.total){_17e.total=_175.when(_17e,function(_17f){return _17a.isDefined(_17f.total)?_17f.total:(_17f.length||0);});}function _180(_181){if(!_17e[_181]){_17e[_181]=function(){var args=arguments;return _175.when(_17e,function(_182){Array.prototype.unshift.call(args,(_182.results||_182));return _17d(_176[_181].apply(_176,args));});};}};_180("forEach");_180("filter");_180("map");_180("some");_180("every");return _17e;},_183={useSSL:function(_184,url){return (_184.indexOf("https:")!==-1||(_17c.self&&_17c.self.allSSL))?url.replace("http:","https:"):url;},formatUrl:function(url){var _185=_17c.loggedInUser&&_17c.loggedInUser.credential&&_17c.loggedInUser.credential.token;return url.indexOf("null")!==-1?null:_183.useSSL(window.location.protocol,(_185?url+(url.indexOf("?")!==-1?"&":"?")+("token="+_185):url));},resultsToTypedArray:function(type,_186,_187){_187=_187?(_187.notifications||_187.userInvitations||_187.tags||_187.items||_187.groups||_187.comments||_187.results||_187):[];return _176.map(_187,function(_188){_188=lang.mixin(_188,_186||{});return type?new type(_188):_188;});},clearFieldsFromObject:function(flds,obj){var fld,i,l=flds.length;if(!lang.isArray(flds)){for(fld in flds){delete obj[fld];}}else{for(i=0;i<l;i++){delete obj[flds[i]];}}return obj;},requestToTypedArray:function(url,_189,_18a,type,_18b){return _17d(_183.request(url,_189,_18a).then(lang.partial(_183.resultsToTypedArray,type,_18b)));},request:function(url,_18c,_18d){_18c&&_18c.portal&&delete _18c.portal;var _18e=lang.mixin(lang.mixin({},_18c||{}),_17c.requestParams);var _18f=lang.mixin(_18d||{},_17c.options);return _17b({url:_183.useSSL(window.location.protocol,(url.url||url)),content:_18e,callbackParamName:"callback",timeout:(_18f&&_18f.timeout)||0},_18f);},formatQueryParams:function(_190,_191){var qp=lang.mixin(lang.mixin({},_190),(lang.isString(_191)?{"q":_191}:(_191||{})));qp.q=_17c.extraQuery?"("+qp.q+")"+_17c.extraQuery:qp.q;return qp;}},_192=_173([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(_193){lang.mixin(this,_193);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null;}}),_194=_173([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(_195){lang.mixin(this,_195);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null;}}),_196=_173([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(_197){lang.mixin(this,_197);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=_183.formatUrl(this.itemUrl.replace("content",("content/users/"+this.owner)+(this.folderId?"/"+this.folderId:"")));this.itemDataUrl=_183.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=_183.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null;},addComment:function(_198){var _199=lang.isString(_198)?{"comment":_198}:_198;return _183.request(this.itemUrl+"/addComment",_199,{"usePost":true}).then(lang.hitch(this,function(_19a){return _192(lang.mixin(_199,{"id":_19a.commentId,"item":this}));}));},updateComment:function(_19b){if(_19b&&_19b.url&&_19b.comment){var _19c={"comment":_19b.comment};return _183.request(_19b.url+"/update",_19c,{"usePost":true}).then(function(_19d){_19b.id=_19d.commentId;return _19b;});}else{throw new Error();}},getComments:function(){return _183.requestToTypedArray(this.itemUrl+"/comments",null,null,_192,{"item":this});},deleteComment:function(_19e){if(_19e&&_19e.url){return _183.request(_19e.url+"/delete",null,{"usePost":true});}else{throw new Error();}},addRating:function(_19f){var _1a0=lang.isObject(_19f)?_19f:{"rating":parseFloat(_19f)};return _183.request(this.itemUrl+"/addRating",_1a0,{"usePost":true}).then(lang.hitch(this,function(_1a1){return new _194(lang.mixin(_1a0,{"id":_1a1.ratingId,"item":this}));}));},getRating:function(){return _183.request(this.itemUrl+"/rating").then(lang.hitch(this,function(_1a2){return new _194(lang.mixin(_1a2,{"item":this}));}));},deleteRating:function(){return _183.request(this.itemUrl+"/deleteRating",null,{"usePost":true});}}),_1a3=_173([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(_1a4){lang.mixin(this,_1a4);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=_183.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null;},getMembers:function(){return _183.request(this.url+"/users");},queryItems:function(_1a5){_1a5=_183.formatQueryParams({},_1a5);_1a5.q="group:"+this.id+(_1a5.q?(" "+_1a5.q):"");return this.portal.queryItems(_1a5);}}),_1a6=_173([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(_1a7){lang.mixin(this,_1a7);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null;},getItems:function(){return _183.requestToTypedArray(this.url,null,null,_196,{"portal":this.portal,"folderId":this.id});}}),_1a8=_173([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(_1a9){lang.mixin(this,_1a9);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=_183.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null;},getGroups:function(){return _17d(_183.request(this.url).then(lang.hitch(this,function(_1aa){return _183.resultsToTypedArray(_1a3,{"portal":this.portal},_1aa.groups);})));},getNotifications:function(){return _183.requestToTypedArray(this.url+"/notifications",null,null,null,{"portal":this.portal});},getGroupInvitations:function(){return _183.requestToTypedArray(this.url+"/invitations",null,null,null,{"portal":this.portal});},getTags:function(){return _183.requestToTypedArray(this.url+"/tags",null,null,null,{"portal":this.portal});},getFolders:function(){return _17d(this.getContent().then(function(_1ab){return _1ab.folders;}));},getItems:function(_1ac){return _17d(this.getContent(_1ac).then(function(_1ad){return _1ad.items;}));},getItem:function(_1ae){var url=this.portal.portalUrl+"content/items/"+_1ae;return _183.request(url).then(lang.hitch(this,function(item){return new _196(lang.mixin(item,{"portal":this.portal}));}));},getContent:function(_1af){var url=(this.url.replace("community","content"))+(_1af?("/"+_1af):"");return _183.request(url).then(lang.hitch(this,function(_1b0){_1b0.folders=_183.resultsToTypedArray(_1a6,{"portal":this.portal},_1b0.folders);_1b0.items=_183.resultsToTypedArray(_196,{"portal":this.portal,"folderId":_1af},_1b0.items);return _1b0;}));}}),_1b1=_173([_177],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},constructor:function(url){lang.mixin(this,{"url":url});this.init(url).then(lang.hitch(this,function(){this.emit("ready",this);this.onLoad(this);}));},init:function(url,_1b2){url=(url||this.portalUrl).replace(/\/+$/,"");var idx=url.indexOf("/sharing");this.portalUrl=(idx!==-1?(url+"/"):(url+"/sharing/rest/"));return this._getSelf(this.portalUrl).then(lang.hitch(this,function(_1b3){_17c.self=lang.mixin({},_1b3);var _1b4=_1b3.user;if(_1b4){_1b4.portal=this;_1b4=new _1a8(_1b4);}if(_17c.self.id&&_17c.self.canSearchPublic===false){_17c.extraQuery=" AND orgid:"+_17c.self.id;}lang.mixin(this,_17c.self);_17c.loggedInUser=lang.mixin({},lang.mixin(_1b4,{"credential":_1b2}));this.thumbnailUrl=_183.formatUrl(this.portalUrl+"accounts/self/resources/"+this.thumbnail);this.isOrganization=(this.access&&this.access.length)||false;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this;}));},signIn:function(){_17c.options.disableIdentityLookup=false;return _179.id.getCredential(this.url).then(lang.hitch(this,"init",this.url)).then(function(){return _17c.loggedInUser;},function(_1b5){_17c.options.disableIdentityLookup=true;throw _1b5;});},signOut:function(){_17c.loggedInUser.credential&&_17c.loggedInUser.credential.destroy();_17c.loggedInUser=null;_17c.options.disableIdentityLookup=true;_183.clearFieldsFromObject(_17c.self,this);_17c.self=null;return this.init(this.url);},getPortalUser:function(){return _17c.loggedInUser;},queryGroups:function(_1b6){return this._queryPortal(this.portalUrl+"community/groups",_183.formatQueryParams({},_1b6),_1a3);},queryItems:function(_1b7){return this._queryPortal(this.portalUrl+"search",_183.formatQueryParams({},_1b7),_196);},queryUsers:function(_1b8){return this._queryPortal(this.portalUrl+"community/users",_183.formatQueryParams({"sortField":"username"},_1b8),_1a8);},_getSelf:function(url){var _1b9=url+"accounts/self?"+"culture="+_174.locale;return _183.request(_1b9);},_queryPortal:function(url,_1ba,type){var _1bb=lang.mixin({"num":10,"start":0,"sortField":"title","sortOrder":"asc"},_1ba),_1bc=["start","query","num","nextStart"],dfd=_183.request(url,_1bb).then(lang.hitch(this,function(_1bd){_1bd.results=_183.resultsToTypedArray(type,{"portal":this},_1bd.results);_1bd.queryParams=lang.mixin({},_1bb);_1bd.nextQueryParams=lang.mixin(_1bb,{"start":_1bd.nextStart});return _183.clearFieldsFromObject(_1bc,_1bd);}));dfd=lang.delegate(dfd);dfd.queryParams=lang.mixin({},_1bb);dfd.nextQueryParams=_175.when(dfd,function(_1be){return _1be.nextQueryParams;});return _17d(dfd);}}),_1bf={Portal:_1b1,PortalFolder:_1a6,PortalGroup:_1a3,PortalItem:_196,PortalComment:_192,PortalRating:_194,PortalUtil:_183,PortalResult:_17d};if(has("extend-esri")){lang.mixin(lang.getObject("arcgis",true,_179),_1bf);}return _1bf;});},"esriviewer/loader/esrirequires/EsriRequires":function(){define("esriviewer/loader/esrirequires/EsriRequires",["esri/arcgis/utils","esri/layers/FeatureLayer","esri/layers/KMLLayer","esri/layers/MapImageLayer","esri/layers/WMSLayer","esri/dijit/BasemapGallery","esri/dijit/OverviewMap","esri/arcgis/Portal"],function(_1c0){return _1c0([],{});});},"esri/layers/FeatureLayer":function(){define("esri/layers/FeatureLayer",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/date/locale","dojo/sniff","dojo/io-query","dojo/dom-construct","dojo/i18n","esri/kernel","esri/lang","esri/request","esri/deferredUtils","esri/SpatialReference","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/jsonUtils","esri/renderers/SimpleRenderer","esri/renderers/UniqueValueRenderer","esri/renderers/jsonUtils","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/FeatureSet","esri/geometry/Extent","esri/geometry/jsonUtils","esri/geometry/normalizeUtils","esri/layers/GraphicsLayer","esri/layers/Field","esri/layers/TimeInfo","esri/layers/FeatureType","esri/layers/FeatureTemplate","esri/layers/FeatureEditResult","esri/layers/SnapshotMode","esri/layers/OnDemandMode","esri/layers/SelectionMode","esri/layers/TrackManager","dojo/i18n!esri/nls/jsapi","dojo/has!extend-esri?esri/layers/agscommon"],function(_1c1,_1c2,lang,_1c3,_1c4,_1c5,_1c6,has,ioq,_1c7,i18n,_1c8,_1c9,_1ca,_1cb,_1cc,_1cd,_1ce,_1cf,_1d0,_1d1,_1d2,_1d3,_1d4,_1d5,_1d6,_1d7,_1d8,_1d9,_1da,_1db,_1dc,_1dd,_1de,_1df,_1e0,_1e1,_1e2,_1e3){var _1e4=_1c1(_1da,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",constructor:function(url,_1e5){this.i18n=i18n.getLocalization("esri","jsapi");this._outFields=_1e5&&_1e5.outFields;this._loadCallback=_1e5&&_1e5.loadCallback;var _1e6=_1e5&&_1e5._usePatch;this._usePatch=(_1e6===null||_1e6===undefined)?true:_1e6;this._trackIdField=_1e5&&_1e5.trackIdField;this.objectIdField=_1e5&&_1e5.objectIdField;this._maxOffset=_1e5&&_1e5.maxAllowableOffset;this._optEditable=_1e5&&_1e5.editable;this._optAutoGen=_1e5&&_1e5.autoGeneralize;this.editSummaryCallback=_1e5&&_1e5.editSummaryCallback;this.userId=_1e5&&_1e5.userId;this.userIsAdmin=_1e5&&_1e5.userIsAdmin;this.useMapTime=(_1e5&&_1e5.hasOwnProperty("useMapTime"))?(!!_1e5.useMapTime):true;this.source=_1e5&&_1e5.source;this.gdbVersion=_1e5&&_1e5.gdbVersion;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var ctor=this.constructor,mode=this.mode=(_1c9.isDefined(_1e5&&_1e5.mode)?_1e5.mode:ctor.MODE_ONDEMAND);switch(mode){case ctor.MODE_SNAPSHOT:this._mode=new _1e0(this);this._isSnapshot=true;break;case ctor.MODE_ONDEMAND:this._tileWidth=(_1e5&&_1e5.tileWidth)||512;this._tileHeight=(_1e5&&_1e5.tileHeight)||512;this._mode=new _1e1(this);var _1e7=_1e5&&_1e5.latticeTiling;this.latticeTiling=_1e7;break;case ctor.MODE_SELECTION:this._mode=new _1e2(this);this._isSelOnly=true;break;}this._initLayer=lang.hitch(this,this._initLayer);this._selectHandler=lang.hitch(this,this._selectHandler);this._editable=false;if(lang.isObject(url)&&url.layerDefinition){var json=url;this._collection=true;this.mode=ctor.MODE_SNAPSHOT;this._initLayer(json);return this;}this._task=new _1d4(this.url,{source:this.source,gdbVersion:this.gdbVersion});var _1e8=this._url.path;this._fserver=false;if(_1e8.search(/\/FeatureServer\//i)!==-1){this._fserver=true;}var _1e9=_1e5&&_1e5.resourceInfo;if(_1e9){this._initLayer(_1e9);}else{if(this.source){var _1ea={source:this.source.toJson()};this._url.query=lang.mixin(this._url.query,{layer:_1c4.toJson(_1ea)});}if(this.gdbVersion){this._url.query=lang.mixin(this._url.query,{gdbVersion:this.gdbVersion});}_1ca({url:_1e8,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}},_initLayer:function(_1eb,io){if(_1eb||io){this._json=_1eb;this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_1eb&&_1eb._ssl);if(ssl){this._useSSL();this._task._useSSL();}if(this._collection){this._mode=new _1e0(this);this._isSnapshot=true;this._featureSet=_1eb.featureSet;this._nextId=_1eb.nextObjectId;_1eb=_1eb.layerDefinition;}if(_1eb.hasOwnProperty("capabilities")){var _1ec=(this.capabilities=_1eb.capabilities);if(_1ec&&_1ec.toLowerCase().indexOf("editing")!==-1){this._editable=true;}else{this._editable=false;}}else{if(!this._collection){this._editable=this._fserver;}}if(_1c9.isDefined(this._optEditable)){this._editable=this._optEditable;delete this._optEditable;}this._json=_1c4.toJson(this._json);if(this.isEditable()){delete this._maxOffset;}else{if(this.mode!==this.constructor.MODE_SNAPSHOT&&((_1eb.geometryType==="esriGeometryPolyline")||(_1eb.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_1c9.isDefined(this._optAutoGen)?this._optAutoGen:(this.mode===this.constructor.MODE_ONDEMAND);delete this._optAutoGen;}}var _1ed=_1eb.effectiveMinScale||_1eb.minScale,_1ee=_1eb.effectiveMaxScale||_1eb.maxScale;if(!this._hasMin&&_1ed){this.setMinScale(_1ed);}if(!this._hasMax&&_1ee){this.setMaxScale(_1ee);}this.layerId=_1eb.id;this.name=_1eb.name;this.description=_1eb.description;this.copyright=_1eb.copyrightText;this.type=_1eb.type;this.geometryType=_1eb.geometryType;this.displayField=_1eb.displayField;this.defaultDefinitionExpression=_1eb.definitionExpression;this.fullExtent=new _1d7(_1eb.extent);this.initialExtent=new _1d7(this.fullExtent.toJson());if(this.fullExtent.spatialReference){this.spatialReference=new _1cc(this.fullExtent.spatialReference.toJson());}this.defaultVisibility=_1eb.defaultVisibility;if((this.geometryType==="esriGeometryPoint")||(this.geometryType==="esriGeometryMultipoint")){this.latticeTiling=false;}this.indexedFields=_1eb.indexedFields;this.maxRecordCount=_1eb.maxRecordCount;this.canModifyLayer=_1eb.canModifyLayer;this.supportsStatistics=_1eb.supportsStatistics;this.supportsAdvancedQueries=_1eb.supportsAdvancedQueries;this.hasLabels=_1eb.hasLabels;this.canScaleSymbols=_1eb.canScaleSymbols;this.supportsRollbackOnFailure=_1eb.supportsRollbackOnFailure;this.syncCanReturnChanges=_1eb.syncCanReturnChanges;this.isDataVersioned=_1eb.isDataVersioned;this.editFieldsInfo=_1eb.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=_1eb.ownershipBasedAccessControlForFeatures;if(this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures){this.creatorField=this.editFieldsInfo.creatorField;}this.relationships=_1eb.relationships;this.allowGeometryUpdates=_1c9.isDefined(_1eb.allowGeometryUpdates)?_1eb.allowGeometryUpdates:true;this._isTable=(this.type==="Table");var _1ef=(this.fields=[]),_1f0=_1eb.fields,i;for(i=0;i<_1f0.length;i++){_1ef.push(new _1db(_1f0[i]));}if(!this.objectIdField){this.objectIdField=_1eb.objectIdField;if(!this.objectIdField){_1f0=_1eb.fields;for(i=0;i<_1f0.length;i++){var _1f1=_1f0[i];if(_1f1.type==="esriFieldTypeOID"){this.objectIdField=_1f1.name;break;}}}if(!this.objectIdField){}}if(!_1c9.isDefined(this._nextId)){var _1f2=this.objectIdField,_1f3=-1;if(this._collection&&_1f2){var fset=this._featureSet,_1f4=fset&&fset.features,il=_1f4?_1f4.length:0,oid,attr;for(i=0;i<il;i++){attr=_1f4[i].attributes;oid=attr&&attr[_1f2];if(oid>_1f3){_1f3=oid;}}}this._nextId=(_1f3+1);}this.globalIdField=_1eb.globalIdField;var _1f5=(this.typeIdField=_1eb.typeIdField),_1f6;if(_1f5){_1f6=!this._getField(_1f5)&&this._getField(_1f5,true);if(_1f6){this.typeIdField=_1f6.name;}}this.visibilityField=_1eb.visibilityField;var _1f7=_1eb.defaultSymbol;if(_1f7){this.defaultSymbol=_1d0.fromJson(_1f7);}var _1f8=this.types=[],_1f9=_1eb.types,_1fa,_1fb,_1fc,_1fd=this.editFieldsInfo,_1fe=_1fd&&_1fd.creatorField,_1ff=_1fd&&_1fd.editorField,fix=(_1fe||_1ff),_200=[];if(_1f9){for(i=0;i<_1f9.length;i++){_1fa=new _1dd(_1f9[i]);_1fb=_1fa.templates;if(fix&&_1fb&&_1fb.length){_200=_200.concat(_1fb);}_1f8.push(_1fa);}}var _201=_1eb.templates,_202,_203=this.templates=[];if(_201){for(i=0;i<_201.length;i++){_202=new _1de(_201[i]);if(fix){_200.push(_202);}_203.push(_202);}}for(i=0;i<_200.length;i++){_1fc=lang.getObject("prototype.attributes",false,_200[i]);if(_1fc){if(_1fe){delete _1fc[_1fe];}if(_1ff){delete _1fc[_1ff];}}}var _204=_1eb.timeInfo;if(_204){this.timeInfo=new _1dc(_204);this._startTimeField=_204.startTimeField;this._endTimeField=_204.endTimeField;if(this._startTimeField&&this._endTimeField){this._twoTimeFields=true;}if(this._trackIdField){_204.trackIdField=this._trackIdField;}else{this._trackIdField=_204.trackIdField;}}this.hasAttachments=(!this._collection&&_1eb.hasAttachments)?true:false;this.htmlPopupType=_1eb.htmlPopupType;var _205=_1eb.drawingInfo,_206;if(!this.renderer){if(_205&&_205.renderer){_206=_205.renderer;this.setRenderer(_1d3.fromJson(_206));if(_206.type==="classBreaks"){this.renderer.setMaxInclusive(true);}if(!this._collection){var _207=_206.type,_208=[];_206=this.renderer;switch(_207){case "simple":_208.push(_206.symbol);break;case "uniqueValue":case "classBreaks":_208.push(_206.defaultSymbol);_208=_208.concat(_1c3.map(_206.infos,function(info){return info.symbol;}));break;}_208=_1c3.filter(_208,_1c9.isDefined);var _209=this._url.path+"/images/",_20a=this._getToken();_1c3.forEach(_208,function(sym){var url=sym.url;if(url){if((url.search(/https?\:/)===-1)&&(url.indexOf("data:")===-1)){sym.url=_209+url;}if(_20a&&sym.url.search(/https?\:/)!==-1){sym.url+=("?token="+_20a);}}});}}else{if(_1f7){_1f9=this.types;if(_1f9.length>0){_206=new _1d2(this.defaultSymbol,this.typeIdField);_1c3.forEach(_1f9,function(type){_206.addValue(type.id,type.symbol);});}else{_206=new _1d1(this.defaultSymbol);}this.setRenderer(_206);}else{if(!this._isTable){var _20b;switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":_20b=new _1cd();break;case "esriGeometryPolyline":_20b=new _1ce();break;case "esriGeometryPolygon":_20b=new _1cf();break;}this.setRenderer(_20b?new _1d1(_20b):null);}}}}var _20c=(_205&&_205.transparency)||0;if(!_1c9.isDefined(this.opacity)&&_20c>0){this.opacity=1-(_20c/100);}this.version=_1eb.currentVersion;if(!this.version){var ver;if("capabilities" in _1eb||"drawingInfo" in _1eb||"hasAttachments" in _1eb||"htmlPopupType" in _1eb||"relationships" in _1eb||"timeInfo" in _1eb||"typeIdField" in _1eb||"types" in _1eb){ver=10;}else{ver=9.3;}this.version=ver;}if((has("ie")||has("safari"))&&this.isEditable()&&this.version<10.02){this._ts=true;}this.loaded=true;this._fixRendererFields();this._checkFields();this._updateCaps();var _20d=function(){this.onLoad(this);var _20e=this._loadCallback;if(_20e){delete this._loadCallback;_20e(this);}};if(this._collection){this._fireUpdateStart();var _20f=this._featureSet;delete this._featureSet;this._mode._drawFeatures(new _1d6(_20f));this._fcAdded=true;_20d.call(this);}else{this._forceIdentity(_20d);}}},setRenderer:function(ren){this.inherited("setRenderer",arguments);var _210=this.renderer;if(_210){this._ager=(_210.declaredClass.indexOf("TemporalRenderer")!==-1&&_210.observationAger&&_210.observationRenderer);var _211=_1c3.filter([_210,_210.observationRenderer,_210.latestObservationRenderer,_210.trackRenderer],_1c9.isDefined);var _212=[];_1c3.forEach(_211,function(rnd){if(!lang.isFunction(rnd.attributeField)){_212.push(rnd.attributeField);}_212.push(rnd.attributeField2);_212.push(rnd.attributeField3);},this);this._rendererFields=_1c3.filter(_212,_1c9.isDefined);}else{this._ager=false;this._rendererFields=[];}if(this.loaded&&this._rendererFields.length>0){this._fixRendererFields();this._checkFields(this._rendererFields);}if(this.loaded&&this._collection){this._typesDirty=true;}},_setMap:function(map){var div=this.inherited(arguments),mode=this._mode;if(mode){mode.initialize(map);}return div;},_unsetMap:function(map){var mode=this._mode;if(mode){mode.suspend();}if(this._trackManager){this._trackManager.destroy();this._trackManager=null;}_1c2.disconnect(this._zoomConnect);this._zoomConnect=null;this._toggleTime(false);this.inherited("_unsetMap",arguments);},refresh:function(){var mode=this._mode;if(mode){mode.refresh();}},setEditable:function(_213){if(!this._collection){return this;}if(!this.loaded){this._optEditable=_213;return this;}var _214=this._editable;this._editable=_213;this._updateCaps();if(_214!==_213){this.onCapabilitiesChange();}return this;},getEditCapabilities:function(_215){var _216={"canCreate":false,"canUpdate":false,"canDelete":false};if(!this.loaded||!this.isEditable()){return _216;}var _217=_215&&_215.feature,_218=_215&&_215.userId,caps=_1c3.map((this.capabilities?this.capabilities.toLowerCase().split(","):[]),lang.trim),_219=_1c3.indexOf(caps,"editing")>-1,_21a=_219&&(_1c3.indexOf(caps,"create")>-1),_21b=_219&&(_1c3.indexOf(caps,"update")>-1),_21c=_219&&(_1c3.indexOf(caps,"delete")>-1),_21d=this.ownershipBasedAccessControlForFeatures,_21e=this.editFieldsInfo,_21f=_21e&&_21e.creatorField,_220=_21e&&_21e.realm,_221=_217&&_217.attributes,_222=(_221&&_21f)?_221[_21f]:undefined,_223,_224=!!this.userIsAdmin,_225=!_21d||_224||!!(_21d.allowOthersToUpdate||_21d.allowUpdateToOthers),_226=!_21d||_224||!!(_21d.allowOthersToDelete||_21d.allowDeleteToOthers);if(_224||(_219&&!(_21a||_21b||_21c))){_21a=_21b=_21c=true;}_223={"canCreate":_21a,"canUpdate":_21b,"canDelete":_21c};if(_222===null){_223.canUpdate=_21b&&_225;_223.canDelete=_21c&&_226;}else{if(_222===""){return _223;}else{if(_222){_218=_218||this.getUserId();if(_218&&_220){_218=_218+"@"+_220;}if(_218.toLowerCase()===_222.toLowerCase()){return _223;}else{_223.canUpdate=_21b&&_225;_223.canDelete=_21c&&_226;}}}}return _223;},getUserId:function(){var _227;if(this.loaded){_227=(this.credential&&this.credential.userId)||this.userId||"";}return _227;},setUserIsAdmin:function(_228){this.userIsAdmin=_228;},setEditSummaryCallback:function(_229){this.editSummaryCallback=_229;},getEditSummary:function(_22a,_22b,_22c){_22c=_1c9.isDefined(_22c)?_22c:(new Date()).getTime();var _22d="",info=this.getEditInfo(_22a,_22b,_22c),_22e=(_22b&&_22b.callback)||this.editSummaryCallback;if(_22e){info=_22e(_22a,info)||"";}if(lang.isString(info)){_22d=info;}else{if(info){var _22f=info.action,_230=info.userId,_231=info.timeValue,_232=0;if(_22f){_232++;}if(_230){_232++;}if(_1c9.isDefined(_231)){_232++;}if(_232>1){_22d=(_22f==="edit"?"edit":"create")+(_230?"User":"")+(_1c9.isDefined(_231)?info.displayPattern:"");}}_22d=_22d&&_1c9.substitute(info,this.i18n.layers.FeatureLayer[_22d]);}return _22d;},getEditInfo:function(_233,_234,_235){if(!this.loaded){return;}_235=_1c9.isDefined(_235)?_235:(new Date()).getTime();var _236=(_234&&_234.action)||"last",_237=this.editFieldsInfo,_238=_237&&_237.creatorField,_239=_237&&_237.creationDateField,_23a=_237&&_237.editorField,_23b=_237&&_237.editDateField,_23c=_237&&_237.realm,_23d=_233&&_233.attributes,_23e=(_23d&&_238)?_23d[_238]:undefined,_23f=(_23d&&_239)?_23d[_239]:null,_240=(_23d&&_23a)?_23d[_23a]:undefined,_241=(_23d&&_23b)?_23d[_23b]:null,_242=this._getEditData(_23e,_23f,_235),_243=this._getEditData(_240,_241,_235),_244;switch(_236){case "creation":_244=_242;break;case "edit":_244=_243;break;case "last":_244=_243||_242;break;}if(_244){_244.action=(_244===_243)?"edit":"creation";}return _244;},_getEditData:function(_245,_246,_247){var data,_248,_249,_24a=60000,_24b=3600000,_24c=2*_24b,_24d=24*_24b,_24e=7*_24d;if(_1c9.isDefined(_246)){_248=_247-_246;if(_248<0){_249="Full";}else{if(_248<_24a){_249="Seconds";}else{if(_248<(2*_24a)){_249="Minute";}else{if(_248<_24b){_249="Minutes";}else{if(_248<_24c){_249="Hour";}else{if(_248<_24d){_249="Hours";}else{if(_248<_24e){_249="WeekDay";}else{_249="Full";}}}}}}}}if((_245!==undefined)||_249){data=data||{};data.userId=_245;if(_249){var _24f=_1c6.format,_250=new Date(_246);data.minutes=Math.floor(_248/_24a);data.hours=Math.floor(_248/_24b);data.weekDay=_24f(_250,{datePattern:"EEEE",selector:"date"});data.formattedDate=_24f(_250,{selector:"date"});data.formattedTime=_24f(_250,{selector:"time"});data.displayPattern=_249;data.timeValue=_246;}}return data;},isEditable:function(){return !!(this._editable||this.userIsAdmin);},setMaxAllowableOffset:function(_251){if(!this.isEditable()){this._maxOffset=_251;}return this;},getMaxAllowableOffset:function(){return this._maxOffset;},setAutoGeneralize:function(_252){if(!this.loaded){this._optAutoGen=_252;}else{if(!this.isEditable()&&(this.mode!==this.constructor.MODE_SNAPSHOT)&&((this.geometryType==="esriGeometryPolyline")||(this.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_252;if(_252){var map=this._map;if(map&&map.loaded){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}else{delete this._maxOffset;}}}return this;},setGDBVersion:function(_253){if(!this._collection&&(_253!==this.gdbVersion)&&(_253||this.gdbVersion)){this.gdbVersion=_253;this._task.gdbVersion=_253;this._url.query=lang.mixin(this._url.query,{gdbVersion:_253});if(this.loaded){this.clearSelection();if(this._map){this.refresh();}}this.onGDBVersionChange();}return this;},setDefinitionExpression:function(expr){this._defnExpr=expr;var mode=this._mode;if(mode){mode.propertyChangeHandler(1);}return this;},getDefinitionExpression:function(){return this._defnExpr;},setTimeDefinition:function(_254){if(this._isSnapshot){this._timeDefn=_254;var mode=this._mode;if(mode){mode.propertyChangeHandler(2);}}else{}return this;},getTimeDefinition:function(){return this._timeDefn;},setTimeOffset:function(_255,_256){this._timeOffset=_255;this._timeOffsetUnits=_256;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}return this;},setUseMapTime:function(use){this.useMapTime=use;this._toggleTime(!this.suspended);var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},selectFeatures:function(_257,_258,_259,_25a){_258=_258||this.constructor.SELECTION_NEW;var _25b=this._getShallowClone(_257),map=this._map,_25c,dfd=_1cb._fixDfd(new _1c5(_1cb._dfdCanceller));_25b.outFields=this._getOutFields();_25b.returnGeometry=true;if(map){_25b.outSpatialReference=new _1cc(map.spatialReference.toJson());}if(!this._applyQueryFilters(_25b)){_25c={features:[]};this._selectHandler(_25c,_258,_259,_25a,dfd);return dfd;}var _25d=this._canDoClientSideQuery(_25b);if(_25d){_25c={features:this._doQuery(_25b,_25d)};this._selectHandler(_25c,_258,_259,_25a,dfd);return dfd;}else{if(this._collection){var err=new Error("FeatureLayer::selectFeatures - "+this.invalidParams);this._resolve([err],null,_25a,dfd,true);return dfd;}var self=this;if(this._ts){_25b._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task.execute(_25b);temp.addCallbacks(function(_25e){self._selectHandler(_25e,_258,_259,_25a,dfd);},function(err){self._resolve([err],null,_25a,dfd,true);});return dfd;}},getSelectedFeatures:function(){var _25f=this._selectedFeatures,_260=[],item;for(item in _25f){if(_25f.hasOwnProperty(item)){_260.push(_25f[item]);}}return _260;},clearSelection:function(_261){var _262=this._selectedFeatures,mode=this._mode,item;for(item in _262){if(_262.hasOwnProperty(item)){this._unSelectFeatureIIf(item,mode);mode._removeFeatureIIf(item);}}this._selectedFeatures={};if(this._isSelOnly){mode._applyTimeFilter(true);}if(!_261){this.onSelectionClear();}return this;},setSelectionSymbol:function(_263){this._selectionSymbol=_263;if(_263){var _264=this._selectedFeatures,item;for(item in _264){if(_264.hasOwnProperty(item)){_264[item].setSymbol(_263);}}}return this;},getSelectionSymbol:function(){return this._selectionSymbol;},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(adds,_265,_266,_267,_268,_269){var _26a=_269.assembly,dfd=_269.dfd;this._applyNormalized(adds,_26a&&_26a[0]);this._applyNormalized(_265,_26a&&_26a[1]);this.onBeforeApplyEdits(adds,_265,_266);var i,_26b={},_26c=this.objectIdField,_26d={f:"json"},_26e=false;if(this._collection){var _26f={};_26f.addResults=adds?_1c3.map(adds,function(){_26e=true;return {objectId:this._nextId++,success:true};},this):null;_26f.updateResults=_265?_1c3.map(_265,function(_270){_26e=true;var oid=_270.attributes[_26c];_26b[oid]=_270;return {objectId:oid,success:true};},this):null;_26f.deleteResults=_266?_1c3.map(_266,function(_271){_26e=true;return {objectId:_271.attributes[_26c],success:true};},this):null;if(_26e){this._editHandler(_26f,adds,_26b,_267,_268,dfd);}return;}if(adds&&adds.length>0){_26d.adds=this._convertFeaturesToJson(adds,0,1);_26e=true;}if(_265&&_265.length>0){for(i=0;i<_265.length;i++){var _272=_265[i];_26b[_272.attributes[_26c]]=_272;}_26d.updates=this._convertFeaturesToJson(_265,0,0,1);_26e=true;}if(_266&&_266.length>0){var ids=[];for(i=0;i<_266.length;i++){ids.push(_266[i].attributes[_26c]);}_26d.deletes=ids.join(",");_26e=true;}if(_26e){var self=this;return _1ca({url:this._url.path+"/applyEdits",content:lang.mixin(_26d,this._url.query),callbackParamName:"callback",load:function(_273){self._editHandler(_273,adds,_26b,_267,_268,dfd);},error:function(err){self._resolve([err],null,_268,dfd,true);}},{usePost:true});}},queryFeatures:function(_274,_275,_276){return this._query("execute","onQueryFeaturesComplete",_274,_275,_276);},queryRelatedFeatures:function(_277,_278,_279){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",_277,_278,_279);},queryIds:function(_27a,_27b,_27c){return this._query("executeForIds","onQueryIdsComplete",_27a,_27b,_27c);},queryCount:function(_27d,_27e,_27f){return this._query("executeForCount","onQueryCountComplete",_27d,_27e,_27f);},queryAttachmentInfos:function(_280,_281,_282){var url=this._url.path+"/"+_280+"/attachments",dfd=new _1c5(_1cb._dfdCanceller),self=this;dfd._pendingDfd=_1ca({url:url,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(_283){var _284=_283.attachmentInfos,_285;_1c3.forEach(_284,function(info){_285=ioq.objectToQuery({gdbVersion:self._url.query&&self._url.query.gdbVersion,layer:self._url.query&&self._url.query.layer,token:self._getToken()});info.url=url+"/"+info.id+(_285?("?"+_285):"");info.objectId=_280;});self._resolve([_284],"onQueryAttachmentInfosComplete",_281,dfd);},error:function(err){self._resolve([err],null,_282,dfd,true);}});return dfd;},addAttachment:function(_286,_287,_288,_289){return this._sendAttachment("add",_286,_287,_288,_289);},updateAttachment:function(_28a,_28b,_28c,_28d,_28e){_28c.appendChild(_1c7.create("input",{type:"hidden",name:"attachmentId",value:_28b}));return this._sendAttachment("update",_28a,_28c,_28d,_28e);},deleteAttachments:function(_28f,_290,_291,_292){var url=this._url.path+"/"+_28f+"/deleteAttachments",dfd=new _1c5(_1cb._dfdCanceller),self=this,_293={f:"json",attachmentIds:_290.join(",")};dfd._pendingDfd=_1ca({url:url,content:lang.mixin(_293,this._url.query),callbackParamName:"callback",load:lang.hitch(this,function(_294){var _295=_294.deleteAttachmentResults;_295=_1c3.map(_295,function(_296){var res=new _1df(_296);res.attachmentId=res.objectId;res.objectId=_28f;return res;});self._resolve([_295],"onDeleteAttachmentsComplete",_291,dfd);}),error:function(err){self._resolve([err],null,_292,dfd,true);}},{usePost:true});return dfd;},addType:function(_297){var _298=this.types;if(_298){var _299=_1c3.some(_298,function(type){if(type.id==_297.id){return true;}return false;});if(_299){return false;}else{_298.push(_297);}}else{this.types=[_297];}this._typesDirty=true;return true;},deleteType:function(_29a){if(!this._collection){return;}var _29b=this.types;if(_29b){var _29c=-1;_1c3.some(_29b,function(type,_29d){if(type.id==_29a){_29c=_29d;return true;}return false;});if(_29c>-1){this._typesDirty=true;return _29b.splice(_29c,1)[0];}}},toJson:function(){var _29e=this._json,json=lang.isString(_29e)?_1c4.fromJson(_29e):lang.clone(_29e);if(!json){return;}json=json.layerDefinition?json:{layerDefinition:json};var _29f=json.layerDefinition,_2a0=this._collection;if(_2a0&&this._typesDirty){_29f.types=_1c3.map(this.types||[],function(type){return type.toJson();});var _2a1=this.renderer,_2a2=_29f.drawingInfo;if(_2a2&&_2a1&&_2a1.declaredClass.indexOf("TemporalRenderer")===-1){_2a2.renderer=_2a1.toJson();}}var _2a3=null;if(!(_2a0&&!this._fcAdded)){_2a3={geometryType:_29f.geometryType,features:this._convertFeaturesToJson(this.graphics,true)};}json.featureSet=lang.mixin({},json.featureSet||{},_2a3);if(_2a0){json.nextObjectId=this._nextId;_29f.capabilities=this.capabilities;}return json;},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(_2a4){var self=this,path=this._url&&this._url.path;if((this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&path&&_1c8.id&&_1c8.id._hasPortalSession()&&_1c8.id._doPortalSignIn(path)){_1c8.id.getCredential(path).then(function(){self._findCredential();_2a4.call(self);},function(){_2a4.call(self);});}else{_2a4.call(this);}},_updateCaps:function(){var _2a5=this._editable,_2a6=lang.trim(this.capabilities||""),_2a7=_1c3.map((_2a6?_2a6.split(","):[]),lang.trim),caps=_1c3.map((_2a6?_2a6.toLowerCase().split(","):[]),lang.trim),_2a8=_1c3.indexOf(caps,"editing"),cap,i,_2a9,_2aa={"Create":_1c3.indexOf(caps,"create"),"Update":_1c3.indexOf(caps,"update"),"Delete":_1c3.indexOf(caps,"delete")};if(_2a5&&_2a8===-1){_2a7.push("Editing");}else{if(!_2a5&&_2a8>-1){_2a9=[_2a8];for(cap in _2aa){if(_2aa[cap]>-1){_2a9.push(_2aa[cap]);}}_2a9.sort();for(i=_2a9.length-1;i>=0;i--){_2a7.splice(_2a9[i],1);}}}this.capabilities=_2a7.join(",");},_counter:{value:0},_getUniqueId:function(){return this._counter.value++;},onSuspend:function(){this.inherited(arguments);this._toggleTime(false);var mode=this._mode;if(mode){mode.suspend();}},onResume:function(evt){this.inherited(arguments);this._toggleTime(true);this._updateMaxOffset();var mode=this._mode,map=this._map,_2ab=this.renderer;if(evt.firstOccurrence){this.clearSelection();if(this.timeInfo){if(this._trackIdField||(_2ab&&(_2ab.latestObservationRenderer||_2ab.trackRenderer))){this._trackManager=new _1e3(this);this._trackManager.initialize(map);}}this._zoomConnect=_1c2.connect(map,"onZoomEnd",this,this._updateMaxOffset);}if(mode){evt.firstOccurrence?mode.startup():mode.resume();}},_updateMaxOffset:function(){var map=this._map;if(map&&map.loaded){if(this._autoGeneralize){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}},_toggleTime:function(_2ac){var map=this._map;if(_2ac&&this.timeInfo&&this.useMapTime&&map){this._mapTimeExtent=map.timeExtent;if(!this._timeConnect){this._timeConnect=_1c2.connect(map,"onTimeExtentChange",this,this._timeChangeHandler);}}else{this._mapTimeExtent=null;_1c2.disconnect(this._timeConnect);this._timeConnect=null;}},_timeChangeHandler:function(_2ad){this._mapTimeExtent=_2ad;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},_getOffsettedTE:function(_2ae){var _2af=this._timeOffset,_2b0=this._timeOffsetUnits;return (_2ae&&_2af&&_2b0)?_2ae.offset(-1*_2af,_2b0):_2ae;},_getTimeOverlap:function(_2b1,_2b2){if(_2b1&&_2b2){return _2b1.intersection(_2b2);}else{return _2b1||_2b2;}},_getTimeFilter:function(_2b3){var _2b4=this.getTimeDefinition(),_2b5=null,_2b6;if(_2b4||_2b5){_2b6=this._getTimeOverlap(_2b4,_2b5);if(!_2b6){return [false];}}if(_2b3){_2b3=_2b6?this._getTimeOverlap(_2b3,_2b6):_2b3;if(!_2b3){return [false];}}else{_2b3=_2b6;}return [true,_2b3];},_getAttributeFilter:function(_2b7){var _2b8=this.getDefinitionExpression();if(_2b7){_2b7=_2b8?"("+_2b8+") AND ("+_2b7+")":_2b7;}else{_2b7=_2b8;}return _2b7;},_applyQueryFilters:function(_2b9){_2b9.where=this._getAttributeFilter(_2b9.where);_2b9.maxAllowableOffset=this._maxOffset;if(this.timeInfo){var _2ba=this._getTimeFilter(_2b9.timeExtent);if(!_2ba[0]){return false;}else{_2b9.timeExtent=_2ba[1];}}return true;},_add:function(_2bb){var _2bc=this._selectionSymbol,attr=_2bb.attributes,_2bd=this.visibilityField;if(_2bc&&this._isSelOnly){_2bb.setSymbol(_2bc);}if(_2bd&&attr&&attr.hasOwnProperty(_2bd)){_2bb[attr[_2bd]?"show":"hide"]();}return this.add.apply(this,arguments);},_remove:function(){return this.remove.apply(this,arguments);},_canDoClientSideQuery:function(_2be){var _2bf=[],map=this._map;if(this._isTable||!map){return;}if(_2be.text||(_2be.where&&_2be.where!==this.getDefinitionExpression())){return;}var _2c0=this._isSnapshot,_2c1=this._isSelOnly;var _2c2=_2be.geometry;if(_2c2){if(!_2c1&&_2be.spatialRelationship===_1d5.SPATIAL_REL_INTERSECTS&&(_2c2.type==="extent"&&(_2c0||map.extent.contains(_2c2)))){_2bf.push(1);}else{return;}}var ids=_2be.objectIds;if(ids){if(_2c0){_2bf.push(2);}else{var len=ids.length,mode=this._mode,_2c3=0,i;for(i=0;i<len;i++){if(mode._getFeature(ids[i])){_2c3++;}}if(_2c3===len){_2bf.push(2);}else{return;}}}if(this.timeInfo){var _2c4=_2be.timeExtent,_2c5=this._mapTimeExtent;if(_2c0){if(_2c4){_2bf.push(3);}}else{if(_2c1){if(_2c4){return;}}else{if(_2c5){if(_1c3.indexOf(_2bf,2)!==-1){if(_2c4){_2bf.push(3);}}else{return;}}else{if(_2bf.length>0){if(_2c4){_2bf.push(3);}}else{if(_2c4){return;}}}}}}return _2bf.length>0?_2bf:null;},_doQuery:function(_2c6,_2c7,_2c8){var _2c9=[],mode=this._mode,_2ca=this.objectIdField,i,len,_2cb;if(_1c3.indexOf(_2c7,2)!==-1){_2c9=[];var ids=_2c6.objectIds;len=ids.length;for(i=0;i<len;i++){var obj=mode._getFeature(ids[i]);if(obj){_2c9.push(obj);}}if(_2c9.length===0){return [];}}if(_1c3.indexOf(_2c7,1)!==-1){_2cb=_2c9.length>0?_2c9:this.graphics;len=_2cb.length;var _2cc=_2c6.geometry._normalize(null,true);_2c9=[];for(i=0;i<len;i++){var _2cd=_2cb[i],_2ce=_2cd.geometry;if(_2ce){if(this.normalization&&_2cc.length){if(_2cc[0].intersects(_2ce)||_2cc[1].intersects(_2ce)){_2c9.push(_2cd);}}else{if(_2cc.intersects(_2ce)){_2c9.push(_2cd);}}}}if(_2c9.length===0){return [];}}if(_1c3.indexOf(_2c7,3)!==-1){if(this.timeInfo){_2cb=_2c9.length>0?_2c9:this.graphics;var time=_2c6.timeExtent,_2cf=this._filterByTime(_2cb,time.startTime,time.endTime);_2c9=_2cf.match;}}if(_2c8){return _1c3.map(_2c9,function(obj){return obj.attributes[_2ca];},this);}else{return _2c9;}},_filterByTime:function(_2d0,_2d1,_2d2){var _2d3=this._startTimeField,_2d4=this._endTimeField,_2d5;if(!this._twoTimeFields){_2d5=_2d3||_2d4;}var _2d6=_1c9.isDefined,yea=[],nay=[],i,len=_2d0.length,_2d7,_2d8;_2d1=_2d1?_2d1.getTime():-Infinity;_2d2=_2d2?_2d2.getTime():Infinity;if(_2d5){for(i=0;i<len;i++){_2d7=_2d0[i];_2d8=_2d7.attributes;var time=_2d8[_2d5];if(time>=_2d1&&time<=_2d2){yea.push(_2d7);}else{nay.push(_2d7);}}}else{for(i=0;i<len;i++){_2d7=_2d0[i];_2d8=_2d7.attributes;var _2d9=_2d8[_2d3],end=_2d8[_2d4];_2d9=_2d6(_2d9)?_2d9:-Infinity;end=_2d6(end)?end:Infinity;if((_2d9>=_2d1&&_2d9<=_2d2)||(end>=_2d1&&end<=_2d2)||(_2d1>=_2d9&&_2d2<=end)){yea.push(_2d7);}else{nay.push(_2d7);}}}return {match:yea,noMatch:nay};},_resolve:function(args,_2da,_2db,dfd,_2dc){if(_2da){this[_2da].apply(this,args);}if(_2db){_2db.apply(null,args);}if(dfd){_1cb._resDfd(dfd,args,_2dc);}},_getShallowClone:function(_2dd){var _2de=new _1d5(),prop;for(prop in _2dd){if(_2dd.hasOwnProperty(prop)){_2de[prop]=_2dd[prop];}}return _2de;},_query:function(type,_2df,_2e0,_2e1,_2e2){var that=this,map=this._map,dfd=new _1c5(_1cb._dfdCanceller),_2e3=_2e0;var _2e4=function(_2e5,_2e6){if(!_2e6&&type==="execute"&&!that._isTable){var _2e7=_2e5.features,mode=that._mode,_2e8=that.objectIdField,il=_2e7.length,i;for(i=il-1;i>=0;i--){var oid=_2e7[i].attributes[_2e8];var _2e9=mode._getFeature(oid);if(_2e9){_2e7.splice(i,1,_2e9);}}}that._resolve([_2e5],_2df,_2e1,dfd);};if(type!=="executeRelationshipQuery"){_2e3=this._getShallowClone(_2e0);_2e3.outFields=this._getOutFields();_2e3.returnGeometry=(!map&&_2e0.hasOwnProperty("returnGeometry"))?_2e0.returnGeometry:true;var _2ea;if(map){_2e3.outSpatialReference=new _1cc(map.spatialReference.toJson());}if(!this._applyQueryFilters(_2e3)){switch(type){case "execute":_2ea=new _1d6({features:[]});break;case "executeForIds":_2ea=[];break;case "executeForCount":_2ea=0;break;}_2e4(_2ea,true);return dfd;}var _2eb=this._canDoClientSideQuery(_2e3);if(_2eb){var _2ec=this._doQuery(_2e3,_2eb,(type==="executeForIds"||type==="executeForCount"));switch(type){case "execute":_2ea=new _1d6();_2ea.features=_2ec;break;case "executeForIds":_2ea=_2ec;break;case "executeForCount":_2ea=_2ec.length;break;}_2e4(_2ea,true);return dfd;}}if(this._collection){var err=new Error("FeatureLayer::_query - "+this.invalidParams);this._resolve([err],null,_2e2,dfd,true);return dfd;}if(this._ts){_2e3._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task[type](_2e3);temp.addCallbacks(_2e4,function(err){that._resolve([err],null,_2e2,dfd,true);});return dfd;},_convertFeaturesToJson:function(_2ed,_2ee,_2ef,_2f0){var json=[],_2f1=this._selectionSymbol,_2f2=this.visibilityField,i,_2f3,_2f4=this.objectIdField;if(this.loaded&&(_2ef||_2f0)){_2f3=_1c3.filter(this.fields,function(_2f5){return (_2f5.editable===false)&&(!_2f0||(_2f5.name!==_2f4));});}for(i=0;i<_2ed.length;i++){var _2f6=_2ed[i],_2f7={},_2f8=_2f6.geometry,attr=_2f6.attributes,_2f9=_2f6.symbol;if(_2f8&&(!_2f0||!this.loaded||this.allowGeometryUpdates)){_2f7.geometry=_2f8.toJson();}if(_2f2){_2f7.attributes=attr=lang.mixin({},attr);attr[_2f2]=_2f6.visible?1:0;}else{if(attr){_2f7.attributes=lang.mixin({},attr);}}if(_2f7.attributes&&_2f3&&_2f3.length){_1c3.forEach(_2f3,function(_2fa){delete _2f7.attributes[_2fa.name];});}if(_2f9&&(_2f9!==_2f1)){_2f7.symbol=_2f9.toJson();}json.push(_2f7);}return _2ee?json:_1c4.toJson(json);},_selectHandler:function(_2fb,_2fc,_2fd,_2fe,dfd){var _2ff,ctor=this.constructor;switch(_2fc){case ctor.SELECTION_NEW:this.clearSelection(true);_2ff=true;break;case ctor.SELECTION_ADD:_2ff=true;break;case ctor.SELECTION_SUBTRACT:_2ff=false;break;}var i,_300=_2fb.features,mode=this._mode,_301=[],_302=this.objectIdField,_303,oid;if(_2ff){for(i=0;i<_300.length;i++){_303=_300[i];oid=_303.attributes[_302];var _304=mode._addFeatureIIf(oid,_303);_301.push(_304);this._selectFeatureIIf(oid,_304,mode);}}else{for(i=0;i<_300.length;i++){_303=_300[i];oid=_303.attributes[_302];this._unSelectFeatureIIf(oid,mode);var _305=mode._removeFeatureIIf(oid);_301.push(_305||_303);}}if(this._isSelOnly){mode._applyTimeFilter(true);}this._resolve([_301,_2fc,_2fb.exceededTransferLimit?{queryLimitExceeded:true}:null],"onSelectionComplete",_2fd,dfd);if(_2fb.exceededTransferLimit){this.onQueryLimitExceeded();}},_selectFeatureIIf:function(oid,_306,mode){var _307=this._selectedFeatures,_308=_307[oid];if(!_308){mode._incRefCount(oid);_307[oid]=_306;if(!this._isTable){this._setSelectSymbol(_306);}}return _308||_306;},_unSelectFeatureIIf:function(oid,mode){var _309=this._selectedFeatures[oid];if(_309){mode._decRefCount(oid);delete this._selectedFeatures[oid];if(!this._isTable){this._setUnSelectSymbol(_309);}}return _309;},_isSelected:function(_30a){},_setSelectSymbol:function(_30b){var _30c=this._selectionSymbol;if(_30c&&!this._isSelOnly){_30b.setSymbol(_30c);}},_setUnSelectSymbol:function(_30d){var _30e=this._selectionSymbol;if(_30e&&!this._isSelOnly){if(_30e===_30d.symbol){_30d.setSymbol(null,true);}}},_getOutFields:function(){var _30f=_1c3.filter([this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields),function(_310,_311,arr){return !!_310&&(_1c3.indexOf(arr,_310)===_311);});var _312=lang.clone(this._outFields);if(_312){if(_1c3.indexOf(_312,"*")!==-1){return _312;}_1c3.forEach(_30f,function(_313){if(_1c3.indexOf(_312,_313)===-1){_312.push(_313);}});return _312;}else{return _30f;}},_checkFields:function(_314){var _315=_314||this._getOutFields();_1c3.forEach(_315,function(_316){if(_316==="*"){return;}if(!this._getField(_316)){}},this);if(!_314&&!this._isTable&&!this._fserver&&!this._collection){var _317=_1c3.some(this.fields,function(_318){return (_318&&_318.type==="esriFieldTypeGeometry")?true:false;});if(!_317){}}},_fixRendererFields:function(){var _319=this.renderer;if(_319&&this.fields.length>0){var _31a=_1c3.filter([_319,_319.observationRenderer,_319.latestObservationRenderer,_319.trackRenderer],_1c9.isDefined);var _31b=[];_1c3.forEach(_31a,function(rnd){var _31c,_31d;_31d=rnd.attributeField;if(_31d&&!lang.isFunction(_31d)){_31c=!this._getField(_31d)&&this._getField(_31d,true);if(_31c){rnd.attributeField=_31c.name;}}_31d=rnd.attributeField2;if(_31d){_31c=!this._getField(_31d)&&this._getField(_31d,true);if(_31c){rnd.attributeField2=_31c.name;}}_31d=rnd.attributeField3;if(_31d){_31c=!this._getField(_31d)&&this._getField(_31d,true);if(_31c){rnd.attributeField3=_31c.name;}}if(!lang.isFunction(rnd.attributeField)){_31b.push(rnd.attributeField);}_31b.push(rnd.attributeField2);_31b.push(rnd.attributeField3);},this);this._rendererFields=_1c3.filter(_31b,_1c9.isDefined);}},_getField:function(_31e,_31f){var _320=this.fields;if(_320.length===0){return null;}var _321;if(_31f){_31e=_31e.toLowerCase();}_1c3.some(_320,function(_322){var _323=false;if(_31f){_323=(_322&&_322.name.toLowerCase()===_31e)?true:false;}else{_323=(_322&&_322.name===_31e)?true:false;}if(_323){_321=_322;}return _323;});return _321;},_getDateOpts:function(){if(!this._dtOpts){var _324=_1c3.map(_1c3.filter(this.fields,function(_325){return !!(_325&&_325.type==="esriFieldTypeDate");}),function(_326){return _326.name;});this._dtOpts={properties:_324};}return this._dtOpts;},_applyNormalized:function(_327,_328){if(_327&&_328){_1c3.forEach(_327,function(_329,_32a){if(_329&&_328[_32a]){_329.setGeometry(_328[_32a]);}});}},_editHandler:function(_32b,adds,_32c,_32d,_32e,dfd){var _32f=_32b.addResults,_330=_32b.updateResults,_331=_32b.deleteResults,i,_332,oid,_333,attr,_334=this.objectIdField,mode=this._mode,_335=this._isTable;var _336=this.editFieldsInfo,_337=this._getOutFields()||[],_338=_336&&_336.creatorField,_339=_336&&_336.creationDateField,_33a=_336&&_336.editorField,_33b=_336&&_336.editDateField,_33c=_336&&_336.realm;if(_1c3.indexOf(_337,"*")===-1){if(_338&&_1c3.indexOf(_337,_338)===-1){_338=null;}if(_339&&_1c3.indexOf(_337,_339)===-1){_339=null;}if(_33a&&_1c3.indexOf(_337,_33a)===-1){_33a=null;}if(_33b&&_1c3.indexOf(_337,_33b)===-1){_33b=null;}}var _33d=(_339||_33b)?(new Date()).getTime():null,_33e=(_338||_33a)?this.getUserId():undefined;if(_33e&&_33c){_33e=_33e+"@"+_33c;}if(_32f){for(i=0;i<_32f.length;i++){_32f[i]=new _1df(_32f[i]);if(_335){continue;}_332=_32f[i];if(_332.success){oid=_332.objectId;_333=adds[i];var gl=_333._graphicsLayer;if(gl&&gl!==this){gl.remove(_333);}attr=_333.attributes||{};attr[_334]=oid;if(_338){attr[_338]=_33e;}if(_33a){attr[_33a]=_33e;}if(_339){attr[_339]=_33d;}if(_33b){attr[_33b]=_33d;}_333.setAttributes(attr);if(mode._init){mode.drawFeature(_333);}}}}if(_330){for(i=0;i<_330.length;i++){_330[i]=new _1df(_330[i]);if(_335){continue;}_332=_330[i];if(_332.success){oid=_332.objectId;_333=_32c[oid];var _33f=mode._getFeature(oid);if(_33f){if(_33f.geometry!==_333.geometry){_33f.setGeometry(_1d8.fromJson(_333.geometry.toJson()));}this._repaint(_33f,oid);}_333=_33f||_333;attr=_333.attributes||{};if(_33a){attr[_33a]=_33e;}if(_33b){attr[_33b]=_33d;}_333.setAttributes(attr);}}}if(_331){var _340=[];for(i=0;i<_331.length;i++){_331[i]=new _1df(_331[i]);if(_335){continue;}_332=_331[i];if(_332.success){oid=_332.objectId;_333=mode._getFeature(oid);if(_333){if(this._unSelectFeatureIIf(oid,mode)){_340.push(_333);}_333._count=0;mode._removeFeatureIIf(oid);}}}if(_340.length>0){this.onSelectionComplete(_340,this.constructor.SELECTION_SUBTRACT);}}this._resolve([_32f,_330,_331],"onEditsComplete",_32d,dfd);},_sendAttachment:function(type,_341,_342,_343,_344){var _345=(type==="add")?"addAttachment":"updateAttachment",url=this._url.path+"/"+_341+"/"+_345,self=this;var dfd=_1ca({url:url,form:_342,content:lang.mixin(this._url.query,{f:"json",token:this._getToken()||undefined}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(_346){var _347=(type==="add")?"addAttachmentResult":"updateAttachmentResult",_348=(type==="add")?"onAddAttachmentComplete":"onUpdateAttachmentComplete",_349=new _1df(_346[_347]);_349.attachmentId=_349.objectId;_349.objectId=_341;self._resolve([_349],_348,_343);return _349;}).addErrback(function(_34a){self._resolve([_34a],null,_344,null,true);});return dfd;},_repaint:function(_34b,oid,_34c){oid=_1c9.isDefined(oid)?oid:_34b.attributes[this.objectIdField];if(!(oid in this._selectedFeatures)||!this._selectionSymbol){_34b.setSymbol(_34b.symbol,_34c);}},_getKind:function(_34d){var _34e=this._trackManager;if(_34e){return _34e.isLatestObservation(_34d)?1:0;}return 0;}});lang.mixin(_1e4,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});_1d9._createWrappers(_1e4);if(has("extend-esri")){lang.setObject("layers.FeatureLayer",_1e4,_1c8);}return _1e4;});},"url:esri/dijit/templates/OverviewMap.html":"<div class=\"esriOverviewMap\">\r\n  <div class=\"ovwContainer\" dojoattachpoint=\"_body\" style=\"width: ${width}px; height: ${height}px;\">\r\n    <div id=\"${id}-map\" style=\"width: 100%; height: 100%;\">\r\n      <div class=\"ovwHighlight\" dojoattachpoint=\"_focusDiv\" title=\"${NLS_drag}\" style=\"border: 1px solid ${color}; background-color: ${color};\"></div>\r\n    </div>\r\n  </div>\r\n  <div class=\"ovwButton ovwController\" title=\"${NLS_show}\" dojoattachpoint=\"_controllerDiv\" dojoattachevent=\"onclick: _visibilityHandler\">\r\n  </div>\r\n  <div class=\"ovwButton ovwMaximizer\" title=\"${NLS_maximize}\" dojoattachpoint=\"_maximizerDiv\" dojoattachevent=\"onclick: _maximizeHandler\">\r\n  </div>\r\n</div>\r\n","dojo/DeferredList":function(){define("dojo/DeferredList",["./_base/kernel","./_base/Deferred","./_base/array"],function(dojo,_34f,_350){dojo.DeferredList=function(list,_351,_352,_353,_354){var _355=[];_34f.call(this);var self=this;if(list.length===0&&!_351){this.resolve([0,[]]);}var _356=0;_350.forEach(list,function(item,i){item.then(function(_357){if(_351){self.resolve([i,_357]);}else{_358(true,_357);}},function(_359){if(_352){self.reject(_359);}else{_358(false,_359);}if(_353){return null;}throw _359;});function _358(_35a,_35b){_355[i]=[_35a,_35b];_356++;if(_356===list.length){self.resolve(_355);}};});};dojo.DeferredList.prototype=new _34f();dojo.DeferredList.prototype.gatherResults=function(_35c){var d=new dojo.DeferredList(_35c,false,true,false);d.addCallback(function(_35d){var ret=[];_350.forEach(_35d,function(_35e){ret.push(_35e[1]);});return ret;});return d;};return dojo.DeferredList;});},"esri/layers/KMLFolder":function(){define("esri/layers/KMLFolder",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(_35f,lang,has,_360,_361){var _362=_35f(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(json){lang.mixin(this,json);if(_361.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLFolder",_362,_360);}return _362;});},"esri/layers/TrackManager":function(){define("esri/layers/TrackManager",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(_363,lang,_364,has,_365,_366,_367,_368){var _369=_363(null,{declaredClass:"esri.layers._TrackManager",constructor:function(_36a){this.layer=_36a;this.trackMap={};},initialize:function(map){this.map=map;var _36b=this.layer,_36c=_36b.renderer.trackRenderer;if(_36c&&(_36b.geometryType==="esriGeometryPoint")){var _36d=(this.container=new _368._GraphicsLayer({id:_36b.id+"_tracks",_child:true}));_36d.loaded=true;_36d.onLoad(_36d);_36d._setMap(map,_36b._div);_36d.setRenderer(_36c);}},addFeatures:function(_36e){var tkid,_36f=this.trackMap,_370=this.layer,_371=_370._trackIdField;_364.forEach(_36e,function(_372){var _373=_372.attributes;tkid=_373[_371];var ary=(_36f[tkid]=(_36f[tkid]||[]));ary.push(_372);});var _374=_370._startTimeField,_375=_370.objectIdField;var _376=function(a,b){var _377=a.attributes[_374],_378=b.attributes[_374];if(_377===_378){return (a.attributes[_375]<b.attributes[_375])?-1:1;}else{return (_377<_378)?-1:1;}};for(tkid in _36f){_36f[tkid].sort(_376);}},drawTracks:function(){var _379=this.container;if(!_379){return;}var _37a=this.trackMap,sr=this.map.spatialReference,tkid,ary,path,i,_37b,_37c=this.layer._trackIdField,_37d;for(tkid in _37a){ary=_37a[tkid];path=[];for(i=ary.length-1;i>=0;i--){_37b=ary[i].geometry;if(_37b){path.push([_37b.x,_37b.y]);}}_37d={};_37d[_37c]=tkid;if(path.length>0){_379.add(new _366(new _367({paths:[path],spatialReference:sr}),null,_37d));}}},moveLatestToFront:function(){_364.forEach(this.getLatestObservations(),function(_37e){var _37f=_37e._shape;_37f&&_37f._moveToFront();this._repaint(_37e,null,true);},this.layer);},getLatestObservations:function(){var _380=[];if(!this.layer.renderer.latestObservationRenderer){return _380;}var _381=this.trackMap,tkid;for(tkid in _381){var ary=_381[tkid];_380.push(ary[ary.length-1]);}return _380;},clearTracks:function(){var _382=this.getLatestObservations();this.trackMap={};var _383=this.container;if(_383){_383.clear();}_364.forEach(_382,function(_384){this._repaint(_384,null,true);},this.layer);},isLatestObservation:function(_385){var _386=this.layer._trackIdField;var _387=this.trackMap[_385.attributes[_386]];if(_387){return (_387[_387.length-1]===_385);}return false;},destroy:function(){var _388=this.container;if(_388){_388.clear();_388._unsetMap(this.map,this.layer._div);this.container=null;}this.map=null;this.layer=null;this.trackMap=null;}});if(has("extend-esri")){lang.setObject("layers._TrackManager",_369,_365);}return _369;});},"esri/layers/WMSLayer":function(){define("esri/layers/WMSLayer",["require","dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/request","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/DynamicMapServiceLayer","esri/layers/WMSLayerInfo","dojo/query"],function(_389,_38a,_38b,lang,_38c,has,_38d,_38e,_38f,_390,_391,_392,_393){var _394=_38b([_392],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(url,_395){url=this._stripParameters(url,["version","service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);this.url=url;this._url=_38f.urlToObject(url);this._getCapabilitiesURL=url;this._initLayer=lang.hitch(this,this._initLayer);this._parseCapabilities=lang.hitch(this,this._parseCapabilities);this._getCapabilitiesError=lang.hitch(this,this._getCapabilitiesError);if(_395){this.imageFormat=this._getImageFormat(_395.format);this.imageTransparency=(_395.transparent===false)?false:true;this.visibleLayers=_395.visibleLayers?_395.visibleLayers:[];if(_395.resourceInfo){this._readResourceInfo(_395.resourceInfo);}else{this._getCapabilities();}}else{this.imageFormat="image/png";this.imageTransparency=true;this.visibleLayers=[];this._getCapabilities();}this._blankImageURL=_389.toUrl("esri/layers")+"/../images/pixel.png";},setVisibleLayers:function(_396){_396=this._checkVisibleLayersList(_396);this.visibleLayers=_396?_396:[];this.refresh(true);},setImageFormat:function(_397){this.imageFormat=this._getImageFormat(_397);this.refresh(true);},setImageTransparency:function(_398){this.imageTransparency=_398;this.refresh(true);},getImageUrl:function(_399,_39a,_39b,_39c){if(!this.visibleLayers||this.visibleLayers.length===0){_39c(this._blankImageURL);return;}var wkid=_399.spatialReference.wkid;if(_38c.some(this._WEB_MERCATOR,function(el){return el==wkid;})){var _39d=_38c.filter(this.spatialReferences,function(el){return (_38c.some(this._WEB_MERCATOR,function(el2){return el2==el;}));},this);if(_39d.length==0){_39d=_38c.filter(this.spatialReferences,function(el){return (_38c.some(this._WORLD_MERCATOR,function(el2){return el2==el;}));},this);}if(_39d.length>0){wkid=_39d[0];}else{wkid=this._WEB_MERCATOR[0];}}var list=_38c.filter(this.spatialReferences,function(el){return el!==wkid;});this.spatialReferences=list;this.spatialReferences.unshift(wkid);var xmin=_399.xmin;var xmax=_399.xmax;var ymin=_399.ymin;var ymax=_399.ymax;var _39e={};_39e.SERVICE="WMS";_39e.REQUEST="GetMap";_39e.FORMAT=this.imageFormat;_39e.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";_39e.STYLES="";_39e.VERSION=this.version;_39e.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;_39e.WIDTH=_39a;_39e.HEIGHT=_39b;if(this.maxWidth<_39a){_39e.WIDTH=this.maxWidth;}if(this.maxHeight<_39b){_39e.HEIGHT=this.maxHeight;}var _39f=wkid?wkid:NaN;if(!isNaN(_39f)){if(this.version=="1.3.0"){_39e.CRS="EPSG:"+_39f;}else{_39e.SRS="EPSG:"+_39f;}}if(this.version=="1.3.0"&&this._useLatLong(_39f)){_39e.BBOX=ymin+","+xmin+","+ymax+","+xmax;}else{_39e.BBOX=xmin+","+ymin+","+xmax+","+ymax;}var _3a0=this.getMapURL,key;_3a0+=(_3a0.indexOf("?")==-1)?"?":"";for(key in _39e){_3a0+=(_3a0.substring(_3a0.length-1,_3a0.length)=="?")?"":"&";_3a0+=key+"="+_39e[key];}_39c(_38f.addProxy(_3a0));},_initLayer:function(_3a1,io){this.spatialReference=new _390(this.extent.spatialReference);this.initialExtent=new _391(this.extent);this.fullExtent=new _391(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=true;this.onLoad(this);var _3a2=this._loadCallback;if(_3a2){delete this._loadCallback;_3a2(this);}},_readResourceInfo:function(_3a3){if(!_3a3.extent){return;}if(!_3a3.layerInfos){return;}this.extent=_3a3.extent;this.allExtents[0]=_3a3.extent;this.layerInfos=_3a3.layerInfos;this.description=_3a3.description?_3a3.description:"";this.copyright=_3a3.copyright?_3a3.copyright:"";this.title=_3a3.title?_3a3.title:"";this.getMapURL=_3a3.getMapURL?_3a3.getMapURL:this._getCapabilitiesURL;this.version=_3a3.version?_3a3.version:"1.3.0";this.maxWidth=_3a3.maxWidth?_3a3.maxWidth:5000;this.maxHeight=_3a3.maxHeight?_3a3.maxHeight:5000;this.spatialReferences=_3a3.spatialReferences?_3a3.spatialReferences:[];this.imageFormat=this._getImageFormat(_3a3.format);this.setScaleRange(_3a3.minScale,_3a3.maxScale);this._initLayer();},_getCapabilities:function(){var _3a4=this._url.query?this._url.query:{};_3a4.SERVICE="WMS";_3a4.REQUEST="GetCapabilities";var uri=this._url.path+"?",key;for(key in _3a4){uri+=(uri.substring(uri.length-1,uri.length)=="?")?"":"&";uri+=key+"="+_3a4[key];}var _3a5=_38e({url:uri,handleAs:"xml",load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:false});},_parseCapabilities:function(xml){if(!xml){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)");return;}this.version=this._getAttributeValue("WMS_Capabilities","version",xml,null);if(!this.version){this.version=this._getAttributeValue("WMT_MS_Capabilities","version",xml,"1.3.0");}var _3a6=this._getTag("Service",xml);this.title=this._getTagValue("Title",_3a6,"");if(!this.title||this.title.length==0){this.title=this._getTagValue("Name",_3a6,"");}this.copyright=this._getTagValue("AccessConstraints",_3a6,"");this.description=this._getTagValue("Abstract",_3a6,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",_3a6,5000),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",_3a6,5000),10);var _3a7=this._getTag("Layer",xml);if(!_3a7){this._getCapabilitiesError({"error":{"message":"Response does not contain any layers."}});return;}var _3a8=this._getLayerInfo(_3a7);if(_3a8){this.layerInfos=_3a8.subLayers;if(!this.layerInfos||this.layerInfos.length==0){this.layerInfos=[_3a8];}this.extent=_3a8.extent;this.allExtents=_3a8.allExtents;this.spatialReferences=_3a8.spatialReferences;if(this.spatialReferences.length==0&&this.layerInfos.length>0){this.spatialReferences=this.layerInfos[0].spatialReferences;}}this.getMapURL=this._getCapabilitiesURL;var _3a9=_38a.query("DCPType",this._getTag("GetMap",xml));if(_3a9&&_3a9.length>0){var _3aa=_38a.query("HTTP",_3a9[0]);if(_3aa&&_3aa.length>0){var _3ab=_38a.query("Get",_3aa[0]);if(_3ab&&_3ab.length>0){var _3ac=this._getAttributeValue("OnlineResource","xlink:href",_3ab[0],null);if(_3ac){if(_3ac.indexOf("&")==(_3ac.length-1)){_3ac=_3ac.substring(0,_3ac.length-1);}this.getMapURL=_3ac;}}}}this.getMapFormats=[];if(_38a.query("Operation",xml).length==0){_38c.forEach(_38a.query("Format",this._getTag("GetMap",xml)),function(_3ad){this.getMapFormats.push(_3ad.text?_3ad.text:_3ad.textContent);},this);}else{_38c.forEach(_38a.query("Operation",xml),function(_3ae){if(_3ae.getAttribute("name")=="GetMap"){_38c.forEach(_38a.query("Format",_3ae),function(_3af){this.getMapFormats.push(_3af.text?_3af.text:_3af.textContent);},this);}},this);}if(!_38c.some(this.getMapFormats,function(el){return el.indexOf(this.imageFormat)>-1;},this)){this.imageFormat=this.getMapFormats[0];}this._initLayer();},_getCapabilitiesError:function(_3b0,io){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",_3b0);},_getLayerInfo:function(_3b1){if(!_3b1){return null;}var _3b2=new _393();_3b2.name="";_3b2.title="";_3b2.description="";_3b2.allExtents=[];_3b2.spatialReferences=[];_3b2.subLayers=[];var _3b3=this._getTag("LatLonBoundingBox",_3b1);if(_3b3){_3b2.allExtents[0]=this._getExtent(_3b3,4326);}var _3b4=this._getTag("EX_GeographicBoundingBox",_3b1);if(_3b4){var _3b5=new _391(0,0,0,0,new _390({wkid:4326}));_3b5.xmin=parseFloat(this._getTagValue("westBoundLongitude",_3b4,0));_3b5.ymin=parseFloat(this._getTagValue("southBoundLatitude",_3b4,0));_3b5.xmax=parseFloat(this._getTagValue("eastBoundLongitude",_3b4,0));_3b5.ymax=parseFloat(this._getTagValue("northBoundLatitude",_3b4,0));_3b2.allExtents[0]=_3b5;}_3b2.extent=_3b2.allExtents[0];var _3b6=(_38c.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)>-1)?"SRS":"CRS";_38c.forEach(_3b1.childNodes,function(_3b7){if(_3b7.nodeName=="Name"){_3b2.name=(_3b7.text?_3b7.text:_3b7.textContent)||"";}else{if(_3b7.nodeName=="Title"){_3b2.title=(_3b7.text?_3b7.text:_3b7.textContent)||"";}else{if(_3b7.nodeName=="Abstract"){_3b2.description=(_3b7.text?_3b7.text:_3b7.textContent)||"";}else{if(_3b7.nodeName=="BoundingBox"){var _3b8=_3b7.getAttribute(_3b6),wkid;if(_3b8&&_3b8.indexOf("EPSG:")===0){wkid=parseInt(_3b8.substring(5),10);if(wkid!==0&&!isNaN(wkid)){var _3b9;if(this.version=="1.3.0"){_3b9=this._getExtent(_3b7,wkid,this._useLatLong(wkid));}else{_3b9=this._getExtent(_3b7,wkid);}_3b2.allExtents[wkid]=_3b9;if(!_3b2.extent){_3b2.extent=_3b9;}}}else{if(_3b8&&_3b8.indexOf("CRS:")===0){wkid=parseInt(_3b8.substring(4),10);if(wkid!==0&&!isNaN(wkid)){if(this._CRS_TO_EPSG[wkid]){wkid=this._CRS_TO_EPSG[wkid];}_3b2.allExtents[wkid]=this._getExtent(_3b7,wkid);}}else{wkid=parseInt(_3b8,10);if(wkid!==0&&!isNaN(wkid)){_3b2.allExtents[wkid]=this._getExtent(_3b7,wkid);}}}}else{if(_3b7.nodeName==_3b6){var _3ba=_3b7.text?_3b7.text:_3b7.textContent;var arr=_3ba.split(" ");_38c.forEach(arr,function(val){if(val.indexOf(":")>-1){val=parseInt(val.split(":")[1],10);}else{val=parseInt(val,10);}if(val!==0&&!isNaN(val)){if(this._CRS_TO_EPSG[val]){val=this._CRS_TO_EPSG[val];}if(_38c.indexOf(_3b2.spatialReferences,val)==-1){_3b2.spatialReferences.push(val);}}},this);}else{if(_3b7.nodeName=="Style"){var _3bb=this._getTag("LegendURL",_3b7);if(_3bb){var _3bc=this._getTag("OnlineResource",_3bb);if(_3bc){_3b2.legendURL=_3bc.getAttribute("xlink:href");}}}else{if(_3b7.nodeName==="Layer"){_3b2.subLayers.push(this._getLayerInfo(_3b7));}}}}}}}},this);return _3b2;},_getImageFormat:function(_3bd){var _3be=_3bd?_3bd.toLowerCase():"";switch(_3be){case "jpg":return "image/jpeg";case "bmp":return "image/bmp";case "gif":return "image/gif";case "svg":return "image/svg+xml";default:return "image/png";}},getImageFormat:function(){var _3bf=this.imageFormat?this.imageFormat.toLowerCase():"";switch(_3bf){case "image/jpeg":return "jpg";case "image/bmp":return "bmp";case "image/gif":return "gif";case "image/svg+xml":return "svg";default:return "png";}},_getExtent:function(_3c0,wkid,_3c1){var _3c2;if(_3c0){_3c2=new _391();var minx=parseFloat(_3c0.getAttribute("minx"));var miny=parseFloat(_3c0.getAttribute("miny"));var maxx=parseFloat(_3c0.getAttribute("maxx"));var maxy=parseFloat(_3c0.getAttribute("maxy"));if(_3c1){_3c2.xmin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_3c2.ymin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_3c2.xmax=isNaN(maxy)?Number.MAX_VALUE:maxy;_3c2.ymax=isNaN(maxx)?Number.MAX_VALUE:maxx;}else{_3c2.xmin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_3c2.ymin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_3c2.xmax=isNaN(maxx)?Number.MAX_VALUE:maxx;_3c2.ymax=isNaN(maxy)?Number.MAX_VALUE:maxy;}_3c2.spatialReference=new _390({wkid:wkid});}return _3c2;},_useLatLong:function(wkid){var _3c3,i;for(i=0;i<this._REVERSED_LAT_LONG_RANGES.length;i++){var _3c4=this._REVERSED_LAT_LONG_RANGES[i];if(wkid>=_3c4[0]&&wkid<=_3c4[1]){_3c3=true;break;}}return _3c3;},_getTag:function(_3c5,xml){var tags=_38a.query(_3c5,xml);if(tags&&tags.length>0){return tags[0];}else{return null;}},_getTagValue:function(_3c6,xml,_3c7){var _3c8=_38a.query(_3c6,xml);if(_3c8&&_3c8.length>0){if(_3c8[0].text){return _3c8[0].text;}else{return _3c8[0].textContent;}}else{return _3c7;}},_getAttributeValue:function(_3c9,_3ca,xml,_3cb){var _3cc=_38a.query(_3c9,xml);if(_3cc&&_3cc.length>0){return _3cc[0].getAttribute(_3ca);}else{return _3cb;}},_checkVisibleLayersList:function(_3cd){if(_3cd&&_3cd.length>0&&this.layerInfos&&this.layerInfos.length>0){if((typeof _3cd[0])=="number"){var list=[];_38c.forEach(_3cd,function(pos){if(pos<this.layerInfos.length){list.push(this.layerInfos[pos].name);}},this);_3cd=list;}}return _3cd;},_stripParameters:function(url,_3ce){var obj=_38f.urlToObject(url),prop,qs=[];for(prop in obj.query){if(_38c.indexOf(_3ce,prop.toLowerCase())===-1){qs.push(prop+"="+obj.query[prop]);}}return obj.path+(qs.length?("?"+qs.join("&")):"");}});if(has("extend-esri")){lang.setObject("layers.WMSLayer",_394,_38d);}return _394;});},"esri/layers/SelectionMode":function(){define("esri/layers/SelectionMode",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(_3cf,lang,has,_3d0,_3d1){var _3d2=_3cf([_3d1],{declaredClass:"esri.layers._SelectionMode",constructor:function(_3d3){this.featureLayer=_3d3;this._featureMap={};},propertyChangeHandler:function(type){if(this._init&&type===0){this._applyTimeFilter();}},resume:function(){this.propertyChangeHandler(0);}});if(has("extend-esri")){lang.setObject("layers._SelectionMode",_3d2,_3d0);}return _3d2;});},"esri/layers/SnapshotMode":function(){define("esri/layers/SnapshotMode",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/SpatialReference","esri/tasks/query","esri/layers/RenderMode"],function(_3d4,lang,has,_3d5,_3d6,_3d7,_3d8){var _3d9=_3d4([_3d8],{declaredClass:"esri.layers._SnapshotMode",constructor:function(_3da){this.featureLayer=_3da;this._featureMap={};this._drawFeatures=lang.hitch(this,this._drawFeatures);this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},startup:function(){if(this.featureLayer._collection){this._applyTimeFilter();}else{this._fetchAll();}},propertyChangeHandler:function(type){if(this._init){if(type){if(this.featureLayer._collection){}else{this._fetchAll();}}else{this._applyTimeFilter();}}},drawFeature:function(_3db){var _3dc=this.featureLayer,_3dd=_3dc.objectIdField,oid=_3db.attributes[_3dd];this._addFeatureIIf(oid,_3db);this._incRefCount(oid);},resume:function(){this.propertyChangeHandler(0);},refresh:function(){var _3de=this.featureLayer;if(_3de._collection){_3de._fireUpdateStart();_3de._refresh(true);_3de._fireUpdateEnd();}else{this._fetchAll();}},_getRequestId:function(_3df){var id="_"+_3df.name+_3df.layerId+_3df._ulid;return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_fetchAll:function(){var _3e0=this.featureLayer;if(_3e0._collection){return;}_3e0._fireUpdateStart();this._clearIIf();this._sendRequest();},_sendRequest:function(){var map=this.map,_3e1=this.featureLayer,_3e2=_3e1.getDefinitionExpression();var _3e3=new _3d7();_3e3.outFields=_3e1._getOutFields();_3e3.where=_3e2||"1=1";_3e3.returnGeometry=true;_3e3.outSpatialReference=new _3d6(map.spatialReference.toJson());_3e3.timeExtent=_3e1.getTimeDefinition();_3e3.maxAllowableOffset=_3e1._maxOffset;if(_3e1._ts){_3e3._ts=(new Date()).getTime();}var _3e4;if(_3e1._usePatch){_3e4=this._getRequestId(_3e1);this._cancelPendingRequest(null,_3e4);}_3e1._task.execute(_3e3,this._drawFeatures,this._queryErrorHandler,_3e4);},_drawFeatures:function(_3e5){this._purgeRequests();var _3e6=_3e5.features,_3e7=this.featureLayer,_3e8=_3e7.objectIdField,i,len=_3e6.length,_3e9,oid;for(i=0;i<len;i++){_3e9=_3e6[i];oid=_3e9.attributes[_3e8];this._addFeatureIIf(oid,_3e9);this._incRefCount(oid);}this._applyTimeFilter(true);_3e7._fireUpdateEnd(null,_3e5.exceededTransferLimit?{queryLimitExceeded:true}:null);if(_3e5.exceededTransferLimit){_3e7.onQueryLimitExceeded();}},_queryErrorHandler:function(err){this._purgeRequests();var _3ea=this.featureLayer;_3ea._errorHandler(err);_3ea._fireUpdateEnd(err);}});if(has("extend-esri")){lang.setObject("layers._SnapshotMode",_3d9,_3d5);}return _3d9;});},"esri/dijit/OverviewMap":function(){require({cache:{"url:esri/dijit/templates/OverviewMap.html":"<div class=\"esriOverviewMap\">\r\n  <div class=\"ovwContainer\" dojoattachpoint=\"_body\" style=\"width: ${width}px; height: ${height}px;\">\r\n    <div id=\"${id}-map\" style=\"width: 100%; height: 100%;\">\r\n      <div class=\"ovwHighlight\" dojoattachpoint=\"_focusDiv\" title=\"${NLS_drag}\" style=\"border: 1px solid ${color}; background-color: ${color};\"></div>\r\n    </div>\r\n  </div>\r\n  <div class=\"ovwButton ovwController\" title=\"${NLS_show}\" dojoattachpoint=\"_controllerDiv\" dojoattachevent=\"onclick: _visibilityHandler\">\r\n  </div>\r\n  <div class=\"ovwButton ovwMaximizer\" title=\"${NLS_maximize}\" dojoattachpoint=\"_maximizerDiv\" dojoattachevent=\"onclick: _maximizeHandler\">\r\n  </div>\r\n</div>\r\n"}});define("esri/dijit/OverviewMap",["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/html","dojo/has","dojo/sniff","dojo/dom-class","dojo/dom-style","dojo/dnd/Moveable","dijit/_Widget","dijit/_Templated","esri/map","esri/geometry/Point","esri/geometry/ScreenPoint","esri/layers/TiledMapServiceLayer","esri/layers/DynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/virtualearth/VETiledLayer","esri/kernel","esri/config","esri/domUtils","dojo/text!esri/dijit/templates/OverviewMap.html","dojo/i18n!esri/nls/jsapi"],function(_3eb,_3ec,lang,_3ed,html,has,_3ee,_3ef,_3f0,_3f1,_3f2,_3f3,Map,_3f4,_3f5,_3f6,_3f7,_3f8,_3f9,_3fa,_3fb,_3fc,_3fd,_3fe,_3ff,_400,_401){var OM=_3ec([_3f2,_3f3],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:true,templateString:_400,basePath:_3eb.toUrl("esri/dijit")+"/",constructor:function(_402,_403){lang.mixin(this,_401.widgets.overviewMap);_402=_402||{};if(!_402.map){return;}var _404={};if(_403){this._detached=true;_404=html.coords(_403,true);}this.map=_402.map;this.baseLayer=_402.baseLayer;this.width=_402.width||_404.w||this.map.width/4;this.height=_402.height||_404.h||this.map.height/4;this.attachTo=_402.attachTo||"top-right";this.expandFactor=_402.expandFactor||2;this.color=_402.color||"#000000";this.opacity=_402.opacity||0.5;this.maximizeButton=!!_402.maximizeButton;this.visible=!!_402.visible;this._mainMapLayer=this.map.getLayer(this.map.layerIds[0]);if(!this._mainMapLayer){return;}var _405=this.baseLayer||this._mainMapLayer;var _406=this.map.spatialReference,_407=_405.spatialReference;if((_407.wkid!==_406.wkid)&&(_407.wkt!==_406.wkt)){return;}var _408=_405.declaredClass;if(_405 instanceof _3f6){if(_402.baseLayer){this.baseLayer=_402.baseLayer;}else{if(_408.indexOf("VETiledLayer")!==-1){this.baseLayer=new _3fc({resourceInfo:_405.getResourceInfo(),culture:_405.culture,mapStyle:_405.mapStyle,bingMapsKey:_405.bingMapsKey});}else{if(_408.indexOf("OpenStreetMapLayer")!==-1){this.baseLayer=new _3fb({tileServers:_405.tileServers});}else{if(_408.indexOf("WebTiledLayer")!==-1){var _409=_405.initialExtent,_40a=_405.fullExtent,_40b=_405.tileInfo;this.baseLayer=new _405.constructor(_405.urlTemplate,{initialExtent:_409&&new _409.constructor(_409.toJson()),fullExtent:_40a&&new _40a.constructor(_40a.toJson()),tileInfo:_40b&&new _40b.constructor(_40b.toJson()),tileServers:_405.tileServers&&_405.tileServers.slice(0)});}else{this.baseLayer=new _3f8(_405.url,{resourceInfo:_405.getResourceInfo()});}}}}}else{if(_405 instanceof _3f7){if(_402.baseLayer){this.baseLayer=_402.baseLayer;}else{if(_408.indexOf("ArcGISImageServiceLayer")!==-1){this.baseLayer=new _3fa(_405.url);}else{this.baseLayer=new _3f9(_405.url);this.baseLayer.setImageFormat("png24");}}}else{return;}}if(this._detached){this.visible=true;}this._maximized=false;},startup:function(){this.inherited(arguments);if(has("ie")){if(!this.domNode.parentElement){this.map.container.appendChild(this.domNode);}}else{if(!this.domNode.parentNode){this.map.container.appendChild(this.domNode);}}if(this._detached){_3f0.set(this._body,"display","block");_3f0.set(this._controllerDiv,"display","none");_3f0.set(this._maximizerDiv,"display","none");if(this.baseLayer.loaded){this._initialize();}else{_3ed.connect(this.baseLayer,"onLoad",this,this._initialize);}}else{if(this.attachTo.split("-")[0]==="bottom"){this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv);}if(!this.maximizeButton){_3ef.add(this._maximizerDiv,"ovwDisabledButton");}_3ef.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]);_3ef.add(this._controllerDiv,"ovwShow");_3ef.add(this._maximizerDiv,"ovwMaximize");if(this.visible){var _40c=function(){this.visible=false;this.show();};if(this.baseLayer.loaded){_40c.call(this);}else{_3ed.connect(this.baseLayer,"onLoad",this,_40c);}}}_3f0.set(this._focusDiv,"opacity",this.opacity);},destroy:function(){this._deactivate();if(this.overviewMap){this.overviewMap.destroy();}this.overviewMap=this.baseLayer=null;this.inherited(arguments);},resize:function(size){if(!size||size.w<=0||size.h<=0){return;}this._resize(size.w,size.h);},show:function(){if(!this.visible){var div=this._controllerDiv;div.title=this.NLS_hide;_3ef.remove(div,"ovwShow");_3ef.add(div,"ovwHide");_3ff.show(this._body);_3ff.show(this._maximizerDiv);this._initialize();this.visible=true;}},hide:function(){if(this.visible){var div=this._controllerDiv;div.title=this.NLS_show;_3ef.remove(div,"ovwHide");_3ef.add(div,"ovwShow");if(this._maximized){this._maximizeHandler();}_3ff.hide(this._body);_3ff.hide(this._maximizerDiv);this._deactivate();this.visible=false;}},_visibilityHandler:function(){if(this.visible){this.hide();}else{this.show();}},_maximizeHandler:function(){var div=this._maximizerDiv;if(this._maximized){div.title=this.NLS_maximize;_3ef.remove(div,"ovwRestore");_3ef.add(div,"ovwMaximize");this._resize(this.width,this.height);}else{div.title=this.NLS_restore;_3ef.remove(div,"ovwMaximize");_3ef.add(div,"ovwRestore");this._resize(this.map.width,this.map.height);}this._maximized=!this._maximized;},_resize:function(_40d,_40e){_3f0.set(this._body,{width:_40d+"px",height:_40e+"px"});var _40f=_3fe.defaults.map.panDuration,_410=this.overviewMap;_3fe.defaults.map.panDuration=0;_410.resize(true);_410.centerAt(this._focusExtent.getCenter());_3fe.defaults.map.panDuration=_40f;},_initialize:function(){if(!this.overviewMap){var _411;_411=(this.overviewMap=new Map(this.id+"-map",{slider:false,showAttribution:false,logo:false,lods:this._overviewLods,wrapAround180:this.map.wrapAround180}));_3ed.connect(_411,"onLoad",this,function(){this._map_resize_override=lang.hitch(_411,this._map_resize_override);_411.disableMapNavigation();this._activate();});_411.addLayer(this.baseLayer);}else{this._activate();}},_activate:function(){var map=this.map,_412=this.overviewMap;this._moveableHandle=new _3f1(this._focusDiv);this._soeConnect=_3ed.connect(map,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=_3ed.connect(map,"onPan",this,this._updateFocus);this._oecConnect=_3ed.connect(_412,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=_3ed.connect(_412,"onPan",this,this._ovwPanHandler);this._ozsConnect=_3ed.connect(_412,"onZoomStart",this,function(){_3ff.hide(this._focusDiv);});this._ozeConnect=_3ed.connect(_412,"onZoomEnd",this,function(){_3ff.show(this._focusDiv);});this._omsConnect=_3ed.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(map.extent,null,null,null);},_deactivate:function(){_3ed.disconnect(this._soeConnect);_3ed.disconnect(this._ufoConnect);_3ed.disconnect(this._oecConnect);_3ed.disconnect(this._opaConnect);_3ed.disconnect(this._ozsConnect);_3ed.disconnect(this._ozeConnect);_3ed.disconnect(this._omsConnect);if(this._moveableHandle){this._moveableHandle.destroy();}},_syncOverviewMap:function(ext,_413,_414,lod){if(this._suspendPanHandling){this._suspendPanHandling=false;return;}this._focusExtent=ext;this.overviewMap.setExtent(ext.expand(this.expandFactor),true);},_updateFocus:function(ext){if(this._suspendPanHandling){return;}this._focusExtent=ext;this._drawFocusDiv(ext);},_drawFocusDiv:function(ext,_415){var _416=this.overviewMap;var tl=_416.toScreen(new _3f4(ext.xmin,ext.ymax,_416.spatialReference));var br=_416.toScreen(new _3f4(ext.xmax,ext.ymin,_416.spatialReference));var _417=br.x-tl.x,_418=br.y-tl.y,_419=true;if((_417>this.overviewMap.width)&&(_418>this.overviewMap.height)){_419=false;}_3f0.set(this._focusDiv,{left:tl.x+(_415?_415.x:0)+"px",top:tl.y+(_415?_415.y:0)+"px",width:_417+"px",height:_418+"px",display:_419?"block":"none"});},_moveStopHandler:function(evt){var _41a=this._moveableHandle.node.style;var ext=this._focusExtent;var _41b=this.overviewMap;var _41c=_41b.toMap(new _3f5(parseInt(_41a.left,10),parseInt(_41a.top,10)));var prev=new _3f4(ext.xmin,ext.ymax,_41b.spatialReference);this._focusExtent=ext.offset(_41c.x-prev.x,_41c.y-prev.y);if(this._maximized){this._maximizeHandler();}else{_41b.centerAt(this._focusExtent.getCenter());}this._suspendPanHandling=true;this.map.setExtent(this._focusExtent);},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent);},_ovwPanHandler:function(ext,_41d){this._drawFocusDiv(this._focusExtent,_41d);}});if(has("extend-esri")){lang.setObject("dijit.OverviewMap",OM,_3fd);}return OM;});},"esri/layers/GridLayout":function(){define("esri/layers/GridLayout",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/Polyline"],function(_41e,lang,_41f,has,_420,_421,_422,_423){var _424=_41e(null,{declaredClass:"esri.layers._GridLayout",constructor:function(_425,_426,_427,_428){this.origin=_425;this.cellWidth=_426.width;this.cellHeight=_426.height;this.mapWidth=_427.width;this.mapHeight=_427.height;this.srInfo=_428;},setResolution:function(_429){this._resolution=(_429.xmax-_429.xmin)/this.mapWidth;if(this.srInfo){var _42a=Math.round((2*this.srInfo.valid[1])/this._resolution),_42b=Math.round(_42a/this.cellWidth);this._frameStats=[_42b,0,_42b-1];}},getCellCoordinates:function(_42c){var res=this._resolution,_42d=this.origin;return {row:Math.floor((_42d.y-_42c.y)/(this.cellHeight*res)),col:Math.floor((_42c.x-_42d.x)/(this.cellWidth*res))};},normalize:function(col){var _42e=this._frameStats;if(_42e){var _42f=_42e[0],m180=_42e[1],p180=_42e[2];if(col<m180){col=col%_42f;col=col<m180?col+_42f:col;}else{if(col>p180){col=col%_42f;}}}return col;},intersects:function(_430,_431){var _432=this.srInfo;if(_432){return _41f.some(_431._getParts(_432),function(_433){return _430.intersects(_433.extent);});}else{return _430.intersects(_431);}},getCellExtent:function(row,col){var res=this._resolution,_434=this.origin,_435=this.cellWidth,_436=this.cellHeight;return new _422((col*_435*res)+_434.x,_434.y-((row+1)*_436*res),((col+1)*_435*res)+_434.x,_434.y-(row*_436*res),new _421(_434.spatialReference.toJson()));},getLatticeID:function(_437){var _438=this.getCellCoordinates({x:_437.xmin,y:_437.ymax}),_439=this.getCellCoordinates({x:_437.xmax,y:_437.ymin}),_43a=_438.row,_43b=_439.row,_43c=this.normalize(_438.col),_43d=this.normalize(_439.col);return _43a+"_"+_43b+"_"+_43c+"_"+_43d;},sorter:function(a,b){return (a<b)?-1:1;},getCellsInExtent:function(_43e,_43f){var _440=this.getCellCoordinates({x:_43e.xmin,y:_43e.ymax}),_441=this.getCellCoordinates({x:_43e.xmax,y:_43e.ymin}),_442=_440.row,_443=_441.row,_444=_440.col,_445=_441.col,_446=[],i,j,nj,_447=[],_448=[],len,xmin,xmax,ymin,ymax,_449=[],_44a,_44b;for(i=_442;i<=_443;i++){for(j=_444;j<=_445;j++){nj=this.normalize(j);_43e=this.getCellExtent(i,nj);_446.push({row:i,col:nj,extent:_43e,resolution:this._resolution});if(_43f){_447.push(_43e.xmin,_43e.xmax);_448.push(_43e.ymin,_43e.ymax);}}}_444=this.normalize(_444);_445=this.normalize(_445);_447.sort(this.sorter);_448.sort(this.sorter);len=_447.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_447[i]===_447[i+1]){_447.splice(i,1);}}}len=_448.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_448[i]===_448[i+1]){_448.splice(i,1);}}}if(_447.length&&_448.length){xmin=_447[0];xmax=_447[_447.length-1];ymin=_448[0];ymax=_448[_448.length-1];len=_447.length;for(i=0;i<len;i++){_449.push([[_447[i],ymax],[_447[i],ymin]]);}len=_448.length;for(i=0;i<len;i++){_449.push([[xmin,_448[i]],[xmax,_448[i]]]);}_44a=new _423({paths:_449,spatialReference:this.origin.spatialReference.toJson()});_44b=_442+"_"+_443+"_"+_444+"_"+_445;_446.push({latticeID:_44b,lattice:_44a,resolution:this._resolution});}return {minRow:_442,maxRow:_443,minCol:_444,maxCol:_445,cells:_446};}});if(has("extend-esri")){lang.setObject("layers._GridLayout",_424,_420);}return _424;});},"dojox/data/CsvStore":function(){define("dojox/data/CsvStore",["dojo/_base/lang","dojo/_base/declare","dojo/_base/xhr","dojo/_base/kernel","dojo/data/util/filter","dojo/data/util/simpleFetch"],function(lang,_44c,xhr,_44d,_44e,_44f){var _450=_44c("dojox.data.CsvStore",null,{constructor:function(_451){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=false;if(_451.url){this.url=_451.url;}this._csvData=_451.data;if(_451.label){this.label=_451.label;}else{if(this.label===""){this.label=undefined;}}this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];this.identifier=_451.identifier;if(this.identifier===""){delete this.identifier;}else{this._idMap={};}if("separator" in _451){this.separator=_451.separator;}if("urlPreventCache" in _451){this.urlPreventCache=_451.urlPreventCache?true:false;}},url:"",label:"",identifier:"",separator:",",urlPreventCache:false,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error(this.declaredClass+": a function was passed an item argument that was not an item");}},_getIndex:function(item){var idx=this.getIdentity(item);if(this.identifier){idx=this._idMap[idx];}return idx;},getValue:function(item,_452,_453){this._assertIsItem(item);var _454=_453;if(typeof _452==="string"){var ai=this._attributeIndexes[_452];if(ai!=null){var _455=this._dataArray[this._getIndex(item)];_454=_455[ai]||_453;}}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}return _454;},getValues:function(item,_456){var _457=this.getValue(item,_456);return (_457?[_457]:[]);},getAttributes:function(item){this._assertIsItem(item);var _458=[];var _459=this._dataArray[this._getIndex(item)];for(var i=0;i<_459.length;i++){if(_459[i]!==""){_458.push(this._attributes[i]);}}return _458;},hasAttribute:function(item,_45a){this._assertIsItem(item);if(typeof _45a==="string"){var _45b=this._attributeIndexes[_45a];var _45c=this._dataArray[this._getIndex(item)];return (typeof _45b!=="undefined"&&_45b<_45c.length&&_45c[_45b]!=="");}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}},containsValue:function(item,_45d,_45e){var _45f=undefined;if(typeof _45e==="string"){_45f=_44e.patternToRegExp(_45e,false);}return this._containsValue(item,_45d,_45e,_45f);},_containsValue:function(item,_460,_461,_462){var _463=this.getValues(item,_460);for(var i=0;i<_463.length;++i){var _464=_463[i];if(typeof _464==="string"&&_462){return (_464.match(_462)!==null);}else{if(_461===_464){return true;}}}return false;},isItem:function(_465){if(_465&&_465[this._storeProp]===this){var _466=_465[this._idProp];if(this.identifier){var data=this._dataArray[this._idMap[_466]];if(data){return true;}}else{if(_466>=0&&_466<this._dataArray.length){return true;}}}return false;},isItemLoaded:function(_467){return this.isItem(_467);},loadItem:function(item){},getFeatures:function(){return this._features;},getLabel:function(item){if(this.label&&this.isItem(item)){return this.getValue(item,this.label);}return undefined;},getLabelAttributes:function(item){if(this.label){return [this.label];}return null;},_fetchItems:function(_468,_469,_46a){var self=this;var _46b=function(_46c,_46d){var _46e=null;if(_46c.query){var key,_46f;_46e=[];var _470=_46c.queryOptions?_46c.queryOptions.ignoreCase:false;var _471={};for(key in _46c.query){_46f=_46c.query[key];if(typeof _46f==="string"){_471[key]=_44e.patternToRegExp(_46f,_470);}}for(var i=0;i<_46d.length;++i){var _472=true;var _473=_46d[i];for(key in _46c.query){_46f=_46c.query[key];if(!self._containsValue(_473,key,_46f,_471[key])){_472=false;}}if(_472){_46e.push(_473);}}}else{_46e=_46d.slice(0,_46d.length);}_469(_46e,_46c);};if(this._loadFinished){_46b(_468,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_468,filter:_46b});}else{this._loadInProgress=true;var _474={url:self.url,handleAs:"text",preventCache:self.urlPreventCache};var _475=xhr.get(_474);_475.addCallback(function(data){try{self._processData(data);_46b(_468,self._arrayOfAllItems);self._handleQueuedFetches();}catch(e){_46a(e,_468);}});_475.addErrback(function(_476){self._loadInProgress=false;if(_46a){_46a(_476,_468);}else{throw _476;}});var _477=null;if(_468.abort){_477=_468.abort;}_468.abort=function(){var df=_475;if(df&&df.fired===-1){df.cancel();df=null;}if(_477){_477.call(_468);}};}}else{if(this._csvData){try{this._processData(this._csvData);this._csvData=null;_46b(_468,this._arrayOfAllItems);}catch(e){_46a(e,_468);}}else{var _478=new Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(_46a){_46a(_478,_468);}else{throw _478;}}}}},close:function(_479){},_getArrayOfArraysFromCsvFileContents:function(_47a){if(lang.isString(_47a)){var _47b=new RegExp("^\\s+","g");var _47c=new RegExp("\\s+$","g");var _47d=new RegExp("\"\"","g");var _47e=[];var i;var _47f=this._splitLines(_47a);for(i=0;i<_47f.length;++i){var _480=_47f[i];if(_480.length>0){var _481=_480.split(this.separator);var j=0;while(j<_481.length){var _482=_481[j];var _483=_482.replace(_47b,"");var _484=_483.replace(_47c,"");var _485=_484.charAt(0);var _486=_484.charAt(_484.length-1);var _487=_484.charAt(_484.length-2);var _488=_484.charAt(_484.length-3);if(_484.length===2&&_484=="\"\""){_481[j]="";}else{if((_485=="\"")&&((_486!="\"")||((_486=="\"")&&(_487=="\"")&&(_488!="\"")))){if(j+1===_481.length){return;}var _489=_481[j+1];_481[j]=_483+this.separator+_489;_481.splice(j+1,1);}else{if((_485=="\"")&&(_486=="\"")){_484=_484.slice(1,(_484.length-1));_484=_484.replace(_47d,"\"");}_481[j]=_484;j+=1;}}}_47e.push(_481);}}this._attributes=_47e.shift();for(i=0;i<this._attributes.length;i++){this._attributeIndexes[this._attributes[i]]=i;}this._dataArray=_47e;}},_splitLines:function(_48a){var _48b=[];var i;var line="";var _48c=false;for(i=0;i<_48a.length;i++){var c=_48a.charAt(i);switch(c){case "\"":_48c=!_48c;line+=c;break;case "\r":if(_48c){line+=c;}else{_48b.push(line);line="";if(i<(_48a.length-1)&&_48a.charAt(i+1)=="\n"){i++;}}break;case "\n":if(_48c){line+=c;}else{_48b.push(line);line="";}break;default:line+=c;}}if(line!==""){_48b.push(line);}return _48b;},_processData:function(data){this._getArrayOfArraysFromCsvFileContents(data);this._arrayOfAllItems=[];if(this.identifier){if(this._attributeIndexes[this.identifier]===undefined){throw new Error(this.declaredClass+": Identity specified is not a column header in the data set.");}}for(var i=0;i<this._dataArray.length;i++){var id=i;if(this.identifier){var _48d=this._dataArray[i];id=_48d[this._attributeIndexes[this.identifier]];this._idMap[id]=i;}this._arrayOfAllItems.push(this._createItemFromIdentity(id));}this._loadFinished=true;this._loadInProgress=false;},_createItemFromIdentity:function(_48e){var item={};item[this._storeProp]=this;item[this._idProp]=_48e;return item;},getIdentity:function(item){if(this.isItem(item)){return item[this._idProp];}return null;},fetchItemByIdentity:function(_48f){var item;var _490=_48f.scope?_48f.scope:_44d.global;if(!this._loadFinished){var self=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_48f});}else{this._loadInProgress=true;var _491={url:self.url,handleAs:"text"};var _492=xhr.get(_491);_492.addCallback(function(data){try{self._processData(data);var item=self._createItemFromIdentity(_48f.identity);if(!self.isItem(item)){item=null;}if(_48f.onItem){_48f.onItem.call(_490,item);}self._handleQueuedFetches();}catch(error){if(_48f.onError){_48f.onError.call(_490,error);}}});_492.addErrback(function(_493){this._loadInProgress=false;if(_48f.onError){_48f.onError.call(_490,_493);}});}}else{if(this._csvData){try{self._processData(self._csvData);self._csvData=null;item=self._createItemFromIdentity(_48f.identity);if(!self.isItem(item)){item=null;}if(_48f.onItem){_48f.onItem.call(_490,item);}}catch(e){if(_48f.onError){_48f.onError.call(_490,e);}}}}}else{item=this._createItemFromIdentity(_48f.identity);if(!this.isItem(item)){item=null;}if(_48f.onItem){_48f.onItem.call(_490,item);}}},getIdentityAttributes:function(item){if(this.identifier){return [this.identifier];}else{return null;}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _494=this._queuedFetches[i];var _495=_494.filter;var _496=_494.args;if(_495){_495(_496,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_494.args);}}this._queuedFetches=[];}}});lang.extend(_450,_44f);return _450;});},"esri/arcgis/csv":function(){define("esri/arcgis/csv",["dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/sniff","dojo/number","dojox/data/CsvStore","esri/kernel","esri/config","esri/request","esri/SpatialReference","esri/geometry/Point","esri/geometry/jsonUtils","esri/geometry/webMercatorUtils"],function(lang,_497,_498,has,_499,_49a,_49b,_49c,_49d,_49e,_49f,_4a0,_4a1){var _4a2=["lat","latitude","y","ycenter","latitude83","latdecdeg","POINT-Y"],_4a3=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","POINT-X"];function _4a4(_4a5){var _4a6=[","," ",";","|","\t"];var _4a7=0;var _4a8="";_497.forEach(_4a6,function(_4a9){var _4aa=_4a5.split(_4a9).length;if(_4aa>_4a7){_4a7=_4aa;_4a8=_4a9;}});return _4a8;};function _4ab(d,_4ac){if(!d||Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){return false;}var _4ad=true;if(has("chrome")&&/\d+\W*$/.test(_4ac)){var _4ae=_4ac.match(/[a-zA-Z]{2,}/);if(_4ae){var _4af=false,i=0,len=_4ae.length,_4b0=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;while(!_4af&&(i<=len)&&!(_4af=!_4b0.test(_4ae[i]))){i++;}_4ad=!_4af;}}return _4ad;};function _4b1(data,_4b2,_4b3){var _4b4=data.indexOf("\n");var _4b5=lang.trim(data.substr(0,_4b4));var _4b6=_4b2.columnDelimiter;if(!_4b6){_4b6=_4a4(_4b5);}var _4b7=new _49a({data:data,separator:_4b6});var _4b8=(has("ie")<9)?750:1001;_4b7.fetch({start:0,count:_4b8,onComplete:function(_4b9,_4ba){var _4bb=0;var _4bc={"layerDefinition":_4b2.layerDefinition,"featureSet":{"features":[],"geometryType":"esriGeometryPoint"}};var _4bd=_4bc.layerDefinition.objectIdField;if(!_4bd){if(!_497.some(_4bc.layerDefinition.fields,function(_4be){if(_4be.type=="esriFieldTypeOID"){_4bd=_4be.name;return true;}return false;})){_4bc.layerDefinition.fields.push({"name":"__OBJECTID","alias":"__OBJECTID","type":"esriFieldTypeOID","editable":false,"domain":null});_4bd="__OBJECTID";}}var _4bf,_4c0;var _4c1=_4b7._attributes;var _4c2=[];var _4c3=[];_497.forEach(_4bc.layerDefinition.fields,function(_4c4,_4c5){if(_4c4.type==="esriFieldTypeDate"){_4c2.push(_4c4.name);}else{if(_4c4.type==="esriFieldTypeDouble"||_4c4.type==="esriFieldTypeInteger"){_4c3.push(_4c4.name);}}});if(_4b2.locationInfo&&_4b2.locationInfo.locationType==="coordinates"){_4bf=_4b2.locationInfo.latitudeFieldName;_4c0=_4b2.locationInfo.longitudeFieldName;}else{_497.forEach(_4c1,function(_4c6){var _4c7;_4c7=_497.indexOf(_4a2,_4c6.toLowerCase());if(_4c7!==-1){_4bf=_4c6;}_4c7=_497.indexOf(_4a3,_4c6.toLowerCase());if(_4c7!==-1){_4c0=_4c6;}},this);}if(!_4bf||!_4c0){setTimeout(function(){},1);return;}var i=0,il=_4b9.length;for(i;i<il;i++){if(_4bc.featureSet.features.length>=1000){setTimeout(function(){},1);break;}var item=_4b9[i];var _4c8=_4b7.getAttributes(item),_4c9={};_497.forEach(_4c8,function(attr,_4ca){if(attr){var _4cb=attr;if(attr.length===0){_497.forEach(_4bc.layerDefinition.fields,function(_4cc,idx){if(_4cc.name==="attribute_"+(idx-1)){attr="attribute_"+(idx-1);}});}if(_497.some(_4c2,function(a){return a===attr;})){var val=_4b7.getValue(item,_4cb),date=new Date(val);_4c9[attr]=_4ab(date,val)?date.getTime():null;}else{if(_497.some(_4c3,function(a){return a===attr;})){var _4cd=_499.parse(_4b7.getValue(item,_4cb));if((attr==_4bf||attr==_4c0)&&(isNaN(_4cd)||Math.abs(_4cd)>181)){_4cd=parseFloat(_4b7.getValue(item,_4cb));if(isNaN(_4cd)){_4c9[attr]=null;}else{_4c9[attr]=_4cd;}}else{if(isNaN(_4cd)){_4c9[attr]=null;}else{_4c9[attr]=_4cd;}}}else{_4c9[attr]=_4b7.getValue(item,_4cb);}}}});_4c9[_4bd]=_4bb;_4bb++;var _4ce=_4c9[_4bf];var _4cf=_4c9[_4c0];if(_4cf==null||_4ce==null||isNaN(_4ce)||isNaN(_4cf)){continue;}var _4d0=new _49f(_4cf,_4ce,new _49e({wkid:4326}));var _4d1={"geometry":_4d0.toJson(),"attributes":_4c9};_4bc.featureSet.features.push(_4d1);}_4bc.layerDefinition.name="csv";if(_4b3){_4b3(_4bc);}},onError:function(_4d2){}});return true;};function _4d3(_4d4,_4d5,inSR,_4d6,_4d7,_4d8){if(_4d4.length===0){_4d7(null);}var _4d9=_4a0.getGeometryType(_4d5);var _4da=[];_497.forEach(_4d4,function(_4db){var _4dc=new _4d9(_4db);_4dc.spatialReference=inSR;_4da.push(_4dc);},this);var _4dd=[102113,102100,3857];if(inSR.wkid&&inSR.wkid===4326&&_4d6.wkid&&_497.indexOf(_4dd,_4d6.wkid)>-1){_497.forEach(_4da,function(_4de){if(_4de.xmin){_4de.xmin=Math.max(_4de.xmin,-180);_4de.xmax=Math.min(_4de.xmax,180);_4de.ymin=Math.max(_4de.ymin,-89.99);_4de.ymax=Math.min(_4de.ymax,89.99);}else{if(_4de.rings){_497.forEach(_4de.rings,function(ring){_497.forEach(ring,function(_4df){_4df[0]=Math.min(Math.max(_4df[0],-180),180);_4df[1]=Math.min(Math.max(_4df[1],-89.99),89.99);},this);},this);}else{if(_4de.paths){_497.forEach(_4de.paths,function(path){_497.forEach(path,function(_4e0){_4e0[0]=Math.min(Math.max(_4e0[0],-180),180);_4e0[1]=Math.min(Math.max(_4e0[1],-89.99),89.99);},this);},this);}else{if(_4de.x){_4de.x=Math.min(Math.max(_4de.x,-180),180);_4de.y=Math.min(Math.max(_4de.y,-89.99),89.99);}}}}},this);_4d4=[];_497.forEach(_4da,function(_4e1){var _4e2=_4a1.geographicToWebMercator(_4e1);if(_4d6.wkid!==102100){_4e2.spatialReference=_4d6;}_4d4.push(_4e2.toJson());},this);_4d7(_4d4);}else{if(inSR.wkid!==null&&_497.indexOf(_4dd,inSR.wkid)>-1&&_4d6.wkid!==null&&_4d6.wkid===4326){_4d4=[];_497.forEach(_4da,function(_4e3){_4d4.push(_4a1.webMercatorToGeographic(_4e3).toJson());},this);_4d7(_4d4);}else{var _4e4=function(_4e5,args){if(_4e5&&_4e5.length===_4d4.length){_4d4=[];_497.forEach(_4e5,function(_4e6){if(_4e6&&((_4e6.rings&&_4e6.rings.length>0&&_4e6.rings[0].length>0&&_4e6.rings[0][0].length>0&&!isNaN(_4e6.rings[0][0][0])&&!isNaN(_4e6.rings[0][0][1]))||(_4e6.paths&&_4e6.paths.length>0&&_4e6.paths[0].length>0&&_4e6.paths[0][0].length>0&&!isNaN(_4e6.paths[0][0][0])&&!isNaN(_4e6.paths[0][0][1]))||(_4e6.xmin&&!isNaN(_4e6.xmin)&&_4e6.ymin&&!isNaN(_4e6.ymin))||(_4e6.x&&!isNaN(_4e6.x)&&_4e6.y&&!isNaN(_4e6.y)))){_4d4.push(_4e6.toJson());}else{_4d4.push(null);}},this);_4d7(_4d4);}else{_4d8(_4e5,args);}};if(_49c.defaults.geometryService){_49c.defaults.geometryService.project(_4da,_4d6,lang.hitch(this,_4e4),_4d8);}else{_4d7(null);}}}};function _4e7(sp1,sp2){var _4e8=[102113,102100,3857];if(sp1&&sp2&&sp1.wkid===sp2.wkid&&sp1.wkt===sp2.wkt){return true;}else{if(sp1&&sp2&&sp1.wkid&&sp2.wkid&&_497.indexOf(_4e8,sp1.wkid)>-1&&_497.indexOf(_4e8,sp2.wkid)>-1){return true;}}return false;};function _4e9(_4ea,_4eb,_4ec,_4ed){if(!_4ea.featureSet||_4ea.featureSet.length===0){return;}if(_4e7(_4ec,_4eb)){_4ed(_4ea);return;}var _4ee=function(_4ef){var _4f0=[];_497.forEach(_4ea.featureSet.features,function(_4f1,i){if(_4ef[i]){_4f1.geometry=_4ef[i];_4f0.push(_4f1);}},this);_4ed(_4ea);};var _4f2=function(_4f3,args){_4ed(_4ea);};var _4f4=function(_4f5,args){_4d3(_4f6,_4ea.featureSet.geometryType,_4eb,_4ec,lang.hitch(this,_4ee),lang.hitch(this,_4f2));};if(_4ea.featureSet.features&&_4ea.featureSet.features.length>0){var _4f6=[];_497.forEach(_4ea.featureSet.features,function(_4f7){_4f6.push(_4f7.geometry);});_4d3(_4f6,_4ea.featureSet.geometryType,_4eb,_4ec,lang.hitch(this,_4ee),lang.hitch(this,_4f4));}else{_4ed(_4ea);}};function _4f8(_4f9){var _4fa=new _498();var _4fb=function(_4fc){_4fa.callback(_4fc);};var _4fd=_49d({url:_4f9.url,handleAs:"text",load:function(_4fe){_4b1(_4fe,_4f9,lang.hitch(this,_4fb));},error:function(_4ff){}},{usePost:false});return _4fa;};function _500(_501,_502){var _503=new _498();var _504=function(_505){_503.callback(_505);};_4e9(_501,new _49e({wkid:4326}),_502,lang.hitch(this,_504));return _503;};function _506(_507){var _508=_507.layerDefinition.fields;var _509={"esriFieldTypeDouble":1,"esriFieldTypeSingle":1};var _50a={"esriFieldTypeInteger":1,"esriFieldTypeSmallInteger":1};var dt={"esriFieldTypeDate":1};var _50b=null;var _50c=_497.map(_508,lang.hitch(this,function(item){if(item.name.toUpperCase()==="NAME"){_50b=item.name;}var _50d=(item.type!=="esriFieldTypeOID"&&item.type!=="esriFieldTypeGlobalID"&&item.type!=="esriFieldTypeGeometry");var _50e=null;if(_50d){var f=item.name.toLowerCase();var _50f=",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";if(_50f.indexOf(","+f+",")>-1||f.indexOf("area")>-1||f.indexOf("length")>-1||f.indexOf("shape")>-1||f.indexOf("perimeter")>-1||f.indexOf("objectid")>-1||f.indexOf("_")===f.length-1||(f.indexOf("_i")===f.length-2&&f.length>1)){_50d=false;}if(item.type in _50a){_50e={places:0,digitSeparator:true};}else{if(item.type in _509){_50e={places:2,digitSeparator:true};}else{if(item.type in dt){_50e={dateFormat:"shortDateShortTime"};}}}}return lang.mixin({},{fieldName:item.name,label:item.alias,isEditable:true,tooltip:"",visible:_50d,format:_50e,stringFieldOption:"textbox"});}));var _510={title:_50b?"{"+_50b+"}":"",fieldInfos:_50c,description:null,showAttachments:false,mediaInfos:[]};return _510;};var csv={latFieldStrings:_4a2,longFieldStrings:_4a3,buildCSVFeatureCollection:_4f8,projectFeatureCollection:_500,generateDefaultPopupInfo:_506,_getSeparator:_4a4,_isValidDate:_4ab,_processCsvData:_4b1,_projectGeometries:_4d3,_sameSpatialReference:_4e7,_projectFeatureSet:_4e9};if(has("extend-esri")){lang.setObject("arcgis.csv",csv,_49b);}return csv;});},"dojo/data/util/filter":function(){define("dojo/data/util/filter",["../../_base/lang"],function(lang){var _511={};lang.setObject("dojo.data.util.filter",_511);_511.patternToRegExp=function(_512,_513){var rxp="^";var c=null;for(var i=0;i<_512.length;i++){c=_512.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_512.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_513){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _511;});},"esri/layers/WMSLayerInfo":function(){define("esri/layers/WMSLayerInfo",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(_514,lang,_515,has,_516){var _517=_514(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(_518){if(_518){this.name=_518.name;this.title=_518.title;this.description=_518.description;this.extent=_518.extent;this.legendURL=_518.legendURL;this.subLayers=_518.subLayers?_518.subLayers:[];this.allExtents=_518.allExtents?_518.allExtents:[];this.spatialReferences=_518.spatialReferences?_518.spatialReferences:[];}},clone:function(){var info={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},wkid;if(this.extent){info.extent=this.extent.getExtent();}info.subLayers=[];_515.forEach(this.subLayers,function(_519){info.subLayers.push(_519.clone());});info.allExtents=[];for(wkid in this.allExtents){wkid=parseInt(wkid,10);if(!isNaN(wkid)){info.allExtents[wkid]=this.allExtents[wkid].getExtent();}}info.spatialReferences=[];_515.forEach(this.spatialReferences,function(wkid){info.spatialReferences.push(wkid);});return info;}});if(has("extend-esri")){lang.setObject("layers.WMSLayerInfo",_517,_516);}return _517;});},"esri/dijit/BasemapLayer":function(){define("esri/dijit/BasemapLayer",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_51a,lang,has,_51b){var BML=_51a(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(_51c){_51c=_51c||{};if(!_51c.url&&!_51c.type){}this.url=_51c.url;this.type=_51c.type;this.isReference=(_51c.isReference===true)?true:false;this.displayLevels=_51c.displayLevels;this.visibleLayers=_51c.visibleLayers;this.bandIds=_51c.bandIds;this.opacity=_51c.opacity;}});if(has("extend-esri")){lang.setObject("dijit.BasemapLayer",BML,_51b);}return BML;});},"esri/layers/RenderMode":function(){define("esri/layers/RenderMode",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/io/script","esri/kernel"],function(_51d,_51e,lang,_51f,has,_520,_521){var _522=_51e(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(_51d._scopeName||"dojo")+"IoScript";},initialize:function(map){this.map=map;this._init=true;},startup:function(){},propertyChangeHandler:function(type){},destroy:function(){this._init=false;},drawFeature:function(_523){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(oid){var _524=this._featureMap[oid];if(_524){_524._count++;}},_decRefCount:function(oid){var _525=this._featureMap[oid];if(_525){_525._count--;}},_getFeature:function(oid){return this._featureMap[oid];},_addFeatureIIf:function(oid,_526){var fmap=this._featureMap,_527=fmap[oid],_528=this.featureLayer;if(!_527){fmap[oid]=_526;_528._add(_526);_526._count=0;}return _527||_526;},_removeFeatureIIf:function(oid){var _529=this._featureMap[oid],_52a=this.featureLayer;if(_529){if(_529._count){return;}delete this._featureMap[oid];_52a._remove(_529);}return _529;},_clearIIf:function(){var i,_52b=this.featureLayer,_52c=_52b.graphics,_52d=_52b._selectedFeatures,_52e=_52b.objectIdField;for(i=_52c.length-1;i>=0;i--){var _52f=_52c[i];var oid=_52f.attributes[_52e];if(oid in _52d){_52f._count=1;continue;}_52f._count=0;this._removeFeatureIIf(oid);}},_isPending:function(id){var dfd=_520[this._prefix+id];return dfd?true:false;},_cancelPendingRequest:function(dfd,id){dfd=dfd||_520[this._prefix+id];if(dfd){try{dfd.cancel();_520._validCheck(dfd);}catch(e){}}},_purgeRequests:function(){_520._validCheck(null);},_toggleVisibility:function(show){var _530=this.featureLayer,_531=_530.graphics,_532=show?"show":"hide",i,len=_531.length;show=show&&_530._ager;for(i=0;i<len;i++){var _533=_531[i];_533[_532]();if(show){_530._repaint(_533);}}},_applyTimeFilter:function(_534){var _535=this.featureLayer;if(!_535.timeInfo||_535.suspended){return;}if(!_534){_535._fireUpdateStart();}var _536=_535._trackManager;if(_536){_536.clearTracks();}var defn=_535.getTimeDefinition(),_537=_535._getOffsettedTE(_535._mapTimeExtent);if(_537){_537=_535._getTimeOverlap(defn,_537);if(_537){var _538=_535._filterByTime(_535.graphics,_537.startTime,_537.endTime);if(_536){_536.addFeatures(_538.match);}_51f.forEach(_538.match,function(_539){var _53a=_539._shape;if(!_539.visible){_539.show();_53a=_539._shape;_53a&&_53a._moveToFront();}if(_535._ager&&_53a){_535._repaint(_539);}});_51f.forEach(_538.noMatch,function(_53b){if(_53b.visible){_53b.hide();}});}else{this._toggleVisibility(false);}}else{if(_536){_536.addFeatures(_535.graphics);}this._toggleVisibility(true);}if(_536){_536.moveLatestToFront();_536.drawTracks();}if(!_534){_535._fireUpdateEnd();}}});if(has("extend-esri")){lang.setObject("layers._RenderMode",_522,_521);}return _522;});},"esri/layers/FeatureType":function(){define("esri/layers/FeatureType",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/symbols/jsonUtils","esri/layers/RangeDomain","esri/layers/CodedValueDomain","esri/layers/InheritedDomain","esri/layers/FeatureTemplate"],function(_53c,lang,_53d,has,_53e,_53f,_540,_541,_542,_543,_544){var _545=_53c(null,{declaredClass:"esri.layers.FeatureType",constructor:function(json){if(json&&lang.isObject(json)){this.id=json.id;this.name=json.name;var _546=json.symbol;if(_546){this.symbol=_540.fromJson(_546);}var _547=json.domains,_548,i;var _549=this.domains={};for(_548 in _547){if(_547.hasOwnProperty(_548)){var _54a=_547[_548];switch(_54a.type){case "range":_549[_548]=new _541(_54a);break;case "codedValue":_549[_548]=new _542(_54a);break;case "inherited":_549[_548]=new _543(_54a);break;}}}var _54b=json.templates;if(_54b){var _54c=this.templates=[];for(i=0;i<_54b.length;i++){_54c.push(new _544(_54b[i]));}}}},toJson:function(){var json={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()};var _54d,_54e=this.domains,_54f=this.templates,_550=_53f.fixJson;if(_54e){var _551=json.domains={};for(_54d in _54e){if(_54e.hasOwnProperty(_54d)){_551[_54d]=_54e[_54d]&&_54e[_54d].toJson();}}_550(_551);}if(_54f){json.templates=_53d.map(_54f,function(_552){return _552.toJson();});}return _550(json);}});if(has("extend-esri")){lang.setObject("layers.FeatureType",_545,_53e);}return _545;});},"esri/dijit/Basemap":function(){define("esri/dijit/Basemap",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/has","esri/kernel","esri/request","esri/dijit/BasemapLayer"],function(_553,_554,lang,has,_555,_556,_557){var BM=_553(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(_558,_559){_558=_558||{};if(!_558.layers&&!_558.itemId){}this.id=_558.id;this.itemId=_558.itemId;this.layers=_558.layers;this.title=_558.title||"";this.thumbnailUrl=_558.thumbnailUrl;this.basemapGallery=_559;},getLayers:function(){if(this.layers){return this.layers;}else{if(this.itemId){var url=_555.dijit._arcgisUrl+"/content/items/"+this.itemId+"/data";var _55a={};_55a.f="json";var _55b=_556({url:url,content:_55a,callbackParamName:"callback",error:lang.hitch(this,function(_55c,args){var msg="esri.dijit.Basemap: could not access basemap item.";if(this.basemapGallery){this.basemapGallery.onError(msg);}else{}})});_55b.addCallback(lang.hitch(this,function(_55d,args){if(_55d.baseMap){this.layers=[];_554.forEach(_55d.baseMap.baseMapLayers,function(_55e){var _55f={};if(_55e.url){_55f.url=_55e.url;}if(_55e.type){_55f.type=_55e.type;}if(_55e.isReference){_55f.isReference=_55e.isReference;}if(_55e.displayLevels){_55f.displayLevels=_55e.displayLevels;}if(_55e.visibleLayers){_55f.visibleLayers=_55e.visibleLayers;}if(_55e.bandIds){_55f.bandIds=_55e.bandIds;}this.layers.push(new _557(_55f));},this);return this.layers;}else{var msg="esri.dijit.Basemap: could not access basemap item.";if(this.basemapGallery){this.basemapGallery.onError(msg);}else{}return [];}}));return _55b;}}}});if(has("extend-esri")){lang.setObject("dijit.Basemap",BM,_555);}return BM;});},"url:esri/dijit/templates/BasemapGallery.html":"<div class=\"esriBasemapGallery\">\r\n  <div dojoAttachPoint=\"flowContainer\">\r\n  </div>\r\n</div>","esri/arcgis/utils":function(){define("esri/arcgis/utils",["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/_base/json","dojo/_base/url","dojo/has","dojo/DeferredList","dojo/dom-construct","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/map","esri/urlUtils","esri/geometry/ScreenPoint","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/symbols/jsonUtils","esri/renderers/jsonUtils","esri/dijit/PopupTemplate","esri/dijit/Popup","esri/tasks/query","esri/tasks/GeometryService","esri/arcgis/csv","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/layers/WebTiledLayer","esri/layers/FeatureLayer","esri/layers/WMSLayer","esri/layers/KMLLayer","esri/layers/GeoRSSLayer","esri/virtualearth/VETiledLayer","esri/layers/TileInfo","esri/layers/DynamicLayerInfo","esri/layers/LayerDrawingOptions","esri/layers/ImageParameters","esri/layers/ImageServiceParameters","esri/layers/WMSLayerInfo","dojo/i18n!esri/nls/jsapi"],function(lang,_560,_561,_562,_563,Url,has,_564,_565,_566,_567,_568,_569,_56a,Map,_56b,_56c,_56d,_56e,_56f,_570,_571,_572,_573,_574,csv,_575,_576,_577,_578,_579,_57a,_57b,_57c,_57d,_57e,_57f,_580,_581,_582,_583,_584,_585){String.prototype.endsWith=function(str){return (this.match(str+"$")==str);};var _586;function _587(_588){var url=_586.arcgisUrl+"/"+_588.itemId+"/data";var _589=_569({url:url,content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:true,_preLookup:true});return _589;};function _58a(_58b){var _58c={f:"json"};if(_566.id){var _58d=_566.id.findCredential(_56b.urlToObject(_586.arcgisUrl).path);if(_58d){_58c.token=_58d.token;}}var _58e=_569({url:_58b,content:_58c,callbackParamName:"callback"});return _58e;};function _58f(_590){if(_590.itemProperties.layerDefinition){if(_590.layerDefinition){if(!_590.layerDefinition.drawingInfo){_590.layerDefinition.drawingInfo=_590.itemProperties.layerDefinition.drawingInfo;}if(!_568.isDefined(_590.layerDefinition.definitionExpression)){_590.layerDefinition.definitionExpression=_590.itemProperties.layerDefinition.definitionExpression;}if(!_568.isDefined(_590.layerDefinition.minScale)){_590.layerDefinition.minScale=_590.itemProperties.layerDefinition.minScale;}if(!_568.isDefined(_590.layerDefinition.maxScale)){_590.layerDefinition.maxScale=_590.itemProperties.layerDefinition.maxScale;}}else{_590.layerDefinition=_590.itemProperties.layerDefinition;}}if(_590.itemProperties.popupInfo&&!_590.popupInfo&&!_590.disablePopup){_590.popupInfo=_590.itemProperties.popupInfo;}};function _591(_592,_593){var _594=new _562();var _595=_592.itemData;var _596=[];var _597=[];_560.forEach(_595.operationalLayers,function(_598){if(_598.itemId&&!_598.type){var _599=_598.url.toLowerCase();if(_599.indexOf("/featureserver")>-1){_597.push(_598);_596.push(_587(_598));}else{if(_599.indexOf("/mapserver")>-1&&_599.indexOf("/mapserver/")===-1&&(!_598.layers||(!_568.isDefined(_598.minScale)&&!_568.isDefined(_598.maxScale)))){_597.push(_598);_596.push(_587(_598));}else{if(_599.indexOf("/imageserver")>-1&&!_568.isDefined(_598.minScale)&&!_568.isDefined(_598.maxScale)){_597.push(_598);_596.push(_587(_598));}}}}});if(_595.baseMap&&_595.baseMap.baseMapLayers){_560.forEach(_595.baseMap.baseMapLayers,function(_59a){if((_59a.type==="BingMapsAerial"||_59a.type==="BingMapsRoad"||_59a.type==="BingMapsHybrid")&&_59a.portalUrl){_597.push(_59a);_596.push(_58a(_59a.portalUrl));}});}if(_596.length>0){var _59b=new _564(_596);_59b.addCallback(function(_59c){_560.forEach(_597,function(_59d,i){if((_59d.type==="BingMapsAerial"||_59d.type==="BingMapsRoad"||_59d.type==="BingMapsHybrid")&&_59d.portalUrl){_593.bingMapsKey=_59c[i][1].bingKey;return;}var _59e=_59c[i][1];if(_59e){var _59f=_59d.url.toLowerCase();if(_59f.indexOf("/featureserver")>-1&&_59e.layers){_560.forEach(_59e.layers,function(_5a0){if(_59f.endsWith("/featureserver/"+_5a0.id)){_59d.itemProperties=_5a0;_58f(_59d);}});}else{if(_59f.indexOf("/mapserver")>-1){if(_59e.layers&&!_59d.layers){_59d.layers=_59e.layers;}if(_568.isDefined(_59e.minScale)&&!_568.isDefined(_59d.minScale)){_59d.minScale=_59e.minScale;}if(_568.isDefined(_59e.maxScale)&&!_568.isDefined(_59d.maxScale)){_59d.maxScale=_59e.maxScale;}}else{if(_59f.indexOf("/imageserver")>-1){if(_568.isDefined(_59e.minScale)&&!_568.isDefined(_59d.minScale)){_59d.minScale=_59e.minScale;}if(_568.isDefined(_59e.maxScale)&&!_568.isDefined(_59d.maxScale)){_59d.maxScale=_59e.maxScale;}}}}}});_594.callback(_592);});}else{_594.callback(_592);}return _594;};function _5a1(_5a2,_5a3){var _5a4=_5a2.dynamicLayerInfos||_5a2.layerInfos;var _5a5=_5a3.layers;if(_5a5&&_5a4){var _5a6=[],ids=[],urls=[];_560.forEach(_5a4,function(_5a7){var id=_5a7.id,i;if(!_5a7.subLayerIds&&_560.indexOf(_5a2.visibleLayers,id)!==-1){for(i=0;i<_5a5.length;i++){var _5a8=_5a5[i];if(_5a8.id===id){ids.push(id);_5a6.push(_5a8.popupInfo);urls.push(_5a8.layerUrl||"");break;}}}});if(_5a6.length){_5a2.__popups=_5a6;_5a2.__popupIds=ids;_5a2.__popupUrls=urls;_5a2.__resourceInfo=_5a3.resourceInfo;}}};function _5a9(url){if(!url){return false;}var _5aa=".arcgis.com/";var _5ab=(new Url(_586.arcgisUrl)).authority;return (url.indexOf(_5aa)!==-1||url.indexOf(_5ab)!==-1);};function _5ac(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);};function _5ad(url){if(location.protocol==="https:"&&(_5a9(url)||_5ac(url))){url=url.replace("http:","https:");}return url;};function _5ae(_5af){var _5b0=[];if(!_5af.displayLevels){_5b0=_560.map(_5af.resourceInfo.tileInfo.lods,function(lod){return lod.level;});}var _5b1=new _575(_5ad(_5af.url),{resourceInfo:_5af.resourceInfo,opacity:_5af.opacity,visible:_5af.visibility,displayLevels:_5af.displayLevels||_5b0,id:_5af.id,minScale:_5af.minScale,maxScale:_5af.maxScale});_5a1(_5b1,_5af);return _5b1;};function _5b2(_5b3,_5b4){if(!_5b3||!_5b4||_5b4.length===0){return [];}var _5b5=","+_5b4+",";var _5b6=[];var _5b7="";var k,_5b8=",";for(k=0;k<_5b3.length;k++){if(_5b3[k].subLayerIds!==null){if(_5b5.indexOf(","+_5b3[k].id+",")===-1||_5b8.indexOf(","+_5b3[k].id+",")>-1){_5b8+=_5b3[k].subLayerIds.toString()+",";}}else{if(_5b5.indexOf(","+_5b3[k].id+",")>-1&&_5b8.indexOf(","+_5b3[k].id+",")===-1){_5b6.push(_5b3[k].id);_5b7=",";}}}return _5b6;};function _5b9(_5ba){var _5bb=new _582();_5bb.format="png24";if(_5ba.resourceInfo&&_5ba.resourceInfo.supportedImageFormatTypes&&_5ba.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")>-1){_5bb.format="png32";}var _5bc=new _576(_5ad(_5ba.url),{resourceInfo:_5ba.resourceInfo,opacity:_5ba.opacity,visible:_5ba.visibility,id:_5ba.id,imageParameters:_5bb,minScale:_5ba.minScale,maxScale:_5ba.maxScale});var _5bd=_5ba.visibleLayers;if(!_5ba.visibleLayers){var _5be="";var _5bf=_5bc.layerInfos;_560.forEach(_5bf,function(_5c0){if(_5c0.defaultVisibility){_5be+=(_5be.length>0?",":"")+_5c0.id;}});_5bd=_5be;}_5bd=_5b2(_5bc.layerInfos,_5bd);_5bc.setVisibleLayers(_5bd);if(_5ba.layers&&_5ba.layers.length>0){var _5c1=[],_5c2=[],_5c3,_5c4=[],_5c5;_560.forEach(_5ba.layers,function(_5c6){if(_5c6.layerDefinition&&_5c6.layerDefinition.definitionExpression){_5c1[_5c6.id]=_5c6.layerDefinition.definitionExpression;}if(_5c6.layerDefinition&&_5c6.layerDefinition.source){_5c3=new _580(lang.mixin(_5c6,_5c6.layerDefinition));delete _5c3.layerDefinition;_5c3.id=_5c6.id;if(_5ba.visibleLayers&&_560.indexOf(_5ba.visibleLayers,_5c6.id)===-1){_5c3.defaultVisibility=false;}if(_568.isDefined(_5c6.parentLayerId)){_5c3.parentLayerId=_5c6.parentLayerId;}if(_5c6.subLayerIds){_5c3.subLayerIds=_5c6.subLayerIds;}if(_5c6.name){_5c3.name=_5c6.name;}_5c2.push(_5c3);}if(_5c6.layerDefinition&&_5c6.layerDefinition.source&&_5c6.layerDefinition.drawingInfo){_5c5=new _581(_5c6.layerDefinition.drawingInfo);_5c4[_5c6.id]=_5c5;}},this);if(_5c1.length>0){_5bc.setLayerDefinitions(_5c1);}if(_5c2.length>0){_5bc.setDynamicLayerInfos(_5c2,true);if(_5c4.length>0){_5bc.setLayerDrawingOptions(_5c4,true);}}}_5a1(_5bc,_5ba);return _5bc;};function _5c7(_5c8,_5c9){var _5ca=[102113,102100,3857];var sp1=new _56a(_5c9[0].layerObject.fullExtent.spatialReference);var sp2=new _56a(_5c8.resourceInfo.fullExtent.spatialReference);if(_563.toJson(sp1.toJson())===_563.toJson(sp2.toJson())){return true;}else{if(_560.some(_5ca,function(wkid){return wkid===sp2.wkid;})&&_560.some(_5ca,function(wkid){return wkid===sp1.wkid;})){return true;}}return false;};function _5cb(_5cc,_5cd){if(!_5cd[0].layerObject.tileInfo){return false;}var _5ce=[];_560.forEach(_5cd,function(_5cf){if(_5cf.baseMapLayer){if(_5cf.layerObject.tileInfo){_5ce=_5ce.concat(_560.map(_5cf.layerObject.tileInfo.lods,function(lod){return lod.scale;}));}}});var _5d0=_560.some(_5cc.resourceInfo.tileInfo.lods,function(lod){return _560.some(_5ce,function(_5d1){return _5d1===lod.scale;});});return _5d0;};function _5d2(_5d3,_5d4,_5d5,_5d6){var _5d7,_5d8=_5d5._clazz;if(_5d3.type==="OpenStreetMap"){_5d7=new _578({id:_5d3.id,opacity:_5d3.opacity,visible:(_5d3.visibility!==null&&_5d3.visibility!==undefined)?_5d3.visibility:true});}else{if(_5d3.type==="WMS"){var _5d9=[];var _5da=[];_560.forEach(_5d3.layers,function(_5db){_5da.push(new _584({name:_5db.name,title:_5db.title,legendURL:_5db.legendURL}));_5d9.push(_5db.name);},this);if(_5d3.visibleLayers){_5d9=_5d3.visibleLayers;}var _5dc=new _56d(_5d3.extent[0][0],_5d3.extent[0][1],_5d3.extent[1][0],_5d3.extent[1][1],new _56a({wkid:4326}));var _5dd={extent:_5dc,layerInfos:_5da,version:_5d3.version,maxWidth:_5d3.maxWidth,maxHeight:_5d3.maxHeight,getMapUrl:_5d3.mapUrl,spatialReferences:_5d3.spatialReferences,title:_5d3.title,copyright:_5d3.copyright};_5d7=new _57b(_5d3.url,{id:_5d3.id,visibleLayers:_5d9,format:"png",transparent:_5d3.baseMapLayer?false:true,opacity:_5d3.opacity,visible:(_5d3.visibility!==null)?_5d3.visibility:true,resourceInfo:_5dd});_5d7.spatialReference.wkid=_5dd.spatialReferences[0];}else{if(_5d3.type==="KML"){_5d7=new _57c(_5d3.url,{id:_5d3.id,visible:(_5d3.visibility!==null)?_5d3.visibility:true,outSR:_5d6});_561.connect(_5d7,"onLoad",function(){var _5de=function(_5df){_560.forEach(_5df,function(_5e0){if(_5e0.declaredClass==="esri.layers.FeatureLayer"||_5e0.declaredClass==="esri.layers.MapImageLayer"){_5e0.setOpacity(_5d3.opacity);}else{if(_5e0.declaredClass==="esri.layers.KMLLayer"){if(_5e0.loaded){_5de(_5e0.getLayers());}else{_561.connect(_5e0,"onLoad",lang.hitch(this,function(lyr){_5de(lyr.getLayers());}));}}}});};if(_5d3.opacity||_5d3.opacity===0){_5de(_5d7.getLayers());}if(_5d3.visibleFolders){_560.forEach(_5d7.folders,function(_5e1){if(_560.indexOf(_5d3.visibleFolders,_5e1.id)>-1){_5d7.setFolderVisibility(_5e1,true);}else{_5d7.setFolderVisibility(_5e1,false);}},this);}});}else{if(_5d3.type==="WebTiledLayer"){_5d7=new _579(_5d3.templateUrl,{id:_5d3.id,visible:(_5d3.visibility!==null)?_5d3.visibility:true,opacity:_5d3.opacity,copyright:_5d3.copyright,fullExtent:_5d3.fullExtent&&new _56d(_5d3.fullExtent),initialExtent:_5d3.fullExtent&&new _56d(_5d3.fullExtent),subDomains:_5d3.subDomains,tileInfo:_5d3.tileInfo?new _57f(_5d3.tileInfo):null});_561.connect(_5d7,"onLoad",function(){if(_568.isDefined(_5d3.minScale)||_568.isDefined(_5d3.maxScale)){_5d7.setScaleRange(_5d3.minScale,_5d3.maxScale);}});}else{if(_5d3.type==="GeoRSS"){_5d7=new _57d(_5d3.url,{id:_5d3.id,visible:(_5d3.visibility!==null)?_5d3.visibility:true,opacity:_5d3.opacity,outSpatialReference:_5d6});_561.connect(_5d7,"onLoad",function(){var _5e2=_5d7.getFeatureLayers();_560.forEach(_5e2,function(_5e3){if(_5d3.pointSymbol&&_5e3.geometryType==="esriGeometryPoint"){_5e3.renderer.symbol=_56f.fromJson(_5d3.pointSymbol);}else{if(_5d3.lineSymbol&&_5e3.geometryType==="esriGeometryPolyline"){_5e3.renderer.symbol=_56f.fromJson(_5d3.lineSymbol);}else{if(_5d3.polygonSymbol&&_5e3.geometryType==="esriGeometryPolygon"){_5e3.renderer.symbol=_56f.fromJson(_5d3.polygonSymbol);}}}if(_568.isDefined(_5d3.minScale)||_568.isDefined(_5d3.maxScale)){_5e3.setScaleRange(_5d3.minScale,_5d3.maxScale);}});});}else{if(_5d3.type=="CSV"&&_5d3.url){_5d7=new _57a(_5d3.featureCollection,{infoTemplate:new _571(_5d3.popupInfo?_5d3.popupInfo:csv.generateDefaultPopupInfo(_5d3.featureCollection)),id:_5d3.id?_5d3.id:null,outFields:["*"],visible:(_5d3.visibility!==null)?_5d3.visibility:true,opacity:_5d3.opacity,autoGeneralize:true});}else{if(_5d3.layerDefinition&&!_5d3.url){var _5e4=_563.fromJson(_563.toJson(_5d3));delete _5e4.id;delete _5e4.opacity;delete _5e4.visibility;_5d7=new _57a(_5e4,{id:_5d3.id,opacity:_5d3.opacity,visible:_5d3.visibility,outFields:["*"],infoTemplate:_5e4.popupInfo&&new _5d8(_5e4.popupInfo),autoGeneralize:true});}else{if(_5d3.type==="BingMapsAerial"||_5d3.type==="BingMapsRoad"||_5d3.type==="BingMapsHybrid"){var _5e5=_57e.MAP_STYLE_AERIAL_WITH_LABELS;if(_5d3.type==="BingMapsAerial"){_5e5=_57e.MAP_STYLE_AERIAL;}else{if(_5d3.type==="BingMapsRoad"){_5e5=_57e.MAP_STYLE_ROAD;}}_5d7=new _57e({bingMapsKey:_5d5.bingMapsKey,mapStyle:_5e5,opacity:_5d3.opacity,id:_5d3.id});}else{if(_5d3.resourceInfo&&_5d3.resourceInfo.mapName){if(_5d3.resourceInfo.singleFusedMapCache===true){if(!_5d3.baseMapLayer){if(_5c7(_5d3,_5d4)){if(_5cb(_5d3,_5d4)){_5d7=_5ae(_5d3);}else{_5d7=_5b9(_5d3);}}else{_5d7=_5b9(_5d3);}}else{_5d7=_5ae(_5d3);}}else{_5d7=_5b9(_5d3);}}else{if(_5d3.resourceInfo&&_5d3.resourceInfo.pixelSizeX){var _5e6=new _583();_5e6.bandIds=_5d3.bandIds;if(!_5d3.bandIds&&_5d3.resourceInfo.bandCount&&parseInt(_5d3.resourceInfo.bandCount,10)>3){_5e6.bandIds=[0,1,2];}_5d7=new _577(_5ad(_5d3.url),{resourceInfo:_5d3.resourceInfo,opacity:_5d3.opacity,visible:_5d3.visibility,id:_5d3.id,imageServiceParameters:_5e6,minScale:_5d3.minScale,maxScale:_5d3.maxScale});}else{if(_5d3.resourceInfo&&_5d3.resourceInfo.type==="Feature Layer"){_5d7=new _57a(_5ad(_5d3.url),{resourceInfo:_5d3.resourceInfo,opacity:_5d3.opacity,visible:_5d3.visibility,id:_5d3.id,mode:_568.isDefined(_5d3.mode)?_5d3.mode:_57a.MODE_ONDEMAND,outFields:["*"],infoTemplate:_5d3.popupInfo&&new _5d8(_5d3.popupInfo),autoGeneralize:true});if(_5d3.layerDefinition){if(_5d3.layerDefinition.drawingInfo&&_5d3.layerDefinition.drawingInfo.renderer){var _5e7=_570.fromJson(_5d3.layerDefinition.drawingInfo.renderer);_5e7.isMaxInclusive=true;_5d7.setRenderer(_5e7);}if(_5d3.layerDefinition.definitionExpression){_5d7.setDefinitionExpression(_5d3.layerDefinition.definitionExpression);}if(_568.isDefined(_5d3.layerDefinition.minScale)){_5d7.setMinScale(_5d3.layerDefinition.minScale);}if(_568.isDefined(_5d3.layerDefinition.maxScale)){_5d7.setMaxScale(_5d3.layerDefinition.maxScale);}}}}}}}}}}}}}if(_5d7){_5d7.arcgisProps={title:_5d3.title};if(_5d3.baseMapLayer){if(_5d3.isReference){_5d7._basemapGalleryLayerType="reference";}else{_5d7._basemapGalleryLayerType="basemap";}}}return _5d7;};function _5e8(_5e9,_5ea,_5eb){_560.forEach(_5e9,function(_5ec,_5ed){if(_5ec.url&&!_5ec.type){if(_5ed===0||_5e9[0].layerObject){_5ec.layerObject=_5d2(_5ec,_5e9,_5ea,_5eb);}}else{if(_5ec.url&&_5ec.type=="CSV"){_5ec.layerObject=_5d2(_5ec,_5e9,_5ea,_5eb);}else{_5ec.layerObject=_5d2(_5ec,_5e9,_5ea,_5eb);}}});var _5ee=_560.filter(_5e9,function(lyr){return !lyr.isReference;});var _5ef=_560.filter(_5e9,function(lyr){return !!lyr.isReference;});_5e9=_5ee.concat(_5ef);return _5e9;};function _5f0(_5f1){var _5f2=null;var _5f3=_5f1[0];if(_5f3.url&&!_5f3.type){if(_5f3.resourceInfo.spatialReference){_5f2=new _56a();if(_5f3.resourceInfo.spatialReference.wkid){_5f2.wkid=_5f3.resourceInfo.spatialReference.wkid;}if(_5f3.resourceInfo.spatialReference.wkt){_5f2.wkt=_5f3.resourceInfo.spatialReference.wkt;}}}else{if(_5f3.type.indexOf("BingMaps")>-1||_5f3.type=="OpenStreetMap"){_5f2=new _56a({wkid:102100});}else{if(_5f3.type=="WMS"){_5f2=new _56a({wkid:_5f3.spatialReferences[0]});}}}return _5f2;};function _5f4(_5f5,_5f6,_5f7,_5f8,_5f9){_560.forEach(_5f6,function(_5fa,_5fb){if(_5fa.url&&!_5fa.type){_5fa.resourceInfo=_5f5[_5fa.deferredsPos][1];delete _5fa.deferredsPos;}else{if(_5fa.url&&_5fa.type=="CSV"){_5fa.featureCollection=_5f8[_5fa.deferredsPos].results[0];delete _5fa.deferredsPos;}}});var _5fc=_5f0(_5f6);var _5fd=[];var _5fe=new _562();_560.forEach(_5f6,function(_5ff){if(_5ff.url&&_5ff.type=="CSV"){_5ff.deferredsPos=_5fd.length;_5fd.push(csv.projectFeatureCollection(_5ff.featureCollection,_5fc));}});if(_5fd.length==0){_5f6=_5e8(_5f6,_5f7,_5fc);_5f9.callback(_5f6);}else{var _600=new _564(_5fd);_600.addCallback(function(){_560.forEach(_5f6,function(_601){if(_601.url&&_601.type=="CSV"){_601.featureCollection=_5fd[_601.deferredsPos].results[0];delete _601.deferredsPos;}});_5f6=_5e8(_5f6,_5f7,_5fc);_5f9.callback(_5f6);});}};function _602(url,_603){var url2=_5ad(url);return _569({url:url2,content:{f:"json"},callbackParamName:"callback",error:function(_604,io){if(_604.message){_604.message+=" [url:"+url2+"]";}else{_604.message="[url:"+url2+"]";}_603.push(_604);_567.defaults.io.errorHandler(_604,io);}});};function _605(_606,_607){var _608=[];var _609=[];var _60a=[];var _60b=new _562();_560.forEach(_606.operationalLayers,function(_60c,_60d){if(_60c.featureCollection){_560.forEach(_60c.featureCollection.layers,function(_60e,idx){var _60f=true;if(_60c.visibleLayers){if(_560.indexOf(_60c.visibleLayers,idx)==-1){_60f=false;}}_60e.visibility=(_60c.visibility&&_60f);_60e.opacity=_60c.opacity;_60e.id=(_60c.id||("operational"+_60d))+"_"+idx;_60a.push(_60e);},this);}else{_60a.push(_60c);}});_560.forEach(_606.baseMap.baseMapLayers,function(_610,_611){_610.baseMapLayer=true;_610.id=_610.id||("base"+_611);_608.push(_610);});_560.forEach(_60a,function(_612,_613){_612.id=_612.id||("operational"+_613);_608.push(_612);});_560.forEach(_608,function(_614){if(_614.url&&!_614.type){_614.deferredsPos=_609.length;_614.errors=[];_609.push(_602(_614.url,_614.errors));}else{if(_614.url&&_614.type=="CSV"){_614.deferredsPos=_609.length;_609.push(csv.buildCSVFeatureCollection(_614));}}});if(_609.length==0){var _615=_5f0(_608);_608=_5e8(_608,_607,_615);_60b.callback(_608);}else{var _616=new _564(_609);_616.addCallback(function(_617){_5f4(_617,_608,_607,_609,_60b);});}return _60b;};function _618(_619,_61a){if(_61a.version<=10.1&&_619){var i,id=parseInt(_61a.url.substring(_61a.url.lastIndexOf("/")+1,_61a.url.length));for(i=_619.length-1;i>=0;i--){if(_619[i].id==id){if(_61a.minScale==0&&_619[i].minScale>0){_61a.minScale=_619[i].minScale;}else{if(_61a.minScale>0&&_619[i].minScale==0){_61a.minScale=_61a.minScale;}else{if(_61a.minScale>0&&_619[i].minScale>0){_61a.minScale=Math.min(_61a.minScale,_619[i].minScale);}}}_61a.maxScale=Math.max(_61a.maxScale||0,_619[i].maxScale||0);if(_619[i].parentLayerId>-1){id=_619[i].parentLayerId;}else{break;}}}}};function _61b(_61c,_61d,_61e,map){var url=_61c.url;var _61f=_61c.__popups;var ids=_61c.__popupIds;var urls=_61c.__popupUrls;var _620=_61c.__resourceInfo;var _621=[];_560.forEach(_61f,function(_622,_623){if(!_622){return;}var _624,_625=[];_560.forEach(_622.fieldInfos,function(item){_625.push(item.fieldName);});if(_61c.dynamicLayerInfos&&_61c.dynamicLayerInfos.length>0){var _626=_560.filter(_61c.dynamicLayerInfos,function(item){return ids[_623]==item.id;})[0].source;_624=new _57a(url+"/dynamicLayer",{id:_61c.id+"_"+ids[_623],source:_626,outFields:_625,mode:_57a.MODE_SELECTION,infoTemplate:_622&&new _61e(_622),drawMode:false,visible:_61c.visible,autoGeneralize:true});}else{var i,_627=null;if(_61d){for(i=0;i<_61d.length;i++){if(_61d[i].id===ids[_623]){_627=_61d[i];break;}}}var _628=url+"/"+ids[_623];if(urls[_623].length){_628=urls[_623];}_624=new _57a(_5ad(_628),{id:_61c.id+"_"+ids[_623],outFields:_625,mode:_57a.MODE_SELECTION,infoTemplate:_622&&new _61e(_622),drawMode:false,visible:_61c.visible,resourceInfo:_627,autoGeneralize:true});}if(_624.loaded){_618(_620.layers,_624);}else{_561.connect(_624,"onLoad",function(_629){_618(_620.layers,_629);});}_621.push(_624);});if(_621.length>0){var _62a=function(_62b,_62c){_560.forEach(_62b,function(_62d){if(_62c){_62d.show();}else{_62d.hide();}});};_561.connect(_61c,"onVisibilityChange",lang.hitch(this,_62a,_621));var _62e=function(_62f,_630,_631){if(_62f.id===_631.id){_560.forEach(_630,function(_632){map.removeLayer(_632);});}};_561.connect(map,"onLayerRemove",lang.hitch(this,_62e,_61c,_621));}delete _61c.__popups;delete _61c.__popupIds;delete _61c.__popupUrls;delete _61c.__resourceInfo;return _621;};function _633(_634){return _569({url:_5ad(_634.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}});};function _635(_636,map,_637){var _638=[];_560.forEach(_636,function(_639){var _63a=_639.__popups;if(_63a&&_63a.length>1&&_639.version>=10){_639.__deferredsPos=_638.length;_638.push(_633(_639));}});var _63b=[];if(_638.length>0){var _63c=new _564(_638);_63c.addCallback(function(_63d){_560.forEach(_636,function(_63e){if(_63e.__popups&&_63e.__popups.length>0){if(_63e.__deferredsPos||_63e.__deferredsPos===0){var _63f=_63d[_63e.__deferredsPos][1];_63b=_63b.concat(_61b(_63e,_63f.layers,_637,map));delete _63e.__deferredsPos;}else{_63b=_63b.concat(_61b(_63e,null,_637,map));}}});map.addLayers(_63b);});}else{_560.forEach(_636,function(_640){if(_640.__popups&&_640.__popups.length>0){_63b=_63b.concat(_61b(_640,null,_637,map));}});map.addLayers(_63b);}};function _641(_642){_560.forEach(_642,function(_643){var _644=_643.layer;if(_644.toJson){var json=_644.toJson();if(json.featureSet&&_644.name.indexOf("Text")>-1){_560.forEach(json.featureSet.features,function(_645,idx){if(_645.attributes.TEXT){var _646=_644.graphics[idx];_646.symbol.setText(_645.attributes.TEXT);if(_645.symbol.horizontalAlignment){_646.symbol.align=_645.symbol.horizontalAlignment;}_646.setSymbol(_646.symbol);_646.setAttributes(_645.attributes);}},this);}}});};function _647(_648){var _649=6;_560.forEach(_648,function(_64a){var _64b=_64a.renderer;if(_64b.declaredClass==="esri.renderer.SimpleRenderer"){var _64c=_64b.symbol;if(_64c&&_64c.xoffset){_649=Math.max(_649,Math.abs(_64c.xoffset));}if(_64c&&_64c.yoffset){_649=Math.max(_649,Math.abs(_64c.yoffset));}}else{if(_64b.declaredClass==="esri.renderer.UniqueValueRenderer"||_64b.declaredClass==="esri.renderer.ClassBreaksRenderer"){_560.forEach(_64b.infos,function(info){var _64d=info.symbol;if(_64d&&_64d.xoffset){_649=Math.max(_649,Math.abs(_64d.xoffset));}if(_64d&&_64d.yoffset){_649=Math.max(_649,Math.abs(_64d.yoffset));}});}}});return _649;};function _64e(evt){var map=this,_64f=map.infoWindow,_650=evt.graphic;if(!map.loaded){return;}_64f.hide();_64f.clearFeatures();var _651=[];_560.forEach(map.graphicsLayerIds,function(_652){var _653=map.getLayer(_652);if(_653&&_653.declaredClass.indexOf("FeatureLayer")!==-1&&_653.loaded&&_653.visible){_653.clearSelection();if(_653.infoTemplate&&!_653.suspended){_651.push(_653);}}});_650=(_650&&_650._getEffInfoTemplate())?_650:null;if(!_651.length&&!_650){return;}var _654=_647(_651);var _655=evt.screenPoint,_656=map.toMap(new _56c(_655.x-_654,_655.y+_654)),_657=map.toMap(new _56c(_655.x+_654,_655.y-_654)),_658=new _56d(_656.x,_656.y,_657.x,_657.y,map.spatialReference);var _659=new _573();_659.geometry=_658;_659.timeExtent=map.timeExtent;var _65a=_560.map(_651,function(_65b){var dfd=_65b.selectFeatures(_659);dfd.addCallback(function(){var _65c=_65b.getSelectedFeatures();return _65c;});return dfd;});if(_650){var dfd=new _562();dfd.callback([_650]);_65a.splice(0,0,dfd);}var _65d=_560.some(_65a,function(dfd){return dfd.fired===-1;});if(!_65d){var _65e=_650?1:0;_560.forEach(_651,function(_65f){_65e=_65e+_65f.getSelectedFeatures().length;});if(!_65e){return;}}_64f.setFeatures(_65a);_64f.show(evt.mapPoint,{closestFirst:true});};function _660(_661,_662,_663,_664,_665,_666){var _667=(_665.mapOptions||{}),_668,_669;if(!_667.infoWindow){_668=new _572(null,_565.create("div"));_667.infoWindow=_668;}if(!_568.isDefined(_667.showInfoWindowOnClick)){_667.showInfoWindowOnClick=false;}var map=new Map(_664,_667);if(_665.ignorePopups){_560.forEach(_661,function(_66a){delete _66a.infoTemplate;});}if(!(_665.ignorePopups||_665.disableClickBehavior)){_669=_561.connect(map,"onClick",_64e);}_561.connect(map,"onLayersAddResult",_641);map.addLayers(_661);if(!_665.ignorePopups){_635(_661,map,_665._clazz);}var _66b=[];_560.forEach(_662,function(_66c){_66b=_66b.concat(_66c.errors);},this);_666.callback({map:map,itemInfo:_663,errors:_66b,clickEventHandle:_669,clickEventListener:_64e});};function _66d(_66e,_66f,_670,_671,_672){try{var _673=_670.mapOptions||{};_670.mapOptions=_673;var card=_66e.item;var _674=[];_560.forEach(_672,function(_675){if(lang.isArray(_675.layerObject)){_560.forEach(_675.layerObject,function(l){_674.push(l);});}else{_674.push(_675.layerObject);}});if(!_674[0]){_671.errback(new Error(_585.arcgis.utils.baseLayerError));return;}_674=_560.filter(_674,_568.isDefined);if(card){if(card.extent){if(!_673.extent){var _676=new _56d(card.extent[0][0],card.extent[0][1],card.extent[1][0],card.extent[1][1],new _56a({wkid:4326}));var _677=_674[0].spatialReference;if(_677.wkid===4326){_673.extent=_676;_660(_674,_672,_66e,_66f,_670,_671);}else{if(_677.wkid===102100||_677.wkid===102113||_677.wkid===3857){_676.xmin=Math.max(_676.xmin,-180);_676.xmax=Math.min(_676.xmax,180);_676.ymin=Math.max(_676.ymin,-89.99);_676.ymax=Math.min(_676.ymax,89.99);_673.extent=_56e.geographicToWebMercator(_676);_660(_674,_672,_66e,_66f,_670,_671);}else{if(_670.geometryServiceURL||_567.defaults.geometryService){var gs;if(_670.geometryServiceURL){gs=new _574(_670.geometryServiceURL);}else{gs=_567.defaults.geometryService;}gs.project([_676],_677,function(_678){var _679=_678[0];_673.extent=_673.extent||_679;_660(_674,_672,_66e,_66f,_670,_671);});}else{_671.errback(new Error(_585.arcgis.utils.geometryServiceError));}}}}else{_660(_674,_672,_66e,_66f,_670,_671);}}else{_660(_674,_672,_66e,_66f,_670,_671);}}else{_660(_674,_672,_66e,_66f,_670,_671);}}catch(err){_671.errback(err);}};function _67a(_67b){var _67c=[];var _67d=_67b.baseMap.baseMapLayers.concat(_67b.operationalLayers);_560.forEach(_67d,function(_67e,_67f){var _680={};if(_67e.featureCollection&&_67e.type!=="CSV"){if(_67e.featureCollection.showLegend===true){_560.forEach(_67e.featureCollection.layers,function(_681){if(_681.showLegend!==false){_680={"layer":_681.layerObject,"title":_67e.title,"defaultSymbol":false};if(_67e.featureCollection.layers.length>1){_680.title+=" - "+_681.layerDefinition.name;}_67c.push(_680);}});}}else{if((_67e.baseMapLayer&&_67e.showLegend===true&&_67e.layerObject)||(!_67e.baseMapLayer&&_67e.showLegend!==false&&_67e.layerObject)){var _682=false;if(_67e.layerObject.version<10.1&&(_67e.layerObject instanceof _576||_67e.layerObject instanceof _575)){_682=true;}_680={"layer":_67e.layerObject,"title":_67e.title,"defaultSymbol":_682};if(_67e.layers){var _683=_560.map(_560.filter(_67e.layers,function(lyr){return (lyr.showLegend===false);}),function(lyr){return lyr.id;});if(_683.length){_680.hideLayers=_683;}}_67c.push(_680);}}});return _67c;};function _684(_685){if(_586._arcgisUrl&&_586._arcgisUrl.length>0){_586.arcgisUrl=_586._arcgisUrl;}var url=_586.arcgisUrl+"/"+_685;var _686={},_687=new _562();_569({url:url,content:{f:"json"},callbackParamName:"callback",load:function(_688){_686.item=_688;_569({url:url+"/data",content:{f:"json"},callbackParamName:"callback",load:function(_689){_686.itemData=_689;_687.callback(_686);},error:function(_68a){_687.errback(_68a);}});},error:function(_68b){_687.errback(_68b);}});return _687;};function _68c(arg1,_68d,_68e){var _68f=new _562();_68e=_68e||{};var _690=_68e.infoTemplateClass;_68e._clazz=(_690&&(lang.isObject(_690)?_690:lang.getObject(_690)))||_571;if(lang.isString(arg1)){_684(arg1).addCallback(function(_691){_591(_691,_68e).addCallback(function(_692){_605(_692.itemData,_68e).addCallback(lang.hitch(null,_66d,_692,_68d,_68e,_68f));});}).addErrback(lang.hitch(_68f,_68f.errback));}else{_591(arg1,_68e).addCallback(function(_693){_605(_693.itemData,_68e).addCallback(lang.hitch(null,_66d,_693,_68d,_68e,_68f));});}return _68f;};function _694(_695){if(_695&&_695.itemInfo&&_695.itemInfo.itemData){return _67a(_695.itemInfo.itemData);}else{return [];}};_586={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:_684,createMap:_68c,getLegendLayers:_694,_arcgisUrl:null,_getItemProps:_591,_getItemData:_587,_getBingKey:_58a,_processFSItemProperties:_58f,_getLayers:_605,_preBuildLayerObjects:_5f4,_buildLayerObjects:_5e8,_preCreateMap:_66d,_getMapSR:_5f0,_createMap:_660,_addSelectionLayers:_635,_createSelectionFeatureLayers:_61b,_getServiceInfo:_602,_getLayersInfo:_633,_initLayer:_5d2,_loadAsCached:_5ae,_loadAsDynamic:_5b9,_processPopups:_5a1,_onLayersAddResult:_641,_sameSpatialReferenceAsBasemap:_5c7,_sameTilingSchemeAsBasemap:_5cb,_showPopup:_64e,_calculateClickTolerance:_647,_getVisibleFeatureLayers:_5b2,_updateLayerScaleInfo:_618,_checkUrl:_5ad,_isHostedService:_5a9,_isAgolService:_5ac,_getLegendLayers:_67a};lang.setObject("arcgis.utils",_586,_566);return _586;});},"esri/layers/GeoRSSLayer":function(){define("esri/layers/GeoRSSLayer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/config","esri/request","esri/layers/ServiceGeneratedFeatureCollection"],function(_696,lang,_697,has,_698,_699,_69a,_69b){var _69c=_696([_69b],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(url,_69d){if(_699.defaults.geoRSSService){this.serviceUrl=_699.defaults.geoRSSService;}this._createLayer();},parse:function(){this._io=_69a({url:this.serviceUrl,content:{url:this._url.path,refresh:this.loaded?true:undefined,outSR:this._outSR?_697.toJson(this._outSR.toJson()):undefined},callbackParamName:"callback"});return this._io;},_initLayer:function(json){this.inherited(arguments);if(!this.loaded){this.loaded=true;this.onLoad(this);}}});if(has("extend-esri")){lang.setObject("layers.GeoRSSLayer",_69c,_698);}return _69c;});},"esri/layers/FeatureTemplate":function(){define("esri/layers/FeatureTemplate",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/graphic"],function(_69e,lang,has,_69f,_6a0,_6a1){var _6a2=_69e(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(json){if(json&&lang.isObject(json)){this.name=json.name;this.description=json.description;this.drawingTool=json.drawingTool;var _6a3=json.prototype;this.prototype=new _6a1(_6a3.geometry,null,_6a3.attributes);}},toJson:function(){return _6a0.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()});}});lang.mixin(_6a2,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});if(has("extend-esri")){lang.setObject("layers.FeatureTemplate",_6a2,_69f);}return _6a2;});},"esri/dijit/BasemapGallery":function(){require({cache:{"url:esri/dijit/templates/BasemapGallery.html":"<div class=\"esriBasemapGallery\">\r\n  <div dojoAttachPoint=\"flowContainer\">\r\n  </div>\r\n</div>"}});define("esri/dijit/BasemapGallery",["require","dojo/_base/declare","dojo/_base/array","dojo/_base/connect","dojo/_base/lang","dojo/_base/kernel","dojo/_base/sniff","dojo/has","dojo/query","dojo/DeferredList","dojo/dom","dojo/dom-construct","dojo/dom-class","dijit/_Widget","dijit/_Templated","esri/kernel","esri/urlUtils","esri/request","esri/geometry/Extent","esri/virtualearth/VETiledLayer","esri/layers/OpenStreetMapLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/ImageServiceParameters","esri/dijit/Basemap","dojo/text!esri/dijit/templates/BasemapGallery.html"],function(_6a4,_6a5,_6a6,_6a7,lang,_6a8,_6a9,has,_6aa,_6ab,dom,_6ac,_6ad,_6ae,_6af,_6b0,_6b1,_6b2,_6b3,_6b4,_6b5,_6b6,_6b7,_6b8,_6b9,_6ba,_6bb){var BMG=_6a5([_6ae,_6af],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:true,templateString:_6bb,basePath:_6a4.toUrl("esri/dijit")+"/",loaded:false,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:false,_selectedBasemap:null,_selectBasemapInProgress:false,constructor:function(_6bc,_6bd){_6bc=_6bc||{};if(!_6bc.map){}this.map=_6bc.map;this._hasUI=_6bd?true:false;this.bingMapsKey=(_6bc.bingMapsKey&&_6bc.bingMapsKey.length>0)?_6bc.bingMapsKey:null;this.showArcGISBasemaps=(_6bc.showArcGISBasemaps===false)?false:true;this.basemaps=_6bc.basemaps||[];this.basemapIds=_6bc.basemapIds;this.referenceIds=_6bc.referenceIds;this.basemapsGroup=_6bc.basemapsGroup;if(location.protocol==="https:"){_6b0.dijit._arcgisUrl=_6b0.dijit._arcgisUrl.replace("http:","https:");}this.init();},init:function(){this.inherited(arguments);_6a6.forEach(this.basemaps,function(_6be,i){if(!_6be.id||_6be.id.length===0){_6be.id=this._getUniqueId();}_6a6.forEach(_6be.layers,function(_6bf){_6bf.opacity=(_6bf.opacity>=0)?_6bf.opacity:1;_6bf.visibility=true;},this);},this);if(this.basemapIds&&this.basemapIds.length>0){_6a6.forEach(this.basemapIds,function(_6c0){var _6c1=this.map.getLayer(_6c0);_6c1._basemapGalleryLayerType="basemap";},this);}if(this.referenceIds&&this.referenceIds.length>0){_6a6.forEach(this.referenceIds,function(_6c2){var _6c3=this.map.getLayer(_6c2);_6c3._basemapGalleryLayerType="reference";},this);}if(this.basemapsGroup&&((this.basemapsGroup.owner&&this.basemapsGroup.title)||this.basemapsGroup.id)){this._findCustomBasemapsGroup(lang.hitch(this,"_handleArcGISBasemapsResponse"));}else{if(this.showArcGISBasemaps){this._findArcGISBasemapsGroup(lang.hitch(this,"_handleArcGISBasemapsResponse"));}else{this._finishStartup();}}},startup:function(){if(this.loaded){this._refreshUI();}else{_6a7.connect(this,"onLoad",lang.hitch(this,function(){this._refreshUI();}));}},select:function(id){this._select(id);},getSelected:function(){return this._selectedBasemap;},get:function(id){var i;for(i=0;i<this.basemaps.length;i++){if(this.basemaps[i].id==id){return this.basemaps[i];}}return null;},add:function(_6c4){if(_6c4&&!_6c4.id){_6c4.id=this._getUniqueId();this.basemaps.push(_6c4);this._refreshUI();this.onAdd(_6c4);return true;}else{if(_6c4&&this._isUniqueId(_6c4.id)){this.basemaps.push(_6c4);this._refreshUI();this.onAdd(_6c4);return true;}}return false;},remove:function(id){var i;for(i=0;i<this.basemaps.length;i++){var _6c5=this.basemaps[i];if(_6c5.id===id){if(this._selectedBasemap&&this._selectedBasemap.id===_6c5.id){this._selectedBasemap=null;}this.basemaps.splice(i,1);this._refreshUI();this.onRemove(_6c5);return _6c5;}}return null;},onLoad:function(){},onSelectionChange:function(){},onAdd:function(_6c6){},onRemove:function(_6c7){},onError:function(msg){},_defaultBasemapGalleryGroupQuery:"title:\"ArcGIS Online Basemaps\" AND owner:esri",_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=true;this.onLoad();if(this.map.layerIds.length===0&&this.basemaps.length>0&&!this._selectBasemapInProgress){this._select(this.basemaps[0].id);}},_findCustomBasemapsGroup:function(_6c8){if(this.basemapsGroup&&this.basemapsGroup.id){this._findArcGISBasemaps(this.basemapsGroup.id,_6c8);}else{this._basemapGalleryGroupQuery="title:\""+this.basemapsGroup.title+"\" AND owner:"+this.basemapsGroup.owner;this._findArcGISBasemapsGroup(_6c8);}},_findArcGISBasemapsGroup:function(_6c9){if(!this._basemapGalleryGroupQuery){var url=_6b0.dijit._arcgisUrl+"/accounts/self";var _6ca={};_6ca.f="json";_6ca.culture=_6a8.locale;_6b2({url:url,content:_6ca,callbackParamName:"callback",load:lang.hitch(this,function(_6cb,args){if(_6cb&&_6cb.basemapGalleryGroupQuery){this._basemapGalleryGroupQuery=_6cb.basemapGalleryGroupQuery;}else{this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery;}this._findArcGISBasemapsGroupContent(_6c9);}),error:lang.hitch(this,function(_6cc,args){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery;})});}else{this._findArcGISBasemapsGroupContent(_6c9);}},_findArcGISBasemapsGroupContent:function(_6cd){var _6ce=lang.hitch(this,"_findArcGISBasemaps");var url=_6b0.dijit._arcgisUrl+"/community/groups";var _6cf={};_6cf.q=this._basemapGalleryGroupQuery;_6cf.f="json";_6b2({url:url,content:_6cf,callbackParamName:"callback",load:lang.hitch(this,function(_6d0,args){if(_6d0.results.length>0){_6ce(_6d0.results[0].id,_6cd);}else{var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);}}),error:lang.hitch(this,function(_6d1){var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);})});},_findArcGISBasemaps:function(_6d2,_6d3){var url=_6b0.dijit._arcgisUrl+"/search";var _6d4={};_6d4.q="group:"+_6d2+" AND type:\"web map\"";_6d4.sortField="name";_6d4.sortOrder="desc";_6d4.num=50;_6d4.f="json";_6b2({url:url,content:_6d4,callbackParamName:"callback",load:lang.hitch(this,function(_6d5,args){if(_6d5.results.length>0){_6d3(_6d5.results);}else{var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);}}),error:lang.hitch(this,function(_6d6,args){var msg="esri.dijit.BasemapGallery: could not find group for basemaps.";this.onError(msg);})});},_handleArcGISBasemapsResponse:function(_6d7){if(_6d7.length>0){_6a6.forEach(_6d7,function(item,i){if(this.bingMapsKey||(!this.bingMapsKey&&item.title&&item.title.indexOf("Bing Maps")==-1)){var _6d8={};_6d8.id=this._getUniqueId();_6d8.title=item.title;_6d8.thumbnailUrl="";if(item.thumbnail&&item.thumbnail.length){_6d8.thumbnailUrl=(_6b0.dijit._arcgisUrl+"/content/items/"+item.id+"/info/"+item.thumbnail);if(_6b0.id){var _6d9=_6b0.id.findCredential(_6b1.urlToObject(_6b0.dijit._arcgisUrl).path);if(_6d9){_6d8.thumbnailUrl+="?token="+_6d9.token;}}}_6d8.itemId=item.id;var _6da=new _6ba(_6d8,this);this.basemaps.splice(0,0,_6da);}},this);this._finishStartup();}},_refreshUI:function(){if(this._hasUI){_6ac.empty(this.flowContainer);_6a6.forEach(this.basemaps,function(_6db,i){if(!_6db.id){_6db.id="basemap_"+i;}this.flowContainer.appendChild(this._buildNodeLayout(_6db));},this);_6ac.create("br",{style:{clear:"both"}},this.flowContainer);this._markSelected(this._selectedBasemap);}},_buildNodeLayout:function(_6dc){var nId="galleryNode_"+_6dc.id;var n=_6ac.create("div",{id:nId,"class":"esriBasemapGalleryNode"});var _6dd=_6ac.create("a",{href:"#"},n);_6a7.connect(_6dd,"onclick",lang.hitch(this,"_onNodeClick",_6dc));if(_6dc.thumbnailUrl){_6ac.create("img",{"class":"esriBasemapGalleryThumbnail",src:_6dc.thumbnailUrl},_6dd);}else{_6ac.create("img",{"class":"esriBasemapGalleryThumbnail",src:this.basePath.toString()+"images/transparent.gif"},_6dd);}var _6de=_6ac.create("div",{"class":"esriBasemapGalleryLabelContainer"},n);var _6df=_6dc.title||"";_6ac.create("span",{innerHTML:_6df,alt:_6df,title:_6df},_6de);return n;},_onNodeClick:function(_6e0,e){e.preventDefault();this._markSelected(_6e0);this.select(_6e0.id);},_markSelected:function(_6e1){if(_6e1){_6a6.forEach(_6a8.query(".esriBasemapGallerySelectedNode",this.domNode),function(node){_6ad.remove(node,"esriBasemapGallerySelectedNode");});var _6e2=dom.byId("galleryNode_"+_6e1.id);if(_6e2){_6ad.add(_6e2,"esriBasemapGallerySelectedNode");}}},_select:function(id){this._selectBasemapInProgress=true;var _6e3=this.get(id);if(_6e3){if(_6e3.layers){this._getServiceInfos(_6e3);}else{var _6e4=_6e3.getLayers();if(lang.isArray(_6e4)){this._getServiceInfos(_6e3);}else{_6e4.addCallback(lang.hitch(this,function(_6e5){this._getServiceInfos(_6e3);}));}}this._markSelected(_6e3);}else{this._selectBasemapInProgress=false;}},_getServiceInfos:function(_6e6){if(location.protocol=="https:"){_6a6.forEach(_6e6.layers,function(_6e7){if(this._isAgolService(_6e7.url)||this._isHostedService(_6e7.url)){_6e7.url=_6e7.url.replace("http:","https:");}},this);}this._selectedBasemap=_6e6;var _6e8=[];_6a6.forEach(_6e6.layers,function(_6e9){if(_6e9.url&&_6e9.url.length>0&&!_6e9.isReference){_6e9.deferredsPos=_6e8.length;_6e8.push(this._getServiceInfo(_6e9.url));}},this);if(_6e8.length>0){var _6ea=new _6ab(_6e8);_6ea.addCallback(lang.hitch(this,function(_6eb){var _6ec=null;_6a6.forEach(_6e6.layers,function(_6ed){if(_6ed.deferredsPos===0||_6ed.deferredsPos){_6ed.serviceInfoResponse=_6eb[_6ed.deferredsPos][1];var ext=_6ed.serviceInfoResponse.fullExtent;if(!ext){ext=_6ed.serviceInfoResponse.extent;}if(!_6ec){_6ec=new _6b3(ext);}else{_6ec=_6ec.union(new _6b3(ext));}}},this);if(this.map.extent){var _6ee=this._getIntersectionPercent(_6ec,this.map.extent);if(_6ee<5){this.map.setExtent(_6ec,true);}}this._switchBasemapLayers(_6e6);this._updateReferenceLayer(_6e6);}));}else{this._switchBasemapLayers(_6e6);this._updateReferenceLayer(_6e6);}},_switchBasemapLayers:function(_6ef){var _6f0=_6ef.layers;if(this.map.layerIds.length>0&&this.map.getNumLevels()===0&&(_6f0[0].type==="OpenStreetMap"||(_6f0[0].type&&_6f0[0].type.indexOf("BingMaps")>-1))){var msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}_6a6.forEach(_6f0,function(_6f1){if(!_6f1.isReference&&_6f1.type&&_6f1.type.indexOf("BingMaps")>-1&&!this.bingMapsKey){var msg="esri.dijit.BasemapGallery: Invalid Bing Maps key.";this.onError(msg);return;}},this);this._removeBasemapLayers();_6a6.forEach(_6f0,function(_6f2){if(!_6f2.isReference){var _6f3,msg;if(_6f2.type==="OpenStreetMap"){if(this.map.layerIds.length>0&&this.map.getNumLevels()===0){msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}_6f3=new _6b5({id:"layer_osm",opacity:_6f2.opacity});}else{if(_6f2.type&&_6f2.type.indexOf("BingMaps")>-1){if(this.map.layerIds.length>0&&this.map.getNumLevels()===0){msg="esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.";this.onError(msg);return;}var _6f4=_6b4.MAP_STYLE_AERIAL_WITH_LABELS;if(_6f2.type=="BingMapsAerial"){_6f4=_6b4.MAP_STYLE_AERIAL;}else{if(_6f2.type=="BingMapsRoad"){_6f4=_6b4.MAP_STYLE_ROAD;}}_6f3=new _6b4({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:_6f4,opacity:_6f2.opacity});}else{if(_6f2.serviceInfoResponse&&_6f2.serviceInfoResponse.mapName){if((this.map.layerIds.length===0||this.map.getNumLevels()>0)&&_6f2.serviceInfoResponse.singleFusedMapCache===true){_6f3=this._loadAsCached(_6f2);}else{_6f3=this._loadAsDynamic(_6f2);}}else{if(_6f2.serviceInfoResponse&&_6f2.serviceInfoResponse.pixelSizeX){var _6f5=new _6b9();_6f5.bandIds=_6f2.bandIds;if(!_6f2.bandIds&&_6f2.serviceInfoResponse.bandCount&&parseInt(_6f2.serviceInfoResponse.bandCount)>3){_6f5.bandIds=[0,1,2];}_6f3=new _6b8(_6f2.url,{resourceInfo:_6f2.serviceInfoResponse,opacity:_6f2.opacity,visible:_6f2.visibility,imageServiceParameters:_6f5});}}}}if(_6f3){_6f3._basemapGalleryLayerType="basemap";this.map.addLayer(_6f3,0);}}},this);this._selectBasemapInProgress=false;this.onSelectionChange();},_removeBasemapLayers:function(){var _6f6=this.map.layerIds;var _6f7=[];_6a6.forEach(_6f6,function(id){var _6f8=this.map.getLayer(id);if(_6f8._basemapGalleryLayerType==="basemap"){_6f7.push(_6f8);}},this);if(_6f7.length===0&&_6f6.length>0){_6f7.push(this.map.getLayer(_6f6[0]));}if(_6f7.length>0){_6a6.forEach(_6f7,function(_6f9){this.map.removeLayer(_6f9);},this);}},_updateReferenceLayer:function(_6fa){var i;this._removeReferenceLayer();for(i=0;i<_6fa.layers.length;i++){if(_6fa.layers[i].isReference===true){this._addReferenceLayer(_6fa.layers[i]);}}},_removeReferenceLayer:function(){var i;for(i=this.map.layerIds.length-1;i>=0;i--){var id=this.map.layerIds[i];var _6fb=this.map.getLayer(id);if(_6fb._basemapGalleryLayerType==="reference"){this.map.removeLayer(_6fb);}}},_addReferenceLayer:function(_6fc){this._getServiceInfo(_6fc.url,lang.hitch(this,"_handleReferenceServiceInfoResponse",_6fc));},_handleReferenceServiceInfoResponse:function(_6fd,_6fe,args){var _6ff;_6fd.serviceInfoResponse=_6fe;if(_6fe&&_6fe.mapName){if(_6fe.singleFusedMapCache===true){_6ff=this._loadAsCached(_6fd);}else{_6ff=this._loadAsDynamic(_6fd);}}else{if(_6fe&&_6fe.pixelSizeX){var _700=new _6b9();_700.bandIds=_6fd.bandIds;if(!_6fd.bandIds&&_6fe.bandCount&&parseInt(_6fe.bandCount)>3){_700.bandIds=[0,1,2];}_6ff=new _6b8(_6fd.url,{resourceInfo:_6fe,opacity:_6fd.opacity,visible:_6fd.visibility,imageServiceParameters:_700});}}if(_6ff){_6ff._basemapGalleryLayerType="reference";this.map.addLayer(_6ff);}},_getServiceInfo:function(url,_701){var _702={};_702.f="json";var _703=_6b2({url:url,content:_702,callbackParamName:"callback",load:function(_704,args){if(_701){_701(_704,args);}},error:lang.hitch(this,function(_705,args){var msg="esri.dijit.BasemapGallery: service not accessible.";this.onError(msg);})});return _703;},_loadAsCached:function(_706){var _707=[];if(!_706.displayLevels){_707=_6a6.map(_706.serviceInfoResponse.tileInfo.lods,function(lod){return lod.level;});}var _708=new _6b6(_706.url,{resourceInfo:_706.serviceInfoResponse,opacity:_706.opacity,visible:_706.visibility,displayLevels:_706.displayLevels||_707});return _708;},_loadAsDynamic:function(_709){var _70a=new _6b7(_709.url,{resourceInfo:_709.serviceInfoResponse,opacity:_709.opacity,visible:_709.visibility});if(_709.visibleLayers){_70a.setVisibleLayers(_709.visibleLayers);}return _70a;},_getIntersectionPercent:function(_70b,_70c){var _70d=_70c.intersects(_70b);if(_70d){var _70e=_70d.getWidth()*_70d.getHeight();var _70f=_70c.getWidth()*_70c.getHeight();return (_70e/_70f)*100;}else{return 0;}},_getIds:function(){var ids=[];_6a6.forEach(this.basemaps,function(_710){ids.push(_710.id);},this);return ids;},_getUniqueId:function(){var _711=","+this._getIds().toString()+",";var _712=0;while(true){if(_711.indexOf(",basemap_"+_712+",")>-1){_712++;}else{return "basemap_"+_712;}}},_isUniqueId:function(id){var _713=","+this._getIds().toString()+",";if(_713.indexOf(","+id+",")===-1){return true;}return false;},_isAgolService:function(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);},_isHostedService:function(url){if(!url){return false;}return (url.indexOf(".arcgis.com/")!==-1);}});if(has("extend-esri")){lang.setObject("dijit.BasemapGallery",BMG,_6b0);}return BMG;});}}});define("esriviewer/mapping",[],1);