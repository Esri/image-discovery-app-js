//>>built
require({cache:{"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_1,_2,_3,_4){var _5=_1(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(_6){if(_6&&_2.isObject(_6)){this.objectId=_6.objectId;this.success=_6.success;if(!_6.success){var _7=_6.error;this.error=new Error();this.error.code=_7.code;this.error.message=_7.description;}}}});if(_3("extend-esri")){_2.setObject("layers.FeatureEditResult",_5,_4);}return _5;});},"esri/layers/MapImageLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/sniff","esri/domUtils","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/layers/layer"],function(_8,_9,_a,_b,_c,_d,_e,_f,has,_10,_11,_12,_13){var _14=_8([_13],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(_15){this.inherited(arguments,[null,_15]);this._mapImages=[];var _16=_a.hitch;this._panStart=_16(this,this._panStart);this._pan=_16(this,this._pan);this._extentChange=_16(this,this._extentChange);this._zoom=_16(this,this._zoom);this._zoomStart=_16(this,this._zoomStart);this._scale=_16(this,this._scale);this._resize=_16(this,this._resize);_9.connect(this,"onSuspend",this,this._onSuspend);_9.connect(this,"onResume",this,this._onResume);this.loaded=true;this.onLoad(this);},opacity:1,_transform:_e._getDOMAccessor("transform"),addImage:function(_17){var _18=this._mapImages.push(_17);_18=_18-1;_17._idx=_18;_17._layer=this;if(this._div){this._createImage(_17,_18);}},removeImage:function(_19){if(_19){var idx=_19._idx,_1a=this._mapImages;if(_1a[idx]===_19){delete _1a[idx];var _1b=_19._node;if(_1b){this._clearEvents(_1b);_1b.e_idx=_1b.e_bl=_1b.e_tr=_1b.e_l=_1b.e_t=_1b.e_w=_1b.e_h=null;if(_1b.parentNode){_1b.parentNode.removeChild(_1b);_c.destroy(_1b);}}_19._node=_19._idx=_19._layer=null;}}},removeAllImages:function(){var _1c=this._mapImages,i,len=_1c.length;for(i=0;i<len;i++){var _1d=_1c[i];if(_1d){this.removeImage(_1d);}}this._mapImages=[];},getImages:function(){var _1e=this._mapImages,_1f=[],i,len=_1e.length;for(i=0;i<len;i++){if(_1e[i]){_1f.push(_1e[i]);}}return _1f;},setOpacity:function(_20){if(this.opacity!=_20){this._opacityChanged(this.opacity=_20);this.onOpacityChange();}},onOpacityChange:function(){},_opacityChanged:function(_21){var div=this._div,i,len,_22;if(div){if(!has("ie")||has("ie")>8){_d.set(div,"opacity",_21);}else{_22=div.childNodes;len=_22.length;for(i=0;i<len;i++){_d.set(_22[i],"opacity",_21);}}}},_createImage:function(_23,idx){var _24=_c.create("img");_d.set(_24,{position:"absolute"});if(has("ie")<=8){_d.set(_24,"opacity",this.opacity);}if(_23.rotation){var _25="rotate("+(360-_23.rotation)+"deg)";if(has("ie")<9){}else{_d.set(_24,this._transform,_25);_d.set(_24,"transform",_25);}}_23._node=_24;_24.e_idx=idx;_24.e_layer=this;_24.e_load=_9.connect(_24,"onload",_14.prototype._imageLoaded);_24.e_error=_9.connect(_24,"onerror",_14.prototype._imageError);_24.e_abort=_9.connect(_24,"onabort",_14.prototype._imageError);_24.src=_23.href;},_imageLoaded:function(evt,img){var _26=img||evt.target||evt.currentTarget,_27=_26.e_layer,_28=_27._mapImages[_26.e_idx],map=_27._map;if(map&&(map.__zooming||map.__panning||!_27._sr)){_27._standby.push(_26);return;}_27._clearEvents(_26);if(!_28||_28._node!==_26){return;}if(map){_27._attach(_28);}},_imageError:function(evt){var _29=evt.target||evt.currentTarget,_2a=_29.e_layer,_2b=_2a._mapImages[_29.e_idx];_2a._clearEvents(_29);if(_2b){_2b._node=null;}},_clearEvents:function(_2c){var _2d=_9.disconnect;_2d(_2c.e_load);_2d(_2c.e_error);_2d(_2c.e_abort);_2c.e_load=_2c.e_error=_2c.e_abort=_2c.e_layer=null;},_attach:function(_2e){var _2f=_2e.extent,_30=_2f.spatialReference,_31=this._sr,div=this._div,_32=_2e._node,_33=new _11({x:_2f.xmin,y:_2f.ymin,spatialReference:_30}),_34=new _11({x:_2f.xmax,y:_2f.ymax,spatialReference:_30});if(!_31.equals(_30)){if(_31.isWebMercator()&&_30.wkid===4326){_33=_12.geographicToWebMercator(_33);_34=_12.geographicToWebMercator(_34);}else{if(_30.isWebMercator()&&_31.wkid===4326){_33=_12.webMercatorToGeographic(_33);_34=_12.webMercatorToGeographic(_34);}}}_32.e_bl=_33;_32.e_tr=_34;if(_2e.visible){this._setPos(_32,div._left,div._top);(this._active||div).appendChild(_32);}},_setPos:function(_35,_36,_37){var _38=_35.e_bl,_39=_35.e_tr,map=this._map;_38=map.toScreen(_38);_39=map.toScreen(_39);var _3a=_38.x-_36,top=_39.y-_37,_3b=Math.abs(_39.x-_38.x),_3c=Math.abs(_38.y-_39.y),css={width:_3b+"px",height:_3c+"px"},_3d=this._mapImages[_35.e_idx];if(map.navigationMode==="css-transforms"){css[_e._css.names.transform]=_e._css.translate(_3a,top)+(_3d.rotation?(" "+_e._css.rotate(360-_3d.rotation)):"");}else{css.left=_3a+"px";css.top=top+"px";}_d.set(_35,css);_35.e_l=_3a;_35.e_t=top;_35.e_w=_3b;_35.e_h=_3c;},managedSuspension:true,_setMap:function(map,_3e){this.inherited(arguments);var div=this._div=_c.create("div",null,_3e),_3f=_e._css.names,css={position:"absolute"},vd=map.__visibleDelta;if(!has("ie")||has("ie")>8){css.opacity=this.opacity;}if(map.navigationMode==="css-transforms"){css[_3f.transform]=_e._css.translate(vd.x,vd.y);_d.set(div,css);div._left=vd.x;div._top=vd.y;css={position:"absolute",width:map.width+"px",height:map.height+"px",overflow:"visible"};this._active=_c.create("div",null,div);_d.set(this._active,css);this._passive=_c.create("div",null,div);_d.set(this._passive,css);}else{div._left=0;div._top=0;_d.set(div,css);}this._standby=[];var _40=this._mapImages,i,len=_40.length;for(i=0;i<len;i++){var _41=_40[i],_42=_41._node;if(!_42){this._createImage(_41,_41._idx);}}_10.hide(div);return div;},_unsetMap:function(map,_43){this._disconnect();var div=this._div;if(div){var _44=this._mapImages,i,len=_44.length;for(i=0;i<len;i++){var _45=_44[i];if(_45){var _46=_45._node;if(_46){this._clearEvents(_46);_46.e_idx=_46.e_bl=_46.e_tr=_46.e_l=_46.e_t=_46.e_w=_46.e_h=null;}_45._node=null;}}_43.removeChild(div);_c.destroy(div);}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments);},_onSuspend:function(){this._disconnect();_10.hide(this._div);},_onResume:function(evt){if(evt.firstOccurrence){this._sr=this._map.spatialReference;this._processStandbyList();}var map=this._map,div=this._div,vd=map.__visibleDelta;if(map.navigationMode==="css-transforms"){div._left=vd.x;div._top=vd.y;_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}this._redraw(map.navigationMode==="css-transforms");this._connect(map);_10.show(div);},_connect:function(map){if(!this._connections){var _47=_9.connect,_48=(map.navigationMode==="css-transforms");this._connections=[_47(map,"onPanStart",this._panStart),_47(map,"onPan",this._pan),_47(map,"onExtentChange",this._extentChange),_48&&_47(map,"onZoomStart",this._zoomStart),_48?_47(map,"onScale",this._scale):_47(map,"onZoom",this._zoom),_48&&_47(map,"onResize",this._resize)];}},_disconnect:function(){if(this._connections){_b.forEach(this._connections,_9.disconnect);this._connections=null;}},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top;},_pan:function(_49,_4a){var div=this._div;div._left=this._panL+_4a.x;div._top=this._panT+_4a.y;if(this._map.navigationMode==="css-transforms"){_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}else{_d.set(div,{left:div._left+"px",top:div._top+"px"});}},_extentChange:function(_4b,_4c,_4d){if(_4d){this._redraw(this._map.navigationMode==="css-transforms");}else{if(_4c){this._pan(_4b,_4c);}}this._processStandbyList();},_processStandbyList:function(){var i,_4e=this._standby;if(_4e&&_4e.length){for(i=_4e.length-1;i>=0;i--){this._imageLoaded(null,_4e[i]);_4e.splice(i,1);}}},_redraw:function(_4f){if(_4f){var _50=this._passive,_51=_e._css.names;_d.set(_50,_51.transition,"none");this._moveImages(_50,this._active);_d.set(_50,_51.transform,"none");}var div=this._active||this._div,_52=this._div._left,_53=this._div._top,i,len=div.childNodes.length,_54;for(i=0;i<len;i++){_54=div.childNodes[i];this._setPos(_54,_52,_53);}},_zoom:function(_55,_56,_57){var div=this._div,_58=div._left,_59=div._top,i,len=div.childNodes.length,_5a;for(i=0;i<len;i++){_5a=div.childNodes[i];var _5b=_5a.e_w*_56,_5c=_5a.e_h*_56,_5d=(_57.x-_58-_5a.e_l)*(_5b-_5a.e_w)/_5a.e_w,_5e=(_57.y-_59-_5a.e_t)*(_5c-_5a.e_h)/_5a.e_h;_5d=isNaN(_5d)?0:_5d;_5e=isNaN(_5e)?0:_5e;_d.set(_5a,{left:(_5a.e_l-_5d)+"px",top:(_5a.e_t-_5e)+"px",width:_5b+"px",height:_5c+"px"});}},_zoomStart:function(){this._moveImages(this._active,this._passive);},_moveImages:function(_5f,_60){var _61=_5f.childNodes,i,len=_61.length;if(len>0){for(i=len-1;i>=0;i--){_60.appendChild(_61[i]);}}},_scale:function(mtx,_62){var css={},_63=_e._css.names,_64=this._passive;_d.set(_64,_63.transition,_62?"none":(_63.transformName+" "+_f.defaults.map.zoomDuration+"ms ease"));css[_63.transform]=_e._css.matrix(mtx);_d.set(_64,_63.transform,_e._css.matrix(mtx));},_resize:function(_65,_66,_67){_d.set(this._active,{width:_66+"px",height:_67+"px"});_d.set(this._passive,{width:_66+"px",height:_67+"px"});}});if(has("extend-esri")){_a.setObject("layers.MapImageLayer",_14,_e);}return _14;});},"esri/layers/WebTiledLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/has","dojo/string","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/TiledMapServiceLayer","esri/layers/TileInfo"],function(_68,_69,_6a,Url,has,_6b,_6c,_6d,_6e,_6f,_70,_71){var _72=_68(_70,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(_73,_74){if(!_74){_74={};}this.urlTemplate=_73;var _75=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));var _76=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));this.initialExtent=_74.initialExtent||_75;this.fullExtent=_74.fullExtent||_76;if(_74.tileInfo){this.tileInfo=_74.tileInfo;}else{var _77=[{"level":0,"resolution":156543.033928,"scale":591657527.591555},{"level":1,"resolution":78271.5169639999,"scale":295828763.795777},{"level":2,"resolution":39135.7584820001,"scale":147914381.897889},{"level":3,"resolution":19567.8792409999,"scale":73957190.948944},{"level":4,"resolution":9783.93962049996,"scale":36978595.474472},{"level":5,"resolution":4891.96981024998,"scale":18489297.737236},{"level":6,"resolution":2445.98490512499,"scale":9244648.868618},{"level":7,"resolution":1222.99245256249,"scale":4622324.434309},{"level":8,"resolution":611.49622628138,"scale":2311162.217155},{"level":9,"resolution":305.748113140558,"scale":1155581.108577},{"level":10,"resolution":152.874056570411,"scale":577790.554289},{"level":11,"resolution":76.4370282850732,"scale":288895.277144},{"level":12,"resolution":38.2185141425366,"scale":144447.638572},{"level":13,"resolution":19.1092570712683,"scale":72223.819286},{"level":14,"resolution":9.55462853563415,"scale":36111.909643},{"level":15,"resolution":4.77731426794937,"scale":18055.954822},{"level":16,"resolution":2.38865713397468,"scale":9027.977411},{"level":17,"resolution":1.19432856685505,"scale":4513.988705},{"level":18,"resolution":0.597164283559817,"scale":2256.994353},{"level":19,"resolution":0.298582141647617,"scale":1128.497176}];var _78=new _71({"rows":256,"cols":256,"origin":{"x":-20037508.342787,"y":20037508.342787},"spatialReference":{"wkid":102100},"lods":_77});this.tileInfo=_78;}this.spatialReference=new _6e(this.tileInfo.spatialReference.toJson());this.copyright=_74.copyright||"";var url=new Url(_73);var _79=url.scheme+"://"+url.authority+"/";this.urlPath=_73.substring(_79.length);this.tileServers=_74.tileServers||[];if(url.authority.indexOf("{subDomain}")===-1){this.tileServers.push(_79);}if(_74.subDomains&&_74.subDomains.length>0&&url.authority.split(".").length>1){this.subDomains=_74.subDomains;var _7a;_6a.forEach(_74.subDomains,function(_7b,idx){if(url.authority.indexOf("${subDomain}")>-1){_7a=url.scheme+"://"+_6b.substitute(url.authority,{subDomain:_7b})+"/";}else{if(url.authority.indexOf("{subDomain}")>-1){_7a=url.scheme+"://"+url.authority.replace(/\{subDomain\}/gi,_7b)+"/";}}this.tileServers.push(_7a);},this);}this.tileServers=_6a.map(this.tileServers,function(_7c){if(_7c.charAt(_7c.length-1)!=="/"){_7c+="/";}return _7c;});this._levelToLevelValue=[];_6a.forEach(this.tileInfo.lods,function(_7d){this._levelToLevelValue[_7d.level]=_7d.levelValue||_7d.level;},this);this.loaded=true;this.onLoad(this);},getTileUrl:function(_7e,row,col){_7e=this._levelToLevelValue[_7e];var _7f=this.tileServers[row%this.tileServers.length]+_6b.substitute(this.urlPath,{level:_7e,col:col,row:row});_7f=_7f.replace(/\{level\}/gi,_7e).replace(/\{row\}/gi,row).replace(/\{col\}/gi,col);_7f=this.addTimestampToURL(_7f);return _6d.addProxy(_7f);}});if(has("extend-esri")){_69.setObject("layers.WebTiledLayer",_72,_6c);}return _72;});},"esri/layers/ServiceGeneratedFeatureCollection":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/renderers/SimpleRenderer","esri/layers/layer","esri/layers/FeatureLayer","esri/dijit/PopupTemplate"],function(_80,_81,_82,_83,_84,_85,has,_86,_87,_88,_89,_8a,_8b,_8c,_8d){var _8e=_80([_8b],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(url,_8f){this.pointSymbol=_8f&&_8f.pointSymbol;this.polylineSymbol=_8f&&_8f.polylineSymbol;this.polygonSymbol=_8f&&_8f.polygonSymbol;this._outSR=(_8f&&(_8f.outSpatialReference||_8f.outSR))||new _87({wkid:4326});this._options=_8f;},parse:function(){},getFeatureLayers:function(){var _90=[];if(this._fLayers){_90=_90.concat(this._fLayers);}return _90;},onRefresh:function(){},refresh:function(){if(!this.loaded||!this._map||this._io||!this.visible){return;}this._createLayer();},_createLayer:function(_91){var _92=this;this._fireUpdateStart();var _93=this.parse(_91);_93.addCallback(function(_94){_92._io=null;_92._initLayer(_94);});_93.addErrback(function(err){_92._io=null;err=_82.mixin(new Error(),err);err.message="Unable to load resource: "+_92.url+" "+(err.message||"");_92._fireUpdateEnd(err);_92.onError(err);});},_initLayer:function(_95){if(this.loaded){this._removeInternalLayers();}this.name=_95.name;this.description=_95.description;this.snippet=_95.snippet;if(_95.visibility!==undefined){this.defaultVisibility=this.visible=!!_95.visibility;}else{this.defaultVisibility=this.visible=true;}this.featureInfos=_95.featureInfos;this.fullExtent=this.initialExtent=new _88(_95.lookAtExtent);this.copyright=_95.author||_95.copyright;var _96;var _97=_82.getObject("featureCollection.layers",false,_95);if(_97&&_97.length>0){this._fLayers=[];_83.forEach(_97,function(_98,i){var _99=_82.getObject("featureSet.features",false,_98),_9a;if(_99&&_99.length>0){_96=_82.mixin({outFields:["*"],infoTemplate:_98.popupInfo?new _8d(_98.popupInfo):null,editable:false},this._options);if(_96.id){_96.id=_96.id+"_"+i;}_98.layerDefinition.capabilities="Query,Data";_9a=new _8c(_98,_96);if(_9a.geometryType){this["_"+_9a.geometryType]=_9a;}this._fLayers.push(_9a);}},this);if(this._fLayers.length===0){delete this._fLayers;}}this.items=[];if(this._esriGeometryPoint){this.items=this.items.concat(this._esriGeometryPoint.graphics);if(this.pointSymbol){var _9b=new _8a(this.pointSymbol);this._esriGeometryPoint.setRenderer(_9b);}}if(this._esriGeometryPolyline){this.items=this.items.concat(this._esriGeometryPolyline.graphics);if(this.polylineSymbol){var _9c=new _8a(this.polylineSymbol);this._esriGeometryPolyline.setRenderer(_9c);}}if(this._esriGeometryPolygon){this.items=this.items.concat(this._esriGeometryPolygon.graphics);if(this.polygonSymbol){var _9d=new _8a(this.polygonSymbol);this._esriGeometryPolygon.setRenderer(_9d);}}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();var _9e=map.spatialReference,_9f=this._outSR,_a0;if(_9e.wkid){_a0=(_9e._isWebMercator()&&_9f._isWebMercator())||(_9e.wkid===_9f.wkid);}else{if(_9e.wkt){_a0=(_9e.wkt===_9f.wkt);}else{return;}}if(!_a0){if(_9e._isWebMercator()&&_9f.wkid===4326){this._converter=_89.geographicToWebMercator;}else{if(_9f._isWebMercator()&&_9e.wkid===4326){this._converter=_89.webMercatorToGeographic;}else{return;}}}var _a1=this._fLayers;if(_a1&&_a1.length>0){_83.forEach(_a1,function(_a2){if(this._converter){var _a3=_a2.graphics,i,_a4,len=_a3?_a3.length:0;for(i=0;i<len;i++){_a4=_a3[i].geometry;if(_a4){_a3[i].setGeometry(this._converter(_a4));}}}map.addLayer(_a2);},this);}this.setVisibility(this.visible);this._fireUpdateEnd();},_removeInternalLayers:function(){var map=this._map;if(map){_83.forEach(this.getFeatureLayers(),map.removeLayer,map);}},onVisibilityChange:function(_a5){this._fireUpdateStart();_83.forEach(this.getFeatureLayers(),function(_a6){_a6.setVisibility(_a5);});this._fireUpdateEnd();},_setMap:function(map,_a7){this.inherited(arguments);this._map=map;var div=this._div=_84.create("div",null,_a7);_85.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_a8){if(this._io){this._io.cancel();}_81.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_a8.removeChild(div);_84.destroy(div);}this._div=null;this.inherited(arguments);}});if(has("extend-esri")){_82.setObject("layers._ServiceGeneratedFeatureCollection",_8e,_86);}return _8e;});},"esri/layers/KMLGroundOverlay":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/layers/MapImage"],function(_a9,_aa,has,_ab,_ac,_ad){var _ae=_a9([_ad],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(_af){if(_ac.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){_aa.setObject("layers.KMLGroundOverlay",_ae,_ab);}return _ae;});},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(_b0,_b1,_b2){var _b3={};_b0.setObject("dojo.data.util.simpleFetch",_b3);_b3.errorHandler=function(_b4,_b5){if(_b5.onError){var _b6=_b5.scope||_b1.global;_b5.onError.call(_b6,_b4,_b5);}};_b3.fetchHandler=function(_b7,_b8){var _b9=_b8.abort||null,_ba=false,_bb=_b8.start?_b8.start:0,_bc=(_b8.count&&(_b8.count!==Infinity))?(_bb+_b8.count):_b7.length;_b8.abort=function(){_ba=true;if(_b9){_b9.call(_b8);}};var _bd=_b8.scope||_b1.global;if(!_b8.store){_b8.store=this;}if(_b8.onBegin){_b8.onBegin.call(_bd,_b7.length,_b8);}if(_b8.sort){_b7.sort(_b2.createSortFunction(_b8.sort,this));}if(_b8.onItem){for(var i=_bb;(i<_b7.length)&&(i<_bc);++i){var _be=_b7[i];if(!_ba){_b8.onItem.call(_bd,_be,_b8);}}}if(_b8.onComplete&&!_ba){var _bf=null;if(!_b8.onItem){_bf=_b7.slice(_bb,_bc);}_b8.onComplete.call(_bd,_bf,_b8);}};_b3.fetch=function(_c0){_c0=_c0||{};if(!_c0.store){_c0.store=this;}this._fetchItems(_c0,_b0.hitch(this,"fetchHandler"),_b0.hitch(this,"errorHandler"));return _c0;};return _b3;});},"esri/layers/KMLLayer":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/sniff","dojo/io-query","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/dijit/PopupTemplate","esri/layers/layer","esri/layers/KMLFolder","esri/layers/KMLGroundOverlay","esri/layers/MapImageLayer","esri/layers/FeatureLayer"],function(_c1,_c2,_c3,_c4,_c5,_c6,has,ioq,_c7,_c8,_c9,_ca,_cb,_cc,_cd,_ce,_cf,_d0,_d1,_d2,_d3,_d4){var _d5=_c2([_d0],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(url,_d6){if(!url){}this._outSR=(_d6&&_d6.outSR)||new _cd({wkid:4326});this._options=_d6;if(_ca.defaults.kmlService){this.serviceUrl=_ca.defaults.kmlService;}var _d7=(this.linkInfo=_d6&&_d6.linkInfo);if(_d7){this.visible=!!_d7.visibility;this._waitingForMap=!!_d7.viewFormat;}if(!_d7||(_d7&&_d7.visibility&&!this._waitingForMap)){this._parseKml();}this.refresh=_c4.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",true);},getFeature:function(_d8){if(!_d8){return;}var _d9=_d8.type,id=_d8.id,_da,i,len;switch(_d9){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var _db=this["_"+_d9];if(_db){_da=_c4.getObject("_mode._featureMap."+id,false,_db);}break;case "GroundOverlay":var _dc=this._groundLyr;if(_dc){var _dd=_dc.getImages();len=_dd.length;for(i=0;i<len;i++){if(_dd[i].id===id){_da=_dd[i];break;}}}break;case "ScreenOverlay":break;case "NetworkLink":_c5.some(this._links,function(_de){if(_de.linkInfo&&_de.linkInfo.id===id){_da=_de;return true;}else{return false;}});break;case "Folder":var _df=this.folders;len=_df?_df.length:0;for(i=0;i<len;i++){if(_df[i].id===id){_da=_df[i];break;}}break;default:undefined;break;}return _da;},getLayers:function(){var _e0=[];if(this._groundLyr){_e0.push(this._groundLyr);}if(this._fLayers){_e0=_e0.concat(this._fLayers);}if(this._links){_c5.forEach(this._links,function(_e1){if(_e1.declaredClass){_e0.push(_e1);}});}return _e0;},setFolderVisibility:function(_e2,_e3){if(!_e2){return;}this._fireUpdateStart();_e2.visible=_e3;if(_e3){_e3=this._areLocalAncestorsVisible(_e2);}this._setState(_e2,_e3);this._fireUpdateEnd();},onRefresh:function(){},_parseKml:function(map){var _e4=this;this._fireUpdateStart();this._io=_cc({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(map),model:"simple",folders:"",refresh:this.loaded?true:undefined,outSR:_c6.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(_e5){_e4._io=null;_e4._initLayer(_e5);},error:function(err){_e4._io=null;err=_c4.mixin(new Error(),err);err.message="Unable to load KML: "+_e4.url+" "+(err.message||"");_e4._fireUpdateEnd(err);_e4.onError(err);}});},_initLayer:function(_e6){if(this.loaded){this._removeInternalLayers();}this.name=_e6.name;this.description=_e6.description;this.snippet=_e6.snippet;this.visibility=_e6.visibility;this.featureInfos=_e6.featureInfos;var i,len;var _e7=(this.folders=_e6.folders),_e8=[],_e9;if(_e7){len=_e7.length;for(i=0;i<len;i++){_e9=(_e7[i]=new _d1(_e7[i]));if(_e9.parentFolderId===-1){_e8.push(_e9);}}}var _ea=(this._links=_e6.networkLinks),_eb;len=_ea?_ea.length:0;for(i=0;i<len;i++){if(_ea[i].viewRefreshMode&&_ea[i].viewRefreshMode.toLowerCase().indexOf("onregion")!==-1){continue;}_eb=_c4.mixin({},this._options);_eb.linkInfo=_ea[i];if(_eb.id){_eb.id=_eb.id+"_"+i;}_ea[i]=new _d5(_ea[i].href,_eb);_ea[i]._parentLayer=this;_ea[i]._parentFolderId=this._getLinkParentId(_ea[i].linkInfo.id);}var _ec=_e6.groundOverlays;if(_ec&&_ec.length>0){_eb=_c4.mixin({},this._options);if(_eb.id){_eb.id=_eb.id+"_"+"mapImage";}var _ed=(this._groundLyr=new _d3(_eb));len=_ec.length;for(i=0;i<len;i++){_ed.addImage(new _d2(_ec[i]));}}var _ee=_c4.getObject("featureCollection.layers",false,_e6);if(_ee&&_ee.length>0){this._fLayers=[];_c5.forEach(_ee,function(_ef,i){var _f0=_c4.getObject("featureSet.features",false,_ef),_f1;if(_f0&&_f0.length>0){_eb=_c4.mixin({outFields:["*"],infoTemplate:_ef.popupInfo?new _cf(_ef.popupInfo):null,editable:false},this._options);if(_eb.id){_eb.id=_eb.id+"_"+i;}_ef.layerDefinition.capabilities="Query,Data";_f1=new _d4(_ef,_eb);if(_f1.geometryType){this["_"+_f1.geometryType]=_f1;}this._fLayers.push(_f1);}},this);if(this._fLayers.length===0){delete this._fLayers;}}len=_e8.length;for(i=0;i<len;i++){_e9=_e8[i];this._setState(_e9,_e9.visible);}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}else{this.loaded=true;this.onLoad(this);}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();if(this._links){_c5.forEach(this._links,function(_f2){if(_f2.declaredClass){map.addLayer(_f2);if(_f2._waitingForMap){_f2._waitingForMap=null;if(_f2.visible){_f2._parseKml(map);}else{_f2._wMap=map;}}}});}var _f3=map.spatialReference,_f4=this._outSR,_f5;if(!_f3.equals(_f4)){if(_f3.isWebMercator()&&_f4.wkid===4326){_f5=_ce.geographicToWebMercator;}else{if(_f4.isWebMercator()&&_f3.wkid===4326){_f5=_ce.webMercatorToGeographic;}else{return;}}}if(this._groundLyr){if(_f5){_c5.forEach(this._groundLyr.getImages(),function(_f6){_f6.extent=_f5(_f6.extent);});}map.addLayer(this._groundLyr);}var _f7=this._fLayers;if(_f7&&_f7.length>0){_c5.forEach(_f7,function(_f8){if(_f5){var _f9=_f8.graphics,i,_fa,len=_f9?_f9.length:0;for(i=0;i<len;i++){_fa=_f9[i].geometry;if(_fa){_f9[i].setGeometry(_f5(_fa));}}}map.addLayer(_f8);});}this.onVisibilityChange(this.visible);},_removeInternalLayers:function(){var map=this._map;if(this._links){_c5.forEach(this._links,function(_fb){if(_fb.declaredClass&&_fb._io){_fb._io.cancel();}});}if(map){_c5.forEach(this.getLayers(),map.removeLayer,map);}},_setState:function(_fc,_fd){var _fe=_fc.featureInfos,_ff,_100,i,len=_fe?_fe.length:0,_101=_fd?"show":"hide";for(i=0;i<len;i++){_ff=_fe[i];_100=this.getFeature(_ff);if(!_100){continue;}if(_ff.type==="Folder"){this._setState(_100,_fd&&_100.visible);}else{if(_ff.type==="NetworkLink"){this._setInternalVisibility(_100,_fd);}else{_100[_101]();}}}},_areLocalAncestorsVisible:function(_102){var _103=_102.parentFolderId,_104=_102.visible;while(_104&&_103!==-1){var _105=this.getFeature({type:"Folder",id:_103});_104=_104&&_105.visible;_103=_105.parentFolderId;}return _104;},_setInternalVisibility:function(_106,_107){var _108=_106._parentLayer,_109=_106._parentFolderId;_107=_107&&_106.visible;while(_107&&_108){_107=_107&&_108.visible;if(_109>-1){_107=_107&&_108._areLocalAncestorsVisible(_108.getFeature({type:"Folder",id:_109}));}_109=_108._parentFolderId;_108=_108._parentLayer;}this._setIntState(_106,_107);},_setIntState:function(link,_10a){if(!link){return;}_c5.forEach(link.getLayers(),function(_10b){if(_10b.linkInfo){link._setIntState(_10b,_10a&&_10b.visible&&link._areLocalAncestorsVisible(link.getFeature({type:"Folder",id:_10b._parentFolderId})));}else{_10b.setVisibility(_10a);}});},_getLinkParentId:function(id){var _10c=-1;if(this.folders){_c5.some(this.folders,function(_10d){if(_10d.networkLinkIds&&_c5.indexOf(_10d.networkLinkIds,id)!==-1){_10c=_10d.id;return true;}return false;});}return _10c;},_checkAutoRefresh:function(){var _10e=this.linkInfo;if(_10e){if(this.visible){if(this.loaded&&this._map){var _10f=_10e.refreshMode,_110=_10e.refreshInterval,_111=_10e.viewRefreshMode,_112=_10e.viewRefreshTime;if(_10f&&_10f.toLowerCase().indexOf("oninterval")!==-1&&_110>0){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,_110*1000);}if(_111&&_111.toLowerCase().indexOf("onstop")!==-1&&_112>0){if(!this._extChgHandle){this._extChgHandle=_c3.connect(this._map,"onExtentChange",this,this._extentChanged);}}}}else{this._stopAutoRefresh();_c3.disconnect(this._extChgHandle);delete this._extChgHandle;}}},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null;},_getQueryParameters:function(map){map=map||this._map;var _113={},_114=this.linkInfo,_115=map&&map.extent,_116;if(this._url.query){_c4.mixin(_113,this._url.query);_116=!!this._url.query.token;}if(_c9.id&&!_116){var _117=_c9.id.findCredential(this._url.path);if(_117){_113.token=_117.token;}}if(_114){var _118=_114.viewFormat,_119=_114.httpQuery,_11a=_114.viewBoundScale;if(_115&&_118){var _11b=_115,_11c=_115,sr=_115.spatialReference;if(sr){if(sr.isWebMercator()){_11b=_ce.webMercatorToGeographic(_115);}else{if(sr.wkid===4326){_11c=_ce.geographicToWebMercator(_115);}}}var _11d=_11b.getCenter(),_11e=Math.max(_11c.getWidth(),_11c.getHeight());if(_11a){_11b=_11b.expand(_11a);}_118=_118.replace(/\[bboxWest\]/ig,_11b.xmin).replace(/\[bboxEast\]/ig,_11b.xmax).replace(/\[bboxSouth\]/ig,_11b.ymin).replace(/\[bboxNorth\]/ig,_11b.ymax).replace(/\[lookatLon\]/ig,_11d.x).replace(/\[lookatLat\]/ig,_11d.y).replace(/\[lookatRange\]/ig,_11e).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,_11d.x).replace(/\[lookatTerrainLat\]/ig,_11d.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,_11d.x).replace(/\[cameraLat\]/ig,_11d.y).replace(/\[cameraAlt\]/ig,_11e).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,map.width).replace(/\[vertPixels\]/ig,map.height).replace(/\[terrainEnabled\]/ig,0);_c4.mixin(_113,ioq.queryToObject(_118));}if(_119){_119=_119.replace(/\[clientVersion\]/ig,_c9.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,_c1.locale);_c4.mixin(_113,ioq.queryToObject(_119));}}var _11f=[],_120;for(_120 in _113){if(_cb.isDefined(_113[_120])){_11f.push(_120+"="+_113[_120]);}}_11f=_11f.join("&");return _11f?("?"+_11f):"";},_setMap:function(map,_121){this.inherited(arguments);this._map=map;var div=this._div=_c7.create("div",null,_121);_c8.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_122){if(this._io){this._io.cancel();}this._stopAutoRefresh();_c3.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_122.removeChild(div);_c7.destroy(div);}this._wMap=this._div=null;this.inherited(arguments);},onVisibilityChange:function(_123){if(!this.loaded){if(this.linkInfo&&_123){if(!this._waitingForMap){this._parseKml(this._wMap);}}return;}this._fireUpdateStart();this._setInternalVisibility(this,_123);this._checkAutoRefresh();this._fireUpdateEnd();},refresh:function(){if(!this.loaded||!this._map||this._io||!this.visible){return;}this._parseKml();},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,this.linkInfo.viewRefreshTime*1000);}});if(has("extend-esri")){_c4.setObject("layers.KMLLayer",_d5,_c9);}return _d5;});},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(lang){var _124={};lang.setObject("dojo.data.util.sorter",_124);_124.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_124.createSortFunction=function(_125,_126){var _127=[];function _128(attr,dir,comp,s){return function(_129,_12a){var a=s.getValue(_129,attr);var b=s.getValue(_12a,attr);return dir*comp(a,b);};};var _12b;var map=_126.comparatorMap;var bc=_124.basicComparator;for(var i=0;i<_125.length;i++){_12b=_125[i];var attr=_12b.attribute;if(attr){var dir=(_12b.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_127.push(_128(attr,dir,comp,_126));}}return function(rowA,rowB){var i=0;while(i<_127.length){var ret=_127[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _124;});},"esri/layers/OnDemandMode":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/geometry/Point","esri/tasks/query","esri/layers/RenderMode","esri/layers/GridLayout"],function(_12c,_12d,lang,_12e,has,_12f,_130,_131,_132,_133){var _134=_12c([_132],{declaredClass:"esri.layers._OnDemandMode",constructor:function(_135){this.featureLayer=_135;this._featureMap={};this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},initialize:function(map){this.inherited(arguments);var _136=this.featureLayer,_137=_136._srInfo;this._gridLayer=new _133(new _130(_137?_137.valid[0]:map.extent.xmin,map.extent.ymax,map.spatialReference),{width:_136._tileWidth,height:_136._tileHeight},{width:map.width,height:map.height},_137);this._cellMap={};this._gridLayer.setResolution(map.extent);},startup:function(){this._ioQueue=[];if(!this.featureLayer.suspended){this._zoomHandler();this._enableConnectors();}},propertyChangeHandler:function(type){if(this._init){if(type<2){this._zoomHandler();}else{}}},destroy:function(){this._disableConnectors();this.inherited(arguments);},drawFeature:function(_138){var _139=this._gridLayer,geom=_138.geometry,_13a=[];if(!geom){return;}_13a=_139.getCellsInExtent((geom.type==="point")?{xmin:geom.x,ymin:geom.y,xmax:geom.x,ymax:geom.y}:geom.getExtent(),false).cells;var _13b=this._cellMap,i,cell,oid=_138.attributes[this.featureLayer.objectIdField],_13c,row,col;for(i=0;i<_13a.length;i++){cell=_13a[i];_13c=cell.latticeID;row=cell.row;col=cell.col;if(_13c){cell=(_13b[_13c]=(_13b[_13c]||cell));}else{_13b[row]=_13b[row]||{};cell=(_13b[row][col]=(_13b[row][col]||cell));}cell.features=cell.features||[];cell.features.push(_138);this._addFeatureIIf(oid,_138);this._incRefCount(oid);}},suspend:function(){if(!this._init){return;}this._disableConnectors();},resume:function(){if(!this._init){return;}this._enableConnectors();this._zoomHandler();},refresh:function(){this._zoomHandler();},_enableConnectors:function(){var map=this.map;this._zoomConnect=_12d.connect(map,"onZoomEnd",this,this._zoomHandler);this._panConnect=_12d.connect(map,"onPanEnd",this,this._panHandler);this._resizeConnect=_12d.connect(map,"onResize",this,this._panHandler);},_disableConnectors:function(){_12d.disconnect(this._zoomConnect);_12d.disconnect(this._panConnect);_12d.disconnect(this._resizeConnect);},_zoomHandler:function(){this._processIOQueue(true);var _13d=this.featureLayer,map=this.map;if(_13d.suspended){return;}_13d._fireUpdateStart();this._clearIIf();var _13e=_13d._trackManager;if(_13e){_13e.clearTracks();}this._cellMap={};this._gridLayer.setResolution(map.extent);this._sendRequest();},_panHandler:function(){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&arguments[0]);},_getRequestId:function(_13f,cell){var id="_"+_13f.name+_13f.layerId+_13f._ulid+"_"+cell.resolution+"_"+(cell.latticeID||(cell.row+"_"+cell.col));return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_sendRequest:function(_140){this._exceeds=false;var _141=this.featureLayer,map=this.map,_142=_140||map.extent,_143=this._gridLayer.getCellsInExtent(_142,_141.latticeTiling),_144=_143.cells;if(!_141.isEditable()){var _145=this._cellMap;_144=_12e.filter(_144,function(cell){if(cell.lattice){if(_145[cell.latticeID]){return false;}}else{if(_145[cell.row]&&_145[cell.row][cell.col]){return false;}}return true;});}var _146=_141.getOutFields(),_147=_141.getDefinitionExpression(),time=_141._getOffsettedTE(_141._mapTimeExtent),_148=_141.supportsAdvancedQueries?_141.orderByFields:null,_149=_141._usePatch,_14a=this._ioQueue,i,self=this,func=this._drawFeatures,cell,_14b,_14c;this._pending=this._pending||0;for(i=0;i<_144.length;i++){cell=_144[i];_14b=new _131();_14b.geometry=cell.extent||cell.lattice;_14b.outFields=_146;_14b.where=_147;if(_141.latticeTiling&&cell.extent){_14b.spatialRelationship=_131.SPATIAL_REL_CONTAINS;}_14b.returnGeometry=true;_14b.timeExtent=time;_14b.maxAllowableOffset=_141._maxOffset;if(_141._ts){_14b._ts=(new Date()).getTime();}_14b.orderByFields=_148;_14c=null;if(_149){_14c=this._getRequestId(_141,cell);if(this._isPending(_14c)){continue;}}this._pending++;_14a.push(_141._task.execute(_14b,function(){var _14d=cell;return function(_14e){func.apply(self,[_14e,_14d]);};}.call(this),this._queryErrorHandler,_14c));}this._removeOldCells(_142);this._endCheck();},_drawFeatures:function(_14f,cell){this._exceeds=this._exceeds||_14f.exceededTransferLimit;this._finalizeIO();var _150=this.featureLayer,map=this.map,_151=map.extent,_152=cell.extent,row=cell.row,col=cell.col,_153=_150.objectIdField,_154=_14f.features,_155=this._gridLayer,_156=this._cellMap,i,len,_157=cell.latticeID,_158=_157?_156[_157]:(_156[row]&&_156[row][col]);if((cell.resolution!=_155._resolution)||(_157?(_157!==_155.getLatticeID(_151)):(!_155.intersects(_152,_151)))){if(_158){this._removeCell(row,col,_157);}}else{if(_158){this._updateCell(_158,_154);}else{cell.features=_154;if(_157){_156[_157]=cell;}else{_156[row]=_156[row]||{};_156[row][col]=cell;}len=_154.length;for(i=0;i<len;i++){var _159=_154[i];var oid=_159.attributes[_153];this._addFeatureIIf(oid,_159);this._incRefCount(oid);}}}this._endCheck();},_queryErrorHandler:function(err){this._finalizeIO();this.featureLayer._errorHandler(err);this._endCheck(true);},_finalizeIO:function(){this._purgeRequests();this._pending--;},_endCheck:function(_15a){if(this._pending===0){this._processIOQueue();var _15b=this.featureLayer,_15c=_15b._trackManager;if(_15c){_15c.clearTracks();_15c.addFeatures(_15b.graphics);if(_15b._ager){_12e.forEach(_15b.graphics,function(_15d){if(_15d._shape){_15b._repaint(_15d);}});}_15c.moveLatestToFront();_15c.drawTracks();}this.featureLayer._fireUpdateEnd(_15a&&new Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:true}:null);if(this._exceeds){_15b.onQueryLimitExceeded();}}},_processIOQueue:function(_15e){this._ioQueue=_12e.filter(this._ioQueue,function(dfd){var keep=dfd.fired>-1?false:true;return keep;});if(_15e){_12e.forEach(this._ioQueue,this._cancelPendingRequest);}},_removeOldCells:function(_15f){var _160=this._cellMap,_161=this._gridLayer,_162,_163;for(_162 in _160){if(_160[_162]){var row=_160[_162],_164=row.latticeID,_165=0,_166=0;if(_164){_165++;if(_164!==_161.getLatticeID(_15f)){this._removeCell(null,null,_164);_166++;}}else{for(_163 in row){if(row[_163]){_165++;var _167=row[_163].extent;if(!_161.intersects(_167,_15f)){this._removeCell(_162,_163);_166++;}}}}if(_166===_165){delete _160[_162];}}}},_updateCell:function(cell,_168){var _169=this.featureLayer,_16a=_169.objectIdField,_16b=_169._selectedFeatures,i,len=_168.length;cell.features=cell.features||[];for(i=0;i<len;i++){var _16c=_168[i];var oid=_16c.attributes[_16a];var _16d=this._addFeatureIIf(oid,_16c);if(_16d===_16c){this._incRefCount(oid);cell.features.push(_16d);}else{if(!(oid in _16b)){_16d.setGeometry(_16c.geometry);_16d.setAttributes(_16c.attributes);}}}},_removeCell:function(row,col,_16e){var _16f=this._cellMap,_170=this.featureLayer,_171=_170.objectIdField;var cell=_16e?_16f[_16e]:(_16f[row]&&_16f[row][col]);if(cell){if(_16e){delete _16f[_16e];}else{delete _16f[row][col];}var _172=cell.features,i;for(i=0;i<_172.length;i++){var _173=_172[i];var oid=_173.attributes[_171];this._decRefCount(oid);if(oid in _170._selectedFeatures){continue;}this._removeFeatureIIf(oid);}}}});if(has("extend-esri")){lang.setObject("layers._OnDemandMode",_134,_12f);}return _134;});},"esriviewer/loader/esrirequires/EsriRequires":function(){define(["dojo/_base/declare","esri/arcgis/utils","esri/layers/FeatureLayer","esri/layers/KMLLayer","esri/layers/WMSLayer"],function(_174){return _174([],{});});},"esri/layers/FeatureLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/date/locale","dojo/sniff","dojo/io-query","dojo/dom-construct","dojo/i18n","esri/kernel","esri/lang","esri/request","esri/deferredUtils","esri/SpatialReference","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/jsonUtils","esri/renderers/SimpleRenderer","esri/renderers/UniqueValueRenderer","esri/renderers/jsonUtils","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/FeatureSet","esri/geometry/Extent","esri/geometry/jsonUtils","esri/geometry/normalizeUtils","esri/layers/GraphicsLayer","esri/layers/Field","esri/layers/TimeInfo","esri/layers/FeatureType","esri/layers/FeatureTemplate","esri/layers/FeatureEditResult","esri/layers/LabelClass","esri/layers/SnapshotMode","esri/layers/OnDemandMode","esri/layers/SelectionMode","esri/layers/TrackManager","dojo/i18n!esri/nls/jsapi","dojo/has!extend-esri?esri/layers/agscommon"],function(_175,_176,lang,_177,_178,_179,_17a,has,ioq,_17b,i18n,_17c,_17d,_17e,_17f,_180,_181,_182,_183,_184,_185,_186,_187,_188,_189,_18a,_18b,_18c,_18d,_18e,_18f,_190,_191,_192,_193,_194,_195,_196,_197,_198){var _199=_175(_18e,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(url,_19a){this.i18n=i18n.getLocalization("esri","jsapi");this._outFields=_19a&&_19a.outFields;this._loadCallback=_19a&&_19a.loadCallback;var _19b=_19a&&_19a._usePatch;this._usePatch=(_19b===null||_19b===undefined)?true:_19b;this._trackIdField=_19a&&_19a.trackIdField;this.objectIdField=_19a&&_19a.objectIdField;this._maxOffset=_19a&&_19a.maxAllowableOffset;this._optEditable=_19a&&_19a.editable;this._optAutoGen=_19a&&_19a.autoGeneralize;this.editSummaryCallback=_19a&&_19a.editSummaryCallback;this.userId=_19a&&_19a.userId;this.userIsAdmin=_19a&&_19a.userIsAdmin;this.useMapTime=(_19a&&_19a.hasOwnProperty("useMapTime"))?(!!_19a.useMapTime):true;this.source=_19a&&_19a.source;this.gdbVersion=_19a&&_19a.gdbVersion;this.orderByFields=_19a&&_19a.orderByFields;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var ctor=this.constructor,mode=this.mode=(_17d.isDefined(_19a&&_19a.mode)?_19a.mode:ctor.MODE_ONDEMAND);switch(mode){case ctor.MODE_SNAPSHOT:this._mode=new _195(this);this._isSnapshot=true;break;case ctor.MODE_ONDEMAND:this._tileWidth=(_19a&&_19a.tileWidth)||512;this._tileHeight=(_19a&&_19a.tileHeight)||512;this._mode=new _196(this);var _19c=_19a&&_19a.latticeTiling;this.latticeTiling=_19c;break;case ctor.MODE_SELECTION:this._mode=new _197(this);this._isSelOnly=true;break;}this._initLayer=lang.hitch(this,this._initLayer);this._selectHandler=lang.hitch(this,this._selectHandler);this._editable=false;if(lang.isObject(url)&&url.layerDefinition){var json=url;this._collection=true;this.mode=ctor.MODE_SNAPSHOT;this._initLayer(json);return this;}this._task=new _188(this.url,{source:this.source,gdbVersion:this.gdbVersion});var _19d=this._url.path;this._fserver=false;if(_19d.search(/\/FeatureServer\//i)!==-1){this._fserver=true;}var _19e=_19a&&_19a.resourceInfo;if(_19e){this._initLayer(_19e);}else{if(this.source){var _19f={source:this.source.toJson()};this._url.query=lang.mixin(this._url.query,{layer:_178.toJson(_19f)});}if(this.gdbVersion){this._url.query=lang.mixin(this._url.query,{gdbVersion:this.gdbVersion});}_17e({url:_19d,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}this.registerConnectEvents();},_initLayer:function(_1a0,io){if(_1a0||io){this._json=_1a0;this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_1a0&&_1a0._ssl);if(ssl){this._useSSL();this._task._useSSL();}if(this._collection){this._mode=new _195(this);this._isSnapshot=true;this._featureSet=_1a0.featureSet;this._nextId=_1a0.nextObjectId;_1a0=_1a0.layerDefinition;}if(_1a0.hasOwnProperty("capabilities")){var _1a1=(this.capabilities=_1a0.capabilities);if(_1a1&&_1a1.toLowerCase().indexOf("editing")!==-1){this._editable=true;}else{this._editable=false;}}else{if(!this._collection){this._editable=this._fserver;}}if(_17d.isDefined(this._optEditable)){this._editable=this._optEditable;delete this._optEditable;}this._json=_178.toJson(this._json);if(this.isEditable()){delete this._maxOffset;}else{if(this.mode!==this.constructor.MODE_SNAPSHOT&&((_1a0.geometryType==="esriGeometryPolyline")||(_1a0.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_17d.isDefined(this._optAutoGen)?this._optAutoGen:(this.mode===this.constructor.MODE_ONDEMAND);delete this._optAutoGen;}}var _1a2=_1a0.effectiveMinScale||_1a0.minScale,_1a3=_1a0.effectiveMaxScale||_1a0.maxScale;if(!this._hasMin&&_1a2){this.setMinScale(_1a2);}if(!this._hasMax&&_1a3){this.setMaxScale(_1a3);}this.layerId=_1a0.id;this.name=_1a0.name;this.description=_1a0.description;this.copyright=_1a0.copyrightText;this.type=_1a0.type;this.geometryType=_1a0.geometryType;this.displayField=_1a0.displayField;this.defaultDefinitionExpression=_1a0.definitionExpression;this.fullExtent=new _18b(_1a0.extent);this.initialExtent=new _18b(this.fullExtent.toJson());if(this.fullExtent.spatialReference){this.spatialReference=new _180(this.fullExtent.spatialReference.toJson());}this.defaultVisibility=_1a0.defaultVisibility;if((this.geometryType==="esriGeometryPoint")||(this.geometryType==="esriGeometryMultipoint")){this.latticeTiling=false;}this.indexedFields=_1a0.indexedFields;this.maxRecordCount=_1a0.maxRecordCount;this.canModifyLayer=_1a0.canModifyLayer;this.supportsStatistics=_1a0.supportsStatistics;this.supportsAdvancedQueries=_1a0.supportsAdvancedQueries;this.hasLabels=_1a0.hasLabels;this.canScaleSymbols=_1a0.canScaleSymbols;this.supportsRollbackOnFailure=_1a0.supportsRollbackOnFailure;this.syncCanReturnChanges=_1a0.syncCanReturnChanges;this.isDataVersioned=_1a0.isDataVersioned;this.editFieldsInfo=_1a0.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=_1a0.ownershipBasedAccessControlForFeatures;if(this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures){this.creatorField=this.editFieldsInfo.creatorField;}this.relationships=_1a0.relationships;this.allowGeometryUpdates=_17d.isDefined(_1a0.allowGeometryUpdates)?_1a0.allowGeometryUpdates:true;this._isTable=(this.type==="Table");var _1a4=(this.fields=[]),_1a5=_1a0.fields,i;for(i=0;i<_1a5.length;i++){_1a4.push(new _18f(_1a5[i]));}if(!this.objectIdField){this.objectIdField=_1a0.objectIdField;if(!this.objectIdField){_1a5=_1a0.fields;for(i=0;i<_1a5.length;i++){var _1a6=_1a5[i];if(_1a6.type==="esriFieldTypeOID"){this.objectIdField=_1a6.name;break;}}}if(!this.objectIdField){}}if(!_17d.isDefined(this._nextId)){var _1a7=this.objectIdField,_1a8=-1;if(this._collection&&_1a7){var fset=this._featureSet,_1a9=fset&&fset.features,il=_1a9?_1a9.length:0,oid,attr;for(i=0;i<il;i++){attr=_1a9[i].attributes;oid=attr&&attr[_1a7];if(oid>_1a8){_1a8=oid;}}}this._nextId=(_1a8+1);}this.globalIdField=_1a0.globalIdField;var _1aa=(this.typeIdField=_1a0.typeIdField),_1ab;if(_1aa){_1ab=!this._getField(_1aa)&&this._getField(_1aa,true);if(_1ab){this.typeIdField=_1ab.name;}}this.visibilityField=_1a0.visibilityField;var _1ac=_1a0.defaultSymbol;if(_1ac){this.defaultSymbol=_184.fromJson(_1ac);}var _1ad=this.types=[],_1ae=_1a0.types,_1af,_1b0,_1b1,_1b2=this.editFieldsInfo,_1b3=_1b2&&_1b2.creatorField,_1b4=_1b2&&_1b2.editorField,fix=(_1b3||_1b4),_1b5=[];if(_1ae){for(i=0;i<_1ae.length;i++){_1af=new _191(_1ae[i]);_1b0=_1af.templates;if(fix&&_1b0&&_1b0.length){_1b5=_1b5.concat(_1b0);}_1ad.push(_1af);}}var _1b6=_1a0.templates,_1b7,_1b8=this.templates=[];if(_1b6){for(i=0;i<_1b6.length;i++){_1b7=new _192(_1b6[i]);if(fix){_1b5.push(_1b7);}_1b8.push(_1b7);}}for(i=0;i<_1b5.length;i++){_1b1=lang.getObject("prototype.attributes",false,_1b5[i]);if(_1b1){if(_1b3){delete _1b1[_1b3];}if(_1b4){delete _1b1[_1b4];}}}var _1b9=_1a0.timeInfo;if(_1b9){this.timeInfo=new _190(_1b9);this._startTimeField=_1b9.startTimeField;this._endTimeField=_1b9.endTimeField;if(this._startTimeField&&this._endTimeField){this._twoTimeFields=true;}if(this._trackIdField){_1b9.trackIdField=this._trackIdField;}else{this._trackIdField=_1b9.trackIdField;}}this.hasAttachments=(!this._collection&&_1a0.hasAttachments)?true:false;this.htmlPopupType=_1a0.htmlPopupType;var _1ba=_1a0.drawingInfo,_1bb,_1bc=_1ba&&_1ba.labelingInfo;if(_1bc){this.labelingInfo=_177.map(_1bc,function(_1bd){return new _194(_1bd);});}if(!this.renderer){if(_1ba&&_1ba.renderer){_1bb=_1ba.renderer;this.setRenderer(_187.fromJson(_1bb));if(_1bb.type==="classBreaks"){this.renderer.setMaxInclusive(true);}if(!this._collection){var _1be=_1bb.type,_1bf=[];_1bb=this.renderer;switch(_1be){case "simple":_1bf.push(_1bb.symbol);break;case "uniqueValue":case "classBreaks":_1bf.push(_1bb.defaultSymbol);_1bf=_1bf.concat(_177.map(_1bb.infos,function(info){return info.symbol;}));break;}_1bf=_177.filter(_1bf,_17d.isDefined);var _1c0=this._url.path+"/images/",_1c1=this._getToken();_177.forEach(_1bf,function(sym){var url=sym.url;if(url){if((url.search(/https?\:/)===-1)&&(url.indexOf("data:")===-1)){sym.url=_1c0+url;}if(_1c1&&sym.url.search(/https?\:/)!==-1){sym.url+=("?token="+_1c1);}}});}}else{if(_1ac){_1ae=this.types;if(_1ae.length>0){_1bb=new _186(this.defaultSymbol,this.typeIdField);_177.forEach(_1ae,function(type){_1bb.addValue(type.id,type.symbol);});}else{_1bb=new _185(this.defaultSymbol);}this.setRenderer(_1bb);}else{if(!this._isTable){var _1c2;switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":_1c2=new _181();break;case "esriGeometryPolyline":_1c2=new _182();break;case "esriGeometryPolygon":_1c2=new _183();break;}this.setRenderer(_1c2?new _185(_1c2):null);}}}}var _1c3=(_1ba&&_1ba.transparency)||0;if(!_17d.isDefined(this.opacity)&&_1c3>0){this.opacity=1-(_1c3/100);}this.version=_1a0.currentVersion;if(!this.version){var ver;if("capabilities" in _1a0||"drawingInfo" in _1a0||"hasAttachments" in _1a0||"htmlPopupType" in _1a0||"relationships" in _1a0||"timeInfo" in _1a0||"typeIdField" in _1a0||"types" in _1a0){ver=10;}else{ver=9.3;}this.version=ver;}if((has("ie")||has("safari"))&&this.isEditable()&&this.version<10.02){this._ts=true;}this.loaded=true;this._fixRendererFields();this._checkFields();this._updateCaps();var _1c4=function(){this.onLoad(this);var _1c5=this._loadCallback;if(_1c5){delete this._loadCallback;_1c5(this);}};if(this._collection){this._fireUpdateStart();var _1c6=this._featureSet;delete this._featureSet;this._mode._drawFeatures(new _18a(_1c6));this._fcAdded=true;_1c4.call(this);}else{this._forceIdentity(_1c4);}}},setRenderer:function(ren){this.inherited("setRenderer",arguments);var _1c7=this.renderer;if(_1c7){this._ager=(_1c7.declaredClass.indexOf("TemporalRenderer")!==-1&&_1c7.observationAger&&_1c7.observationRenderer);var _1c8=[],_1c9=_177.filter([_1c7,_1c7.observationRenderer,_1c7.latestObservationRenderer,_1c7.trackRenderer],_17d.isDefined);_177.forEach(_1c9,function(rnd){if(!lang.isFunction(rnd.attributeField)){_1c8.push(rnd.attributeField);}_1c8.push(rnd.attributeField2);_1c8.push(rnd.attributeField3);},this);this._rendererFields=_177.filter(_1c8,_17d.isDefined);}else{this._ager=false;this._rendererFields=[];}if(this.loaded){if(this._rendererFields.length>0){this._fixRendererFields();this._checkFields(this._rendererFields);}if(this._collection){this._typesDirty=true;}}},_setMap:function(map){var div=this.inherited(arguments),mode=this._mode,self=this;if(mode){mode.initialize(map);}if(this.geometryType){this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());}this._addHandle=this.on("graphic-node-add",function(evt){var _1ca=evt.graphic.attributes,oid=_1ca&&_1ca[self.objectIdField],_1cb=self._selectedFeatures[oid];if(_1cb){_1cb.attr("data-selected","");}});return div;},_unsetMap:function(map){var mode=this._mode;if(mode){mode.suspend();}if(this._trackManager){this._trackManager.destroy();this._trackManager=null;}_176.disconnect(this._zoomConnect);_176.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(false);this.inherited("_unsetMap",arguments);},refresh:function(){var mode=this._mode;if(mode){mode.refresh();}},getOutFields:function(){return _177.filter(this._getOutFields(),function(_1cc){return (_1cc==="*"||!!this._getField(_1cc));},this);},setEditable:function(_1cd){if(!this._collection){return this;}if(!this.loaded){this._optEditable=_1cd;return this;}var _1ce=this._editable;this._editable=_1cd;this._updateCaps();if(_1ce!==_1cd){this.onCapabilitiesChange();}return this;},getEditCapabilities:function(_1cf){var _1d0={"canCreate":false,"canUpdate":false,"canDelete":false};if(!this.loaded||!this.isEditable()){return _1d0;}var _1d1=_1cf&&_1cf.feature,_1d2=_1cf&&_1cf.userId,caps=_177.map((this.capabilities?this.capabilities.toLowerCase().split(","):[]),lang.trim),_1d3=_177.indexOf(caps,"editing")>-1,_1d4=_1d3&&(_177.indexOf(caps,"create")>-1),_1d5=_1d3&&(_177.indexOf(caps,"update")>-1),_1d6=_1d3&&(_177.indexOf(caps,"delete")>-1),_1d7=this.ownershipBasedAccessControlForFeatures,_1d8=this.editFieldsInfo,_1d9=_1d8&&_1d8.creatorField,_1da=_1d8&&_1d8.realm,_1db=_1d1&&_1d1.attributes,_1dc=(_1db&&_1d9)?_1db[_1d9]:undefined,_1dd,_1de=!!this.userIsAdmin,_1df=!_1d7||_1de||!!(_1d7.allowOthersToUpdate||_1d7.allowUpdateToOthers),_1e0=!_1d7||_1de||!!(_1d7.allowOthersToDelete||_1d7.allowDeleteToOthers);if(_1de||(_1d3&&!(_1d4||_1d5||_1d6))){_1d4=_1d5=_1d6=true;}_1dd={"canCreate":_1d4,"canUpdate":_1d5,"canDelete":_1d6};if(_1dc===null){_1dd.canUpdate=_1d5&&_1df;_1dd.canDelete=_1d6&&_1e0;}else{if(_1dc===""){return _1dd;}else{if(_1dc){_1d2=_1d2||this.getUserId();if(_1d2&&_1da){_1d2=_1d2+"@"+_1da;}if(_1d2.toLowerCase()===_1dc.toLowerCase()){return _1dd;}else{_1dd.canUpdate=_1d5&&_1df;_1dd.canDelete=_1d6&&_1e0;}}}}return _1dd;},getUserId:function(){var _1e1;if(this.loaded){_1e1=(this.credential&&this.credential.userId)||this.userId||"";}return _1e1;},setUserIsAdmin:function(_1e2){this.userIsAdmin=_1e2;},setEditSummaryCallback:function(_1e3){this.editSummaryCallback=_1e3;},getEditSummary:function(_1e4,_1e5,_1e6){_1e6=_17d.isDefined(_1e6)?_1e6:(new Date()).getTime();var _1e7="",info=this.getEditInfo(_1e4,_1e5,_1e6),_1e8=(_1e5&&_1e5.callback)||this.editSummaryCallback;if(_1e8){info=_1e8(_1e4,info)||"";}if(lang.isString(info)){_1e7=info;}else{if(info){var _1e9=info.action,_1ea=info.userId,_1eb=info.timeValue,_1ec=0;if(_1e9){_1ec++;}if(_1ea){_1ec++;}if(_17d.isDefined(_1eb)){_1ec++;}if(_1ec>1){_1e7=(_1e9==="edit"?"edit":"create")+(_1ea?"User":"")+(_17d.isDefined(_1eb)?info.displayPattern:"");}}_1e7=_1e7&&_17d.substitute(info,this.i18n.layers.FeatureLayer[_1e7]);}return _1e7;},getEditInfo:function(_1ed,_1ee,_1ef){if(!this.loaded){return;}_1ef=_17d.isDefined(_1ef)?_1ef:(new Date()).getTime();var _1f0=(_1ee&&_1ee.action)||"last",_1f1=this.editFieldsInfo,_1f2=_1f1&&_1f1.creatorField,_1f3=_1f1&&_1f1.creationDateField,_1f4=_1f1&&_1f1.editorField,_1f5=_1f1&&_1f1.editDateField,_1f6=_1f1&&_1f1.realm,_1f7=_1ed&&_1ed.attributes,_1f8=(_1f7&&_1f2)?_1f7[_1f2]:undefined,_1f9=(_1f7&&_1f3)?_1f7[_1f3]:null,_1fa=(_1f7&&_1f4)?_1f7[_1f4]:undefined,_1fb=(_1f7&&_1f5)?_1f7[_1f5]:null,_1fc=this._getEditData(_1f8,_1f9,_1ef),_1fd=this._getEditData(_1fa,_1fb,_1ef),_1fe;switch(_1f0){case "creation":_1fe=_1fc;break;case "edit":_1fe=_1fd;break;case "last":_1fe=_1fd||_1fc;break;}if(_1fe){_1fe.action=(_1fe===_1fd)?"edit":"creation";}return _1fe;},_getEditData:function(_1ff,_200,_201){var data,_202,_203,_204=60000,_205=3600000,_206=2*_205,_207=24*_205,_208=7*_207;if(_17d.isDefined(_200)){_202=_201-_200;if(_202<0){_203="Full";}else{if(_202<_204){_203="Seconds";}else{if(_202<(2*_204)){_203="Minute";}else{if(_202<_205){_203="Minutes";}else{if(_202<_206){_203="Hour";}else{if(_202<_207){_203="Hours";}else{if(_202<_208){_203="WeekDay";}else{_203="Full";}}}}}}}}if((_1ff!==undefined)||_203){data=data||{};data.userId=_1ff;if(_203){var _209=_17a.format,_20a=new Date(_200);data.minutes=Math.floor(_202/_204);data.hours=Math.floor(_202/_205);data.weekDay=_209(_20a,{datePattern:"EEEE",selector:"date"});data.formattedDate=_209(_20a,{selector:"date"});data.formattedTime=_209(_20a,{selector:"time"});data.displayPattern=_203;data.timeValue=_200;}}return data;},isEditable:function(){return !!(this._editable||this.userIsAdmin);},setMaxAllowableOffset:function(_20b){if(!this.isEditable()){this._maxOffset=_20b;}return this;},getMaxAllowableOffset:function(){return this._maxOffset;},setAutoGeneralize:function(_20c){if(!this.loaded){this._optAutoGen=_20c;}else{if(!this.isEditable()&&(this.mode!==this.constructor.MODE_SNAPSHOT)&&((this.geometryType==="esriGeometryPolyline")||(this.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_20c;if(_20c){var map=this._map;if(map&&map.loaded){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}else{delete this._maxOffset;}}}return this;},setGDBVersion:function(_20d){if(!this._collection&&(_20d!==this.gdbVersion)&&(_20d||this.gdbVersion)){this.gdbVersion=_20d;this._task.gdbVersion=_20d;this._url.query=lang.mixin(this._url.query,{gdbVersion:_20d});if(this.loaded){this.clearSelection();if(this._map){this.refresh();}}this.onGDBVersionChange();}return this;},setDefinitionExpression:function(expr){this._defnExpr=expr;var mode=this._mode;if(mode){mode.propertyChangeHandler(1);}return this;},getDefinitionExpression:function(){return this._defnExpr;},setTimeDefinition:function(_20e){if(this._isSnapshot){this._timeDefn=_20e;var mode=this._mode;if(mode){mode.propertyChangeHandler(2);}}else{}return this;},getTimeDefinition:function(){return this._timeDefn;},setTimeOffset:function(_20f,_210){this._timeOffset=_20f;this._timeOffsetUnits=_210;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}return this;},setUseMapTime:function(use){this.useMapTime=use;this._toggleTime(!this.suspended);var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},selectFeatures:function(_211,_212,_213,_214){_212=_212||this.constructor.SELECTION_NEW;var _215=this._getShallowClone(_211),map=this._map,_216,dfd=_17f._fixDfd(new _179(_17f._dfdCanceller));_215.outFields=this.getOutFields();_215.returnGeometry=true;if(map){_215.outSpatialReference=new _180(map.spatialReference.toJson());}if(!this._applyQueryFilters(_215,true)){_216={features:[]};this._selectHandler(_216,_212,_213,_214,dfd);return dfd;}var _217=this._canDoClientSideQuery(_215);if(_217){_216={features:this._doQuery(_215,_217)};this._selectHandler(_216,_212,_213,_214,dfd);return dfd;}else{if(this._collection){var err=new Error("FeatureLayer::selectFeatures - "+this.invalidParams);this._resolve([err],null,_214,dfd,true);return dfd;}var self=this;if(this._ts){_215._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task.execute(_215);temp.addCallbacks(function(_218){self._selectHandler(_218,_212,_213,_214,dfd);},function(err){self._resolve([err],null,_214,dfd,true);});return dfd;}},getSelectedFeatures:function(){var _219=this._selectedFeatures,_21a=[],item;for(item in _219){if(_219.hasOwnProperty(item)){_21a.push(_219[item]);}}return _21a;},clearSelection:function(_21b){var _21c=this._selectedFeatures,mode=this._mode,item;for(item in _21c){if(_21c.hasOwnProperty(item)){this._unSelectFeatureIIf(item,mode);mode._removeFeatureIIf(item);}}this._selectedFeatures={};if(this._isSelOnly){mode._applyTimeFilter(true);}if(!_21b){this.onSelectionClear();}return this;},setSelectionSymbol:function(_21d){this._selectionSymbol=_21d;if(_21d){var _21e=this._selectedFeatures,item;for(item in _21e){if(_21e.hasOwnProperty(item)){_21e[item].setSymbol(_21d);}}}return this;},getSelectionSymbol:function(){return this._selectionSymbol;},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(adds,_21f,_220,_221,_222,_223){var _224=_223.assembly,dfd=_223.dfd;this._applyNormalized(adds,_224&&_224[0]);this._applyNormalized(_21f,_224&&_224[1]);this.onBeforeApplyEdits(adds,_21f,_220);var i,_225={},_226=this.objectIdField,_227={f:"json"},_228=false;if(this._collection){var _229={};_229.addResults=adds?_177.map(adds,function(){_228=true;return {objectId:this._nextId++,success:true};},this):null;_229.updateResults=_21f?_177.map(_21f,function(_22a){_228=true;var oid=_22a.attributes[_226];_225[oid]=_22a;return {objectId:oid,success:true};},this):null;_229.deleteResults=_220?_177.map(_220,function(_22b){_228=true;return {objectId:_22b.attributes[_226],success:true};},this):null;if(_228){this._editHandler(_229,adds,_225,_221,_222,dfd);}return;}if(adds&&adds.length>0){_227.adds=this._convertFeaturesToJson(adds,0,1);_228=true;}if(_21f&&_21f.length>0){for(i=0;i<_21f.length;i++){var _22c=_21f[i];_225[_22c.attributes[_226]]=_22c;}_227.updates=this._convertFeaturesToJson(_21f,0,0,1);_228=true;}if(_220&&_220.length>0){var ids=[];for(i=0;i<_220.length;i++){ids.push(_220[i].attributes[_226]);}_227.deletes=ids.join(",");_228=true;}if(_228){var self=this;return _17e({url:this._url.path+"/applyEdits",content:lang.mixin(_227,this._url.query),callbackParamName:"callback",load:function(_22d){self._editHandler(_22d,adds,_225,_221,_222,dfd);},error:function(err){self._resolve([err],null,_222,dfd,true);}},{usePost:true});}},queryFeatures:function(_22e,_22f,_230){return this._query("execute","onQueryFeaturesComplete",_22e,_22f,_230);},queryRelatedFeatures:function(_231,_232,_233){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",_231,_232,_233);},queryIds:function(_234,_235,_236){return this._query("executeForIds","onQueryIdsComplete",_234,_235,_236);},queryCount:function(_237,_238,_239){return this._query("executeForCount","onQueryCountComplete",_237,_238,_239);},queryAttachmentInfos:function(_23a,_23b,_23c){var url=this._url.path+"/"+_23a+"/attachments",dfd=new _179(_17f._dfdCanceller),self=this;dfd._pendingDfd=_17e({url:url,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(_23d){var _23e=_23d.attachmentInfos,_23f;_177.forEach(_23e,function(info){_23f=ioq.objectToQuery({gdbVersion:self._url.query&&self._url.query.gdbVersion,layer:self._url.query&&self._url.query.layer,token:self._getToken()});info.url=url+"/"+info.id+(_23f?("?"+_23f):"");info.objectId=_23a;});self._resolve([_23e],"onQueryAttachmentInfosComplete",_23b,dfd);},error:function(err){self._resolve([err],null,_23c,dfd,true);}});return dfd;},addAttachment:function(_240,_241,_242,_243){return this._sendAttachment("add",_240,_241,_242,_243);},updateAttachment:function(_244,_245,_246,_247,_248){_246.appendChild(_17b.create("input",{type:"hidden",name:"attachmentId",value:_245}));return this._sendAttachment("update",_244,_246,_247,_248);},deleteAttachments:function(_249,_24a,_24b,_24c){var url=this._url.path+"/"+_249+"/deleteAttachments",dfd=new _179(_17f._dfdCanceller),self=this,_24d={f:"json",attachmentIds:_24a.join(",")};dfd._pendingDfd=_17e({url:url,content:lang.mixin(_24d,this._url.query),callbackParamName:"callback",load:lang.hitch(this,function(_24e){var _24f=_24e.deleteAttachmentResults;_24f=_177.map(_24f,function(_250){var res=new _193(_250);res.attachmentId=res.objectId;res.objectId=_249;return res;});self._resolve([_24f],"onDeleteAttachmentsComplete",_24b,dfd);}),error:function(err){self._resolve([err],null,_24c,dfd,true);}},{usePost:true});return dfd;},addType:function(_251){var _252=this.types;if(_252){var _253=_177.some(_252,function(type){if(type.id==_251.id){return true;}return false;});if(_253){return false;}else{_252.push(_251);}}else{this.types=[_251];}this._typesDirty=true;return true;},deleteType:function(_254){if(!this._collection){return;}var _255=this.types;if(_255){var _256=-1;_177.some(_255,function(type,_257){if(type.id==_254){_256=_257;return true;}return false;});if(_256>-1){this._typesDirty=true;return _255.splice(_256,1)[0];}}},toJson:function(){var _258=this._json,json=lang.isString(_258)?_178.fromJson(_258):lang.clone(_258);if(!json){return;}json=json.layerDefinition?json:{layerDefinition:json};var _259=json.layerDefinition,_25a=this._collection;if(_25a&&this._typesDirty){_259.types=_177.map(this.types||[],function(type){return type.toJson();});var _25b=this.renderer,_25c=_259.drawingInfo;if(_25b&&!_25c){_25c=(_259.drawingInfo={});}if(_25c&&_25b&&_25b.declaredClass.indexOf("TemporalRenderer")===-1){_25c.renderer=_25b.toJson();}}var _25d=null;if(!(_25a&&!this._fcAdded)){_25d={geometryType:_259.geometryType,features:this._convertFeaturesToJson(this.graphics,true)};}json.featureSet=lang.mixin({},json.featureSet||{},_25d);if(_25a){json.nextObjectId=this._nextId;_259.capabilities=this.capabilities;}return json;},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(_25e){var self=this,path=this._url&&this._url.path;if((this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&path&&_17c.id&&_17c.id._hasPortalSession()&&_17c.id._doPortalSignIn(path)){_17c.id.getCredential(path).then(function(){self._findCredential();_25e.call(self);},function(){_25e.call(self);});}else{_25e.call(this);}},_updateCaps:function(){var _25f=this._editable,_260=lang.trim(this.capabilities||""),_261=_177.map((_260?_260.split(","):[]),lang.trim),caps=_177.map((_260?_260.toLowerCase().split(","):[]),lang.trim),_262=_177.indexOf(caps,"editing"),cap,i,_263,_264={"Create":_177.indexOf(caps,"create"),"Update":_177.indexOf(caps,"update"),"Delete":_177.indexOf(caps,"delete")};if(_25f&&_262===-1){_261.push("Editing");}else{if(!_25f&&_262>-1){_263=[_262];for(cap in _264){if(_264[cap]>-1){_263.push(_264[cap]);}}_263.sort();for(i=_263.length-1;i>=0;i--){_261.splice(_263[i],1);}}}this.capabilities=_261.join(",");},_counter:{value:0},_getUniqueId:function(){return this._counter.value++;},onSuspend:function(){this.inherited(arguments);this._toggleTime(false);var mode=this._mode;if(mode){mode.suspend();}},onResume:function(evt){this.inherited(arguments);this._toggleTime(true);this._updateMaxOffset();var mode=this._mode,map=this._map,_265=this.renderer;if(evt.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo){if(this._trackIdField||(_265&&(_265.latestObservationRenderer||_265.trackRenderer))){this._trackManager=new _198(this);this._trackManager.initialize(map);}}this._zoomConnect=_176.connect(map,"onZoomEnd",this,this._updateMaxOffset);}if(mode){evt.firstOccurrence?mode.startup():mode.resume();}},_updateMaxOffset:function(){var map=this._map;if(map&&map.loaded){if(this._autoGeneralize){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}},_toggleTime:function(_266){var map=this._map;if(_266&&this.timeInfo&&this.useMapTime&&map){this._mapTimeExtent=map.timeExtent;if(!this._timeConnect){this._timeConnect=_176.connect(map,"onTimeExtentChange",this,this._timeChangeHandler);}}else{this._mapTimeExtent=null;_176.disconnect(this._timeConnect);this._timeConnect=null;}},_timeChangeHandler:function(_267){this._mapTimeExtent=_267;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},_getOffsettedTE:function(_268){var _269=this._timeOffset,_26a=this._timeOffsetUnits;return (_268&&_269&&_26a)?_268.offset(-1*_269,_26a):_268;},_getTimeOverlap:function(_26b,_26c){if(_26b&&_26c){return _26b.intersection(_26c);}else{return _26b||_26c;}},_getTimeFilter:function(_26d){var _26e=this.getTimeDefinition(),_26f=null,_270;if(_26e||_26f){_270=this._getTimeOverlap(_26e,_26f);if(!_270){return [false];}}if(_26d){_26d=_270?this._getTimeOverlap(_26d,_270):_26d;if(!_26d){return [false];}}else{_26d=_270;}return [true,_26d];},_getAttributeFilter:function(_271){var _272=this.getDefinitionExpression();if(_271){_271=_272?"("+_272+") AND ("+_271+")":_271;}else{_271=_272;}return _271;},_applyQueryFilters:function(_273,_274){_273.where=this._getAttributeFilter(_273.where);_273.maxAllowableOffset=this._maxOffset;if(_274&&this.supportsAdvancedQueries){_273.orderByFields=_273.orderByFields||this.orderByFields;}if(this.timeInfo){var _275=this._getTimeFilter(_273.timeExtent);if(!_275[0]){return false;}else{_273.timeExtent=_275[1];}}return true;},_add:function(_276){var _277=this._selectionSymbol,attr=_276.attributes,_278=this.visibilityField;if(_277&&this._isSelOnly){_276.setSymbol(_277);}if(_278&&attr&&attr.hasOwnProperty(_278)){_276[attr[_278]?"show":"hide"]();}return this.add.apply(this,arguments);},_remove:function(){return this.remove.apply(this,arguments);},_canDoClientSideQuery:function(_279){var _27a=[],map=this._map;if(this._isTable||!map){return;}if(_279.text||(_279.where&&_279.where!==this.getDefinitionExpression())||(_279.orderByFields&&_279.orderByFields.length)){return;}var _27b=this._isSnapshot,_27c=this._isSelOnly;var _27d=_279.geometry;if(_27d){if(!_27c&&_279.spatialRelationship===_189.SPATIAL_REL_INTERSECTS&&(_27d.type==="extent"&&(_27b||map.extent.contains(_27d)))){_27a.push(1);}else{return;}}var ids=_279.objectIds;if(ids){if(_27b){_27a.push(2);}else{var len=ids.length,mode=this._mode,_27e=0,i;for(i=0;i<len;i++){if(mode._getFeature(ids[i])){_27e++;}}if(_27e===len){_27a.push(2);}else{return;}}}if(this.timeInfo){var _27f=_279.timeExtent,_280=this._mapTimeExtent;if(_27b){if(_27f){_27a.push(3);}}else{if(_27c){if(_27f){return;}}else{if(_280){if(_177.indexOf(_27a,2)!==-1){if(_27f){_27a.push(3);}}else{return;}}else{if(_27a.length>0){if(_27f){_27a.push(3);}}else{if(_27f){return;}}}}}}return _27a.length>0?_27a:null;},_doQuery:function(_281,_282,_283){var _284=[],mode=this._mode,_285=this.objectIdField,i,len,_286;if(_177.indexOf(_282,2)!==-1){_284=[];var ids=_281.objectIds;len=ids.length;for(i=0;i<len;i++){var obj=mode._getFeature(ids[i]);if(obj){_284.push(obj);}}if(_284.length===0){return [];}}if(_177.indexOf(_282,1)!==-1){_286=_284.length>0?_284:this.graphics;len=_286.length;var _287=_281.geometry._normalize(null,true);_284=[];for(i=0;i<len;i++){var _288=_286[i],_289=_288.geometry;if(_289){if(this.normalization&&_287.length){if(_287[0].intersects(_289)||_287[1].intersects(_289)){_284.push(_288);}}else{if(_287.intersects(_289)){_284.push(_288);}}}}if(_284.length===0){return [];}}if(_177.indexOf(_282,3)!==-1){if(this.timeInfo){_286=_284.length>0?_284:this.graphics;var time=_281.timeExtent,_28a=this._filterByTime(_286,time.startTime,time.endTime);_284=_28a.match;}}if(_283){return _177.map(_284,function(obj){return obj.attributes[_285];},this);}else{return _284;}},_filterByTime:function(_28b,_28c,_28d){var _28e=this._startTimeField,_28f=this._endTimeField,_290;if(!this._twoTimeFields){_290=_28e||_28f;}var _291=_17d.isDefined,yea=[],nay=[],i,len=_28b.length,_292,_293;_28c=_28c?_28c.getTime():-Infinity;_28d=_28d?_28d.getTime():Infinity;if(_290){for(i=0;i<len;i++){_292=_28b[i];_293=_292.attributes;var time=_293[_290];if(time>=_28c&&time<=_28d){yea.push(_292);}else{nay.push(_292);}}}else{for(i=0;i<len;i++){_292=_28b[i];_293=_292.attributes;var _294=_293[_28e],end=_293[_28f];_294=_291(_294)?_294:-Infinity;end=_291(end)?end:Infinity;if((_294>=_28c&&_294<=_28d)||(end>=_28c&&end<=_28d)||(_28c>=_294&&_28d<=end)){yea.push(_292);}else{nay.push(_292);}}}return {match:yea,noMatch:nay};},_resolve:function(args,_295,_296,dfd,_297){if(_295){this[_295].apply(this,args);}if(_296){_296.apply(null,args);}if(dfd){_17f._resDfd(dfd,args,_297);}},_getShallowClone:function(_298){var _299=new _189(),prop;for(prop in _298){if(_298.hasOwnProperty(prop)){_299[prop]=_298[prop];}}return _299;},_query:function(type,_29a,_29b,_29c,_29d){var that=this,map=this._map,dfd=new _179(_17f._dfdCanceller),_29e=_29b;var _29f=function(_2a0,_2a1){if(!_2a1&&type==="execute"&&!that._isTable){var _2a2=_2a0.features,mode=that._mode,_2a3=that.objectIdField,il=_2a2.length,i;for(i=il-1;i>=0;i--){var oid=_2a2[i].attributes[_2a3];var _2a4=mode._getFeature(oid);if(_2a4){_2a2.splice(i,1,_2a4);}}}that._resolve([_2a0],_29a,_29c,dfd);};if(type!=="executeRelationshipQuery"){_29e=this._getShallowClone(_29b);_29e.outFields=this.getOutFields();_29e.returnGeometry=_29b.hasOwnProperty("returnGeometry")?_29b.returnGeometry:true;var _2a5;if(map){_29e.outSpatialReference=new _180(map.spatialReference.toJson());}if(!this._applyQueryFilters(_29e,type==="execute")){switch(type){case "execute":_2a5=new _18a({features:[]});break;case "executeForIds":_2a5=[];break;case "executeForCount":_2a5=0;break;}_29f(_2a5,true);return dfd;}var _2a6=this._canDoClientSideQuery(_29e);if(_2a6){var _2a7=this._doQuery(_29e,_2a6,(type==="executeForIds"||type==="executeForCount"));switch(type){case "execute":_2a5=new _18a();_2a5.features=_2a7;break;case "executeForIds":_2a5=_2a7;break;case "executeForCount":_2a5=_2a7.length;break;}_29f(_2a5,true);return dfd;}}if(this._collection){var err=new Error("FeatureLayer::_query - "+this.invalidParams);this._resolve([err],null,_29d,dfd,true);return dfd;}if(this._ts){_29e._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task[type](_29e);temp.addCallbacks(_29f,function(err){that._resolve([err],null,_29d,dfd,true);});return dfd;},_convertFeaturesToJson:function(_2a8,_2a9,_2aa,_2ab){var json=[],_2ac=this._selectionSymbol,_2ad=this.visibilityField,i,_2ae,_2af=this.objectIdField;if(this.loaded&&(_2aa||_2ab)){_2ae=_177.filter(this.fields,function(_2b0){return (_2b0.editable===false)&&(!_2ab||(_2b0.name!==_2af));});}for(i=0;i<_2a8.length;i++){var _2b1=_2a8[i],_2b2={},_2b3=_2b1.geometry,attr=_2b1.attributes,_2b4=_2b1.symbol;if(_2b3&&(!_2ab||!this.loaded||this.allowGeometryUpdates)){_2b2.geometry=_2b3.toJson();}if(_2ad){_2b2.attributes=attr=lang.mixin({},attr);attr[_2ad]=_2b1.visible?1:0;}else{if(attr){_2b2.attributes=lang.mixin({},attr);}}if(_2b2.attributes&&_2ae&&_2ae.length){_177.forEach(_2ae,function(_2b5){delete _2b2.attributes[_2b5.name];});}if(_2b4&&(_2b4!==_2ac)){_2b2.symbol=_2b4.toJson();}json.push(_2b2);}return _2a9?json:_178.toJson(json);},_selectHandler:function(_2b6,_2b7,_2b8,_2b9,dfd){var _2ba,ctor=this.constructor;switch(_2b7){case ctor.SELECTION_NEW:this.clearSelection(true);_2ba=true;break;case ctor.SELECTION_ADD:_2ba=true;break;case ctor.SELECTION_SUBTRACT:_2ba=false;break;}var i,_2bb=_2b6.features,mode=this._mode,_2bc=[],_2bd=this.objectIdField,_2be,oid;if(_2ba){for(i=0;i<_2bb.length;i++){_2be=_2bb[i];oid=_2be.attributes[_2bd];var _2bf=mode._addFeatureIIf(oid,_2be);_2bc.push(_2bf);this._selectFeatureIIf(oid,_2bf,mode);}}else{for(i=0;i<_2bb.length;i++){_2be=_2bb[i];oid=_2be.attributes[_2bd];this._unSelectFeatureIIf(oid,mode);var _2c0=mode._removeFeatureIIf(oid);_2bc.push(_2c0||_2be);}}if(this._isSelOnly){mode._applyTimeFilter(true);}this._resolve([_2bc,_2b7,_2b6.exceededTransferLimit?{queryLimitExceeded:true}:null],"onSelectionComplete",_2b8,dfd);if(_2b6.exceededTransferLimit){this.onQueryLimitExceeded();}},_selectFeatureIIf:function(oid,_2c1,mode){var _2c2=this._selectedFeatures,_2c3=_2c2[oid];if(!_2c3){mode._incRefCount(oid);_2c2[oid]=_2c1;if(!this._isTable){this._setSelectSymbol(_2c1);_2c1.attr("data-selected","");}}return _2c3||_2c1;},_unSelectFeatureIIf:function(oid,mode){var _2c4=this._selectedFeatures[oid];if(_2c4){mode._decRefCount(oid);delete this._selectedFeatures[oid];if(!this._isTable){this._setUnSelectSymbol(_2c4);_2c4.attr("data-selected");}}return _2c4;},_isSelected:function(_2c5){},_setSelectSymbol:function(_2c6){var _2c7=this._selectionSymbol;if(_2c7&&!this._isSelOnly){_2c6.setSymbol(_2c7);}},_setUnSelectSymbol:function(_2c8){var _2c9=this._selectionSymbol;if(_2c9&&!this._isSelOnly){if(_2c9===_2c8.symbol){_2c8.setSymbol(null,true);}}},_getOutFields:function(){var _2ca=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes);_2ca=_177.filter(_2ca,function(_2cb,_2cc,arr){return !!_2cb&&(_177.indexOf(arr,_2cb)===_2cc);});var _2cd=lang.clone(this._outFields);if(_2cd){if(_177.indexOf(_2cd,"*")!==-1){return _2cd;}_177.forEach(_2ca,function(_2ce){if(_177.indexOf(_2cd,_2ce)===-1){_2cd.push(_2ce);}});return _2cd;}else{return _2ca;}},_checkFields:function(_2cf){var _2d0=_2cf||this._getOutFields();_177.forEach(_2d0,function(_2d1){if(_2d1==="*"){return;}if(!this._getField(_2d1)){}},this);if(!_2cf&&!this._isTable&&!this._fserver&&!this._collection){var _2d2=_177.some(this.fields,function(_2d3){return (_2d3&&_2d3.type==="esriFieldTypeGeometry")?true:false;});if(!_2d2){}}},_fixRendererFields:function(){var _2d4=this.renderer;if(_2d4&&this.fields.length>0){var _2d5=[],_2d6,_2d7,_2d8=_177.filter([_2d4,_2d4.observationRenderer,_2d4.latestObservationRenderer,_2d4.trackRenderer],_17d.isDefined),_2d9=[].concat(_2d8);_177.forEach(_2d8,function(L1){_177.forEach(L1.rendererInfos,function(info){if(info.renderer){_2d9.push(info.renderer);}});});_177.forEach(_2d9,function(rnd){_2d7=rnd.attributeField;if(_2d7&&!lang.isFunction(_2d7)){_2d6=!this._getField(_2d7)&&this._getField(_2d7,true);if(_2d6){rnd.attributeField=_2d6.name;}}_2d7=rnd.attributeField2;if(_2d7){_2d6=!this._getField(_2d7)&&this._getField(_2d7,true);if(_2d6){rnd.attributeField2=_2d6.name;}}_2d7=rnd.attributeField3;if(_2d7){_2d6=!this._getField(_2d7)&&this._getField(_2d7,true);if(_2d6){rnd.attributeField3=_2d6.name;}}if(!lang.isFunction(rnd.attributeField)){_2d5.push(rnd.attributeField);}_2d5.push(rnd.attributeField2);_2d5.push(rnd.attributeField3);_2d7=rnd.rotationInfo&&rnd.rotationInfo.field;if(_2d7&&!lang.isFunction(_2d7)){_2d6=!this._getField(_2d7)&&this._getField(_2d7,true);if(_2d6){_2d7=rnd.rotationInfo.field=_2d6.name;}_2d5.push(_2d7);}if(rnd.proportionalSymbolInfo){_2d7=rnd.proportionalSymbolInfo.field;if(_2d7&&!lang.isFunction(_2d7)){_2d6=!this._getField(_2d7)&&this._getField(_2d7,true);if(_2d6){_2d7=rnd.proportionalSymbolInfo.field=_2d6.name;}_2d5.push(_2d7);}_2d7=rnd.proportionalSymbolInfo.normalizationField;if(_2d7&&!lang.isFunction(_2d7)){_2d6=!this._getField(_2d7)&&this._getField(_2d7,true);if(_2d6){_2d7=rnd.proportionalSymbolInfo.normalizationField=_2d6.name;}_2d5.push(_2d7);}}},this);this._rendererFields=_177.filter(_2d5,_17d.isDefined);}},_getField:function(_2da,_2db){var _2dc=this.fields;if(!_2dc||_2dc.length===0){return null;}var _2dd;if(_2db){_2da=_2da.toLowerCase();}_177.some(_2dc,function(_2de){var _2df=false;if(_2db){_2df=(_2de&&_2de.name.toLowerCase()===_2da)?true:false;}else{_2df=(_2de&&_2de.name===_2da)?true:false;}if(_2df){_2dd=_2de;}return _2df;});return _2dd;},_getDateOpts:function(){if(!this._dtOpts){var _2e0=_177.map(_177.filter(this.fields,function(_2e1){return !!(_2e1&&_2e1.type==="esriFieldTypeDate");}),function(_2e2){return _2e2.name;});this._dtOpts={properties:_2e0};}return this._dtOpts;},_applyNormalized:function(_2e3,_2e4){if(_2e3&&_2e4){_177.forEach(_2e3,function(_2e5,_2e6){if(_2e5&&_2e4[_2e6]){_2e5.setGeometry(_2e4[_2e6]);}});}},_editHandler:function(_2e7,adds,_2e8,_2e9,_2ea,dfd){var _2eb=_2e7.addResults,_2ec=_2e7.updateResults,_2ed=_2e7.deleteResults,i,_2ee,oid,_2ef,attr,_2f0=this.objectIdField,mode=this._mode,_2f1=this._isTable;var _2f2=this.editFieldsInfo,_2f3=this.getOutFields()||[],_2f4=_2f2&&_2f2.creatorField,_2f5=_2f2&&_2f2.creationDateField,_2f6=_2f2&&_2f2.editorField,_2f7=_2f2&&_2f2.editDateField,_2f8=_2f2&&_2f2.realm;if(_177.indexOf(_2f3,"*")===-1){if(_2f4&&_177.indexOf(_2f3,_2f4)===-1){_2f4=null;}if(_2f5&&_177.indexOf(_2f3,_2f5)===-1){_2f5=null;}if(_2f6&&_177.indexOf(_2f3,_2f6)===-1){_2f6=null;}if(_2f7&&_177.indexOf(_2f3,_2f7)===-1){_2f7=null;}}var _2f9=(_2f5||_2f7)?(new Date()).getTime():null,_2fa=(_2f4||_2f6)?this.getUserId():undefined;if(_2fa&&_2f8){_2fa=_2fa+"@"+_2f8;}if(_2eb){for(i=0;i<_2eb.length;i++){_2eb[i]=new _193(_2eb[i]);if(_2f1){continue;}_2ee=_2eb[i];if(_2ee.success){oid=_2ee.objectId;_2ef=adds[i];var gl=_2ef._graphicsLayer;if(gl&&gl!==this){gl.remove(_2ef);}attr=_2ef.attributes||{};attr[_2f0]=oid;if(_2f4){attr[_2f4]=_2fa;}if(_2f6){attr[_2f6]=_2fa;}if(_2f5){attr[_2f5]=_2f9;}if(_2f7){attr[_2f7]=_2f9;}_2ef.setAttributes(attr);if(mode._init){mode.drawFeature(_2ef);}}}}if(_2ec){for(i=0;i<_2ec.length;i++){_2ec[i]=new _193(_2ec[i]);if(_2f1){continue;}_2ee=_2ec[i];if(_2ee.success){oid=_2ee.objectId;_2ef=_2e8[oid];var _2fb=mode._getFeature(oid);if(_2fb){if(_2fb.geometry!==_2ef.geometry){_2fb.setGeometry(_18c.fromJson(_2ef.geometry.toJson()));}this._repaint(_2fb,oid);}_2ef=_2fb||_2ef;attr=_2ef.attributes||{};if(_2f6){attr[_2f6]=_2fa;}if(_2f7){attr[_2f7]=_2f9;}_2ef.setAttributes(attr);}}}if(_2ed){var _2fc=[];for(i=0;i<_2ed.length;i++){_2ed[i]=new _193(_2ed[i]);if(_2f1){continue;}_2ee=_2ed[i];if(_2ee.success){oid=_2ee.objectId;_2ef=mode._getFeature(oid);if(_2ef){if(this._unSelectFeatureIIf(oid,mode)){_2fc.push(_2ef);}_2ef._count=0;mode._removeFeatureIIf(oid);}}}if(_2fc.length>0){this.onSelectionComplete(_2fc,this.constructor.SELECTION_SUBTRACT);}}this._resolve([_2eb,_2ec,_2ed],"onEditsComplete",_2e9,dfd);},_sendAttachment:function(type,_2fd,_2fe,_2ff,_300){var _301=(type==="add")?"addAttachment":"updateAttachment",url=this._url.path+"/"+_2fd+"/"+_301,self=this;var dfd=_17e({url:url,form:_2fe,content:lang.mixin(this._url.query,{f:"json",token:this._getToken()||undefined}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(_302){var _303=(type==="add")?"addAttachmentResult":"updateAttachmentResult",_304=(type==="add")?"onAddAttachmentComplete":"onUpdateAttachmentComplete",_305=new _193(_302[_303]);_305.attachmentId=_305.objectId;_305.objectId=_2fd;self._resolve([_305],_304,_2ff);return _305;}).addErrback(function(_306){self._resolve([_306],null,_300,null,true);});return dfd;},_repaint:function(_307,oid,_308){oid=_17d.isDefined(oid)?oid:_307.attributes[this.objectIdField];if(!(oid in this._selectedFeatures)||!this._selectionSymbol){_307.setSymbol(_307.symbol,_308);}},_getKind:function(_309){var _30a=this._trackManager;if(_30a){return _30a.isLatestObservation(_309)?1:0;}return 0;}});lang.mixin(_199,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});_18d._createWrappers(_199);if(has("extend-esri")){lang.setObject("layers.FeatureLayer",_199,_17c);}return _199;});},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(dojo,_30b,_30c){dojo.DeferredList=function(list,_30d,_30e,_30f,_310){var _311=[];_30b.call(this);var self=this;if(list.length===0&&!_30d){this.resolve([0,[]]);}var _312=0;_30c.forEach(list,function(item,i){item.then(function(_313){if(_30d){self.resolve([i,_313]);}else{_314(true,_313);}},function(_315){if(_30e){self.reject(_315);}else{_314(false,_315);}if(_30f){return null;}throw _315;});function _314(_316,_317){_311[i]=[_316,_317];_312++;if(_312===list.length){self.resolve(_311);}};});};dojo.DeferredList.prototype=new _30b();dojo.DeferredList.prototype.gatherResults=function(_318){var d=new dojo.DeferredList(_318,false,true,false);d.addCallback(function(_319){var ret=[];_30c.forEach(_319,function(_31a){ret.push(_31a[1]);});return ret;});return d;};return dojo.DeferredList;});},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(_31b,lang,has,_31c,_31d){var _31e=_31b(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(json){lang.mixin(this,json);if(_31d.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLFolder",_31e,_31c);}return _31e;});},"esri/layers/TrackManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(_31f,lang,_320,has,_321,_322,_323,_324){var _325=_31f(null,{declaredClass:"esri.layers._TrackManager",constructor:function(_326){this.layer=_326;this.trackMap={};},initialize:function(map){this.map=map;var _327=this.layer,_328=_327.renderer.trackRenderer;if(_328&&(_327.geometryType==="esriGeometryPoint")){var _329=(this.container=new _324._GraphicsLayer({id:_327.id+"_tracks",_child:true}));_329.loaded=true;_329.onLoad(_329);_329._setMap(map,_327._div);_329.setRenderer(_328);}},addFeatures:function(_32a){var tkid,_32b=this.trackMap,_32c=this.layer,_32d=_32c._trackIdField;_320.forEach(_32a,function(_32e){var _32f=_32e.attributes;tkid=_32f[_32d];var ary=(_32b[tkid]=(_32b[tkid]||[]));ary.push(_32e);});var _330=_32c._startTimeField,_331=_32c.objectIdField;var _332=function(a,b){var _333=a.attributes[_330],_334=b.attributes[_330];if(_333===_334){return (a.attributes[_331]<b.attributes[_331])?-1:1;}else{return (_333<_334)?-1:1;}};for(tkid in _32b){_32b[tkid].sort(_332);}},drawTracks:function(){var _335=this.container;if(!_335){return;}var _336=this.trackMap,sr=this.map.spatialReference,tkid,ary,path,i,_337,_338=this.layer._trackIdField,_339;for(tkid in _336){ary=_336[tkid];path=[];for(i=ary.length-1;i>=0;i--){_337=ary[i].geometry;if(_337){path.push([_337.x,_337.y]);}}_339={};_339[_338]=tkid;if(path.length>0){_335.add(new _322(new _323({paths:[path],spatialReference:sr}),null,_339));}}},moveLatestToFront:function(){_320.forEach(this.getLatestObservations(),function(_33a){var _33b=_33a._shape;_33b&&_33b._moveToFront();this._repaint(_33a,null,true);},this.layer);},getLatestObservations:function(){var _33c=[];if(!this.layer.renderer.latestObservationRenderer){return _33c;}var _33d=this.trackMap,tkid;for(tkid in _33d){var ary=_33d[tkid];_33c.push(ary[ary.length-1]);}return _33c;},clearTracks:function(){var _33e=this.getLatestObservations();this.trackMap={};var _33f=this.container;if(_33f){_33f.clear();}_320.forEach(_33e,function(_340){this._repaint(_340,null,true);},this.layer);},isLatestObservation:function(_341){var _342=this.layer._trackIdField;var _343=this.trackMap[_341.attributes[_342]];if(_343){return (_343[_343.length-1]===_341);}return false;},destroy:function(){var _344=this.container;if(_344){_344.clear();_344._unsetMap(this.map,this.layer._div);this.container=null;}this.map=null;this.layer=null;this.trackMap=null;}});if(has("extend-esri")){lang.setObject("layers._TrackManager",_325,_321);}return _325;});},"esri/layers/WMSLayer":function(){define(["require","dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/request","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/DynamicMapServiceLayer","esri/layers/WMSLayerInfo","dojo/query"],function(_345,_346,_347,lang,_348,has,_349,_34a,_34b,_34c,_34d,_34e,_34f){var _350=_347([_34e],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(url,_351){url=this._stripParameters(url,["version","service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);this.url=url;this._url=_34b.urlToObject(url);this._getCapabilitiesURL=url;this._initLayer=lang.hitch(this,this._initLayer);this._parseCapabilities=lang.hitch(this,this._parseCapabilities);this._getCapabilitiesError=lang.hitch(this,this._getCapabilitiesError);if(_351){this.imageFormat=this._getImageFormat(_351.format);this.imageTransparency=(_351.transparent===false)?false:true;this.visibleLayers=_351.visibleLayers?_351.visibleLayers:[];if(_351.resourceInfo){this._readResourceInfo(_351.resourceInfo);}else{this._getCapabilities();}}else{this.imageFormat="image/png";this.imageTransparency=true;this.visibleLayers=[];this._getCapabilities();}this._blankImageURL=_345.toUrl("esri/layers")+"/../images/pixel.png";},setVisibleLayers:function(_352){_352=this._checkVisibleLayersList(_352);this.visibleLayers=_352?_352:[];this.refresh(true);},setImageFormat:function(_353){this.imageFormat=this._getImageFormat(_353);this.refresh(true);},setImageTransparency:function(_354){this.imageTransparency=_354;this.refresh(true);},getImageUrl:function(_355,_356,_357,_358){if(!this.visibleLayers||this.visibleLayers.length===0){_358(this._blankImageURL);return;}var wkid=_355.spatialReference.wkid;if(_348.some(this._WEB_MERCATOR,function(el){return el==wkid;})){var _359=_348.filter(this.spatialReferences,function(el){return (_348.some(this._WEB_MERCATOR,function(el2){return el2==el;}));},this);if(_359.length==0){_359=_348.filter(this.spatialReferences,function(el){return (_348.some(this._WORLD_MERCATOR,function(el2){return el2==el;}));},this);}if(_359.length>0){wkid=_359[0];}else{wkid=this._WEB_MERCATOR[0];}}var list=_348.filter(this.spatialReferences,function(el){return el!==wkid;});this.spatialReferences=list;this.spatialReferences.unshift(wkid);var xmin=_355.xmin;var xmax=_355.xmax;var ymin=_355.ymin;var ymax=_355.ymax;var _35a={};_35a.SERVICE="WMS";_35a.REQUEST="GetMap";_35a.FORMAT=this.imageFormat;_35a.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";_35a.STYLES="";_35a.VERSION=this.version;_35a.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;_35a.WIDTH=_356;_35a.HEIGHT=_357;if(this.maxWidth<_356){_35a.WIDTH=this.maxWidth;}if(this.maxHeight<_357){_35a.HEIGHT=this.maxHeight;}var _35b=wkid?wkid:NaN;if(!isNaN(_35b)){if(this.version=="1.3.0"){_35a.CRS="EPSG:"+_35b;}else{_35a.SRS="EPSG:"+_35b;}}if(this.version=="1.3.0"&&this._useLatLong(_35b)){_35a.BBOX=ymin+","+xmin+","+ymax+","+xmax;}else{_35a.BBOX=xmin+","+ymin+","+xmax+","+ymax;}var _35c=this.getMapURL,key;_35c+=(_35c.indexOf("?")==-1)?"?":"";for(key in _35a){_35c+=(_35c.substring(_35c.length-1,_35c.length)=="?")?"":"&";_35c+=key+"="+_35a[key];}_358(_34b.addProxy(_35c));},_initLayer:function(_35d,io){this.spatialReference=new _34c(this.extent.spatialReference);this.initialExtent=new _34d(this.extent);this.fullExtent=new _34d(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=true;this.onLoad(this);var _35e=this._loadCallback;if(_35e){delete this._loadCallback;_35e(this);}},_readResourceInfo:function(_35f){if(!_35f.extent){return;}if(!_35f.layerInfos){return;}this.extent=_35f.extent;this.allExtents[0]=_35f.extent;this.layerInfos=_35f.layerInfos;this.description=_35f.description?_35f.description:"";this.copyright=_35f.copyright?_35f.copyright:"";this.title=_35f.title?_35f.title:"";this.getMapURL=_35f.getMapURL?_35f.getMapURL:this._getCapabilitiesURL;this.version=_35f.version?_35f.version:"1.3.0";this.maxWidth=_35f.maxWidth?_35f.maxWidth:5000;this.maxHeight=_35f.maxHeight?_35f.maxHeight:5000;this.spatialReferences=_35f.spatialReferences?_35f.spatialReferences:[];this.imageFormat=this._getImageFormat(_35f.format);this.setScaleRange(_35f.minScale,_35f.maxScale);this._initLayer();},_getCapabilities:function(){var _360=this._url.query?this._url.query:{};_360.SERVICE="WMS";_360.REQUEST="GetCapabilities";var uri=this._url.path+"?",key;for(key in _360){uri+=(uri.substring(uri.length-1,uri.length)=="?")?"":"&";uri+=key+"="+_360[key];}var _361=_34a({url:uri,handleAs:"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:false});},_parseCapabilities:function(xml){if(!xml){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)");return;}this.version=this._getAttributeValue("WMS_Capabilities","version",xml,null);if(!this.version){this.version=this._getAttributeValue("WMT_MS_Capabilities","version",xml,"1.3.0");}var _362=this._getTag("Service",xml);this.title=this._getTagValue("Title",_362,"");if(!this.title||this.title.length==0){this.title=this._getTagValue("Name",_362,"");}this.copyright=this._getTagValue("AccessConstraints",_362,"");this.description=this._getTagValue("Abstract",_362,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",_362,5000),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",_362,5000),10);var _363=this._getTag("Layer",xml);if(!_363){this._getCapabilitiesError({"error":{"message":"Response does not contain any layers."}});return;}var _364=this._getLayerInfo(_363);var _365=0;var _366=null;var _367=this._getTag("Capability",xml);_348.forEach(_367.childNodes,function(_368){if(_368.nodeName=="Layer"){if(_365===0){_366=_368;}else{if(_365===1){if(_364.name){_364.name="";_364.subLayers=[];_364.subLayers.push(this._getLayerInfo(_366));}_364.subLayers.push(this._getLayerInfo(_368));}else{_364.subLayers.push(this._getLayerInfo(_368));}}_365++;}},this);if(_364){this.layerInfos=_364.subLayers;if(!this.layerInfos||this.layerInfos.length==0){this.layerInfos=[_364];}this.extent=_364.extent;this.allExtents=_364.allExtents;this.spatialReferences=_364.spatialReferences;if(this.spatialReferences.length==0&&this.layerInfos.length>0){this.spatialReferences=this.layerInfos[0].spatialReferences;}}this.getMapURL=this._getCapabilitiesURL;var _369=_346.query("DCPType",this._getTag("GetMap",xml));if(_369&&_369.length>0){var _36a=_346.query("HTTP",_369[0]);if(_36a&&_36a.length>0){var _36b=_346.query("Get",_36a[0]);if(_36b&&_36b.length>0){var _36c=this._getAttributeValue("OnlineResource","xlink:href",_36b[0],null);if(_36c){if(_36c.indexOf("&")==(_36c.length-1)){_36c=_36c.substring(0,_36c.length-1);}this.getMapURL=_36c;}}}}this.getMapFormats=[];if(_346.query("Operation",xml).length==0){_348.forEach(_346.query("Format",this._getTag("GetMap",xml)),function(_36d){this.getMapFormats.push(_36d.text?_36d.text:_36d.textContent);},this);}else{_348.forEach(_346.query("Operation",xml),function(_36e){if(_36e.getAttribute("name")=="GetMap"){_348.forEach(_346.query("Format",_36e),function(_36f){this.getMapFormats.push(_36f.text?_36f.text:_36f.textContent);},this);}},this);}if(!_348.some(this.getMapFormats,function(el){return el.indexOf(this.imageFormat)>-1;},this)){this.imageFormat=this.getMapFormats[0];}this._initLayer();},_getCapabilitiesError:function(_370,io){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",_370);},_getLayerInfo:function(_371){if(!_371){return null;}var _372=new _34f();_372.name="";_372.title="";_372.description="";_372.allExtents=[];_372.spatialReferences=[];_372.subLayers=[];var _373=this._getTag("LatLonBoundingBox",_371);if(_373){_372.allExtents[0]=this._getExtent(_373,4326);}var _374=this._getTag("EX_GeographicBoundingBox",_371);if(_374){var _375=new _34d(0,0,0,0,new _34c({wkid:4326}));_375.xmin=parseFloat(this._getTagValue("westBoundLongitude",_374,0));_375.ymin=parseFloat(this._getTagValue("southBoundLatitude",_374,0));_375.xmax=parseFloat(this._getTagValue("eastBoundLongitude",_374,0));_375.ymax=parseFloat(this._getTagValue("northBoundLatitude",_374,0));_372.allExtents[0]=_375;}_372.extent=_372.allExtents[0];var _376=(_348.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)>-1)?"SRS":"CRS";_348.forEach(_371.childNodes,function(_377){if(_377.nodeName=="Name"){_372.name=(_377.text?_377.text:_377.textContent)||"";}else{if(_377.nodeName=="Title"){_372.title=(_377.text?_377.text:_377.textContent)||"";}else{if(_377.nodeName=="Abstract"){_372.description=(_377.text?_377.text:_377.textContent)||"";}else{if(_377.nodeName=="BoundingBox"){var _378=_377.getAttribute(_376),wkid;if(_378&&_378.indexOf("EPSG:")===0){wkid=parseInt(_378.substring(5),10);if(wkid!==0&&!isNaN(wkid)){var _379;if(this.version=="1.3.0"){_379=this._getExtent(_377,wkid,this._useLatLong(wkid));}else{_379=this._getExtent(_377,wkid);}_372.allExtents[wkid]=_379;if(!_372.extent){_372.extent=_379;}}}else{if(_378&&_378.indexOf("CRS:")===0){wkid=parseInt(_378.substring(4),10);if(wkid!==0&&!isNaN(wkid)){if(this._CRS_TO_EPSG[wkid]){wkid=this._CRS_TO_EPSG[wkid];}_372.allExtents[wkid]=this._getExtent(_377,wkid);}}else{wkid=parseInt(_378,10);if(wkid!==0&&!isNaN(wkid)){_372.allExtents[wkid]=this._getExtent(_377,wkid);}}}}else{if(_377.nodeName==_376){var _37a=_377.text?_377.text:_377.textContent;var arr=_37a.split(" ");_348.forEach(arr,function(val){if(val.indexOf(":")>-1){val=parseInt(val.split(":")[1],10);}else{val=parseInt(val,10);}if(val!==0&&!isNaN(val)){if(this._CRS_TO_EPSG[val]){val=this._CRS_TO_EPSG[val];}if(_348.indexOf(_372.spatialReferences,val)==-1){_372.spatialReferences.push(val);}}},this);}else{if(_377.nodeName=="Style"){var _37b=this._getTag("LegendURL",_377);if(_37b){var _37c=this._getTag("OnlineResource",_37b);if(_37c){_372.legendURL=_37c.getAttribute("xlink:href");}}}else{if(_377.nodeName==="Layer"){_372.subLayers.push(this._getLayerInfo(_377));}}}}}}}},this);_372.title=_372.title||_372.name;return _372;},_getImageFormat:function(_37d){var _37e=_37d?_37d.toLowerCase():"";switch(_37e){case "jpg":return "image/jpeg";case "bmp":return "image/bmp";case "gif":return "image/gif";case "svg":return "image/svg+xml";default:return "image/png";}},getImageFormat:function(){var _37f=this.imageFormat?this.imageFormat.toLowerCase():"";switch(_37f){case "image/jpeg":return "jpg";case "image/bmp":return "bmp";case "image/gif":return "gif";case "image/svg+xml":return "svg";default:return "png";}},_getExtent:function(_380,wkid,_381){var _382;if(_380){_382=new _34d();var minx=parseFloat(_380.getAttribute("minx"));var miny=parseFloat(_380.getAttribute("miny"));var maxx=parseFloat(_380.getAttribute("maxx"));var maxy=parseFloat(_380.getAttribute("maxy"));if(_381){_382.xmin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_382.ymin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_382.xmax=isNaN(maxy)?Number.MAX_VALUE:maxy;_382.ymax=isNaN(maxx)?Number.MAX_VALUE:maxx;}else{_382.xmin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_382.ymin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_382.xmax=isNaN(maxx)?Number.MAX_VALUE:maxx;_382.ymax=isNaN(maxy)?Number.MAX_VALUE:maxy;}_382.spatialReference=new _34c({wkid:wkid});}return _382;},_useLatLong:function(wkid){var _383,i;for(i=0;i<this._REVERSED_LAT_LONG_RANGES.length;i++){var _384=this._REVERSED_LAT_LONG_RANGES[i];if(wkid>=_384[0]&&wkid<=_384[1]){_383=true;break;}}return _383;},_getTag:function(_385,xml){var tags=_346.query(_385,xml);if(tags&&tags.length>0){return tags[0];}else{return null;}},_getTagValue:function(_386,xml,_387){var _388=_346.query(_386,xml);if(_388&&_388.length>0){if(_388[0].text){return _388[0].text;}else{return _388[0].textContent;}}else{return _387;}},_getAttributeValue:function(_389,_38a,xml,_38b){var _38c=_346.query(_389,xml);if(_38c&&_38c.length>0){return _38c[0].getAttribute(_38a);}else{return _38b;}},_checkVisibleLayersList:function(_38d){if(_38d&&_38d.length>0&&this.layerInfos&&this.layerInfos.length>0){if((typeof _38d[0])=="number"){var list=[];_348.forEach(_38d,function(pos){if(pos<this.layerInfos.length){list.push(this.layerInfos[pos].name);}},this);_38d=list;}}return _38d;},_stripParameters:function(url,_38e){var obj=_34b.urlToObject(url),prop,qs=[];for(prop in obj.query){if(_348.indexOf(_38e,prop.toLowerCase())===-1){qs.push(prop+"="+obj.query[prop]);}}return obj.path+(qs.length?("?"+qs.join("&")):"");}});if(has("extend-esri")){lang.setObject("layers.WMSLayer",_350,_349);}return _350;});},"esri/layers/SnapshotMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/SpatialReference","esri/tasks/query","esri/layers/RenderMode"],function(_38f,lang,has,_390,_391,_392,_393){var _394=_38f([_393],{declaredClass:"esri.layers._SnapshotMode",constructor:function(_395){this.featureLayer=_395;this._featureMap={};this._drawFeatures=lang.hitch(this,this._drawFeatures);this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},startup:function(){if(this.featureLayer._collection){this._applyTimeFilter();}else{this._fetchAll();}},propertyChangeHandler:function(type){if(this._init){if(type){if(this.featureLayer._collection){}else{this._fetchAll();}}else{this._applyTimeFilter();}}},drawFeature:function(_396){var _397=this.featureLayer,_398=_397.objectIdField,oid=_396.attributes[_398];this._addFeatureIIf(oid,_396);this._incRefCount(oid);},resume:function(){this.propertyChangeHandler(0);},refresh:function(){var _399=this.featureLayer;if(_399._collection){_399._fireUpdateStart();_399._refresh(true);_399._fireUpdateEnd();}else{this._fetchAll();}},_getRequestId:function(_39a){var id="_"+_39a.name+_39a.layerId+_39a._ulid;return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_fetchAll:function(){var _39b=this.featureLayer;if(_39b._collection||_39b.suspended){return;}_39b._fireUpdateStart();this._clearIIf();this._sendRequest();},_sendRequest:function(){var map=this.map,_39c=this.featureLayer,_39d=_39c.getDefinitionExpression();var _39e=new _392();_39e.outFields=_39c.getOutFields();_39e.where=_39d||"1=1";_39e.returnGeometry=true;_39e.outSpatialReference=new _391(map.spatialReference.toJson());_39e.timeExtent=_39c.getTimeDefinition();_39e.maxAllowableOffset=_39c._maxOffset;if(_39c._ts){_39e._ts=(new Date()).getTime();}_39e.orderByFields=_39c.supportsAdvancedQueries?_39c.orderByFields:null;var _39f;if(_39c._usePatch){_39f=this._getRequestId(_39c);this._cancelPendingRequest(null,_39f);}_39c._task.execute(_39e,this._drawFeatures,this._queryErrorHandler,_39f);},_drawFeatures:function(_3a0){this._purgeRequests();var _3a1=_3a0.features,_3a2=this.featureLayer,_3a3=_3a2.objectIdField,i,len=_3a1.length,_3a4,oid;for(i=0;i<len;i++){_3a4=_3a1[i];oid=_3a4.attributes[_3a3];this._addFeatureIIf(oid,_3a4);this._incRefCount(oid);}this._applyTimeFilter(true);_3a2._fireUpdateEnd(null,_3a0.exceededTransferLimit?{queryLimitExceeded:true}:null);if(_3a0.exceededTransferLimit){_3a2.onQueryLimitExceeded();}},_queryErrorHandler:function(err){this._purgeRequests();var _3a5=this.featureLayer;_3a5._errorHandler(err);_3a5._fireUpdateEnd(err);}});if(has("extend-esri")){lang.setObject("layers._SnapshotMode",_394,_390);}return _394;});},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(_3a6,lang,has,_3a7,_3a8){var _3a9=_3a6([_3a8],{declaredClass:"esri.layers._SelectionMode",constructor:function(_3aa){this.featureLayer=_3aa;this._featureMap={};},propertyChangeHandler:function(type){if(this._init&&type===0){this._applyTimeFilter();}},resume:function(){this.propertyChangeHandler(0);}});if(has("extend-esri")){lang.setObject("layers._SelectionMode",_3a9,_3a7);}return _3a9;});},"esri/layers/GridLayout":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/Polyline"],function(_3ab,lang,_3ac,has,_3ad,_3ae,_3af,_3b0){var _3b1=_3ab(null,{declaredClass:"esri.layers._GridLayout",constructor:function(_3b2,_3b3,_3b4,_3b5){this.origin=_3b2;this.cellWidth=_3b3.width;this.cellHeight=_3b3.height;this.mapWidth=_3b4.width;this.mapHeight=_3b4.height;this.srInfo=_3b5;},setResolution:function(_3b6){this._resolution=(_3b6.xmax-_3b6.xmin)/this.mapWidth;if(this.srInfo){var _3b7=Math.round((2*this.srInfo.valid[1])/this._resolution),_3b8=Math.round(_3b7/this.cellWidth);this._frameStats=[_3b8,0,_3b8-1];}},getCellCoordinates:function(_3b9){var res=this._resolution,_3ba=this.origin;return {row:Math.floor((_3ba.y-_3b9.y)/(this.cellHeight*res)),col:Math.floor((_3b9.x-_3ba.x)/(this.cellWidth*res))};},normalize:function(col){var _3bb=this._frameStats;if(_3bb){var _3bc=_3bb[0],m180=_3bb[1],p180=_3bb[2];if(col<m180){col=col%_3bc;col=col<m180?col+_3bc:col;}else{if(col>p180){col=col%_3bc;}}}return col;},intersects:function(_3bd,_3be){var _3bf=this.srInfo;if(_3bf){return _3ac.some(_3be._getParts(_3bf),function(_3c0){return _3bd.intersects(_3c0.extent);});}else{return _3bd.intersects(_3be);}},getCellExtent:function(row,col){var res=this._resolution,_3c1=this.origin,_3c2=this.cellWidth,_3c3=this.cellHeight;return new _3af((col*_3c2*res)+_3c1.x,_3c1.y-((row+1)*_3c3*res),((col+1)*_3c2*res)+_3c1.x,_3c1.y-(row*_3c3*res),new _3ae(_3c1.spatialReference.toJson()));},getLatticeID:function(_3c4){var _3c5=this.getCellCoordinates({x:_3c4.xmin,y:_3c4.ymax}),_3c6=this.getCellCoordinates({x:_3c4.xmax,y:_3c4.ymin}),_3c7=_3c5.row,_3c8=_3c6.row,_3c9=this.normalize(_3c5.col),_3ca=this.normalize(_3c6.col);return _3c7+"_"+_3c8+"_"+_3c9+"_"+_3ca;},sorter:function(a,b){return (a<b)?-1:1;},getCellsInExtent:function(_3cb,_3cc){var _3cd=this.getCellCoordinates({x:_3cb.xmin,y:_3cb.ymax}),_3ce=this.getCellCoordinates({x:_3cb.xmax,y:_3cb.ymin}),_3cf=_3cd.row,_3d0=_3ce.row,_3d1=_3cd.col,_3d2=_3ce.col,_3d3=[],i,j,nj,_3d4=[],_3d5=[],len,xmin,xmax,ymin,ymax,_3d6=[],_3d7,_3d8;for(i=_3cf;i<=_3d0;i++){for(j=_3d1;j<=_3d2;j++){nj=this.normalize(j);_3cb=this.getCellExtent(i,nj);_3d3.push({row:i,col:nj,extent:_3cb,resolution:this._resolution});if(_3cc){_3d4.push(_3cb.xmin,_3cb.xmax);_3d5.push(_3cb.ymin,_3cb.ymax);}}}_3d1=this.normalize(_3d1);_3d2=this.normalize(_3d2);_3d4.sort(this.sorter);_3d5.sort(this.sorter);len=_3d4.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_3d4[i]===_3d4[i+1]){_3d4.splice(i,1);}}}len=_3d5.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_3d5[i]===_3d5[i+1]){_3d5.splice(i,1);}}}if(_3d4.length&&_3d5.length){xmin=_3d4[0];xmax=_3d4[_3d4.length-1];ymin=_3d5[0];ymax=_3d5[_3d5.length-1];len=_3d4.length;for(i=0;i<len;i++){_3d6.push([[_3d4[i],ymax],[_3d4[i],ymin]]);}len=_3d5.length;for(i=0;i<len;i++){_3d6.push([[xmin,_3d5[i]],[xmax,_3d5[i]]]);}_3d7=new _3b0({paths:_3d6,spatialReference:this.origin.spatialReference.toJson()});_3d8=_3cf+"_"+_3d0+"_"+_3d1+"_"+_3d2;_3d3.push({latticeID:_3d8,lattice:_3d7,resolution:this._resolution});}return {minRow:_3cf,maxRow:_3d0,minCol:_3d1,maxCol:_3d2,cells:_3d3};}});if(has("extend-esri")){lang.setObject("layers._GridLayout",_3b1,_3ad);}return _3b1;});},"dojox/data/CsvStore":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/xhr","dojo/_base/kernel","dojo/data/util/filter","dojo/data/util/simpleFetch"],function(lang,_3d9,xhr,_3da,_3db,_3dc){var _3dd=_3d9("dojox.data.CsvStore",null,{constructor:function(_3de){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=false;if(_3de.url){this.url=_3de.url;}this._csvData=_3de.data;if(_3de.label){this.label=_3de.label;}else{if(this.label===""){this.label=undefined;}}this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];this.identifier=_3de.identifier;if(this.identifier===""){delete this.identifier;}else{this._idMap={};}if("separator" in _3de){this.separator=_3de.separator;}if("urlPreventCache" in _3de){this.urlPreventCache=_3de.urlPreventCache?true:false;}},url:"",label:"",identifier:"",separator:",",urlPreventCache:false,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error(this.declaredClass+": a function was passed an item argument that was not an item");}},_getIndex:function(item){var idx=this.getIdentity(item);if(this.identifier){idx=this._idMap[idx];}return idx;},getValue:function(item,_3df,_3e0){this._assertIsItem(item);var _3e1=_3e0;if(typeof _3df==="string"){var ai=this._attributeIndexes[_3df];if(ai!=null){var _3e2=this._dataArray[this._getIndex(item)];_3e1=_3e2[ai]||_3e0;}}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}return _3e1;},getValues:function(item,_3e3){var _3e4=this.getValue(item,_3e3);return (_3e4?[_3e4]:[]);},getAttributes:function(item){this._assertIsItem(item);var _3e5=[];var _3e6=this._dataArray[this._getIndex(item)];for(var i=0;i<_3e6.length;i++){if(_3e6[i]!==""){_3e5.push(this._attributes[i]);}}return _3e5;},hasAttribute:function(item,_3e7){this._assertIsItem(item);if(typeof _3e7==="string"){var _3e8=this._attributeIndexes[_3e7];var _3e9=this._dataArray[this._getIndex(item)];return (typeof _3e8!=="undefined"&&_3e8<_3e9.length&&_3e9[_3e8]!=="");}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}},containsValue:function(item,_3ea,_3eb){var _3ec=undefined;if(typeof _3eb==="string"){_3ec=_3db.patternToRegExp(_3eb,false);}return this._containsValue(item,_3ea,_3eb,_3ec);},_containsValue:function(item,_3ed,_3ee,_3ef){var _3f0=this.getValues(item,_3ed);for(var i=0;i<_3f0.length;++i){var _3f1=_3f0[i];if(typeof _3f1==="string"&&_3ef){return (_3f1.match(_3ef)!==null);}else{if(_3ee===_3f1){return true;}}}return false;},isItem:function(_3f2){if(_3f2&&_3f2[this._storeProp]===this){var _3f3=_3f2[this._idProp];if(this.identifier){var data=this._dataArray[this._idMap[_3f3]];if(data){return true;}}else{if(_3f3>=0&&_3f3<this._dataArray.length){return true;}}}return false;},isItemLoaded:function(_3f4){return this.isItem(_3f4);},loadItem:function(item){},getFeatures:function(){return this._features;},getLabel:function(item){if(this.label&&this.isItem(item)){return this.getValue(item,this.label);}return undefined;},getLabelAttributes:function(item){if(this.label){return [this.label];}return null;},_fetchItems:function(_3f5,_3f6,_3f7){var self=this;var _3f8=function(_3f9,_3fa){var _3fb=null;if(_3f9.query){var key,_3fc;_3fb=[];var _3fd=_3f9.queryOptions?_3f9.queryOptions.ignoreCase:false;var _3fe={};for(key in _3f9.query){_3fc=_3f9.query[key];if(typeof _3fc==="string"){_3fe[key]=_3db.patternToRegExp(_3fc,_3fd);}}for(var i=0;i<_3fa.length;++i){var _3ff=true;var _400=_3fa[i];for(key in _3f9.query){_3fc=_3f9.query[key];if(!self._containsValue(_400,key,_3fc,_3fe[key])){_3ff=false;}}if(_3ff){_3fb.push(_400);}}}else{_3fb=_3fa.slice(0,_3fa.length);}_3f6(_3fb,_3f9);};if(this._loadFinished){_3f8(_3f5,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_3f5,filter:_3f8});}else{this._loadInProgress=true;var _401={url:self.url,handleAs:"text",preventCache:self.urlPreventCache};var _402=xhr.get(_401);_402.addCallback(function(data){try{self._processData(data);_3f8(_3f5,self._arrayOfAllItems);self._handleQueuedFetches();}catch(e){_3f7(e,_3f5);}});_402.addErrback(function(_403){self._loadInProgress=false;if(_3f7){_3f7(_403,_3f5);}else{throw _403;}});var _404=null;if(_3f5.abort){_404=_3f5.abort;}_3f5.abort=function(){var df=_402;if(df&&df.fired===-1){df.cancel();df=null;}if(_404){_404.call(_3f5);}};}}else{if(this._csvData){try{this._processData(this._csvData);this._csvData=null;_3f8(_3f5,this._arrayOfAllItems);}catch(e){_3f7(e,_3f5);}}else{var _405=new Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(_3f7){_3f7(_405,_3f5);}else{throw _405;}}}}},close:function(_406){},_getArrayOfArraysFromCsvFileContents:function(_407){if(lang.isString(_407)){var _408=new RegExp("^\\s+","g");var _409=new RegExp("\\s+$","g");var _40a=new RegExp("\"\"","g");var _40b=[];var i;var _40c=this._splitLines(_407);for(i=0;i<_40c.length;++i){var _40d=_40c[i];if(_40d.length>0){var _40e=_40d.split(this.separator);var j=0;while(j<_40e.length){var _40f=_40e[j];var _410=_40f.replace(_408,"");var _411=_410.replace(_409,"");var _412=_411.charAt(0);var _413=_411.charAt(_411.length-1);var _414=_411.charAt(_411.length-2);var _415=_411.charAt(_411.length-3);if(_411.length===2&&_411=="\"\""){_40e[j]="";}else{if((_412=="\"")&&((_413!="\"")||((_413=="\"")&&(_414=="\"")&&(_415!="\"")))){if(j+1===_40e.length){return;}var _416=_40e[j+1];_40e[j]=_410+this.separator+_416;_40e.splice(j+1,1);}else{if((_412=="\"")&&(_413=="\"")){_411=_411.slice(1,(_411.length-1));_411=_411.replace(_40a,"\"");}_40e[j]=_411;j+=1;}}}_40b.push(_40e);}}this._attributes=_40b.shift();for(i=0;i<this._attributes.length;i++){this._attributeIndexes[this._attributes[i]]=i;}this._dataArray=_40b;}},_splitLines:function(_417){var _418=[];var i;var line="";var _419=false;for(i=0;i<_417.length;i++){var c=_417.charAt(i);switch(c){case "\"":_419=!_419;line+=c;break;case "\r":if(_419){line+=c;}else{_418.push(line);line="";if(i<(_417.length-1)&&_417.charAt(i+1)=="\n"){i++;}}break;case "\n":if(_419){line+=c;}else{_418.push(line);line="";}break;default:line+=c;}}if(line!==""){_418.push(line);}return _418;},_processData:function(data){this._getArrayOfArraysFromCsvFileContents(data);this._arrayOfAllItems=[];if(this.identifier){if(this._attributeIndexes[this.identifier]===undefined){throw new Error(this.declaredClass+": Identity specified is not a column header in the data set.");}}for(var i=0;i<this._dataArray.length;i++){var id=i;if(this.identifier){var _41a=this._dataArray[i];id=_41a[this._attributeIndexes[this.identifier]];this._idMap[id]=i;}this._arrayOfAllItems.push(this._createItemFromIdentity(id));}this._loadFinished=true;this._loadInProgress=false;},_createItemFromIdentity:function(_41b){var item={};item[this._storeProp]=this;item[this._idProp]=_41b;return item;},getIdentity:function(item){if(this.isItem(item)){return item[this._idProp];}return null;},fetchItemByIdentity:function(_41c){var item;var _41d=_41c.scope?_41c.scope:_3da.global;if(!this._loadFinished){var self=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_41c});}else{this._loadInProgress=true;var _41e={url:self.url,handleAs:"text"};var _41f=xhr.get(_41e);_41f.addCallback(function(data){try{self._processData(data);var item=self._createItemFromIdentity(_41c.identity);if(!self.isItem(item)){item=null;}if(_41c.onItem){_41c.onItem.call(_41d,item);}self._handleQueuedFetches();}catch(error){if(_41c.onError){_41c.onError.call(_41d,error);}}});_41f.addErrback(function(_420){this._loadInProgress=false;if(_41c.onError){_41c.onError.call(_41d,_420);}});}}else{if(this._csvData){try{self._processData(self._csvData);self._csvData=null;item=self._createItemFromIdentity(_41c.identity);if(!self.isItem(item)){item=null;}if(_41c.onItem){_41c.onItem.call(_41d,item);}}catch(e){if(_41c.onError){_41c.onError.call(_41d,e);}}}}}else{item=this._createItemFromIdentity(_41c.identity);if(!this.isItem(item)){item=null;}if(_41c.onItem){_41c.onItem.call(_41d,item);}}},getIdentityAttributes:function(item){if(this.identifier){return [this.identifier];}else{return null;}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _421=this._queuedFetches[i];var _422=_421.filter;var _423=_421.args;if(_422){_422(_423,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_421.args);}}this._queuedFetches=[];}}});lang.extend(_3dd,_3dc);return _3dd;});},"esri/arcgis/csv":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/sniff","dojo/number","dojox/data/CsvStore","esri/kernel","esri/config","esri/request","esri/SpatialReference","esri/geometry/Point","esri/geometry/jsonUtils","esri/geometry/webMercatorUtils"],function(lang,_424,_425,has,_426,_427,_428,_429,_42a,_42b,_42c,_42d,_42e){var _42f=["lat","latitude","y","ycenter","latitude83","latdecdeg","POINT-Y"],_430=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","POINT-X"];function _431(_432){var _433=[","," ",";","|","\t"];var _434=0;var _435="";_424.forEach(_433,function(_436){var _437=_432.split(_436).length;if(_437>_434){_434=_437;_435=_436;}});return _435;};function _438(d,_439){if(!d||Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){return false;}var _43a=true;if(has("chrome")&&/\d+\W*$/.test(_439)){var _43b=_439.match(/[a-zA-Z]{2,}/);if(_43b){var _43c=false,i=0,len=_43b.length,_43d=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;while(!_43c&&(i<=len)&&!(_43c=!_43d.test(_43b[i]))){i++;}_43a=!_43c;}}return _43a;};function _43e(data,_43f,_440){var _441=data.indexOf("\n");var _442=lang.trim(data.substr(0,_441));var _443=_43f.columnDelimiter;if(!_443){_443=_431(_442);}var _444=new _427({data:data,separator:_443});var _445=(has("ie")<9)?750:1001;_444.fetch({start:0,count:_445,onComplete:function(_446,_447){var _448=0;var _449={"layerDefinition":_43f.layerDefinition,"featureSet":{"features":[],"geometryType":"esriGeometryPoint"}};var _44a=_449.layerDefinition.objectIdField;if(!_44a){if(!_424.some(_449.layerDefinition.fields,function(_44b){if(_44b.type=="esriFieldTypeOID"){_44a=_44b.name;return true;}return false;})){_449.layerDefinition.fields.push({"name":"__OBJECTID","alias":"__OBJECTID","type":"esriFieldTypeOID","editable":false,"domain":null});_44a="__OBJECTID";}}var _44c,_44d;var _44e=_444._attributes;var _44f=[];var _450=[];_424.forEach(_449.layerDefinition.fields,function(_451,_452){if(_451.type==="esriFieldTypeDate"){_44f.push(_451.name);}else{if(_451.type==="esriFieldTypeDouble"||_451.type==="esriFieldTypeInteger"){_450.push(_451.name);}}});if(_43f.locationInfo&&_43f.locationInfo.locationType==="coordinates"){_44c=_43f.locationInfo.latitudeFieldName;_44d=_43f.locationInfo.longitudeFieldName;}else{_424.forEach(_44e,function(_453){var _454;_454=_424.indexOf(_42f,_453.toLowerCase());if(_454!==-1){_44c=_453;}_454=_424.indexOf(_430,_453.toLowerCase());if(_454!==-1){_44d=_453;}},this);}if(!_44c||!_44d){setTimeout(function(){},1);return;}var i=0,il=_446.length;for(i;i<il;i++){if(_449.featureSet.features.length>=1000){setTimeout(function(){},1);break;}var item=_446[i];var _455=_444.getAttributes(item),_456={};_424.forEach(_455,function(attr,_457){if(attr){var _458=attr;if(attr.length===0){_424.forEach(_449.layerDefinition.fields,function(_459,idx){if(_459.name==="attribute_"+(idx-1)){attr="attribute_"+(idx-1);}});}if(_424.some(_44f,function(a){return a===attr;})){var val=_444.getValue(item,_458),date=new Date(val);_456[attr]=_438(date,val)?date.getTime():null;}else{if(_424.some(_450,function(a){return a===attr;})){var _45a=_426.parse(_444.getValue(item,_458));if((attr==_44c||attr==_44d)&&(isNaN(_45a)||Math.abs(_45a)>181)){_45a=parseFloat(_444.getValue(item,_458));if(isNaN(_45a)){_456[attr]=null;}else{_456[attr]=_45a;}}else{if(isNaN(_45a)){_456[attr]=null;}else{_456[attr]=_45a;}}}else{_456[attr]=_444.getValue(item,_458);}}}});_456[_44a]=_448;_448++;var _45b=_456[_44c];var _45c=_456[_44d];if(_45c==null||_45b==null||isNaN(_45b)||isNaN(_45c)){continue;}var _45d=new _42c(_45c,_45b,new _42b({wkid:4326}));var _45e={"geometry":_45d.toJson(),"attributes":_456};_449.featureSet.features.push(_45e);}_449.layerDefinition.name="csv";if(_440){_440(_449);}},onError:function(_45f){}});return true;};function _460(_461,_462,inSR,_463,_464,_465){if(_461.length===0){_464(null);}var _466=_42d.getGeometryType(_462);var _467=[];_424.forEach(_461,function(_468){var _469=new _466(_468);_469.spatialReference=inSR;_467.push(_469);},this);var _46a=[102113,102100,3857];if(inSR.wkid&&inSR.wkid===4326&&_463.wkid&&_424.indexOf(_46a,_463.wkid)>-1){_424.forEach(_467,function(_46b){if(_46b.xmin){_46b.xmin=Math.max(_46b.xmin,-180);_46b.xmax=Math.min(_46b.xmax,180);_46b.ymin=Math.max(_46b.ymin,-89.99);_46b.ymax=Math.min(_46b.ymax,89.99);}else{if(_46b.rings){_424.forEach(_46b.rings,function(ring){_424.forEach(ring,function(_46c){_46c[0]=Math.min(Math.max(_46c[0],-180),180);_46c[1]=Math.min(Math.max(_46c[1],-89.99),89.99);},this);},this);}else{if(_46b.paths){_424.forEach(_46b.paths,function(path){_424.forEach(path,function(_46d){_46d[0]=Math.min(Math.max(_46d[0],-180),180);_46d[1]=Math.min(Math.max(_46d[1],-89.99),89.99);},this);},this);}else{if(_46b.x){_46b.x=Math.min(Math.max(_46b.x,-180),180);_46b.y=Math.min(Math.max(_46b.y,-89.99),89.99);}}}}},this);_461=[];_424.forEach(_467,function(_46e){var _46f=_42e.geographicToWebMercator(_46e);if(_463.wkid!==102100){_46f.spatialReference=_463;}_461.push(_46f.toJson());},this);_464(_461);}else{if(inSR.wkid!==null&&_424.indexOf(_46a,inSR.wkid)>-1&&_463.wkid!==null&&_463.wkid===4326){_461=[];_424.forEach(_467,function(_470){_461.push(_42e.webMercatorToGeographic(_470).toJson());},this);_464(_461);}else{var _471=function(_472,args){if(_472&&_472.length===_461.length){_461=[];_424.forEach(_472,function(_473){if(_473&&((_473.rings&&_473.rings.length>0&&_473.rings[0].length>0&&_473.rings[0][0].length>0&&!isNaN(_473.rings[0][0][0])&&!isNaN(_473.rings[0][0][1]))||(_473.paths&&_473.paths.length>0&&_473.paths[0].length>0&&_473.paths[0][0].length>0&&!isNaN(_473.paths[0][0][0])&&!isNaN(_473.paths[0][0][1]))||(_473.xmin&&!isNaN(_473.xmin)&&_473.ymin&&!isNaN(_473.ymin))||(_473.x&&!isNaN(_473.x)&&_473.y&&!isNaN(_473.y)))){_461.push(_473.toJson());}else{_461.push(null);}},this);_464(_461);}else{_465(_472,args);}};if(_429.defaults.geometryService){_429.defaults.geometryService.project(_467,_463,lang.hitch(this,_471),_465);}else{_464(null);}}}};function _474(sp1,sp2){var _475=[102113,102100,3857];if(sp1&&sp2&&sp1.wkid===sp2.wkid&&sp1.wkt===sp2.wkt){return true;}else{if(sp1&&sp2&&sp1.wkid&&sp2.wkid&&_424.indexOf(_475,sp1.wkid)>-1&&_424.indexOf(_475,sp2.wkid)>-1){return true;}}return false;};function _476(_477,_478,_479,_47a){if(!_477.featureSet||_477.featureSet.length===0){return;}if(_474(_479,_478)){_47a(_477);return;}var _47b=function(_47c){var _47d=[];_424.forEach(_477.featureSet.features,function(_47e,i){if(_47c[i]){_47e.geometry=_47c[i];_47d.push(_47e);}},this);_47a(_477);};var _47f=function(_480,args){_47a(_477);};var _481=function(_482,args){_460(_483,_477.featureSet.geometryType,_478,_479,lang.hitch(this,_47b),lang.hitch(this,_47f));};if(_477.featureSet.features&&_477.featureSet.features.length>0){var _483=[];_424.forEach(_477.featureSet.features,function(_484){_483.push(_484.geometry);});_460(_483,_477.featureSet.geometryType,_478,_479,lang.hitch(this,_47b),lang.hitch(this,_481));}else{_47a(_477);}};function _485(_486){var _487=new _425();var _488=function(_489){_487.callback(_489);};var _48a=_42a({url:_486.url,handleAs:"text",load:function(_48b){_43e(_48b,_486,lang.hitch(this,_488));},error:function(_48c){}},{usePost:false});return _487;};function _48d(_48e,_48f){var _490=new _425();var _491=function(_492){_490.callback(_492);};_476(_48e,new _42b({wkid:4326}),_48f,lang.hitch(this,_491));return _490;};function _493(_494){var _495=_494.layerDefinition.fields;var _496={"esriFieldTypeDouble":1,"esriFieldTypeSingle":1};var _497={"esriFieldTypeInteger":1,"esriFieldTypeSmallInteger":1};var dt={"esriFieldTypeDate":1};var _498=null;var _499=_424.map(_495,lang.hitch(this,function(item){if(item.name.toUpperCase()==="NAME"){_498=item.name;}var _49a=(item.type!=="esriFieldTypeOID"&&item.type!=="esriFieldTypeGlobalID"&&item.type!=="esriFieldTypeGeometry");var _49b=null;if(_49a){var f=item.name.toLowerCase();var _49c=",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";if(_49c.indexOf(","+f+",")>-1||f.indexOf("area")>-1||f.indexOf("length")>-1||f.indexOf("shape")>-1||f.indexOf("perimeter")>-1||f.indexOf("objectid")>-1||f.indexOf("_")===f.length-1||(f.indexOf("_i")===f.length-2&&f.length>1)){_49a=false;}if(item.type in _497){_49b={places:0,digitSeparator:true};}else{if(item.type in _496){_49b={places:2,digitSeparator:true};}else{if(item.type in dt){_49b={dateFormat:"shortDateShortTime"};}}}}return lang.mixin({},{fieldName:item.name,label:item.alias,isEditable:true,tooltip:"",visible:_49a,format:_49b,stringFieldOption:"textbox"});}));var _49d={title:_498?"{"+_498+"}":"",fieldInfos:_499,description:null,showAttachments:false,mediaInfos:[]};return _49d;};var csv={latFieldStrings:_42f,longFieldStrings:_430,buildCSVFeatureCollection:_485,projectFeatureCollection:_48d,generateDefaultPopupInfo:_493,_getSeparator:_431,_isValidDate:_438,_processCsvData:_43e,_projectGeometries:_460,_sameSpatialReference:_474,_projectFeatureSet:_476};if(has("extend-esri")){lang.setObject("arcgis.csv",csv,_428);}return csv;});},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(lang){var _49e={};lang.setObject("dojo.data.util.filter",_49e);_49e.patternToRegExp=function(_49f,_4a0){var rxp="^";var c=null;for(var i=0;i<_49f.length;i++){c=_49f.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_49f.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_4a0){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _49e;});},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(_4a1,lang,_4a2,has,_4a3){var _4a4=_4a1(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(_4a5){if(_4a5){this.name=_4a5.name;this.title=_4a5.title;this.description=_4a5.description;this.extent=_4a5.extent;this.legendURL=_4a5.legendURL;this.subLayers=_4a5.subLayers?_4a5.subLayers:[];this.allExtents=_4a5.allExtents?_4a5.allExtents:[];this.spatialReferences=_4a5.spatialReferences?_4a5.spatialReferences:[];}},clone:function(){var info={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},wkid;if(this.extent){info.extent=this.extent.getExtent();}info.subLayers=[];_4a2.forEach(this.subLayers,function(_4a6){info.subLayers.push(_4a6.clone());});info.allExtents=[];for(wkid in this.allExtents){wkid=parseInt(wkid,10);if(!isNaN(wkid)){info.allExtents[wkid]=this.allExtents[wkid].getExtent();}}info.spatialReferences=[];_4a2.forEach(this.spatialReferences,function(wkid){info.spatialReferences.push(wkid);});return info;}});if(has("extend-esri")){lang.setObject("layers.WMSLayerInfo",_4a4,_4a3);}return _4a4;});},"esri/layers/FeatureType":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/symbols/jsonUtils","esri/layers/RangeDomain","esri/layers/CodedValueDomain","esri/layers/InheritedDomain","esri/layers/FeatureTemplate"],function(_4a7,lang,_4a8,has,_4a9,_4aa,_4ab,_4ac,_4ad,_4ae,_4af){var _4b0=_4a7(null,{declaredClass:"esri.layers.FeatureType",constructor:function(json){if(json&&lang.isObject(json)){this.id=json.id;this.name=json.name;var _4b1=json.symbol;if(_4b1){this.symbol=_4ab.fromJson(_4b1);}var _4b2=json.domains,_4b3,i;var _4b4=this.domains={};for(_4b3 in _4b2){if(_4b2.hasOwnProperty(_4b3)){var _4b5=_4b2[_4b3];switch(_4b5.type){case "range":_4b4[_4b3]=new _4ac(_4b5);break;case "codedValue":_4b4[_4b3]=new _4ad(_4b5);break;case "inherited":_4b4[_4b3]=new _4ae(_4b5);break;}}}var _4b6=json.templates;if(_4b6){var _4b7=this.templates=[];for(i=0;i<_4b6.length;i++){_4b7.push(new _4af(_4b6[i]));}}}},toJson:function(){var json={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()};var _4b8,_4b9=this.domains,_4ba=this.templates,_4bb=_4aa.fixJson;if(_4b9){var _4bc=json.domains={};for(_4b8 in _4b9){if(_4b9.hasOwnProperty(_4b8)){_4bc[_4b8]=_4b9[_4b8]&&_4b9[_4b8].toJson();}}_4bb(_4bc);}if(_4ba){json.templates=_4a8.map(_4ba,function(_4bd){return _4bd.toJson();});}return _4bb(json);}});if(has("extend-esri")){lang.setObject("layers.FeatureType",_4b0,_4a9);}return _4b0;});},"esri/layers/RenderMode":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/io/script","esri/kernel"],function(_4be,_4bf,lang,_4c0,has,_4c1,_4c2){var _4c3=_4bf(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(_4be._scopeName||"dojo")+"IoScript";},initialize:function(map){this.map=map;this._init=true;},startup:function(){},propertyChangeHandler:function(type){},destroy:function(){this._init=false;},drawFeature:function(_4c4){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(oid){var _4c5=this._featureMap[oid];if(_4c5){_4c5._count++;}},_decRefCount:function(oid){var _4c6=this._featureMap[oid];if(_4c6){_4c6._count--;}},_getFeature:function(oid){return this._featureMap[oid];},_addFeatureIIf:function(oid,_4c7){var fmap=this._featureMap,_4c8=fmap[oid],_4c9=this.featureLayer;if(!_4c8){fmap[oid]=_4c7;_4c9._add(_4c7);_4c7._count=0;}return _4c8||_4c7;},_removeFeatureIIf:function(oid){var _4ca=this._featureMap[oid],_4cb=this.featureLayer;if(_4ca){if(_4ca._count){return;}delete this._featureMap[oid];_4cb._remove(_4ca);}return _4ca;},_clearIIf:function(){var i,_4cc=this.featureLayer,_4cd=_4cc.graphics,_4ce=_4cc._selectedFeatures,_4cf=_4cc.objectIdField;for(i=_4cd.length-1;i>=0;i--){var _4d0=_4cd[i];var oid=_4d0.attributes[_4cf];if(oid in _4ce){_4d0._count=1;continue;}_4d0._count=0;this._removeFeatureIIf(oid);}},_isPending:function(id){var dfd=_4c1[this._prefix+id];return dfd?true:false;},_cancelPendingRequest:function(dfd,id){dfd=dfd||_4c1[this._prefix+id];if(dfd){try{dfd.cancel();_4c1._validCheck(dfd);}catch(e){}}},_purgeRequests:function(){_4c1._validCheck(null);},_toggleVisibility:function(show){var _4d1=this.featureLayer,_4d2=_4d1.graphics,_4d3=show?"show":"hide",i,len=_4d2.length;show=show&&_4d1._ager;for(i=0;i<len;i++){var _4d4=_4d2[i];_4d4[_4d3]();if(show){_4d1._repaint(_4d4);}}},_applyTimeFilter:function(_4d5){var _4d6=this.featureLayer;if(!_4d6.timeInfo||_4d6.suspended){return;}if(!_4d5){_4d6._fireUpdateStart();}var _4d7=_4d6._trackManager;if(_4d7){_4d7.clearTracks();}var defn=_4d6.getTimeDefinition(),_4d8=_4d6._getOffsettedTE(_4d6._mapTimeExtent);if(_4d8){_4d8=_4d6._getTimeOverlap(defn,_4d8);if(_4d8){var _4d9=_4d6._filterByTime(_4d6.graphics,_4d8.startTime,_4d8.endTime);if(_4d7){_4d7.addFeatures(_4d9.match);}_4c0.forEach(_4d9.match,function(_4da){var _4db=_4da._shape;if(!_4da.visible){_4da.show();_4db=_4da._shape;_4db&&_4db._moveToFront();}if(_4d6._ager&&_4db){_4d6._repaint(_4da);}});_4c0.forEach(_4d9.noMatch,function(_4dc){if(_4dc.visible){_4dc.hide();}});}else{this._toggleVisibility(false);}}else{if(_4d7){_4d7.addFeatures(_4d6.graphics);}this._toggleVisibility(true);}if(_4d7){_4d7.moveLatestToFront();_4d7.drawTracks();}if(!_4d5){_4d6._fireUpdateEnd();}}});if(has("extend-esri")){lang.setObject("layers._RenderMode",_4c3,_4c2);}return _4c3;});},"esri/arcgis/utils":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/_base/json","dojo/_base/url","dojo/has","dojo/DeferredList","dojo/dom-construct","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/map","esri/urlUtils","esri/geometry/ScreenPoint","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/symbols/jsonUtils","esri/renderers/jsonUtils","esri/dijit/PopupTemplate","esri/dijit/Popup","esri/tasks/query","esri/tasks/GeometryService","esri/arcgis/csv","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/layers/WebTiledLayer","esri/layers/FeatureLayer","esri/layers/WMSLayer","esri/layers/KMLLayer","esri/layers/GeoRSSLayer","esri/virtualearth/VETiledLayer","esri/layers/TileInfo","esri/layers/DynamicLayerInfo","esri/layers/LayerDrawingOptions","esri/layers/ImageParameters","esri/layers/ImageServiceParameters","esri/layers/RasterFunction","esri/layers/MosaicRule","esri/layers/WMSLayerInfo","dojo/i18n!esri/nls/jsapi"],function(lang,_4dd,_4de,_4df,_4e0,Url,has,_4e1,_4e2,_4e3,_4e4,_4e5,_4e6,_4e7,Map,_4e8,_4e9,_4ea,_4eb,_4ec,_4ed,_4ee,_4ef,_4f0,_4f1,csv,_4f2,_4f3,_4f4,_4f5,_4f6,_4f7,_4f8,_4f9,_4fa,_4fb,_4fc,_4fd,_4fe,_4ff,_500,_501,_502,_503,_504){String.prototype.endsWith=function(str){return (this.match(str+"$")==str);};var _505;function _506(_507){var url=_505.arcgisUrl+"/"+_507.itemId+"/data";var _508=_4e6({url:url,content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:true,_preLookup:true});return _508;};function _509(_50a){var _50b={f:"json"};if(_4e3.id){var _50c=_4e3.id.findCredential(_4e8.urlToObject(_505.arcgisUrl).path);if(_50c){_50b.token=_50c.token;}}var _50d=_4e6({url:_50a,content:_50b,callbackParamName:"callback"},{"disableIdentityLookup":true});return _50d;};function _50e(_50f){if(_50f.itemProperties.layerDefinition){if(_50f.layerDefinition){if(!_50f.layerDefinition.drawingInfo){_50f.layerDefinition.drawingInfo=_50f.itemProperties.layerDefinition.drawingInfo;}if(!_4e5.isDefined(_50f.layerDefinition.definitionExpression)){_50f.layerDefinition.definitionExpression=_50f.itemProperties.layerDefinition.definitionExpression;}if(!_4e5.isDefined(_50f.layerDefinition.minScale)){_50f.layerDefinition.minScale=_50f.itemProperties.layerDefinition.minScale;}if(!_4e5.isDefined(_50f.layerDefinition.maxScale)){_50f.layerDefinition.maxScale=_50f.itemProperties.layerDefinition.maxScale;}}else{_50f.layerDefinition=_50f.itemProperties.layerDefinition;}}if(_50f.itemProperties.popupInfo&&!_50f.popupInfo&&!_50f.disablePopup){_50f.popupInfo=_50f.itemProperties.popupInfo;}};function _510(_511,_512){var _513=new _4df();var _514=_511.itemData;var _515=[];var _516=[];_4dd.forEach(_514.operationalLayers,function(_517){if(_517.itemId&&!_517.type){var _518=_517.url.toLowerCase();if(_518.indexOf("/featureserver")>-1){_516.push(_517);_515.push(_506(_517));}else{if(_518.indexOf("/mapserver")>-1&&_518.indexOf("/mapserver/")===-1&&(!_517.layers||(!_4e5.isDefined(_517.minScale)&&!_4e5.isDefined(_517.maxScale)))){_516.push(_517);_515.push(_506(_517));}else{if(_518.indexOf("/imageserver")>-1&&!_4e5.isDefined(_517.minScale)&&!_4e5.isDefined(_517.maxScale)){_516.push(_517);_515.push(_506(_517));}}}}});if(_514.baseMap&&_514.baseMap.baseMapLayers){_4dd.forEach(_514.baseMap.baseMapLayers,function(_519){if((_519.type==="BingMapsAerial"||_519.type==="BingMapsRoad"||_519.type==="BingMapsHybrid")&&_519.portalUrl){_516.push(_519);_515.push(_509(_519.portalUrl));}else{if(_519.itemId){_516.push(_519);_515.push(_506(_519));}}});}if(_515.length>0){var _51a=new _4e1(_515);_51a.addCallback(function(_51b){_4dd.forEach(_516,function(_51c,i){if((_51c.type==="BingMapsAerial"||_51c.type==="BingMapsRoad"||_51c.type==="BingMapsHybrid")&&_51c.portalUrl){if(_51b[i][1].bingKey){_512.bingMapsKey=_51b[i][1].bingKey;}else{_51c.errors=_51c.errors||[];var _51d={message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. [type:"+_51c.type+"]"};_51c.errors.push(_51d);}return;}var _51e=_51b[i][1];if(_51e){var _51f=_51c.url.toLowerCase();if(_51f.indexOf("/featureserver")>-1&&_51e.layers){_4dd.forEach(_51e.layers,function(_520){if(_51f.endsWith("/featureserver/"+_520.id)){_51c.itemProperties=_520;_50e(_51c);}});}else{if(_51f.indexOf("/mapserver")>-1){if(_51e.layers&&!_51c.layers){_51c.layers=_51e.layers;}if(_4e5.isDefined(_51e.minScale)&&!_4e5.isDefined(_51c.minScale)){_51c.minScale=_51e.minScale;}if(_4e5.isDefined(_51e.maxScale)&&!_4e5.isDefined(_51c.maxScale)){_51c.maxScale=_51e.maxScale;}if(_4e5.isDefined(_51e.refreshInterval)&&!_4e5.isDefined(_51c.refreshInterval)){_51c.refreshInterval=_51e.refreshInterval;}}else{if(_51f.indexOf("/imageserver")>-1){if(_4e5.isDefined(_51e.minScale)&&!_4e5.isDefined(_51c.minScale)){_51c.minScale=_51e.minScale;}if(_4e5.isDefined(_51e.maxScale)&&!_4e5.isDefined(_51c.maxScale)){_51c.maxScale=_51e.maxScale;}if(_4e5.isDefined(_51e.refreshInterval)&&!_4e5.isDefined(_51c.refreshInterval)){_51c.refreshInterval=_51e.refreshInterval;}if(_51e.popupInfo&&!_51c.popupInfo&&!_51c.disablePopup){_51c.popupInfo=_51e.popupInfo;}if(_51e.renderingRule&&!_51c.renderingRule){_51c.renderingRule=_51e.renderingRule;if(_51e.renderingRule.functionName){_51c.renderingRule.rasterFunction=_51e.renderingRule.functionName;}}if(_51e.bandIds&&!_51c.bandIds){_51c.bandIds=_51e.bandIds;}if(_51e.mosaicRule&&!_51c.mosaicRule){_51c.mosaicRule=_51e.mosaicRule;}if(_51e.format&&!_51c.format){_51c.format=_51e.format;}if(_4e5.isDefined(_51e.compressionQuality)&&!_4e5.isDefined(_51c.compressionQuality)){_51c.compressionQuality=_51e.compressionQuality;}}}}}});_513.callback(_511);});}else{_513.callback(_511);}return _513;};function _521(_522,_523){var _524=_522.dynamicLayerInfos||_522.layerInfos;var _525=_523.layers;if(_525&&_524){var _526=[],ids=[],urls=[],_527=[],_528=[],_529=[];_4dd.forEach(_524,function(_52a){var id=_52a.id,i;if(!_52a.subLayerIds&&_4dd.indexOf(_522.visibleLayers,id)!==-1){for(i=0;i<_525.length;i++){var _52b=_525[i];if(_52b.id===id){ids.push(id);_526.push(_52b.popupInfo);urls.push(_52b.layerUrl||"");if(_52b.layerDefinition&&_52b.layerDefinition.definitionExpression){_527.push(_52b.layerDefinition.definitionExpression);}else{_527.push("");}_528.push(esri.isDefined(_52b.minScale)?_52b.minScale:0);_529.push(esri.isDefined(_52b.maxScale)?_52b.maxScale:0);break;}}}});if(_526.length){_522.__popups=_526;_522.__popupIds=ids;_522.__popupUrls=urls;_522.__popupWhereClauses=_527;_522.__popupMinScales=_528;_522.__popupMaxScales=_529;_522.__resourceInfo=_523.resourceInfo;}}};function _52c(url){if(!url){return false;}var _52d=".arcgis.com/";var _52e=(new Url(_505.arcgisUrl)).authority;return (url.indexOf(_52d)!==-1||url.indexOf(_52e)!==-1);};function _52f(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);};function _530(url){if(location.protocol==="https:"&&(_52c(url)||_52f(url))){url=url.replace("http:","https:");}return url;};function _531(_532){var _533=[];if(!_532.displayLevels){_533=_4dd.map(_532.resourceInfo.tileInfo.lods,function(lod){return lod.level;});}var _534=new _4f2(_530(_532.url),{resourceInfo:_532.resourceInfo,opacity:_532.opacity,visible:_532.visibility,displayLevels:_532.displayLevels||_533,id:_532.id,minScale:_532.minScale,maxScale:_532.maxScale,refreshInterval:_532.refreshInterval});_521(_534,_532);return _534;};function _535(_536,_537){if(!_536||!_537||_537.length===0){return [];}var _538=","+_537+",";var _539=[];var _53a="";var k,_53b=",";for(k=0;k<_536.length;k++){if(_536[k].subLayerIds!==null){if(_538.indexOf(","+_536[k].id+",")===-1||_53b.indexOf(","+_536[k].id+",")>-1){_53b+=_536[k].subLayerIds.toString()+",";}}else{if(_538.indexOf(","+_536[k].id+",")>-1&&_53b.indexOf(","+_536[k].id+",")===-1){_539.push(_536[k].id);_53a=",";}}}return _539;};function _53c(_53d){var _53e=new _4ff();_53e.format="png24";if(_53d.resourceInfo&&_53d.resourceInfo.supportedImageFormatTypes&&_53d.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")>-1){_53e.format="png32";}var _53f=new _4f3(_530(_53d.url),{resourceInfo:_53d.resourceInfo,opacity:_53d.opacity,visible:_53d.visibility,id:_53d.id,imageParameters:_53e,minScale:_53d.minScale,maxScale:_53d.maxScale,refreshInterval:_53d.refreshInterval});var _540=_53d.visibleLayers;if(!_53d.visibleLayers){var _541="";var _542=_53f.layerInfos;_4dd.forEach(_542,function(_543){if(_543.defaultVisibility){_541+=(_541.length>0?",":"")+_543.id;}});_540=_541;}if(_53d.layers&&_53d.layers.length>0){var _544=[],_545=[],_546,_547=[],_548;_4dd.forEach(_53d.layers,function(_549){if(_549.layerDefinition&&_549.layerDefinition.definitionExpression){_544[_549.id]=_549.layerDefinition.definitionExpression;}if(_549.layerDefinition&&_549.layerDefinition.source){_546=new _4fd(lang.mixin(_549,_549.layerDefinition));delete _546.layerDefinition;_546.id=_549.id;if(_53d.visibleLayers){var vis=((typeof _53d.visibleLayers)=="string")?_53d.visibleLayers.split(","):_53d.visibleLayers;if(_4dd.indexOf(vis,_549.id)>-1){_546.defaultVisibility=true;}else{_546.defaultVisibility=false;}}_545.push(_546);}if(_549.layerDefinition&&_549.layerDefinition.source&&_549.layerDefinition.drawingInfo){_548=new _4fe(_549.layerDefinition.drawingInfo);_547[_549.id]=_548;}},this);if(_544.length>0){_53f.setLayerDefinitions(_544);}if(_545.length>0){_53f.setDynamicLayerInfos(_545,true);if(_547.length>0){_53f.setLayerDrawingOptions(_547,true);}}else{_540=_535(_53f.layerInfos,_540);_53f.setVisibleLayers(_540);}}else{_540=_535(_53f.layerInfos,_540);_53f.setVisibleLayers(_540);}_521(_53f,_53d);return _53f;};function _54a(_54b,_54c){var _54d=new _500();_54d.bandIds=_54b.bandIds;if(_54b.format!=null){_54d.format=_54b.format;if(_54b.compressionQuality!=null){_54d.compressionQuality=_54b.compressionQuality;}}if(_54b.renderingRule&&_54b.renderingRule.rasterFunction){var _54e=new _501(_54b.renderingRule);_54d.renderingRule=_54e;}if(_54b.mosaicRule){var _54f=new _502(_54b.mosaicRule);_54d.mosaicRule=_54f;}if(_4e5.isDefined(_54b.noData)){_54d.noData=_54b.noData;}if(_4e5.isDefined(_54b.noDataInterpretation)){_54d.noDataInterpretation=_54b.noDataInterpretation;}if(_4e5.isDefined(_54b.interpolation)){_54d.interpolation=_54b.interpolation;}var _550=new _4f4(_530(_54b.url),{resourceInfo:_54b.resourceInfo,opacity:_54b.opacity,visible:_54b.visibility,id:_54b.id,imageServiceParameters:_54d,infoTemplate:_54b.popupInfo&&new _54c(_54b.popupInfo),minScale:_54b.minScale,maxScale:_54b.maxScale,refreshInterval:_54b.refreshInterval});if(_54b.layerDefinition&&_54b.layerDefinition.definitionExpression){_550.setDefinitionExpression(_54b.layerDefinition.definitionExpression,true);}return _550;};function _551(_552,_553,_554){var _555=[102113,102100,3857];var sp1=_554||new _4e7(_553[0].layerObject.fullExtent.spatialReference);var sp2=new _4e7(_552.resourceInfo.fullExtent.spatialReference);if(sp1.wkt==sp2.wkt&&(sp1.wkid==sp2.wkid||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.wkid)||(esri.isDefined(sp2.latestWkid)&&sp1.wkid==sp2.latestWkid)||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.latestWkid))){return true;}else{if(sp1.wkid&&sp2.wkid&&_4dd.some(_555,function(wkid){return wkid===sp2.wkid;})&&_4dd.some(_555,function(wkid){return wkid===sp1.wkid;})){return true;}}return false;};function _556(_557,_558){if(!_558[0].layerObject.tileInfo){return false;}var _559=[];_4dd.forEach(_558,function(_55a){if(_55a.baseMapLayer){if(_55a.layerObject.tileInfo){_559=_559.concat(_4dd.map(_55a.layerObject.tileInfo.lods,function(lod){return lod.scale;}));}}});var _55b=_4dd.some(_557.resourceInfo.tileInfo.lods,function(lod){return _4dd.some(_559,function(_55c){return _55c===lod.scale;});});return _55b;};function _55d(_55e,_55f,_560,_561,_562){var _563,_564=_560._clazz;if(_55e.type==="OpenStreetMap"){_563=new _4f5({id:_55e.id,opacity:_55e.opacity,visible:(_55e.visibility!==null&&_55e.visibility!==undefined)?_55e.visibility:true});}else{if(_55e.type==="WMS"){var _565=[];var _566=[];_4dd.forEach(_55e.layers,function(_567){_566.push(new _503({name:_567.name,title:_567.title,legendURL:_567.legendURL}));_565.push(_567.name);},this);if(_55e.visibleLayers){_565=_55e.visibleLayers;}var _568=new _4ea(_55e.extent[0][0],_55e.extent[0][1],_55e.extent[1][0],_55e.extent[1][1],new _4e7({wkid:4326}));var _569={extent:_568,layerInfos:_566,version:_55e.version,maxWidth:_55e.maxWidth,maxHeight:_55e.maxHeight,getMapURL:_55e.mapUrl,spatialReferences:_55e.spatialReferences,title:_55e.title,copyright:_55e.copyright};_563=new _4f8(_55e.url,{id:_55e.id,visibleLayers:_565,format:"png",transparent:_55e.baseMapLayer?false:true,opacity:_55e.opacity,visible:(_55e.visibility!==null)?_55e.visibility:true,resourceInfo:_569,refreshInterval:_55e.refreshInterval});_563.spatialReference.wkid=_569.spatialReferences[0];}else{if(_55e.type==="KML"){var url=_55e.url;if(_4e3.id){var _56a=_4e3.id.findCredential(_4e8.urlToObject(_505.arcgisUrl).path);if(_56a){var _56b=_505.arcgisUrl.substring(_505.arcgisUrl.indexOf("//")+2,_505.arcgisUrl.indexOf("/",_505.arcgisUrl.indexOf("//")+3));var list=_56b.split(".");var _56c=list[list.length-2]+"."+list[list.length-1];var pos=url.indexOf(_56c);if(pos>-1){url="https://"+_56b+url.substring(pos+_56c.length);}url+="?token="+_56a.token;}}_563=new _4f9(url,{id:_55e.id,visible:(_55e.visibility!==null)?_55e.visibility:true,outSR:_561,refreshInterval:_55e.refreshInterval});_4de.connect(_563,"onLoad",function(){var _56d=function(_56e){_4dd.forEach(_56e,function(_56f){if(_56f.declaredClass==="esri.layers.FeatureLayer"||_56f.declaredClass==="esri.layers.MapImageLayer"){_56f.setOpacity(_55e.opacity);}else{if(_56f.declaredClass==="esri.layers.KMLLayer"){if(_56f.loaded){_56d(_56f.getLayers());}else{_4de.connect(_56f,"onLoad",lang.hitch(this,function(lyr){_56d(lyr.getLayers());}));}}}});};if(_55e.opacity||_55e.opacity===0){_56d(_563.getLayers());}if(_55e.visibleFolders){_4dd.forEach(_563.folders,function(_570){if(_4dd.indexOf(_55e.visibleFolders,_570.id)>-1){_563.setFolderVisibility(_570,true);}else{_563.setFolderVisibility(_570,false);}},this);}});}else{if(_55e.type==="WebTiledLayer"){_563=new _4f6(_55e.templateUrl,{id:_55e.id,visible:(_55e.visibility!==null)?_55e.visibility:true,opacity:_55e.opacity,copyright:_55e.copyright,fullExtent:_55e.fullExtent&&new _4ea(_55e.fullExtent),initialExtent:_55e.fullExtent&&new _4ea(_55e.fullExtent),subDomains:_55e.subDomains,tileInfo:_55e.tileInfo?new _4fc(_55e.tileInfo):null,refreshInterval:_55e.refreshInterval});_4de.connect(_563,"onLoad",function(){if(_4e5.isDefined(_55e.minScale)||_4e5.isDefined(_55e.maxScale)){_563.setScaleRange(_55e.minScale,_55e.maxScale);}});}else{if(_55e.type==="GeoRSS"){_563=new _4fa(_55e.url,{id:_55e.id,opacity:_55e.opacity,outSpatialReference:_561,refreshInterval:_55e.refreshInterval});_4de.connect(_563,"onLoad",function(){if(_55e.visibility===false){_563.hide();}var _571=_563.getFeatureLayers();_4dd.forEach(_571,function(_572){if(_55e.pointSymbol&&_572.geometryType==="esriGeometryPoint"){_572.renderer.symbol=_4ec.fromJson(_55e.pointSymbol);}else{if(_55e.lineSymbol&&_572.geometryType==="esriGeometryPolyline"){_572.renderer.symbol=_4ec.fromJson(_55e.lineSymbol);}else{if(_55e.polygonSymbol&&_572.geometryType==="esriGeometryPolygon"){_572.renderer.symbol=_4ec.fromJson(_55e.polygonSymbol);}}}if(_4e5.isDefined(_55e.minScale)||_4e5.isDefined(_55e.maxScale)){_572.setScaleRange(_55e.minScale,_55e.maxScale);}});});}else{if(_55e.type=="CSV"&&_55e.url){_563=new _4f7(_55e.featureCollection,{infoTemplate:new _4ee(_55e.popupInfo?_55e.popupInfo:csv.generateDefaultPopupInfo(_55e.featureCollection)),id:_55e.id?_55e.id:null,outFields:["*"],visible:(_55e.visibility!==null)?_55e.visibility:true,opacity:_55e.opacity,autoGeneralize:true});}else{if(_55e.layerDefinition&&!_55e.url){var _573=_4e0.fromJson(_4e0.toJson(_55e));delete _573.id;delete _573.opacity;delete _573.visibility;_563=new _4f7(_573,{id:_55e.id,opacity:_55e.opacity,visible:_55e.visibility,outFields:["*"],infoTemplate:_573.popupInfo&&new _564(_573.popupInfo),autoGeneralize:true});}else{if(_55e.type==="BingMapsAerial"||_55e.type==="BingMapsRoad"||_55e.type==="BingMapsHybrid"){if(_560.bingMapsKey){var _574=_4fb.MAP_STYLE_AERIAL_WITH_LABELS;if(_55e.type==="BingMapsAerial"){_574=_4fb.MAP_STYLE_AERIAL;}else{if(_55e.type==="BingMapsRoad"){_574=_4fb.MAP_STYLE_ROAD;}}_563=new _4fb({bingMapsKey:_560.bingMapsKey,mapStyle:_574,opacity:_55e.opacity,id:_55e.id});}else{_55e.errors=_55e.errors||[];var _575={message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+_55e.type+"]"};_55e.errors.push(_575);}}else{if(_55e.resourceInfo&&_55e.resourceInfo.mapName){if(_55e.resourceInfo.singleFusedMapCache===true&&(_55e.baseMapLayer||(_551(_55e,_55f,_561)&&_556(_55e,_562)))){_563=_531(_55e);}else{_563=_53c(_55e);}}else{if(_55e.resourceInfo&&_55e.resourceInfo.pixelSizeX){if(_55e.resourceInfo.singleFusedMapCache===true&&(_55e.baseMapLayer||(_551(_55e,_55f,_561)&&_556(_55e,_562)))){_563=_531(_55e);}else{_563=_54a(_55e,_564);}}else{if(_55e.resourceInfo&&_55e.resourceInfo.type==="Feature Layer"){_563=new _4f7(_530(_55e.url),{resourceInfo:_55e.resourceInfo,opacity:_55e.opacity,visible:_55e.visibility,id:_55e.id,mode:_4e5.isDefined(_55e.mode)?_55e.mode:_4f7.MODE_ONDEMAND,outFields:["*"],infoTemplate:_55e.popupInfo&&new _564(_55e.popupInfo),autoGeneralize:true,refreshInterval:_55e.refreshInterval});if(_55e.layerDefinition){if(_55e.layerDefinition.drawingInfo&&_55e.layerDefinition.drawingInfo.renderer){var _576=_4ed.fromJson(_55e.layerDefinition.drawingInfo.renderer);_576.isMaxInclusive=true;_563.setRenderer(_576);}if(_55e.layerDefinition.definitionExpression){_563.setDefinitionExpression(_55e.layerDefinition.definitionExpression);}if(_4e5.isDefined(_55e.layerDefinition.minScale)){_563.setMinScale(_55e.layerDefinition.minScale);}if(_4e5.isDefined(_55e.layerDefinition.maxScale)){_563.setMaxScale(_55e.layerDefinition.maxScale);}}}}}}}}}}}}}if(_563){_563.arcgisProps={title:_55e.title};if(_55e.baseMapLayer){if(_55e.isReference){_563._basemapGalleryLayerType="reference";}else{_563._basemapGalleryLayerType="basemap";}}}return _563;};function _577(_578,_579,_57a,_57b){_4dd.forEach(_578,function(_57c,_57d){if(_57c.url&&!_57c.type){if(_57d===0||_578[0].layerObject){_57c.layerObject=_55d(_57c,_578,_579,_57a,_57b);}}else{if(_57c.url&&_57c.type=="CSV"){_57c.layerObject=_55d(_57c,_578,_579,_57a,_57b);}else{_57c.layerObject=_55d(_57c,_578,_579,_57a,_57b);}}});var _57e=_4dd.filter(_578,function(lyr){return !lyr.isReference;});var _57f=_4dd.filter(_578,function(lyr){return !!lyr.isReference;});_578=_57e.concat(_57f);return _578;};function _580(_581){var _582=null;var _583=_581[0];if(_583.url&&!_583.type){if(_583.resourceInfo.spatialReference){_582=new _4e7();if(_583.resourceInfo.spatialReference.wkid){_582.wkid=_583.resourceInfo.spatialReference.wkid;}if(_583.resourceInfo.spatialReference.wkt){_582.wkt=_583.resourceInfo.spatialReference.wkt;}}}else{if(_583.type.indexOf("BingMaps")>-1||_583.type=="OpenStreetMap"){_582=new _4e7({wkid:102100});}else{if(_583.type=="WMS"){_582=new _4e7({wkid:_583.spatialReferences[0]});}}}return _582;};function _584(_585,_586,_587,_588,_589,_58a,_58b){_4dd.forEach(_586,function(_58c,_58d){if(_58c.url&&!_58c.type){_58c.resourceInfo=_585[_58c.deferredsPos][1];delete _58c.deferredsPos;}else{if(_58c.url&&_58c.type=="CSV"){_58c.featureCollection=_588[_58c.deferredsPos].results[0];delete _58c.deferredsPos;}}});_58a=_58a||_580(_586);var _58e=[];_4dd.forEach(_586,function(_58f){if(_58f.url&&_58f.type=="CSV"){_58f.deferredsPos=_58e.length;_58e.push(csv.projectFeatureCollection(_58f.featureCollection,_58a));}});if(_58e.length==0){_586=_577(_586,_587,_58a,_58b);_589.callback(_586);}else{var _590=new _4e1(_58e);_590.addCallback(function(){_4dd.forEach(_586,function(_591){if(_591.url&&_591.type=="CSV"){_591.featureCollection=_58e[_591.deferredsPos].results[0];delete _591.deferredsPos;}});_586=_577(_586,_587,_58a,_58b);_589.callback(_586);});}};function _592(url,_593){var url2=_530(url);return _4e6({url:url2,content:{f:"json"},callbackParamName:"callback",error:function(_594,io){if(_594.message){_594.message+=" [url:"+url2+"]";}else{_594.message="[url:"+url2+"]";}_593.push(_594);_4e4.defaults.io.errorHandler(_594,io);}});};function _595(_596,_597,_598,_599){var _59a=[];var _59b=[];var _59c=[];var _59d=new _4df();_4dd.forEach(_596.operationalLayers,function(_59e,_59f){if(_59e.featureCollection){_4dd.forEach(_59e.featureCollection.layers,function(_5a0,idx){var _5a1=true;if(_59e.visibleLayers){if(_4dd.indexOf(_59e.visibleLayers,idx)==-1){_5a1=false;}}_5a0.visibility=(_59e.visibility&&_5a1);_5a0.opacity=_59e.opacity;_5a0.id=(_59e.id||("operational"+_59f))+"_"+idx;_59c.push(_5a0);},this);}else{_59c.push(_59e);}});_4dd.forEach(_596.baseMap.baseMapLayers,function(_5a2,_5a3){_5a2.baseMapLayer=true;_5a2.id=_5a2.id||("base"+_5a3);_59a.push(_5a2);});_4dd.forEach(_59c,function(_5a4,_5a5){_5a4.id=_5a4.id||("operational"+_5a5);_59a.push(_5a4);});_4dd.forEach(_59a,function(_5a6){if(_5a6.url&&!_5a6.type){_5a6.deferredsPos=_59b.length;_5a6.errors=[];_59b.push(_592(_5a6.url,_5a6.errors));}else{if(_5a6.url&&_5a6.type=="CSV"){_5a6.deferredsPos=_59b.length;_59b.push(csv.buildCSVFeatureCollection(_5a6));}}});if(_59b.length==0){_598=_598||_580(_59a);_59a=_577(_59a,_597,_598,_599);_59d.callback(_59a);}else{var _5a7=new _4e1(_59b);_5a7.addCallback(function(_5a8){_584(_5a8,_59a,_597,_59b,_59d,_598,_599);});}return _59d;};function _5a9(_5aa,_5ab){if(_5ab.version<=10.1&&_5aa){var i,id=parseInt(_5ab.url.substring(_5ab.url.lastIndexOf("/")+1,_5ab.url.length));for(i=_5aa.length-1;i>=0;i--){if(_5aa[i].id==id){if(_5ab.minScale==0&&_5aa[i].minScale>0){_5ab.minScale=_5aa[i].minScale;}else{if(_5ab.minScale>0&&_5aa[i].minScale==0){_5ab.minScale=_5ab.minScale;}else{if(_5ab.minScale>0&&_5aa[i].minScale>0){_5ab.minScale=Math.min(_5ab.minScale,_5aa[i].minScale);}}}_5ab.maxScale=Math.max(_5ab.maxScale||0,_5aa[i].maxScale||0);if(_5aa[i].parentLayerId>-1){id=_5aa[i].parentLayerId;}else{break;}}}}};function _5ac(_5ad,_5ae,_5af,map){var url=_5ad.url;var _5b0=_5ad.__popups;var ids=_5ad.__popupIds;var urls=_5ad.__popupUrls;var _5b1=_5ad.__popupWhereClauses;var _5b2=_5ad.__popupMinScales;var _5b3=_5ad.__popupMaxScales;var _5b4=_5ad.__resourceInfo;var _5b5=[];_4dd.forEach(_5b0,function(_5b6,_5b7){if(!_5b6){return;}var _5b8,_5b9=[];_4dd.forEach(_5b6.fieldInfos,function(item){if(item.fieldName.toLowerCase()!=="shape"){_5b9.push(item.fieldName);}});if(_5ad.dynamicLayerInfos&&_5ad.dynamicLayerInfos.length>0){var _5ba=_4dd.filter(_5ad.dynamicLayerInfos,function(item){return ids[_5b7]==item.id;})[0].source;_5b8=new _4f7(url+"/dynamicLayer",{id:_5ad.id+"_"+ids[_5b7],source:_5ba,outFields:_5b9,mode:_4f7.MODE_SELECTION,infoTemplate:_5b6&&new _5af(_5b6),drawMode:false,visible:_5ad.visible,autoGeneralize:true});if(_5b8.loaded){if(_5b1[_5b7].length>0){_5b8.setDefinitionExpression(_5b1[_5b7]);}if(esri.isDefined(_5b2[_5b7])&&esri.isDefined(_5b3[_5b7])){_5b8.setScaleRange(_5b2[_5b7],_5b3[_5b7]);}}else{_4de.connect(_5b8,"onLoad",function(_5bb){if(_5b1[_5b7].length>0){_5b8.setDefinitionExpression(_5b1[_5b7]);}if(esri.isDefined(_5b2[_5b7])&&esri.isDefined(_5b3[_5b7])){_5b8.setScaleRange(_5b2[_5b7],_5b3[_5b7]);}});}}else{var i,_5bc=null;if(_5ae){for(i=0;i<_5ae.length;i++){if(_5ae[i].id===ids[_5b7]){_5bc=_5ae[i];break;}}}var _5bd=url+"/"+ids[_5b7];if(urls[_5b7].length){_5bd=urls[_5b7];}_5b8=new _4f7(_530(_5bd),{id:_5ad.id+"_"+ids[_5b7],outFields:_5b9,mode:_4f7.MODE_SELECTION,infoTemplate:_5b6&&new _5af(_5b6),drawMode:false,visible:_5ad.visible,resourceInfo:_5bc,autoGeneralize:true});if(_5b8.loaded){_5b8.setScaleRange(_5ad.minScale,_5ad.maxScale);if(_5b1[_5b7].length>0){_5b8.setDefinitionExpression(_5b1[_5b7]);}}else{_4de.connect(_5b8,"onLoad",function(_5be){_5be.setScaleRange(_5ad.minScale,_5ad.maxScale);if(_5b1[_5b7].length>0){_5b8.setDefinitionExpression(_5b1[_5b7]);}});}if(_5b8.loaded){_5a9(_5b4.layers,_5b8);}else{_4de.connect(_5b8,"onLoad",function(_5bf){_5a9(_5b4.layers,_5bf);});}}_5b5.push(_5b8);});if(_5b5.length>0){var _5c0=function(_5c1,_5c2){_4dd.forEach(_5c1,function(_5c3){if(_5c2){_5c3.show();}else{_5c3.hide();}});};_4de.connect(_5ad,"onVisibilityChange",lang.hitch(this,_5c0,_5b5));var _5c4=function(_5c5,_5c6,_5c7){if(_5c5.id===_5c7.id){_4dd.forEach(_5c6,function(_5c8){map.removeLayer(_5c8);});}};_4de.connect(map,"onLayerRemove",lang.hitch(this,_5c4,_5ad,_5b5));}delete _5ad.__popups;delete _5ad.__popupIds;delete _5ad.__popupUrls;delete _5ad.__popupWhereClauses;delete _5ad.__popupMinScales;delete _5ad.__popupMaxScales;delete _5ad.__resourceInfo;return _5b5;};function _5c9(_5ca){return _4e6({url:_530(_5ca.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}});};function _5cb(_5cc,map,_5cd){var _5ce=[];_4dd.forEach(_5cc,function(_5cf){var _5d0=_5cf.__popups;if(_5d0&&_5d0.length>1&&_5cf.version>=10){_5cf.__deferredsPos=_5ce.length;_5ce.push(_5c9(_5cf));}});var _5d1=[];if(_5ce.length>0){var _5d2=new _4e1(_5ce);_5d2.addCallback(function(_5d3){_4dd.forEach(_5cc,function(_5d4){if(_5d4.__popups&&_5d4.__popups.length>0){if(_5d4.__deferredsPos||_5d4.__deferredsPos===0){var _5d5=_5d3[_5d4.__deferredsPos][1];_5d1=_5d1.concat(_5ac(_5d4,_5d5.layers,_5cd,map));delete _5d4.__deferredsPos;}else{_5d1=_5d1.concat(_5ac(_5d4,null,_5cd,map));}}});map.addLayers(_5d1);});}else{_4dd.forEach(_5cc,function(_5d6){if(_5d6.__popups&&_5d6.__popups.length>0){_5d1=_5d1.concat(_5ac(_5d6,null,_5cd,map));}});map.addLayers(_5d1);}};function _5d7(_5d8){_4dd.forEach(_5d8,function(_5d9){var _5da=_5d9.layer;if(_5da.toJson){var json=_5da.toJson();if(json.featureSet&&_5da.name.indexOf("Text")>-1){_4dd.forEach(json.featureSet.features,function(_5db,idx){if(_5db.attributes.TEXT){var _5dc=_5da.graphics[idx];_5dc.symbol.setText(_5db.attributes.TEXT);if(_5db.symbol.horizontalAlignment){_5dc.symbol.align=_5db.symbol.horizontalAlignment;}_5dc.setSymbol(_5dc.symbol);_5dc.setAttributes(_5db.attributes);}},this);}}});};function _5dd(_5de){var _5df=6;_4dd.forEach(_5de,function(_5e0){var _5e1=_5e0.renderer;if(_5e1){if(_5e1.declaredClass==="esri.renderer.SimpleRenderer"){var _5e2=_5e1.symbol;if(_5e2&&_5e2.xoffset){_5df=Math.max(_5df,Math.abs(_5e2.xoffset));}if(_5e2&&_5e2.yoffset){_5df=Math.max(_5df,Math.abs(_5e2.yoffset));}}else{if(_5e1.declaredClass==="esri.renderer.UniqueValueRenderer"||_5e1.declaredClass==="esri.renderer.ClassBreaksRenderer"){_4dd.forEach(_5e1.infos,function(info){var _5e3=info.symbol;if(_5e3&&_5e3.xoffset){_5df=Math.max(_5df,Math.abs(_5e3.xoffset));}if(_5e3&&_5e3.yoffset){_5df=Math.max(_5df,Math.abs(_5e3.yoffset));}});}}}});return _5df;};function _5e4(evt){var map=this,_5e5=map.infoWindow,_5e6=evt.graphic;if(!map.loaded){return;}_5e5.hide();_5e5.clearFeatures();var _5e7=[];_4dd.forEach(map.graphicsLayerIds,function(_5e8){var _5e9=map.getLayer(_5e8);if(_5e9&&_5e9.declaredClass.indexOf("FeatureLayer")!==-1&&_5e9.loaded&&_5e9.visible){_5e9.clearSelection();if(_5e9.infoTemplate&&!_5e9.suspended){_5e7.push(_5e9);}}});_4dd.forEach(map.layerIds,function(_5ea){var _5eb=map.getLayer(_5ea);if(_5eb&&_5eb.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1&&_5eb.loaded&&_5eb.visible&&_5eb.infoTemplate){_5e7.push(_5eb);}});_5e6=(_5e6&&_5e6.getInfoTemplate())?_5e6:null;if(!_5e7.length&&!_5e6){return;}var _5ec=_5dd(_5e7);var _5ed=evt.screenPoint,_5ee=map.toMap(new _4e9(_5ed.x-_5ec,_5ed.y+_5ec)),_5ef=map.toMap(new _4e9(_5ed.x+_5ec,_5ed.y-_5ec)),_5f0=new _4ea(_5ee.x,_5ee.y,_5ef.x,_5ef.y,map.spatialReference);var _5f1=new _4f0();_5f1.geometry=_5f0;_5f1.timeExtent=map.timeExtent;var _5f2=true;var _5f3=_4dd.map(_5e7,function(_5f4){var dfd;if(_5f4.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1){_5f2=false;var _5f5={};_5f5.rasterAttributeTableFieldPrefix="Raster.";_5f5.returnDomainValues=true;dfd=_5f4.queryVisibleRasters(_5f1,_5f5);dfd.addCallback(function(){var _5f6=_5f4.getVisibleRasters();return _5f6;});}else{dfd=_5f4.selectFeatures(_5f1);dfd.addCallback(function(){var _5f7=_5f4.getSelectedFeatures();return _5f7;});}return dfd;});if(_5e6){var dfd=new _4df();dfd.callback([_5e6]);_5f3.splice(0,0,dfd);}var _5f8=_4dd.some(_5f3,function(dfd){return dfd.fired===-1;});if(!_5f8){var _5f9=_5e6?1:0;_4dd.forEach(_5e7,function(_5fa){if(_5fa.declaredClass.indexOf("ArcGISImageServiceLayer")!==-1){_5f9=_5f9+_5fa.getVisibleRasters().length;}else{_5f9=_5f9+_5fa.getSelectedFeatures().length;}});if(!_5f9){return;}}_5e5.setFeatures(_5f3);_5e5.show(evt.mapPoint,{closestFirst:_5f2});};function _5fb(_5fc,_5fd){var _5fe=(_5fd.mapOptions||{}),_5ff;if(!_5fe.infoWindow){_5ff=new _4ef(null,_4e2.create("div"));_5fe.infoWindow=_5ff;}if(!_4e5.isDefined(_5fe.showInfoWindowOnClick)){_5fe.showInfoWindowOnClick=false;}var map=new Map(_5fc,_5fe);_4de.connect(map,"onLayersAddResult",_5d7);return map;};function _600(_601,_602,_603,_604,_605,_606){var map,_607,errs;if(_604.map){map=_604.map;_607=_604.clickEventHandle;errs=_604.errors;}else{map=_5fb(_604,_605);if(!(_605.ignorePopups||_605.disableClickBehavior)){_607=_4de.connect(map,"onClick",_5e4);}}if(_605.ignorePopups){_4dd.forEach(_601,function(_608){delete _608.infoTemplate;});}map.addLayers(_601);if(!_605.ignorePopups){_5cb(_601,map,_605._clazz);}var _609=errs||[];_4dd.forEach(_602,function(_60a){_609=_609.concat(_60a.errors);},this);if(!map.loaded){_4de.connect(map,"onLoad",function(){_606.callback({map:map,itemInfo:_603,errors:_609,clickEventHandle:_607,clickEventListener:_5e4});});}else{_606.callback({map:map,itemInfo:_603,errors:_609,clickEventHandle:_607,clickEventListener:_5e4});}};function _60b(_60c,_60d,_60e,_60f,_610){try{var _611=_60e.mapOptions||{};_60e.mapOptions=_611;var card=_60c.item;var _612=[];_4dd.forEach(_610,function(_613){if(lang.isArray(_613.layerObject)){_4dd.forEach(_613.layerObject,function(l){_612.push(l);});}else{_612.push(_613.layerObject);}});if(!_612[0]){var msg="";if(_610[0].errors&&_610[0].errors.length){msg=" ("+_610[0].errors[0].message+")";}_60f.errback(new Error(_504.arcgis.utils.baseLayerError+msg));return;}_612=_4dd.filter(_612,_4e5.isDefined);if(card){if(card.extent&&card.extent.length){if(!_611.extent){var _614=new _4ea(card.extent[0][0],card.extent[0][1],card.extent[1][0],card.extent[1][1],new _4e7({wkid:4326}));var _615=_612[0].spatialReference;if(_615.wkid===4326){_611.extent=_614;_600(_612,_610,_60c,_60d,_60e,_60f);}else{if(_615.wkid===102100||_615.wkid===102113||_615.wkid===3857){_614.xmin=Math.max(_614.xmin,-180);_614.xmax=Math.min(_614.xmax,180);_614.ymin=Math.max(_614.ymin,-89.99);_614.ymax=Math.min(_614.ymax,89.99);_611.extent=_4eb.geographicToWebMercator(_614);_600(_612,_610,_60c,_60d,_60e,_60f);}else{if(_60e.geometryServiceURL||_4e4.defaults.geometryService){var gs;if(_60e.geometryServiceURL){gs=new _4f1(_60e.geometryServiceURL);}else{gs=_4e4.defaults.geometryService;}gs.project([_614],_615,function(_616){var _617=_616[0];_611.extent=_611.extent||_617;_600(_612,_610,_60c,_60d,_60e,_60f);});}else{_60f.errback(new Error(_504.arcgis.utils.geometryServiceError));}}}}else{_600(_612,_610,_60c,_60d,_60e,_60f);}}else{_600(_612,_610,_60c,_60d,_60e,_60f);}}else{_600(_612,_610,_60c,_60d,_60e,_60f);}}catch(err){_60f.errback(err);}};function _618(_619){var _61a=[];var _61b=_619.baseMap.baseMapLayers.concat(_619.operationalLayers);_4dd.forEach(_61b,function(_61c,_61d){var _61e={};if(_61c.featureCollection&&_61c.type!=="CSV"){if(_61c.featureCollection.showLegend===true){_4dd.forEach(_61c.featureCollection.layers,function(_61f){if(_61f.showLegend!==false){_61e={"layer":_61f.layerObject,"title":_61c.title,"defaultSymbol":(_61f.renderer&&_61f.renderer.defaultSymbol&&_61f.renderer.defaultLabel)?true:false};if(_61c.featureCollection.layers.length>1){_61e.title+=" - "+_61f.layerDefinition.name;}_61a.push(_61e);}});}}else{if((_61c.baseMapLayer&&_61c.showLegend===true&&_61c.layerObject)||(!_61c.baseMapLayer&&_61c.showLegend!==false&&_61c.layerObject)){var rend=_61c.layerObject.renderer;var _620=(!rend||(rend&&rend.defaultSymbol&&rend.defaultLabel))?true:false;if((_61c.layerObject.version<10.1&&(_61c.layerObject instanceof _4f3||_61c.layerObject instanceof _4f2))||(_61c.layerObject instanceof esri.layers.ArcGISImageServiceLayer)){_620=true;}_61e={"layer":_61c.layerObject,"title":_61c.title,"defaultSymbol":_620};if(_61c.layers){var _621=_4dd.map(_4dd.filter(_61c.layers,function(lyr){return (lyr.showLegend===false);}),function(lyr){return lyr.id;});if(_621.length){_61e.hideLayers=_621;}}_61a.push(_61e);}}});return _61a;};function _622(_623,_624,_625,_626){if(!_626.itemData.operationalLayers||_626.itemData.operationalLayers.length===0){_510(_626,_624).addCallback(function(_627){_595(_627.itemData,_624).addCallback(lang.hitch(null,_60b,_627,_623,_624,_625));});}else{var _628=new _4df(),_629=_626.itemData.baseMap.baseMapLayers.slice(0),_62a=_4dd.filter(_626.itemData.baseMap.baseMapLayers,function(item){return !item.isReference;}),_62b={item:_626.item,itemData:{baseMap:{baseMapLayers:_62a}}};_626.itemData.baseMap.baseMapLayers=_4dd.filter(_626.itemData.baseMap.baseMapLayers,function(item){return item.isReference;});_510(_62b,_624).addCallback(function(_62c){_595(_62c.itemData,_624).addCallback(lang.hitch(null,_60b,_62c,_623,_624,_628));});_628.then(function(_62d){_510(_626,_624).addCallback(function(_62e){_595(_62e.itemData,_624,_62d.map.spatialReference,_62a).addCallback(function(_62f){_62e.itemData.baseMap.baseMapLayers=_629;_60b(_62e,_62d,_624,_625,_62f);});});},lang.hitch(_625,_625.errback));}};function _630(_631){if(_505._arcgisUrl&&_505._arcgisUrl.length>0){_505.arcgisUrl=_505._arcgisUrl;}var url=_505.arcgisUrl+"/"+_631;var _632={},_633=new _4df();_4e6({url:url,content:{f:"json"},callbackParamName:"callback",load:function(_634){_632.item=_634;_4e6({url:url+"/data",content:{f:"json"},callbackParamName:"callback",load:function(_635){_632.itemData=_635;_633.callback(_632);},error:function(_636){_633.errback(_636);}});},error:function(_637){_633.errback(_637);}});return _633;};function _638(arg1,_639,_63a){var _63b=new _4df();_63a=_63a||{};var _63c=_63a.infoTemplateClass;_63a._clazz=(_63c&&(lang.isObject(_63c)?_63c:lang.getObject(_63c)))||_4ee;if(lang.isString(arg1)){_630(arg1).addCallback(lang.hitch(null,_622,_639,_63a,_63b)).addErrback(lang.hitch(_63b,_63b.errback));}else{_622(_639,_63a,_63b,arg1);}return _63b;};function _63d(_63e){if(_63e&&_63e.itemInfo&&_63e.itemInfo.itemData){return _618(_63e.itemInfo.itemData);}else{return [];}};_505={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:_630,createMap:_638,getLegendLayers:_63d,_arcgisUrl:null,_getItemProps:_510,_getItemData:_506,_getBingKey:_509,_processFSItemProperties:_50e,_getLayers:_595,_preBuildLayerObjects:_584,_buildLayerObjects:_577,_preCreateMap:_60b,_getMapSR:_580,_createMap:_600,_addSelectionLayers:_5cb,_createSelectionFeatureLayers:_5ac,_getServiceInfo:_592,_getLayersInfo:_5c9,_initLayer:_55d,_loadAsCached:_531,_loadAsDynamic:_53c,_processPopups:_521,_onLayersAddResult:_5d7,_sameSpatialReferenceAsBasemap:_551,_sameTilingSchemeAsBasemap:_556,_showPopup:_5e4,_calculateClickTolerance:_5dd,_getVisibleFeatureLayers:_535,_updateLayerScaleInfo:_5a9,_checkUrl:_530,_isHostedService:_52c,_isAgolService:_52f,_getLegendLayers:_618};lang.setObject("arcgis.utils",_505,_4e3);return _505;});},"esri/layers/GeoRSSLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/config","esri/request","esri/layers/ServiceGeneratedFeatureCollection"],function(_63f,lang,_640,has,_641,_642,_643,_644){var _645=_63f([_644],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(url,_646){if(_642.defaults.geoRSSService){this.serviceUrl=_642.defaults.geoRSSService;}this._createLayer();},parse:function(){this._io=_643({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?true:undefined,outSR:this._outSR?_640.toJson(this._outSR.toJson()):undefined},callbackParamName:"callback"});return this._io;},_initLayer:function(json){this.inherited(arguments);if(!this.loaded){this.loaded=true;this.onLoad(this);}}});if(has("extend-esri")){lang.setObject("layers.GeoRSSLayer",_645,_641);}return _645;});},"esri/layers/FeatureTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/graphic"],function(_647,lang,has,_648,_649,_64a){var _64b=_647(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(json){if(json&&lang.isObject(json)){this.name=json.name;this.description=json.description;this.drawingTool=json.drawingTool;var _64c=json.prototype;this.prototype=new _64a(_64c.geometry,null,_64c.attributes);}},toJson:function(){return _649.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()});}});lang.mixin(_64b,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});if(has("extend-esri")){lang.setObject("layers.FeatureTemplate",_64b,_648);}return _64b;});}}});define("esriviewer/mapping",[],1);