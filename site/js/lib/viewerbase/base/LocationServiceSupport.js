//>>built
define("esriviewer/base/LocationServiceSupport",["dojo/_base/declare","dojo/topic","dojo/_base/lang","esri/tasks/locator"],function(_1,_2,_3,_4){return _1([],{constructor:function(){this.locatorLookup={};},_initListeners:function(){_2.subscribe(VIEWER_GLOBALS.EVENTS.LOCATOR.SINGLE_LINE_ADDRESS_TO_LOCATION,_3.hitch(this,this._handleSingleAddressLineAddressToLocations));_2.subscribe(VIEWER_GLOBALS.EVENTS.LOCATOR.REVERSE_GEOCODE,_3.hitch(this,this.handleReverseGeocode));_2.subscribe(VIEWER_GLOBALS.EVENTS.LOCATOR.ADD_LOCATOR,_3.hitch(this,this.handleAddLocatorRequest));_2.subscribe(VIEWER_GLOBALS.EVENTS.LOCATOR.REMOVE_LOCATOR,_3.hitch(this,this.handleRemoveLocatorRequest));_2.subscribe(VIEWER_GLOBALS.EVENTS.LOCATOR.GET_LOCATORS,_3.hitch(this,this.handleGetLocators));},handleGetLocators:function(_5){if(_5!=null&&_3.isFunction(_5)){var _6=[];for(var _7 in this.locatorLookup){_6.push(this.locatorLookup[_7]);}_5(_6);}},handleReverseGeocode:function(_8,_9,_a,_b){if(_a!=null&&_3.isFunction(_a)){var _c;var _d=null;for(var _e in this.locatorLookup){_c=this.locatorLookup[_e];if(_c!=null&&_c.locator!=null&&_3.isFunction(_c.locator.locationToAddress)){_d=_c.locator;break;}}if(_d==null){if(_b!=null&&_3.isFunction(_b)){_b("Reverse Geocode Not Supported");return;}}if(_9==null){_9=VIEWER_GLOBALS.DEFAULT_REVERSE_GEOCODE_DISTANCE;}_d.locationToAddress(_8,_9,_a,_b);}},_handleSingleAddressLineAddressToLocations:function(_f,_10,_11){this.singleLineAddressToLocations(_f,_10,_11);},handleRemoveLocatorRequest:function(_12){if(this.locatorLookup[_12]!=null){delete this.locatorLookup[_12];_2.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.LOCATOR_REMOVED,_12);}},handleAddLocatorRequest:function(_13,_14,_15){this.addLocator(_13,null,function(id){if(id!=null){if(_14!=null&&_3.isFunction(_14)){_14(id,_13);}}else{if(_15!=null&&_3.isFunction(_15)){_15("Locator Exists");}}});},addLocator:function(_16,_17,_18){var id=_16.toLowerCase();if(this.locatorLookup[id]==null){var _19=new _4(_16);var _1a={locator:_19,label:(_17!=null&&_17!="")?_17:REG_EXP_UTILS.getServiceNameFromUrl(_19.url)};var _1b=null;_2.publish(VIEWER_GLOBALS.EVENTS.MAP.EXTENT.GET_EXTENT,function(ext){_1b=ext;});if(_1b&&_1b.spatialReference){_19.setOutSpatialReference(_1b.spatialReference);}var _1c=_18;var _1d=this.locatorLookup;VIEWER_UTILS.getServiceDescription(_16,function(_1e){if(_1e!=null&&_3.isObject(_1e)){if(_1e.singleLineAddressField!=null&&_3.isObject(_1e.singleLineAddressField)&&_1e.singleLineAddressField.name!=null&&_1e.singleLineAddressField.name!=""){_19.serviceDescription=_1e;_1d[id]=_1a;_2.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.LOCATOR_ADDED,_1a);if(_1c!=null&&_3.isFunction(_1c)){_1c(id);}}else{_2.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Locator does not support single line address.");}}});}else{VIEWER_UTILS.log("Locator Already Exists: "+_16,VIEWER_GLOBALS.LOG_TYPE.ERROR);_2.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Locator already exists.");}},singleLineAddressToLocations:function(_1f,_20,_21){if(_21!=null){var _22={};_22[_21.serviceDescription.singleLineAddressField.name]=VIEWER_UTILS.trim(_1f);var _23=_3.hitch(this,this._handleLocatorResponse,_21.url.toLowerCase(),_20);var _24=_3.hitch(this,this._handleLocatorError,_21.url.toLowerCase(),_20);_21.addressToLocations(_22,["*"],_23,_24);}},_handleLocatorResponse:function(_25,_26,_27){_2.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.LOCATOR_REQUEST_COMPLETE,{addressCandidates:_27,locatorId:_25,requestId:_26});},_handleLocatorError:function(_28,_29,_2a){_2.publish(VIEWER_GLOBALS.EVENTS.LOCATOR.LOCATOR_REQUEST_ERROR,{error:_2a,locatorId:_28,requestId:_29});VIEWER_UTILS.log("Could not perform locate",VIEWER_GLOBALS.LOG_TYPE.ERROR);_2.publish(VIEWER_GLOBALS.EVENTS.MESSAGING.SHOW,"Could not perform locate");}});});